/*! For license information please see LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{106:function(e,t,r){"use strict";t.a=function(e,t){return t=t||{},new Promise((function(r,o){var s=new XMLHttpRequest,n=[],u=[],i={},a=function(){return{ok:2==(s.status/100|0),statusText:s.statusText,status:s.status,url:s.responseURL,text:function(){return Promise.resolve(s.responseText)},json:function(){return Promise.resolve(JSON.parse(s.responseText))},blob:function(){return Promise.resolve(new Blob([s.response]))},clone:a,headers:{keys:function(){return n},entries:function(){return u},get:function(e){return i[e.toLowerCase()]},has:function(e){return e.toLowerCase()in i}}}};for(var l in s.open(t.method||"get",e,!0),s.onload=function(){s.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,(function(e,t,r){n.push(t=t.toLowerCase()),u.push([t,r]),i[t]=i[t]?i[t]+","+r:r})),r(a())},s.onerror=o,s.withCredentials="include"==t.credentials,t.headers)s.setRequestHeader(l,t.headers[l]);s.send(t.body||null)}))}},108:function(e,t,r){"use strict";var o=function(e){return function(e){return!!e&&"object"==typeof e}(e)&&!function(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||function(e){return e.$$typeof===n}(e)}(e)};var n="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function l(e,t){return!1!==t.clone&&t.isMergeableObject(e)?m((r=e,Array.isArray(r)?[]:{}),e,t):e;var r}function h(e,source,t){return e.concat(source).map((function(element){return l(element,t)}))}function c(e){return Object.keys(e).concat(function(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e).filter((function(symbol){return e.propertyIsEnumerable(symbol)})):[]}(e))}function f(object,e){try{return e in object}catch(e){return!1}}function d(e,source,t){var r={};return t.isMergeableObject(e)&&c(e).forEach((function(o){r[o]=l(e[o],t)})),c(source).forEach((function(o){(function(e,t){return f(e,t)&&!(Object.hasOwnProperty.call(e,t)&&Object.propertyIsEnumerable.call(e,t))})(e,o)||(f(e,o)&&t.isMergeableObject(source[o])?r[o]=function(e,t){if(!t.customMerge)return m;var r=t.customMerge(e);return"function"==typeof r?r:m}(o,t)(e[o],source[o],t):r[o]=l(source[o],t))})),r}function m(e,source,t){(t=t||{}).arrayMerge=t.arrayMerge||h,t.isMergeableObject=t.isMergeableObject||o,t.cloneUnlessOtherwiseSpecified=l;var r=Array.isArray(source);return r===Array.isArray(e)?r?t.arrayMerge(e,source,t):d(e,source,t):l(source,t)}m.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce((function(e,r){return m(e,r,t)}),{})};var v=m;e.exports=v},110:function(e,t){function r(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)}e.exports=function e(t,o){if(!r(t))return e({},o);if(!r(o))return e(t,{});var n=Object.assign({},o);return Object.keys(t).forEach((function(o){if("__proto__"!==o&&"constructor"!==o){var l=t[o];null!==l&&(r(l)&&r(n[o])?n[o]=e(l,n[o]):n[o]=l)}})),n}},161:function(e,t,r){"use strict";e.exports=function(e,t){return t||(t={}),"string"!=typeof(e=e&&e.__esModule?e.default:e)?e:(/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e)}},184:function(e,t,r){var o,n,l,h,c,q,f,d,m,v,y,x,_,M,w,S,A,T,C,E,L,P,R,D,U,F,V,N,O,z,I,B,k,G,H,j,W,X,area,Y,K,$,Q,Z,J,ee,te,re,ie,ae=ae||{},oe={REVISION:"66"};ae.console=ae.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}},function(){for(var e=0,t=["ms","moz","webkit","o"],r=0;r<t.length&&!ae.requestAnimationFrame;++r)ae.requestAnimationFrame=ae[t[r]+"RequestAnimationFrame"],ae.cancelAnimationFrame=ae[t[r]+"CancelAnimationFrame"]||ae[t[r]+"CancelRequestAnimationFrame"];void 0===ae.requestAnimationFrame&&void 0!==ae.setTimeout&&(ae.requestAnimationFrame=function(t){var r=Date.now(),o=Math.max(0,16-(r-e)),n=ae.setTimeout((function(){t(r+o)}),o);return e=r+o,n}),void 0===ae.cancelAnimationFrame&&void 0!==ae.clearTimeout&&(ae.cancelAnimationFrame=function(e){ae.clearTimeout(e)})}(),oe.ExceptionErrorHandler=function(e,t){console.error(e),console.error(t);var r=new Error(e);throw r.optionalData=t,r},oe.ConsoleErrorHandler=function(e,t){console.error(e),console.error(t)},oe.ConsoleWarningHandler=function(e,t){console.warn(e),console.warn(t)},oe.NullHandler=function(e,t){},oe.onerror=oe.ExceptionErrorHandler,oe.onwarning=oe.ConsoleWarningHandler,oe.CullFaceNone=0,oe.CullFaceBack=1,oe.CullFaceFront=2,oe.CullFaceFrontBack=3,oe.FrontFaceDirectionCW=0,oe.FrontFaceDirectionCCW=1,oe.BasicShadowMap=0,oe.PCFShadowMap=1,oe.PCFSoftShadowMap=2,oe.FrontSide=0,oe.BackSide=1,oe.DoubleSide=2,oe.NoShading=0,oe.FlatShading=1,oe.SmoothShading=2,oe.NoColors=0,oe.FaceColors=1,oe.VertexColors=2,oe.NoBlending=0,oe.NormalBlending=1,oe.AdditiveBlending=2,oe.SubtractiveBlending=3,oe.MultiplyBlending=4,oe.CustomBlending=5,oe.AddEquation=100,oe.SubtractEquation=101,oe.ReverseSubtractEquation=102,oe.ZeroFactor=200,oe.OneFactor=201,oe.SrcColorFactor=202,oe.OneMinusSrcColorFactor=203,oe.SrcAlphaFactor=204,oe.OneMinusSrcAlphaFactor=205,oe.DstAlphaFactor=206,oe.OneMinusDstAlphaFactor=207,oe.DstColorFactor=208,oe.OneMinusDstColorFactor=209,oe.SrcAlphaSaturateFactor=210,oe.MultiplyOperation=0,oe.MixOperation=1,oe.AddOperation=2,oe.UVMapping=function(){},oe.CubeReflectionMapping=function(){},oe.CubeRefractionMapping=function(){},oe.SphericalReflectionMapping=function(){},oe.SphericalRefractionMapping=function(){},oe.RepeatWrapping=1e3,oe.ClampToEdgeWrapping=1001,oe.MirroredRepeatWrapping=1002,oe.NearestFilter=1003,oe.NearestMipMapNearestFilter=1004,oe.NearestMipMapLinearFilter=1005,oe.LinearFilter=1006,oe.LinearMipMapNearestFilter=1007,oe.LinearMipMapLinearFilter=1008,oe.None=3e3,oe.Gamma=3001,oe.RGBE=3002,oe.LogLUV=3003,oe.Scale7=3004,oe.Scale16=3005,oe.UnsignedByteType=1009,oe.ByteType=1010,oe.ShortType=1011,oe.UnsignedShortType=1012,oe.IntType=1013,oe.UnsignedIntType=1014,oe.FloatType=1015,oe.UnsignedShort4444Type=1016,oe.UnsignedShort5551Type=1017,oe.UnsignedShort565Type=1018,oe.AlphaFormat=1019,oe.RGBFormat=1020,oe.RGBAFormat=1021,oe.LuminanceFormat=1022,oe.LuminanceAlphaFormat=1023,oe.RGB_S3TC_DXT1_Format=2001,oe.RGBA_S3TC_DXT1_Format=2002,oe.RGBA_S3TC_DXT3_Format=2003,oe.RGBA_S3TC_DXT5_Format=2004,oe.Color=function(e){return 3===arguments.length?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(e)},oe.Color.prototype={constructor:oe.Color,r:1,g:1,b:1,set:function(e){return e instanceof oe.Color?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,g,b){return this.r=e,this.g=g,this.b=b,this},setHSL:function(e,s,t){if(0===s)this.r=this.g=this.b=t;else{var r=function(p,q,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?p+6*(q-p)*e:e<.5?q:e<2/3?p+6*(q-p)*(2/3-e):p},p=t<=.5?t*(1+s):t+s-t*s,q=2*t-p;this.r=r(q,p,e+1/3),this.g=r(q,p,e),this.b=r(q,p,e-1/3)}return this},setStyle:function(style){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(style)){var e=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(style);return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,this}if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(style)){e=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(style);return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,this}if(/^\#([0-9a-f]{6})$/i.test(style)){e=/^\#([0-9a-f]{6})$/i.exec(style);return this.setHex(parseInt(e[1],16)),this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(style)){e=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(style);return this.setHex(parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3],16)),this}if(/^(\w+)$/i.test(style))return this.setHex(oe.ColorKeywords[style]),this},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},convertGammaToLinear:function(){var e=this.r,g=this.g,b=this.b;return this.r=e*e,this.g=g*g,this.b=b*b,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t,r,o=e||{h:0,s:0,l:0},n=this.r,g=this.g,b=this.b,l=Math.max(n,g,b),h=Math.min(n,g,b),c=(h+l)/2;if(h===l)t=0,r=0;else{var f=l-h;switch(r=c<=.5?f/(l+h):f/(2-l-h),l){case n:t=(g-b)/f+(g<b?6:0);break;case g:t=(b-n)/f+2;break;case b:t=(n-g)/f+4}t/=6}return o.h=t,o.s=r,o.l=c,o},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,s,t){var r=this.getHSL();return r.h+=e,r.s+=s,r.l+=t,this.setHSL(r.h,r.s,r.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(s){return this.r+=s,this.g+=s,this.b+=s,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(s){return this.r*=s,this.g*=s,this.b*=s,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e){return this.r=e[0],this.g=e[1],this.b=e[2],this},toArray:function(){return[this.r,this.g,this.b]},clone:function(){return(new oe.Color).setRGB(this.r,this.g,this.b)}},oe.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},oe.Quaternion=function(e,t,r,o){this._x=e||0,this._y=t||0,this._z=r||0,this._w=void 0!==o?o:1},oe.Quaternion.prototype={constructor:oe.Quaternion,_x:0,_y:0,_z:0,_w:0,_euler:void 0,_updateEuler:function(e){void 0!==this._euler&&this._euler.setFromQuaternion(this,void 0,!1)},get x(){return this._x},set x(e){this._x=e,this._updateEuler()},get y(){return this._y},set y(e){this._y=e,this._updateEuler()},get z(){return this._z},set z(e){this._z=e,this._updateEuler()},get w(){return this._w},set w(e){this._w=e,this._updateEuler()},set:function(e,t,r,o){return this._x=e,this._y=t,this._z=r,this._w=o,this._updateEuler(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._w=e._w,this._updateEuler(),this},setFromEuler:function(e,t){if(!(e instanceof oe.Euler))return oe.onerror("expecting a Euler",e);var r=Math.cos(e._x/2),o=Math.cos(e._y/2),n=Math.cos(e._z/2),l=Math.sin(e._x/2),h=Math.sin(e._y/2),c=Math.sin(e._z/2);return"XYZ"===e.order?(this._x=l*o*n+r*h*c,this._y=r*h*n-l*o*c,this._z=r*o*c+l*h*n,this._w=r*o*n-l*h*c):"YXZ"===e.order?(this._x=l*o*n+r*h*c,this._y=r*h*n-l*o*c,this._z=r*o*c-l*h*n,this._w=r*o*n+l*h*c):"ZXY"===e.order?(this._x=l*o*n-r*h*c,this._y=r*h*n+l*o*c,this._z=r*o*c+l*h*n,this._w=r*o*n-l*h*c):"ZYX"===e.order?(this._x=l*o*n-r*h*c,this._y=r*h*n+l*o*c,this._z=r*o*c-l*h*n,this._w=r*o*n+l*h*c):"YZX"===e.order?(this._x=l*o*n+r*h*c,this._y=r*h*n+l*o*c,this._z=r*o*c-l*h*n,this._w=r*o*n-l*h*c):"XZY"===e.order&&(this._x=l*o*n-r*h*c,this._y=r*h*n-l*o*c,this._z=r*o*c+l*h*n,this._w=r*o*n+l*h*c),!1!==t&&this._updateEuler(),this},setFromAxisAngle:function(e,t){var r=t/2,s=Math.sin(r);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(r),this._updateEuler(),this},setFromRotationMatrix:function(e){var s,t=e.elements,r=t[0],o=t[4],n=t[8],l=t[1],h=t[5],c=t[9],f=t[2],d=t[6],m=t[10],v=r+h+m;return v>0?(s=.5/Math.sqrt(v+1),this._w=.25/s,this._x=(d-c)*s,this._y=(n-f)*s,this._z=(l-o)*s):r>h&&r>m?(s=2*Math.sqrt(1+r-h-m),this._w=(d-c)/s,this._x=.25*s,this._y=(o+l)/s,this._z=(n+f)/s):h>m?(s=2*Math.sqrt(1+h-r-m),this._w=(n-f)/s,this._x=(o+l)/s,this._y=.25*s,this._z=(c+d)/s):(s=2*Math.sqrt(1+m-r-h),this._w=(l-o)/s,this._x=(n+f)/s,this._y=(c+d)/s,this._z=.25*s),this._updateEuler(),this},inverse:function(){return this.conjugate().normalize(),this},add:function(q){return this._x+=q._x,this._y+=q._y,this._z+=q._z,this._w+=q._w,this},sub:function(q){return this._x-=q._x,this._y-=q._y,this._z-=q._z,this._w-=q._w,this},multiplyScalar:function(s){return this._x*=s,this._y*=s,this._z*=s,this._w*=s,this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._updateEuler(),this},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this},multiply:function(q,p){return void 0!==p?(oe.onwarning("DEPRECATED: Quaternion's .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(q,p)):this.multiplyQuaternions(this,q)},multiplyQuaternions:function(a,b){var e=a._x,t=a._y,r=a._z,o=a._w,n=b._x,l=b._y,h=b._z,c=b._w;return this._x=e*c+o*n+t*h-r*l,this._y=t*c+o*l+r*n-e*h,this._z=r*c+o*h+e*l-t*n,this._w=o*c-e*n-t*l-r*h,this._updateEuler(),this},multiplyVector3:function(e){return oe.onwarning("DEPRECATED: Quaternion's .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){var r=this._x,o=this._y,n=this._z,l=this._w,h=l*e._w+r*e._x+o*e._y+n*e._z;if(h<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,h=-h):this.copy(e),h>=1)return this._w=l,this._x=r,this._y=o,this._z=n,this;var c=Math.acos(h),f=Math.sqrt(1-h*h);if(Math.abs(f)<.001)return this._w=.5*(l+this._w),this._x=.5*(r+this._x),this._y=.5*(o+this._y),this._z=.5*(n+this._z),this;var d=Math.sin((1-t)*c)/f,m=Math.sin(t*c)/f;return this._w=l*d+this._w*m,this._x=r*d+this._x*m,this._y=o*d+this._y*m,this._z=n*d+this._z*m,this._updateEuler(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],this._w=e[3],this._updateEuler(),this},toArray:function(){return[this._x,this._y,this._z,this._w]},clone:function(){return new oe.Quaternion(this._x,this._y,this._z,this._w)}},oe.Quaternion.slerp=function(e,t,r,o){return r.copy(e).slerp(t,o)},oe.Vector2=function(e,t){this.x=e||0,this.y=t||0},oe.Vector2.prototype={constructor:oe.Vector2,set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:return oe.onerror("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:return oe.onerror("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(oe.onwarning("DEPRECATED: Vector2's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this},addScalar:function(s){return this.x+=s,this.y+=s,this},sub:function(e,t){return void 0!==t?(oe.onwarning("DEPRECATED: Vector2's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this},multiplyScalar:function(s){return this.x*=s,this.y*=s,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t}else this.x=0,this.y=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},clampScalar:function(e,t){return void 0===o&&(o=new oe.Vector2,n=new oe.Vector2),o.set(e,e),n.set(t,t),this.clamp(o,n)},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e){return this.x=e[0],this.y=e[1],this},toArray:function(){return[this.x,this.y]},clone:function(){return new oe.Vector2(this.x,this.y)}},oe.Vector3=function(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0},oe.Vector3.prototype={constructor:oe.Vector3,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:return oe.onerror("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:return oe.onerror("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(oe.onwarning("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(s){return this.x+=s,this.y+=s,this.z+=s,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this},sub:function(e,t){return void 0!==t?(oe.onwarningn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this},multiply:function(e,t){return void 0!==t?(oe.onwarning("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(a,b){return this.x=a.x*b.x,this.y=a.y*b.y,this.z=a.z*b.z,this},applyEuler:function(e){return e instanceof oe.Euler?(void 0===c&&(c=new oe.Quaternion),this.applyQuaternion(c.setFromEuler(e)),this):oe.onerror("expecting an Euler",e)},applyAxisAngle:function(){var e;return function(t,r){return void 0===e&&(e=new oe.Quaternion),this.applyQuaternion(e.setFromAxisAngle(t,r)),this}}(),applyMatrix3:function(e){var t=this.x,r=this.y,o=this.z,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6]*o,this.y=n[1]*t+n[4]*r+n[7]*o,this.z=n[2]*t+n[5]*r+n[8]*o,this},applyMatrix4:function(e){var t=this.x,r=this.y,o=this.z,n=e.elements;return this.x=n[0]*t+n[4]*r+n[8]*o+n[12],this.y=n[1]*t+n[5]*r+n[9]*o+n[13],this.z=n[2]*t+n[6]*r+n[10]*o+n[14],this},applyProjection:function(e){var t=this.x,r=this.y,o=this.z,n=e.elements,l=1/(n[3]*t+n[7]*r+n[11]*o+n[15]);return this.x=(n[0]*t+n[4]*r+n[8]*o+n[12])*l,this.y=(n[1]*t+n[5]*r+n[9]*o+n[13])*l,this.z=(n[2]*t+n[6]*r+n[10]*o+n[14])*l,this},applyQuaternion:function(q){var e=this.x,t=this.y,r=this.z,o=q.x,n=q.y,l=q.z,h=q.w,c=h*e+n*r-l*t,f=h*t+l*e-o*r,d=h*r+o*t-n*e,m=-o*e-n*t-l*r;return this.x=c*h+m*-o+f*-l-d*-n,this.y=f*h+m*-n+d*-o-c*-l,this.z=d*h+m*-l+c*-n-f*-o,this},transformDirection:function(e){var t=this.x,r=this.y,o=this.z,n=e.elements;return this.x=n[0]*t+n[4]*r+n[8]*o,this.y=n[1]*t+n[5]*r+n[9]*o,this.z=n[2]*t+n[6]*r+n[10]*o,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},clampScalar:function(){var e,t;return function(r,o){return void 0===e&&(e=new oe.Vector3,t=new oe.Vector3),e.set(r,r,r),t.set(o,o,o),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},cross:function(e,t){if(void 0!==t)return oe.onwarning("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var r=this.x,o=this.y,n=this.z;return this.x=o*e.z-n*e.y,this.y=n*e.x-r*e.z,this.z=r*e.y-o*e.x,this},crossVectors:function(a,b){var e=a.x,t=a.y,r=a.z,o=b.x,n=b.y,l=b.z;return this.x=t*l-r*n,this.y=r*o-e*l,this.z=e*n-t*o,this},projectOnVector:function(e){return void 0===l&&(l=new oe.Vector3),l.copy(e).normalize(),h=this.dot(l),this.copy(l).multiplyScalar(h)},projectOnPlane:function(){var e;return function(t){return void 0===e&&(e=new oe.Vector3),e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e;return function(t){return void 0===e&&(e=new oe.Vector3),this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos(oe.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y,o=this.z-e.z;return t*t+r*r+o*o},setEulerFromRotationMatrix:function(e,t){oe.onerror("REMOVED: Vector3's setEulerFromRotationMatrix has been removed in favor of Euler.setFromRotationMatrix(), please update your code.")},setEulerFromQuaternion:function(q,e){oe.onerror("REMOVED: Vector3's setEulerFromQuaternion: has been removed in favor of Euler.setFromQuaternion(), please update your code.")},getPositionFromMatrix:function(e){return oe.onwarning("DEPRECATED: Vector3's .getPositionFromMatrix() has been renamed to .setFromMatrixPosition(). Please update your code."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return oe.onwarning("DEPRECATED: Vector3's .getScaleFromMatrix() has been renamed to .setFromMatrixScale(). Please update your code."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return oe.onwarning("DEPRECATED: Vector3's .getColumnFromMatrix() has been renamed to .setFromMatrixColumn(). Please update your code."),this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),r=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),o=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=r,this.z=o,this},setFromMatrixColumn:function(e,t){var r=4*e,o=t.elements;return this.x=o[r],this.y=o[r+1],this.z=o[r+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this},toArray:function(){return[this.x,this.y,this.z]},clone:function(){return new oe.Vector3(this.x,this.y,this.z)}},oe.Vector4=function(e,t,r,o){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0!==o?o:1},oe.Vector4.prototype={constructor:oe.Vector4,set:function(e,t,r,o){return this.x=e,this.y=t,this.z=r,this.w=o,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:return oe.onerror("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:return oe.onerror("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(oe.onwarning("DEPRECATED: Vector4's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(s){return this.x+=s,this.y+=s,this.z+=s,this.w+=s,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this.w=a.w+b.w,this},sub:function(e,t){return void 0!==t?(oe.onwarning("DEPRECATED: Vector4's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this.w=a.w-b.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,r=this.y,o=this.z,n=this.w,l=e.elements;return this.x=l[0]*t+l[4]*r+l[8]*o+l[12]*n,this.y=l[1]*t+l[5]*r+l[9]*o+l[13]*n,this.z=l[2]*t+l[6]*r+l[10]*o+l[14]*n,this.w=l[3]*t+l[7]*r+l[11]*o+l[15]*n,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t,this.w*=t}else this.x=0,this.y=0,this.z=0,this.w=1;return this},setAxisAngleFromQuaternion:function(q){this.w=2*Math.acos(q.w);var s=Math.sqrt(1-q.w*q.w);return s<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=q.x/s,this.y=q.y/s,this.z=q.z/s),this},setAxisAngleFromRotationMatrix:function(e){var t,r,o,n,l=e.elements,h=l[0],c=l[4],f=l[8],d=l[1],m=l[5],v=l[9],y=l[2],x=l[6],_=l[10];if(Math.abs(c-d)<.01&&Math.abs(f-y)<.01&&Math.abs(v-x)<.01){if(Math.abs(c+d)<.1&&Math.abs(f+y)<.1&&Math.abs(v+x)<.1&&Math.abs(h+m+_-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var M=(h+1)/2,w=(m+1)/2,S=(_+1)/2,A=(c+d)/4,T=(f+y)/4,C=(v+x)/4;return M>w&&M>S?M<.01?(r=0,o=.707106781,n=.707106781):(o=A/(r=Math.sqrt(M)),n=T/r):w>S?w<.01?(r=.707106781,o=0,n=.707106781):(r=A/(o=Math.sqrt(w)),n=C/o):S<.01?(r=.707106781,o=.707106781,n=0):(r=T/(n=Math.sqrt(S)),o=C/n),this.set(r,o,n,t),this}var s=Math.sqrt((x-v)*(x-v)+(f-y)*(f-y)+(d-c)*(d-c));return Math.abs(s)<.001&&(s=1),this.x=(x-v)/s,this.y=(f-y)/s,this.z=(d-c)/s,this.w=Math.acos((h+m+_-1)/2),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this.w<e.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},clampScalar:function(){var e,t;return function(r,o){return void 0===e&&(e=new oe.Vector4,t=new oe.Vector4),e.set(r,r,r,r),t.set(o,o,o,o),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this.w=e[3],this},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new oe.Vector4(this.x,this.y,this.z,this.w)}},oe.Euler=function(e,t,r,o){this._x=e||0,this._y=t||0,this._z=r||0,this._order=o||oe.Euler.DefaultOrder},oe.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],oe.Euler.DefaultOrder="XYZ",oe.Euler.prototype={constructor:oe.Euler,_x:0,_y:0,_z:0,_order:oe.Euler.DefaultOrder,_quaternion:void 0,_updateQuaternion:function(){void 0!==this._quaternion&&this._quaternion.setFromEuler(this,!1)},get x(){return this._x},set x(e){this._x=e,this._updateQuaternion()},get y(){return this._y},set y(e){this._y=e,this._updateQuaternion()},get z(){return this._z},set z(e){this._z=e,this._updateQuaternion()},get order(){return this._order},set order(e){this._order=e,this._updateQuaternion()},set:function(e,t,r,o){return this._x=e,this._y=t,this._z=r,this._order=o||this._order,this._updateQuaternion(),this},setFromVector:function(e,t){return this._x=e.x,this._y=e.y,this._z=e.z,this._order=t||this._order,this._updateQuaternion(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._updateQuaternion(),this},setFromRotationMatrix:function(e,t,r){function o(e){return Math.min(Math.max(e,-1),1)}var n=e.elements,l=n[0],h=n[4],c=n[8],f=n[1],d=n[5],m=n[9],v=n[2],y=n[6],x=n[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(o(c)),Math.abs(c)<.99999?(this._x=Math.atan2(-m,x),this._z=Math.atan2(-h,l)):(this._x=Math.atan2(y,d),this._z=0)):"YXZ"===t?(this._x=Math.asin(-o(m)),Math.abs(m)<.99999?(this._y=Math.atan2(c,x),this._z=Math.atan2(f,d)):(this._y=Math.atan2(-v,l),this._z=0)):"ZXY"===t?(this._x=Math.asin(o(y)),Math.abs(y)<.99999?(this._y=Math.atan2(-v,x),this._z=Math.atan2(-h,d)):(this._y=0,this._z=Math.atan2(f,l))):"ZYX"===t?(this._y=Math.asin(-o(v)),Math.abs(v)<.99999?(this._x=Math.atan2(y,x),this._z=Math.atan2(f,l)):(this._x=0,this._z=Math.atan2(-h,d))):"YZX"===t?(this._z=Math.asin(o(f)),Math.abs(f)<.99999?(this._x=Math.atan2(-m,d),this._y=Math.atan2(-v,l)):(this._x=0,this._y=Math.atan2(c,x))):"XZY"===t?(this._z=Math.asin(-o(h)),Math.abs(h)<.99999?(this._x=Math.atan2(y,d),this._y=Math.atan2(c,l)):(this._x=Math.atan2(-m,x),this._y=0)):oe.onwarning("WARNING: Euler.setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==r&&this._updateQuaternion(),this},setFromQuaternion:(f=null,function(q,e,t){return(f=f||new oe.Matrix4).makeRotationFromQuaternion(q),this.setFromRotationMatrix(f,e,t),this}),reorder:(q=new oe.Quaternion,function(e){q.setFromEuler(this),this.setFromQuaternion(q,e)}),fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._updateQuaternion(),this},toArray:function(){return[this._x,this._y,this._z,this._order]},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new oe.Vector3(this._x,this._y,this._z)},clone:function(){return new oe.Euler(this._x,this._y,this._z,this._order)}},oe.Line3=function(e,t){this.start=void 0!==e?e:new oe.Vector3,this.end=void 0!==t?t:new oe.Vector3},oe.Line3.prototype={constructor:oe.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},copy:function(line){return this.start.copy(line.start),this.end.copy(line.end),this},center:function(e){return(e||new oe.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return(e||new oe.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var r=t||new oe.Vector3;return this.delta(r).multiplyScalar(e).add(this.start)},closestPointToPointParameter:(d=new oe.Vector3,m=new oe.Vector3,function(e,t){d.subVectors(e,this.start),m.subVectors(this.end,this.start);var r=m.dot(m),o=m.dot(d)/r;return t&&(o=oe.Math.clamp(o,0,1)),o}),closestPointToPoint:function(e,t,r){var o=this.closestPointToPointParameter(e,t),n=r||new oe.Vector3;return this.delta(n).multiplyScalar(o).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(line){return line.start.equals(this.start)&&line.end.equals(this.end)},clone:function(){return(new oe.Line3).copy(this)}},oe.Box2=function(e,t){this.min=void 0!==e?e:new oe.Vector2(1/0,1/0),this.max=void 0!==t?t:new oe.Vector2(-1/0,-1/0)},oe.Box2.prototype={constructor:oe.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){if(e.length>0){var t=e[0];this.min.copy(t),this.max.copy(t);for(var i=1,r=e.length;i<r;i++)(t=e[i]).x<this.min.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),t.y<this.min.y?this.min.y=t.y:t.y>this.max.y&&(this.max.y=t.y)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var e=new oe.Vector2;return function(t,r){var o=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(o),this.max.copy(t).add(o),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){return(e||new oe.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new oe.Vector2).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return(t||new oe.Vector2).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return(t||new oe.Vector2).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new oe.Vector2;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new oe.Box2).copy(this)}},oe.Box3=function(e,t){this.min=void 0!==e?e:new oe.Vector3(1/0,1/0,1/0),this.max=void 0!==t?t:new oe.Vector3(-1/0,-1/0,-1/0)},oe.Box3.prototype={constructor:oe.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},addPoint:function(e){e.x<this.min.x?this.min.x=e.x:e.x>this.max.x&&(this.max.x=e.x),e.y<this.min.y?this.min.y=e.y:e.y>this.max.y&&(this.max.y=e.y),e.z<this.min.z?this.min.z=e.z:e.z>this.max.z&&(this.max.z=e.z)},setFromPoints:function(e){if(e.length>0){var t=e[0];this.min.copy(t),this.max.copy(t);for(var i=1,r=e.length;i<r;i++)this.addPoint(e[i])}else this.makeEmpty();return this},setFromCenterAndSize:function(){var e=new oe.Vector3;return function(t,r){var o=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(o),this.max.copy(t).add(o),this}}(),setFromObject:function(){var e=new oe.Vector3;return function(object){var t=this;return object.updateMatrixWorld(!0),this.makeEmpty(),object.traverse((function(r){if(void 0!==r.geometry&&void 0!==r.geometry.vertices)for(var o=r.geometry.vertices,i=0,n=o.length;i<n;i++)e.copy(o[i]),e.applyMatrix4(r.matrixWorld),t.expandByPoint(e)})),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){return(e||new oe.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new oe.Vector3).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return(t||new oe.Vector3).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},clampPoint:function(e,t){return(t||new oe.Vector3).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new oe.Vector3;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var e=new oe.Vector3;return function(t){var r=t||new oe.Sphere;return r.center=this.center(),r.radius=.5*this.size(e).length(),r}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:(v=[new oe.Vector3,new oe.Vector3,new oe.Vector3,new oe.Vector3,new oe.Vector3,new oe.Vector3,new oe.Vector3,new oe.Vector3],function(e){return v[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),v[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),v[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),v[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),v[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),v[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),v[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),v[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.makeEmpty(),this.setFromPoints(v),this}),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new oe.Box3).copy(this)}},oe.Matrix3=function(e,t,r,o,n,l,h,c,f){this.elements=new Float32Array(9),this.set(void 0!==e?e:1,t||0,r||0,o||0,void 0!==n?n:1,l||0,h||0,c||0,void 0!==f?f:1)},oe.Matrix3.prototype={constructor:oe.Matrix3,set:function(e,t,r,o,n,l,h,c,f){var d=this.elements;return d[0]=e,d[3]=t,d[6]=r,d[1]=o,d[4]=n,d[7]=l,d[2]=h,d[5]=c,d[8]=f,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},multiplyVector3:function(e){return oe.onwarning("DEPRECATED: Matrix3's .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){var e=new oe.Vector3;return function(a){for(var i=0,t=a.length;i<t;i+=3)e.x=a[i],e.y=a[i+1],e.z=a[i+2],e.applyMatrix3(this),a[i]=e.x,a[i+1]=e.y,a[i+2]=e.z;return a}}(),multiplyScalar:function(s){var e=this.elements;return e[0]*=s,e[3]*=s,e[6]*=s,e[1]*=s,e[4]*=s,e[7]*=s,e[2]*=s,e[5]*=s,e[8]*=s,this},determinant:function(){var e=this.elements,a=e[0],b=e[1],t=e[2],r=e[3],o=e[4],n=e[5],g=e[6],l=e[7],i=e[8];return a*o*i-a*n*l-b*r*i+b*n*g+t*r*l-t*o*g},getInverse:function(e,t){if(!(e instanceof oe.Matrix4))return oe.onerror("expecting a Matrix4",e);var r=e.elements,o=this.elements;o[0]=r[10]*r[5]-r[6]*r[9],o[1]=-r[10]*r[1]+r[2]*r[9],o[2]=r[6]*r[1]-r[2]*r[5],o[3]=-r[10]*r[4]+r[6]*r[8],o[4]=r[10]*r[0]-r[2]*r[8],o[5]=-r[6]*r[0]+r[2]*r[4],o[6]=r[9]*r[4]-r[5]*r[8],o[7]=-r[9]*r[0]+r[1]*r[8],o[8]=r[5]*r[0]-r[1]*r[4];var n=r[0]*o[0]+r[1]*o[3]+r[2]*o[6];return 0===n?!0===t?oe.onerror("Matrix3.getInverse(): can't invert matrix, determinant is 0",this):(this.identity(),this):(this.multiplyScalar(1/n),this)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},clone:function(){var e=this.elements;return new oe.Matrix3(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])}},oe.Matrix4=function(e,t,r,o,n,l,h,c,f,d,m,v,y,x,_,M){this.elements=new Float32Array(16);var w=this.elements;w[0]=void 0!==e?e:1,w[4]=t||0,w[8]=r||0,w[12]=o||0,w[1]=n||0,w[5]=void 0!==l?l:1,w[9]=h||0,w[13]=c||0,w[2]=f||0,w[6]=d||0,w[10]=void 0!==m?m:1,w[14]=v||0,w[3]=y||0,w[7]=x||0,w[11]=_||0,w[15]=void 0!==M?M:1},oe.Matrix4.prototype={constructor:oe.Matrix4,set:function(e,t,r,o,n,l,h,c,f,d,m,v,y,x,_,M){var w=this.elements;return w[0]=e,w[4]=t,w[8]=r,w[12]=o,w[1]=n,w[5]=l,w[9]=h,w[13]=c,w[2]=f,w[6]=d,w[10]=m,w[14]=v,w[3]=y,w[7]=x,w[11]=_,w[15]=M,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.elements.set(e.elements),this},extractPosition:function(e){return oe.onwarning("DEPRECATED: Matrix4's .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},copyPosition:function(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this},extractBasis:function(e,t,r){var o=this.elements;return e.set(o[0],o[1],o[2]),t.set(o[4],o[5],o[6]),r.set(o[8],o[9],o[10]),this},makeBasis:function(e,t,r){this.identity();var o=this.elements;return o.elements[0]=e.x,o.elements[1]=e.y,o.elements[2]=e.z,o.elements[4]=t.x,o.elements[5]=t.y,o.elements[6]=t.z,o.elements[8]=r.x,o.elements[9]=r.y,o.elements[10]=r.z,this},extractRotation:function(){var e=new oe.Vector3;return function(t){var r=this.elements,o=t.elements,n=1/e.set(o[0],o[1],o[2]).length(),l=1/e.set(o[4],o[5],o[6]).length(),h=1/e.set(o[8],o[9],o[10]).length();return r[0]=o[0]*n,r[1]=o[1]*n,r[2]=o[2]*n,r[4]=o[4]*l,r[5]=o[5]*l,r[6]=o[6]*l,r[8]=o[8]*h,r[9]=o[9]*h,r[10]=o[10]*h,this}}(),makeRotationFromEuler:function(e){if(!(e instanceof oe.Euler))return oe.onerror("expecting a Euler",e);var t=this.elements,r=e.x,o=e.y,n=e.z,a=Math.cos(r),b=Math.sin(r),l=Math.cos(o),h=Math.sin(o),c=Math.cos(n),f=Math.sin(n);if("XYZ"===e.order){var d=a*c,m=a*f,v=b*c,y=b*f;t[0]=l*c,t[4]=-l*f,t[8]=h,t[1]=m+v*h,t[5]=d-y*h,t[9]=-b*l,t[2]=y-d*h,t[6]=v+m*h,t[10]=a*l}else if("YXZ"===e.order){var x=l*c,_=l*f,M=h*c,w=h*f;t[0]=x+w*b,t[4]=M*b-_,t[8]=a*h,t[1]=a*f,t[5]=a*c,t[9]=-b,t[2]=_*b-M,t[6]=w+x*b,t[10]=a*l}else if("ZXY"===e.order){x=l*c,_=l*f,M=h*c,w=h*f;t[0]=x-w*b,t[4]=-a*f,t[8]=M+_*b,t[1]=_+M*b,t[5]=a*c,t[9]=w-x*b,t[2]=-a*h,t[6]=b,t[10]=a*l}else if("ZYX"===e.order){d=a*c,m=a*f,v=b*c,y=b*f;t[0]=l*c,t[4]=v*h-m,t[8]=d*h+y,t[1]=l*f,t[5]=y*h+d,t[9]=m*h-v,t[2]=-h,t[6]=b*l,t[10]=a*l}else if("YZX"===e.order){var S=a*l,A=a*h,T=b*l,C=b*h;t[0]=l*c,t[4]=C-S*f,t[8]=T*f+A,t[1]=f,t[5]=a*c,t[9]=-b*c,t[2]=-h*c,t[6]=A*f+T,t[10]=S-C*f}else if("XZY"===e.order){S=a*l,A=a*h,T=b*l,C=b*h;t[0]=l*c,t[4]=-f,t[8]=h*c,t[1]=S*f+C,t[5]=a*c,t[9]=A*f-T,t[2]=T*f-A,t[6]=b*c,t[10]=C*f+S}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},setRotationFromQuaternion:function(q){return oe.onwarning("DEPRECATED: Matrix4's .setRotationFromQuaternion() has been deprecated in favor of makeRotationFromQuaternion.  Please update your code."),this.makeRotationFromQuaternion(q)},makeRotationFromQuaternion:function(q){var e=this.elements,t=q.x,r=q.y,o=q.z,n=q.w,l=t+t,h=r+r,c=o+o,f=t*l,d=t*h,m=t*c,v=r*h,y=r*c,x=o*c,_=n*l,M=n*h,w=n*c;return e[0]=1-(v+x),e[4]=d-w,e[8]=m+M,e[1]=d+w,e[5]=1-(f+x),e[9]=y-_,e[2]=m-M,e[6]=y+_,e[10]=1-(f+v),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},lookAt:(_=new oe.Vector3,M=new oe.Vector3,w=new oe.Vector3,function(e,t,r){var o=this.elements;return w.subVectors(e,t).normalize(),0===w.length()&&(w.z=1),_.crossVectors(r,w).normalize(),0===_.length()&&(w.x+=1e-4,_.crossVectors(r,w).normalize()),M.crossVectors(w,_),o[0]=_.x,o[4]=M.x,o[8]=w.x,o[1]=_.y,o[5]=M.y,o[9]=w.y,o[2]=_.z,o[6]=M.z,o[10]=w.z,this}),multiply:function(e,t){return void 0!==t?(oe.onwarning("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyList:function(e){for(var i=0,t=e.length;i<t;i++)this.multiplyMatrices(this,e[i]);return this},multiplyMatricesList:function(e){return e.length>0?(this.copy(e[0]),this.multiplyList(e.slice(1))):this.identity(),this},multiplyMatrices:function(a,b){if(!(a instanceof oe.Matrix4))return oe.onerror("expecting a Matrix4",a);if(!(b instanceof oe.Matrix4))return oe.onerror("expecting a Matrix4",b);var e=a.elements,t=b.elements,r=this.elements,o=e[0],n=e[4],l=e[8],h=e[12],c=e[1],f=e[5],d=e[9],m=e[13],v=e[2],y=e[6],x=e[10],_=e[14],M=e[3],w=e[7],S=e[11],A=e[15],T=t[0],C=t[4],E=t[8],L=t[12],P=t[1],R=t[5],D=t[9],U=t[13],F=t[2],V=t[6],N=t[10],O=t[14],z=t[3],I=t[7],B=t[11],k=t[15];return r[0]=o*T+n*P+l*F+h*z,r[4]=o*C+n*R+l*V+h*I,r[8]=o*E+n*D+l*N+h*B,r[12]=o*L+n*U+l*O+h*k,r[1]=c*T+f*P+d*F+m*z,r[5]=c*C+f*R+d*V+m*I,r[9]=c*E+f*D+d*N+m*B,r[13]=c*L+f*U+d*O+m*k,r[2]=v*T+y*P+x*F+_*z,r[6]=v*C+y*R+x*V+_*I,r[10]=v*E+y*D+x*N+_*B,r[14]=v*L+y*U+x*O+_*k,r[3]=M*T+w*P+S*F+A*z,r[7]=M*C+w*R+S*V+A*I,r[11]=M*E+w*D+S*N+A*B,r[15]=M*L+w*U+S*O+A*k,this},multiplyToArray:function(a,b,e){var t=this.elements;return this.multiplyMatrices(a,b),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],this},multiplyScalar:function(s){var e=this.elements;return e[0]*=s,e[4]*=s,e[8]*=s,e[12]*=s,e[1]*=s,e[5]*=s,e[9]*=s,e[13]*=s,e[2]*=s,e[6]*=s,e[10]*=s,e[14]*=s,e[3]*=s,e[7]*=s,e[11]*=s,e[15]*=s,this},multiplyVector3:function(e){return oe.onwarning("DEPRECATED: Matrix4's .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return oe.onwarning("DEPRECATED: Matrix4's .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){var e=new oe.Vector3;return function(a){for(var i=0,t=a.length;i<t;i+=3)e.x=a[i],e.y=a[i+1],e.z=a[i+2],e.applyProjection(this),a[i]=e.x,a[i+1]=e.y,a[i+2]=e.z;return a}}(),rotateAxis:function(e){oe.onwarning("DEPRECATED: Matrix4's .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return oe.onwarning("DEPRECATED: Matrix4's .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},determinant:function(){var e=this.elements,t=e[0],r=e[4],o=e[8],n=e[12],l=e[1],h=e[5],c=e[9],f=e[13],d=e[2],m=e[6],v=e[10],y=e[14];return e[3]*(+n*c*m-o*f*m-n*h*v+r*f*v+o*h*y-r*c*y)+e[7]*(+t*c*y-t*f*v+n*l*v-o*l*y+o*f*d-n*c*d)+e[11]*(+t*f*m-t*h*y-n*l*m+r*l*y+n*h*d-r*f*d)+e[15]*(-o*h*d-t*c*m+t*h*v+o*l*m-r*l*v+r*c*d)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},flattenToArrayOffset:function(e,t){var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e},getPosition:function(){var e=new oe.Vector3;return function(){oe.onwarning("DEPRECATED: Matrix4's .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var r=this.elements,o=e.elements,n=o[0],l=o[4],h=o[8],c=o[12],f=o[1],d=o[5],m=o[9],v=o[13],y=o[2],x=o[6],_=o[10],M=o[14],w=o[3],S=o[7],A=o[11],T=o[15];r[0]=m*M*S-v*_*S+v*x*A-d*M*A-m*x*T+d*_*T,r[4]=c*_*S-h*M*S-c*x*A+l*M*A+h*x*T-l*_*T,r[8]=h*v*S-c*m*S+c*d*A-l*v*A-h*d*T+l*m*T,r[12]=c*m*x-h*v*x-c*d*_+l*v*_+h*d*M-l*m*M,r[1]=v*_*w-m*M*w-v*y*A+f*M*A+m*y*T-f*_*T,r[5]=h*M*w-c*_*w+c*y*A-n*M*A-h*y*T+n*_*T,r[9]=c*m*w-h*v*w-c*f*A+n*v*A+h*f*T-n*m*T,r[13]=h*v*y-c*m*y+c*f*_-n*v*_-h*f*M+n*m*M,r[2]=d*M*w-v*x*w+v*y*S-f*M*S-d*y*T+f*x*T,r[6]=c*x*w-l*M*w-c*y*S+n*M*S+l*y*T-n*x*T,r[10]=l*v*w-c*d*w+c*f*S-n*v*S-l*f*T+n*d*T,r[14]=c*d*y-l*v*y-c*f*x+n*v*x+l*f*M-n*d*M,r[3]=m*x*w-d*_*w-m*y*S+f*_*S+d*y*A-f*x*A,r[7]=l*_*w-h*x*w+h*y*S-n*_*S-l*y*A+n*x*A,r[11]=h*d*w-l*m*w-h*f*S+n*m*S+l*f*A-n*d*A,r[15]=l*m*y-h*d*y+h*f*x-n*m*x-l*f*_+n*d*_;var C=n*r[0]+f*r[4]+y*r[8]+w*r[12];return 0==C?!0===t?oe.onerror("Matrix4.getInverse(): can't invert matrix, determinant is 0",this):(this.identity(),this):(this.multiplyScalar(1/C),this)},translate:function(e){oe.onerror("DEPRECATED: Matrix4's .translate() has been removed.")},rotateX:function(e){oe.onerror("DEPRECATED: Matrix4's .rotateX() has been removed.")},rotateY:function(e){oe.onerror("DEPRECATED: Matrix4's .rotateY() has been removed.")},rotateZ:function(e){oe.onerror("DEPRECATED: Matrix4's .rotateZ() has been removed.")},rotateByAxis:function(e,t){oe.onerror("DEPRECATED: Matrix4's .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements,r=e.x,o=e.y,n=e.z;return t[0]*=r,t[4]*=o,t[8]*=n,t[1]*=r,t[5]*=o,t[9]*=n,t[2]*=r,t[6]*=o,t[10]*=n,t[3]*=r,t[7]*=o,t[11]*=n,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],o=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(r,o)))},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),s=Math.sin(e);return this.set(1,0,0,0,0,t,-s,0,0,s,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),s=Math.sin(e);return this.set(t,0,s,0,0,1,0,0,-s,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),s=Math.sin(e);return this.set(t,-s,0,0,s,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var r=Math.cos(t),s=Math.sin(t),o=1-r,n=e.x,l=e.y,h=e.z,c=o*n,f=o*l;return this.set(c*n+r,c*l-s*h,c*h+s*l,0,c*l+s*h,f*l+r,f*h-s*n,0,c*h-s*l,f*h+s*n,o*h*h+r,0,0,0,0,1),this},makeScale:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},makeShear:function(e,t){var r=e.x,o=e.y,n=e.z;return t?this.set(1,0,0,0,r,1,0,0,o,n,1,0,0,0,0,1):this.set(1,r,o,0,0,1,n,0,0,0,1,0,0,0,0,1),this},compose:function(e,t,r){return this.makeRotationFromQuaternion(t),this.scale(r),this.setPosition(e),this},decompose:(y=new oe.Vector3,x=new oe.Matrix4,function(e,t,r){var o=this.elements,n=y.set(o[0],o[1],o[2]).length(),l=y.set(o[4],o[5],o[6]).length(),h=y.set(o[8],o[9],o[10]).length();this.determinant()<0&&(n=-n),e.x=o[12],e.y=o[13],e.z=o[14],x.elements.set(this.elements);var c=1/n,f=1/l,d=1/h;return x.elements[0]*=c,x.elements[1]*=c,x.elements[2]*=c,x.elements[4]*=f,x.elements[5]*=f,x.elements[6]*=f,x.elements[8]*=d,x.elements[9]*=d,x.elements[10]*=d,t.setFromRotationMatrix(x),r.x=n,r.y=l,r.z=h,this}),makeFrustum:function(e,t,r,o,n,l){var h=this.elements,c=2*n/(t-e),f=2*n/(o-r),a=(t+e)/(t-e),b=(o+r)/(o-r),d=-(l+n)/(l-n),m=-2*l*n/(l-n);return h[0]=c,h[4]=0,h[8]=a,h[12]=0,h[1]=0,h[5]=f,h[9]=b,h[13]=0,h[2]=0,h[6]=0,h[10]=d,h[14]=m,h[3]=0,h[7]=0,h[11]=-1,h[15]=0,this},makePerspective:function(e,t,r,o){var n=r*Math.tan(oe.Math.degToRad(.5*e)),l=-n,h=l*t,c=n*t;return this.makeFrustum(h,c,l,n,r,o)},makeOrthographic:function(e,t,r,o,n,l){var h=this.elements,c=t-e,f=r-o,p=l-n,d=(t+e)/c,m=(r+o)/f,v=(l+n)/p;return h[0]=2/c,h[4]=0,h[8]=0,h[12]=-d,h[1]=0,h[5]=2/f,h[9]=0,h[13]=-m,h[2]=0,h[6]=0,h[10]=-2/p,h[14]=-v,h[3]=0,h[7]=0,h[11]=0,h[15]=1,this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){var e=this.elements;return new oe.Matrix4(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])}},oe.Ray=function(e,t){this.origin=void 0!==e?e:new oe.Vector3,this.direction=void 0!==t?t:new oe.Vector3},oe.Ray.prototype={constructor:oe.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return(t||new oe.Vector3).copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new oe.Vector3;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var r=t||new oe.Vector3;r.subVectors(e,this.origin);var o=r.dot(this.direction);return o<0?r.copy(this.origin):r.copy(this.direction).multiplyScalar(o).add(this.origin)},distanceToPoint:function(){var e=new oe.Vector3;return function(t){var r=e.subVectors(t,this.origin).dot(this.direction);return r<0?this.origin.distanceTo(t):(e.copy(this.direction).multiplyScalar(r).add(this.origin),e.distanceTo(t))}}(),distanceSqToSegment:function(e,t,r,o){var n,l,h,c,f=e.clone().add(t).multiplyScalar(.5),d=t.clone().sub(e).normalize(),m=.5*e.distanceTo(t),v=this.origin.clone().sub(f),y=-this.direction.dot(d),x=v.dot(this.direction),_=-v.dot(d),M=v.lengthSq(),w=Math.abs(1-y*y);if(w>=0)if(l=y*x-_,c=m*w,(n=y*_-x)>=0)if(l>=-c)if(l<=c){var S=1/w;h=(n*=S)*(n+y*(l*=S)+2*x)+l*(y*n+l+2*_)+M}else l=m,h=-(n=Math.max(0,-(y*l+x)))*n+l*(l+2*_)+M;else l=-m,h=-(n=Math.max(0,-(y*l+x)))*n+l*(l+2*_)+M;else l<=-c?h=-(n=Math.max(0,-(-y*m+x)))*n+(l=n>0?-m:Math.min(Math.max(-m,-_),m))*(l+2*_)+M:l<=c?(n=0,h=(l=Math.min(Math.max(-m,-_),m))*(l+2*_)+M):h=-(n=Math.max(0,-(y*m+x)))*n+(l=n>0?m:Math.min(Math.max(-m,-_),m))*(l+2*_)+M;else l=y>0?-m:m,h=-(n=Math.max(0,-(y*l+x)))*n+l*(l+2*_)+M;return r&&r.copy(this.direction.clone().multiplyScalar(n).add(this.origin)),o&&o.copy(d.clone().multiplyScalar(l).add(f)),h},isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},isIntersectionPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0==t)return 0==e.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null},intersectPlane:function(e,t){var r=this.distanceToPlane(e);return null===r?null:this.at(r,t)},isIntersectionBox:(E=new oe.Vector3,function(e){return null!==this.intersectBox(e,E)}),intersectBox:function(e,t){var r,o,n,l,h,c,f=1/this.direction.x,d=1/this.direction.y,m=1/this.direction.z,v=this.origin;return f>=0?(r=(e.min.x-v.x)*f,o=(e.max.x-v.x)*f):(r=(e.max.x-v.x)*f,o=(e.min.x-v.x)*f),d>=0?(n=(e.min.y-v.y)*d,l=(e.max.y-v.y)*d):(n=(e.max.y-v.y)*d,l=(e.min.y-v.y)*d),r>l||n>o?null:((n>r||r!=r)&&(r=n),(l<o||o!=o)&&(o=l),m>=0?(h=(e.min.z-v.z)*m,c=(e.max.z-v.z)*m):(h=(e.max.z-v.z)*m,c=(e.min.z-v.z)*m),r>c||h>o?null:((h>r||r!=r)&&(r=h),(c<o||o!=o)&&(o=c),o<0?null:this.at(r>=0?r:o,t)))},intersectTriangle:(S=new oe.Vector3,A=new oe.Vector3,T=new oe.Vector3,C=new oe.Vector3,function(a,b,e,t,r){A.subVectors(b,a),T.subVectors(e,a),C.crossVectors(A,T);var o,n=this.direction.dot(C);if(n>0){if(t)return null;o=1}else{if(!(n<0))return null;o=-1,n=-n}S.subVectors(this.origin,a);var l=o*this.direction.dot(T.crossVectors(S,T));if(l<0)return null;var h=o*this.direction.dot(A.cross(S));if(h<0)return null;if(l+h>n)return null;var c=-o*S.dot(C);return c<0?null:this.at(c/n,r)}),applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new oe.Ray).copy(this)}},oe.Sphere=function(e,t){this.center=void 0!==e?e:new oe.Vector3,this.radius=void 0!==t?t:0},oe.Sphere.prototype={constructor:oe.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:(L=new oe.Box3,function(e,t){var r=this.center;void 0!==t?r.copy(t):L.setFromPoints(e).center(r);for(var o=0,n=r.x,l=r.y,h=r.z,i=0,c=e.length;i<c;i++){var f=e[i],d=n-f.x,m=l-f.y,v=h-f.z,y=d*d+m*m+v*v;o=Math.max(o,y)}return this.radius=Math.sqrt(o),this}),copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var r=this.center.distanceToSquared(e),o=t||new oe.Vector3;return o.copy(e),r>this.radius*this.radius&&(o.sub(this.center).normalize(),o.multiplyScalar(this.radius).add(this.center)),o},getBoundingBox:function(e){var t=e||new oe.Box3;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new oe.Sphere).copy(this)}},oe.Frustum=function(e,t,r,o,n,l){this.planes=[void 0!==e?e:new oe.Plane,void 0!==t?t:new oe.Plane,void 0!==r?r:new oe.Plane,void 0!==o?o:new oe.Plane,void 0!==n?n:new oe.Plane,void 0!==l?l:new oe.Plane]},oe.Frustum.prototype={constructor:oe.Frustum,set:function(e,t,r,o,n,l){var h=this.planes;return h[0].copy(e),h[1].copy(t),h[2].copy(r),h[3].copy(o),h[4].copy(n),h[5].copy(l),this},copy:function(e){for(var t=this.planes,i=0;i<6;i++)t[i].copy(e.planes[i]);return this},setFromMatrix:function(e){var t=this.planes,r=e.elements,o=r[0],n=r[1],l=r[2],h=r[3],c=r[4],f=r[5],d=r[6],m=r[7],v=r[8],y=r[9],x=r[10],_=r[11],M=r[12],w=r[13],S=r[14],A=r[15];return t[0].setComponents(h-o,m-c,_-v,A-M).normalize(),t[1].setComponents(h+o,m+c,_+v,A+M).normalize(),t[2].setComponents(h+n,m+f,_+y,A+w).normalize(),t[3].setComponents(h-n,m-f,_-y,A-w).normalize(),t[4].setComponents(h-l,m-d,_-x,A-S).normalize(),t[5].setComponents(h+l,m+d,_+x,A+S).normalize(),this},intersectsObject:(D=new oe.Sphere,function(object){var e=object.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),D.copy(e.boundingSphere),D.applyMatrix4(object.matrixWorld),this.intersectsSphere(D)}),intersectsSphere:function(e){for(var t=this.planes,r=e.center,o=-e.radius,i=0;i<6;i++){if(t[i].distanceToPoint(r)<o)return!1}return!0},intersectsBox:(P=new oe.Vector3,R=new oe.Vector3,function(e){for(var t=this.planes,i=0;i<6;i++){var r=t[i];P.x=r.normal.x>0?e.min.x:e.max.x,R.x=r.normal.x>0?e.max.x:e.min.x,P.y=r.normal.y>0?e.min.y:e.max.y,R.y=r.normal.y>0?e.max.y:e.min.y,P.z=r.normal.z>0?e.min.z:e.max.z,R.z=r.normal.z>0?e.max.z:e.min.z;var o=r.distanceToPoint(P),n=r.distanceToPoint(R);if(o<0&&n<0)return!1}return!0}),containsPoint:function(e){for(var t=this.planes,i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0},clone:function(){return(new oe.Frustum).copy(this)}},oe.Plane=function(e,t){this.normal=void 0!==e?e:new oe.Vector3(1,0,0),this.constant=void 0!==t?t:0},oe.Plane.prototype={constructor:oe.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,r,o){return this.normal.set(e,t,r),this.constant=o,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new oe.Vector3,t=new oe.Vector3;return function(a,b,r){var o=e.subVectors(r,b).cross(t.subVectors(a,b)).normalize();return this.setFromNormalAndCoplanarPoint(o,a),this}}(),copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var r=this.distanceToPoint(e);return(t||new oe.Vector3).copy(this.normal).multiplyScalar(r)},isIntersectionLine:function(line){var e=this.distanceToPoint(line.start),t=this.distanceToPoint(line.end);return e<0&&t>0||t<0&&e>0},intersectLine:function(){var e=new oe.Vector3;return function(line,t){var r=t||new oe.Vector3,o=line.delta(e),n=this.normal.dot(o);if(0==n)return 0==this.distanceToPoint(line.start)?r.copy(line.start):void 0;var l=-(line.start.dot(this.normal)+this.constant)/n;return l<0||l>1?void 0:r.copy(o).multiplyScalar(l).add(line.start)}}(),coplanarPoint:function(e){return(e||new oe.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new oe.Vector3,t=new oe.Vector3,r=new oe.Matrix3;return function(o,n){if(!(o instanceof oe.Matrix4))return oe.onerror("expecting a Matrix4",o);var l=n||r.getNormalMatrix(o),h=e.copy(this.normal).applyMatrix3(l),c=this.coplanarPoint(t);return c.applyMatrix4(o),this.setFromNormalAndCoplanarPoint(h,c),this}}(),translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new oe.Plane).copy(this)}},oe.Math={PI2:2*Math.PI,DegreeToRadiansFactor:Math.PI/180,RadianToDegreesFactor:180/Math.PI,generateUUID:(F="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),V=new Array(36),N=0,function(){for(var i=0;i<36;i++)8==i||13==i||18==i||23==i?V[i]="-":14==i?V[i]="4":(N<=2&&(N=33554432+16777216*Math.random()|0),U=15&N,N>>=4,V[i]=F[19==i?3&U|8:U]);return V.join("")}),clamp:function(e,a,b){return e<a?a:e>b?b:e},clampBottom:function(e,a){return e<a?a:e},mapLinear:function(e,t,r,o,n){return o+(e-t)*(n-o)/(r-t)},smoothstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*(3-2*e)},smootherstep:function(e,t,r){return e<=t?0:e>=r?1:(e=(e-t)/(r-t))*e*e*(e*(6*e-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},sign:function(e){return e<0?-1:e>0?1:0},degToRad:function(e){return e*this.DegreeToRadiansFactor},radToDeg:function(e){return e*this.RadianToDegreesFactor},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e}},oe.Spline=function(e){this.points=e;var t,r,o,n,l,h,c,f,d,m=[],v={x:0,y:0,z:0};function y(e,t,r,o,n,l,h){var c=.5*(r-e),f=.5*(o-t);return(2*(t-r)+c+f)*h+(-3*(t-r)-2*c-f)*l+c*n+t}this.initFromArray=function(a){this.points=[];for(var i=0;i<a.length;i++)this.points[i]={x:a[i][0],y:a[i][1],z:a[i][2]}},this.getPoint=function(e){return t=(this.points.length-1)*e,r=Math.floor(t),o=t-r,m[0]=0===r?r:r-1,m[1]=r,m[2]=r>this.points.length-2?this.points.length-1:r+1,m[3]=r>this.points.length-3?this.points.length-1:r+2,h=this.points[m[0]],c=this.points[m[1]],f=this.points[m[2]],d=this.points[m[3]],l=o*(n=o*o),v.x=y(h.x,c.x,f.x,d.x,o,n,l),v.y=y(h.y,c.y,f.y,d.y,o,n,l),v.z=y(h.z,c.z,f.z,d.z,o,n,l),v},this.getControlPointsArray=function(){var i,p,e=this.points.length,t=[];for(i=0;i<e;i++)p=this.points[i],t[i]=[p.x,p.y,p.z];return t},this.getLength=function(e){var i,t,r,o,n=0,l=0,h=0,c=new oe.Vector3,f=new oe.Vector3,d=[],m=0;for(d[0]=0,e||(e=100),r=this.points.length*e,c.copy(this.points[0]),i=1;i<r;i++)t=i/r,o=this.getPoint(t),f.copy(o),m+=f.distanceTo(c),c.copy(o),n=(this.points.length-1)*t,(l=Math.floor(n))!=h&&(d[l]=m,h=l);return d[d.length]=m,{chunks:d,total:m}},this.reparametrizeByArcLength=function(e){var i,t,r,o,n,l,h,c,f=[],d=new oe.Vector3,m=this.getLength();for(f.push(d.copy(this.points[0]).clone()),i=1;i<this.points.length;i++){for(l=m.chunks[i]-m.chunks[i-1],h=Math.ceil(e*l/m.total),o=(i-1)/(this.points.length-1),n=i/(this.points.length-1),t=1;t<h-1;t++)r=o+t*(1/h)*(n-o),c=this.getPoint(r),f.push(d.copy(c).clone());f.push(d.copy(this.points[i]).clone())}this.points=f}},oe.Triangle=function(a,b,e){this.a=void 0!==a?a:new oe.Vector3,this.b=void 0!==b?b:new oe.Vector3,this.c=void 0!==e?e:new oe.Vector3},oe.Triangle.normal=(O=new oe.Vector3,function(a,b,e,t){var r=t||new oe.Vector3;r.subVectors(e,b),O.subVectors(a,b),r.cross(O);var o=r.lengthSq();return o>0?r.multiplyScalar(1/Math.sqrt(o)):r.set(0,0,0)}),oe.Triangle.barycoordFromPoint=function(){var e=new oe.Vector3,t=new oe.Vector3,r=new oe.Vector3;return function(o,a,b,n,l){e.subVectors(n,a),t.subVectors(b,a),r.subVectors(o,a);var h=e.dot(e),c=e.dot(t),f=e.dot(r),d=t.dot(t),m=t.dot(r),v=h*d-c*c,y=l||new oe.Vector3;if(0==v)return y.set(-2,-1,-1);var x=1/v,u=(d*f-c*m)*x,_=(h*m-c*f)*x;return y.set(1-u-_,_,u)}}(),oe.Triangle.containsPoint=function(){var e=new oe.Vector3;return function(t,a,b,r){var o=oe.Triangle.barycoordFromPoint(t,a,b,r,e);return o.x>=0&&o.y>=0&&o.x+o.y<=1}}(),oe.Triangle.prototype={constructor:oe.Triangle,set:function(a,b,e){return this.a.copy(a),this.b.copy(b),this.c.copy(e),this},setFromPointsAndIndices:function(e,t,r,o){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[o]),this},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new oe.Vector3,t=new oe.Vector3;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),midpoint:function(e){return(e||new oe.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return oe.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){return(e||new oe.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return oe.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return oe.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new oe.Triangle).copy(this)}},oe.Vertex=function(e){return oe.onerror("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead.")},oe.UV=function(u,e){return oe.onerror("THREE.UV has been DEPRECATED. Use THREE.Vector2 instead."),new oe.Vector2(u,e)},oe.Clock=function(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},oe.Clock.prototype={constructor:oe.Clock,start:function(){this.startTime=void 0!==ae.performance&&void 0!==ae.performance.now?ae.performance.now():Date.now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=void 0!==ae.performance&&void 0!==ae.performance.now?ae.performance.now():Date.now();e=.001*(t-this.oldTime),this.oldTime=t,this.elapsedTime+=e}return e}},oe.EventDispatcher=function(){},oe.EventDispatcher.prototype={constructor:oe.EventDispatcher,apply:function(object){object.addEventListener=oe.EventDispatcher.prototype.addEventListener,object.hasEventListener=oe.EventDispatcher.prototype.hasEventListener,object.removeEventListener=oe.EventDispatcher.prototype.removeEventListener,object.dispatchEvent=oe.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var r=this._listeners[e];if(void 0!==r){var o=r.indexOf(t);-1!==o&&r.splice(o,1)}}},dispatchEvent:(z=[],function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var r=t.length,i=0;i<r;i++)z[i]=t[i];for(i=0;i<r;i++)z[i].call(this,e)}}})},function(e){e.Raycaster=function(t,r,o,n){this.ray=new e.Ray(t,r),this.near=o||0,this.far=n||1/0};var t=new e.Sphere,r=new e.Ray,o=(new e.Plane,new e.Vector3,new e.Vector3),n=new e.Matrix4,l=function(a,b){return a.distance-b.distance},h=new e.Vector3,c=new e.Vector3,f=new e.Vector3,d=function(object,l,m){if(object instanceof e.Sprite){if(o.setFromMatrixPosition(object.matrixWorld),(v=l.ray.distanceToPoint(o))>object.scale.x)return m;m.push({distance:v,point:object.position,face:null,object:object})}else if(object instanceof e.LOD){o.setFromMatrixPosition(object.matrixWorld);var v=l.ray.origin.distanceTo(o);d(object.getObjectForDistance(v),l,m)}else if(object instanceof e.Mesh){if(null===(j=object.geometry).boundingSphere&&j.computeBoundingSphere(),t.copy(j.boundingSphere),t.applyMatrix4(object.matrixWorld),!1===l.ray.isIntersectionSphere(t))return m;if(n.getInverse(object.matrixWorld),r.copy(l.ray).applyMatrix4(n),null!==j.boundingBox&&!1===r.isIntersectionBox(j.boundingBox))return m;if(j instanceof e.BufferGeometry){if(void 0===(N=object.material))return m;var y=j.attributes,x=l.precision;if(void 0!==y.index)for(var _=j.offsets,M=y.index.array,w=y.position.array,S=0,ol=_.length;S<ol;++S)for(var A=_[S].start,T=_[S].count,C=_[S].index,i=A,E=A+T;i<E;i+=3){if(a=C+M[i],b=C+M[i+1],P=C+M[i+2],h.set(w[3*a],w[3*a+1],w[3*a+2]),c.set(w[3*b],w[3*b+1],w[3*b+2]),f.set(w[3*P],w[3*P+1],w[3*P+2]),N.side===e.BackSide)var L=r.intersectTriangle(f,c,h,!0);else L=r.intersectTriangle(h,c,f,N.side!==e.DoubleSide);if(null!==L)L.applyMatrix4(object.matrixWorld),(v=l.ray.origin.distanceTo(L))<x||v<l.near||v>l.far||m.push({distance:v,point:L,indices:[a,b,P],face:null,faceIndex:null,object:object})}else for(_=j.offsets,w=y.position.array,i=0,E=y.position.array.length;i<E;i+=3){if(a=i,b=i+1,P=i+2,h.set(w[3*a],w[3*a+1],w[3*a+2]),c.set(w[3*b],w[3*b+1],w[3*b+2]),f.set(w[3*P],w[3*P+1],w[3*P+2]),N.side===e.BackSide)L=r.intersectTriangle(f,c,h,!0);else L=r.intersectTriangle(h,c,f,N.side!==e.DoubleSide);if(null!==L)L.applyMatrix4(object.matrixWorld),(v=l.ray.origin.distanceTo(L))<x||v<l.near||v>l.far||m.push({distance:v,point:L,indices:[a,b,P],face:null,faceIndex:null,object:object})}}else if(j instanceof e.Geometry)for(var a,b,P,R=object.material instanceof e.MeshFaceMaterial,D=!0===R?object.material.materials:null,U=(x=l.precision,j.vertices),F=0,V=j.faces.length;F<V;F++){var N,O=j.faces[F];if(void 0!==(N=!0===R?D[O.materialIndex]:object.material)){if(a=U[O.a],b=U[O.b],P=U[O.c],!0===N.morphTargets){var z=j.morphTargets,I=object.morphTargetInfluences;h.set(0,0,0),c.set(0,0,0),f.set(0,0,0);for(var B=0,k=z.length;B<k;B++){var G=I[B];if(0!==G){var H=z[B].vertices;h.x+=(H[O.a].x-a.x)*G,h.y+=(H[O.a].y-a.y)*G,h.z+=(H[O.a].z-a.z)*G,c.x+=(H[O.b].x-b.x)*G,c.y+=(H[O.b].y-b.y)*G,c.z+=(H[O.b].z-b.z)*G,f.x+=(H[O.c].x-P.x)*G,f.y+=(H[O.c].y-P.y)*G,f.z+=(H[O.c].z-P.z)*G}}h.add(a),c.add(b),f.add(P),a=h,b=c,P=f}if(N.side===e.BackSide)L=r.intersectTriangle(P,b,a,!0);else L=r.intersectTriangle(a,b,P,N.side!==e.DoubleSide);if(null!==L)L.applyMatrix4(object.matrixWorld),(v=l.ray.origin.distanceTo(L))<x||v<l.near||v>l.far||m.push({distance:v,point:L,face:O,faceIndex:F,object:object})}}}else if(object instanceof e.Line){var j,W=(x=l.linePrecision)*x;if(null===(j=object.geometry).boundingSphere&&j.computeBoundingSphere(),t.copy(j.boundingSphere),t.applyMatrix4(object.matrixWorld),!1===l.ray.isIntersectionSphere(t))return m;if(n.getInverse(object.matrixWorld),r.copy(l.ray).applyMatrix4(n),j instanceof e.Geometry){var X=(U=j.vertices).length,Y=new e.Vector3,K=new e.Vector3,$=object.type===e.LineStrip?1:2;for(i=0;i<X-1;i+=$){if(!(r.distanceSqToSegment(U[i],U[i+1],K,Y)>W))(v=r.origin.distanceTo(K))<l.near||v>l.far||m.push({distance:v,point:Y.clone().applyMatrix4(object.matrixWorld),face:null,faceIndex:null,object:object})}}}},m=function(object,e,t){for(var r=object.getDescendants(),i=0,o=r.length;i<o;i++)d(r[i],e,t)};e.Raycaster.prototype.precision=1e-4,e.Raycaster.prototype.linePrecision=1,e.Raycaster.prototype.set=function(e,t){this.ray.set(e,t)},e.Raycaster.prototype.intersectObject=function(object,e){var t=[];return!0===e&&m(object,this,t),d(object,this,t),t.sort(l),t},e.Raycaster.prototype.intersectObjects=function(e,t){for(var r=[],i=0,o=e.length;i<o;i++)d(e[i],this,r),!0===t&&m(e[i],this,r);return r.sort(l),r}}(oe),oe.Object3D=function(){this.id=oe.Object3DIdCount++,this.uuid=oe.Math.generateUUID(),this.className="Object3D",this.name="",this.parent=void 0,this.children=[],this.up=new oe.Vector3(0,1,0),this.position=new oe.Vector3,this._rotation=new oe.Euler,this._quaternion=new oe.Quaternion,this.scale=new oe.Vector3(1,1,1),this._rotation._quaternion=this.quaternion,this._quaternion._euler=this.rotation,this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new oe.Matrix4,this.matrixWorld=new oe.Matrix4,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!0,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.userData={}},oe.Object3D.prototype={constructor:oe.Object3D,get rotation(){return this._rotation},set rotation(e){this._rotation=e,this._rotation._quaternion=this._quaternion,this._quaternion._euler=this._rotation,this._rotation._updateQuaternion()},get quaternion(){return this._quaternion},set quaternion(e){this._quaternion=e,this._quaternion._euler=this._rotation,this._rotation._quaternion=this._quaternion,this._quaternion._updateEuler()},get eulerOrder(){return oe.onwarning("DEPRECATED: Object3D's .eulerOrder has been moved to Object3D's .rotation.order."),this.rotation.order},set eulerOrder(e){oe.onwarning("DEPRECATED: Object3D's .eulerOrder has been moved to Object3D's .rotation.order."),this.rotation.order=e},get useQuaternion(){oe.onwarning("DEPRECATED: Object3D's .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(e){oe.onwarning("DEPRECATED: Object3D's .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(q){this.quaternion.copy(q)},rotateOnAxis:(B=new oe.Quaternion,function(e,t){return B.setFromAxisAngle(e,t),this.quaternion.multiply(B),this}),rotateX:function(){var e=new oe.Vector3(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new oe.Vector3(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new oe.Vector3(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new oe.Vector3;return function(t,r){return e.copy(t),e.applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(r)),this}}(),translate:function(e,t){return oe.onwarning("DEPRECATED: Object3D's .translate() has been removed. Use .translateOnAxis( axis, distance ) instead. Note args have been changed."),this.translateOnAxis(t,e)},translateX:function(){var e=new oe.Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new oe.Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new oe.Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:(I=new oe.Matrix4,function(e){return e.applyMatrix4(I.getInverse(this.matrixWorld))}),lookAt:function(){var e=new oe.Matrix4;return function(t){e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(object){if(object!==this){if(object instanceof oe.Object3D){void 0!==object.parent&&object.parent.remove(object),object.parent=this,object.dispatchEvent({type:"added"}),this.children.push(object);for(var e=this;void 0!==e.parent;)e=e.parent;void 0!==e&&e instanceof oe.Scene&&e.__addObject(object)}}else oe.onwarning("THREE.Object3D.add: An object can't be added as a child of itself.")},remove:function(object){var e=this.children.indexOf(object);if(-1!==e){object.parent=void 0,object.dispatchEvent({type:"removed"}),this.children.splice(e,1);for(var t=this;void 0!==t.parent;)t=t.parent;void 0!==t&&t instanceof oe.Scene&&t.__removeObject(object)}},traverse:function(e){e(this);for(var i=0,t=this.children.length;i<t;i++)this.children[i].traverse(e)},getObjectById:function(e,t){for(var i=0,r=this.children.length;i<r;i++){var o=this.children[i];if(o.id===e)return o;if(!0===t&&void 0!==(o=o.getObjectById(e,t)))return o}},getObjectByName:function(e,t){for(var i=0,r=this.children.length;i<r;i++){var o=this.children[i];if(o.name===e)return o;if(!0===t&&void 0!==(o=o.getObjectByName(e,t)))return o}},getChildByName:function(e,t){return oe.onwarning("DEPRECATED: Object3D's .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e,t)},getDescendants:function(e){void 0===e&&(e=[]),Array.prototype.push.apply(e,this.children);for(var i=0,t=this.children.length;i<t;i++)this.children[i].getDescendants(e);return e},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){!0===this.matrixAutoUpdate&&this.updateMatrix(),!0!==this.matrixWorldNeedsUpdate&&!0!==e||(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var i=0,t=this.children.length;i<t;i++)this.children[i].updateMatrixWorld(e)},clone:function(object,e){if(void 0===object&&(object=new oe.Object3D),void 0===e&&(e=!0),object.name=this.name,object.up.copy(this.up),object.position.copy(this.position),object.quaternion.copy(this.quaternion),object.scale.copy(this.scale),object.renderDepth=this.renderDepth,object.rotationAutoUpdate=this.rotationAutoUpdate,object.matrix.copy(this.matrix),object.matrixWorld.copy(this.matrixWorld),object.matrixAutoUpdate=this.matrixAutoUpdate,object.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,object.visible=this.visible,object.castShadow=this.castShadow,object.receiveShadow=this.receiveShadow,object.frustumCulled=this.frustumCulled,object.userData=JSON.parse(JSON.stringify(this.userData)),!0===e)for(var i=0;i<this.children.length;i++){var t=this.children[i];object.add(t.clone())}return object}},oe.EventDispatcher.prototype.apply(oe.Object3D.prototype),oe.Object3DIdCount=0,oe.Projector=function(){var e,t,r,o,n,l,h,c,f,d,m,v,y=[],x=0,_=[],M=0,w=[],S=0,A=[],T=0,C=[],E=0,L={objects:[],lights:[],elements:[]},P=new oe.Vector3,R=new oe.Vector3,D=new oe.Vector3,U=new oe.Vector3,F=new oe.Vector4,V=new oe.Box3(new oe.Vector3(-1,-1,-1),new oe.Vector3(1,1,1)),N=new oe.Box3,O=new Array(3),z=(new Array(4),new oe.Matrix4),I=new oe.Matrix4,B=new oe.Matrix4,k=new oe.Matrix3,G=new oe.Frustum,H=new oe.Vector4,j=new oe.Vector4;this.projectVector=function(e,t){return t.matrixWorldInverse.getInverse(t.matrixWorld),I.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),e.applyProjection(I)},this.unprojectVector=(v=new oe.Matrix4,function(e,t){return v.getInverse(t.projectionMatrix),I.multiplyMatrices(t.matrixWorld,v),e.applyProjection(I)}),this.pickingRay=function(e,t){e.z=-1;var r=new oe.Vector3(e.x,e.y,1);return this.unprojectVector(e,t),this.unprojectVector(r,t),r.sub(e).normalize(),new oe.Raycaster(e,r)};var W=function(object){if(!1!==object.visible){object instanceof oe.Light?L.lights.push(object):(object instanceof oe.Mesh||object instanceof oe.Line||object instanceof oe.Sprite)&&(!1!==object.frustumCulled&&!0!==G.intersectsObject(object)||((e=function(){if(t===x){var object=new oe.RenderableObject;return y.push(object),x++,t++,object}return y[t++]}()).id=object.id,e.object=object,null!==object.renderDepth?e.z=object.renderDepth:(U.setFromMatrixPosition(object.matrixWorld),U.applyProjection(I),e.z=U.z),L.objects.push(e)));for(var i=0,r=object.children.length;i<r;i++)W(object.children[i])}},X=new function(){var e=[],object=null,t=new oe.Matrix3,o=function(e){var t=e.position,r=e.positionWorld,o=e.positionScreen;r.copy(t).applyMatrix4(m),o.copy(r).applyMatrix4(I);var n=1/o.w;o.x*=n,o.y*=n,o.z*=n,e.visible=o.x>=-1&&o.x<=1&&o.y>=-1&&o.y<=1&&o.z>=-1&&o.z<=1},l=function(e,t,r){return O[0]=e.positionScreen,O[1]=t.positionScreen,O[2]=r.positionScreen,!(!0!==e.visible&&!0!==t.visible&&!0!==r.visible&&!V.isIntersectionBox(N.setFromPoints(O)))&&(r.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(r.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)<0};return{setObject:function(r){object=r,t.getNormalMatrix(object.matrixWorld),e.length=0},projectVertex:o,checkTriangleVisibility:l,pushVertex:function(e,t,n){(r=Y()).position.set(e,t,n),o(r)},pushNormal:function(t,r,o){e.push(t,r,o)},pushLine:function(a,b){var e=_[a],t=_[b];(h=$()).id=object.id,h.v1.copy(e),h.v2.copy(t),h.z=(e.positionScreen.z+t.positionScreen.z)/2,h.material=object.material,L.elements.push(h)},pushTriangle:function(a,b,r){var o=_[a],h=_[b],c=_[r];if(!0===l(o,h,c)){(n=K()).id=object.id,n.v1.copy(o),n.v2.copy(h),n.v3.copy(c),n.z=(o.positionScreen.z+h.positionScreen.z+c.positionScreen.z)/3;for(var i=0;i<3;i++){var f=3*arguments[i],d=n.vertexNormalsModel[i];d.set(e[f+0],e[f+1],e[f+2]),d.applyMatrix3(t).normalize()}n.vertexNormalsLength=3,n.material=object.material,L.elements.push(n)}}}};function Y(){if(o===M){var e=new oe.RenderableVertex;return _.push(e),M++,o++,e}return _[o++]}function K(){if(l===S){var e=new oe.RenderableFace;return w.push(e),S++,l++,e}return w[l++]}function $(){if(c===T){var line=new oe.RenderableLine;return A.push(line),T++,c++,line}return A[c++]}function Q(){if(d===E){var e=new oe.RenderableSprite;return C.push(e),E++,d++,e}return C[d++]}function Z(a,b){return a.z!==b.z?b.z-a.z:a.id!==b.id?a.id-b.id:0}function J(e,t){var r=0,o=1,n=e.z+e.w,l=t.z+t.w,h=-e.z+e.w,c=-t.z+t.w;return n>=0&&l>=0&&h>=0&&c>=0||!(n<0&&l<0||h<0&&c<0)&&(n<0?r=Math.max(r,n/(n-l)):l<0&&(o=Math.min(o,n/(n-l))),h<0?r=Math.max(r,h/(h-c)):c<0&&(o=Math.min(o,h/(h-c))),!(o<r)&&(e.lerp(t,r),t.lerp(e,1-o),!0))}this.projectScene=function(e,r,v,y){var object,x,M,w,S,A,T,C,E,U;l=0,c=0,d=0,L.elements.length=0,!0===e.autoUpdate&&e.updateMatrixWorld(),void 0===r.parent&&r.updateMatrixWorld(),z.copy(r.matrixWorldInverse.getInverse(r.matrixWorld)),I.multiplyMatrices(r.projectionMatrix,z),G.setFromMatrix(I),function(e,r){t=0,L.objects.length=0,L.lights.length=0,W(e),!0===r&&L.objects.sort(Z)}(e,v);for(var V=0,ol=L.objects.length;V<ol;V++)if(x=(object=L.objects[V].object).geometry,X.setObject(object),m=object.matrixWorld,o=0,object instanceof oe.Mesh){if(x instanceof oe.BufferGeometry){var N=x.attributes,O=x.offsets;if(void 0===N.position)continue;for(var i=0,ee=(Re=N.position.array).length;i<ee;i+=3)X.pushVertex(Re[i],Re[i+1],Re[i+2]);var te=N.normal.array;for(i=0,ee=te.length;i<ee;i+=3)X.pushNormal(te[i],te[i+1],te[i+2]);if(void 0!==N.index){var re=N.index.array;if(O.length>0)for(V=0;V<O.length;V++){var ie=O[V],ae=ie.index;for(i=ie.start,ee=ie.start+ie.count;i<ee;i+=3)X.pushTriangle(re[i]+ae,re[i+1]+ae,re[i+2]+ae)}else for(i=0,ee=re.length;i<ee;i+=3)X.pushTriangle(re[i],re[i+1],re[i+2])}else for(i=0,ee=Re.length/3;i<ee;i+=3)X.pushTriangle(i,i+1,i+2)}else if(x instanceof oe.Geometry){M=x.vertices,w=x.faces,T=x.faceVertexUvs,k.getNormalMatrix(m),U=!0===(E=object.material instanceof oe.MeshFaceMaterial)?object.material:null;for(var ne=0,se=M.length;ne<se;ne++){var le=M[ne];X.pushVertex(le.x,le.y,le.z)}for(var he=0,ce=w.length;he<ce;he++){S=w[he];var ue=!0===E?U.materials[S.materialIndex]:object.material;if(void 0!==ue){var fe=ue.side,pe=_[S.a],de=_[S.b],me=_[S.c];if(!0===ue.morphTargets){var ge=x.morphTargets,ve=object.morphTargetInfluences,ye=pe.position,xe=de.position,_e=me.position;P.set(0,0,0),R.set(0,0,0),D.set(0,0,0);for(var Me=0,be=ge.length;Me<be;Me++){var we=ve[Me];if(0!==we){var Se=ge[Me].vertices;P.x+=(Se[S.a].x-ye.x)*we,P.y+=(Se[S.a].y-ye.y)*we,P.z+=(Se[S.a].z-ye.z)*we,R.x+=(Se[S.b].x-xe.x)*we,R.y+=(Se[S.b].y-xe.y)*we,R.z+=(Se[S.b].z-xe.z)*we,D.x+=(Se[S.c].x-_e.x)*we,D.y+=(Se[S.c].y-_e.y)*we,D.z+=(Se[S.c].z-_e.z)*we}}pe.position.add(P),de.position.add(R),me.position.add(D),X.projectVertex(pe),X.projectVertex(de),X.projectVertex(me)}var Ae=X.checkTriangleVisibility(pe,de,me);if(!(!1===Ae&&fe===oe.FrontSide||!0===Ae&&fe===oe.BackSide)){(n=K()).id=object.id,n.v1.copy(pe),n.v2.copy(de),n.v3.copy(me),n.normalModel.copy(S.normal),!1!==Ae||fe!==oe.BackSide&&fe!==oe.DoubleSide||n.normalModel.negate(),n.normalModel.applyMatrix3(k).normalize(),n.centroidModel.copy(S.centroid).applyMatrix4(m),A=S.vertexNormals;for(var Te=0,Ce=Math.min(A.length,3);Te<Ce;Te++){var Ee=n.vertexNormalsModel[Te];Ee.copy(A[Te]),!1!==Ae||fe!==oe.BackSide&&fe!==oe.DoubleSide||Ee.negate(),Ee.applyMatrix3(k).normalize()}n.vertexNormalsLength=A.length;for(var Le=0,Pe=Math.min(T.length,3);Le<Pe;Le++)if(void 0!==(C=T[Le][he]))for(var u=0,ul=C.length;u<ul;u++)n.uvs[Le][u]=C[u];n.color=S.color,n.material=ue,n.z=(pe.positionScreen.z+de.positionScreen.z+me.positionScreen.z)/3,L.elements.push(n)}}}}}else if(object instanceof oe.Line){if(x instanceof oe.BufferGeometry){if(void 0!==(N=x.attributes).position){var Re;for(i=0,ee=(Re=N.position.array).length;i<ee;i+=3)X.pushVertex(Re[i],Re[i+1],Re[i+2]);if(void 0!==N.index)for(i=0,ee=(re=N.index.array).length;i<ee;i+=2)X.pushLine(re[i],re[i+1]);else for(i=0,ee=Re.length/3-1;i<ee;i++)X.pushLine(i,i+1)}}else if(x instanceof oe.Geometry){if(B.multiplyMatrices(I,m),0===(M=object.geometry.vertices).length)continue;(pe=Y()).positionScreen.copy(M[0]).applyMatrix4(B);var De=object.type===oe.LinePieces?2:1;for(ne=1,se=M.length;ne<se;ne++)(pe=Y()).positionScreen.copy(M[ne]).applyMatrix4(B),(ne+1)%De>0||(de=_[o-2],H.copy(pe.positionScreen),j.copy(de.positionScreen),!0===J(H,j)&&(H.multiplyScalar(1/H.w),j.multiplyScalar(1/j.w),(h=$()).id=object.id,h.v1.positionScreen.copy(H),h.v2.positionScreen.copy(j),h.z=Math.max(H.z,j.z),h.material=object.material,object.material.vertexColors===oe.VertexColors&&(h.vertexColors[0].copy(object.geometry.colors[ne]),h.vertexColors[1].copy(object.geometry.colors[ne-1])),L.elements.push(h)))}}else if(object instanceof oe.Sprite){F.set(m.elements[12],m.elements[13],m.elements[14],1),F.applyMatrix4(I);var Ue=1/F.w;F.z*=Ue,F.z>=-1&&F.z<=1&&((f=Q()).id=object.id,f.x=F.x*Ue,f.y=F.y*Ue,f.z=F.z,f.object=object,f.rotation=object.rotation,f.scale.x=object.scale.x*Math.abs(f.x-(F.x+r.projectionMatrix.elements[0])/(F.w+r.projectionMatrix.elements[12])),f.scale.y=object.scale.y*Math.abs(f.y-(F.y+r.projectionMatrix.elements[5])/(F.w+r.projectionMatrix.elements[13])),f.material=object.material,L.elements.push(f))}return!0===y&&L.elements.sort(Z),L}},oe.Face3=function(a,b,e,t,r,o){this.a=a,this.b=b,this.c=e,this.normal=t instanceof oe.Vector3?t:new oe.Vector3,this.vertexNormals=t instanceof Array?t:[],this.color=r instanceof oe.Color?r:new oe.Color,this.vertexColors=r instanceof Array?r:[],this.vertexTangents=[],this.materialIndex=void 0!==o?o:0,this.centroid=new oe.Vector3},oe.Face3.prototype={constructor:oe.Face3,clone:function(){var i,e,t=new oe.Face3(this.a,this.b,this.c);for(t.normal.copy(this.normal),t.color.copy(this.color),t.centroid.copy(this.centroid),t.materialIndex=this.materialIndex,i=0,e=this.vertexNormals.length;i<e;i++)t.vertexNormals[i]=this.vertexNormals[i].clone();for(i=0,e=this.vertexColors.length;i<e;i++)t.vertexColors[i]=this.vertexColors[i].clone();for(i=0,e=this.vertexTangents.length;i<e;i++)t.vertexTangents[i]=this.vertexTangents[i].clone();return t}},oe.Face4=function(a,b,e,t,r,o,n){return oe.onwarning("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new oe.Face3(a,b,e,r,o,n)},oe.BufferGeometry=function(){this.id=oe.GeometryIdCount++,this.uuid=oe.Math.generateUUID(),this.className="BufferGeometry",this.name="",this.attributes={},this.offsets=[],this.boundingBox=null,this.boundingSphere=null},oe.BufferGeometry.prototype={constructor:oe.BufferGeometry,addAttribute:function(e,t,r,o){return this.attributes[e]={array:new t(r*o),itemSize:o},this.attributes[e]},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.multiplyVector3Array(t.array),t.needsUpdate=!0);var r=this.attributes.normal;void 0!==r&&((new oe.Matrix3).getNormalMatrix(e).multiplyVector3Array(r.array),r.needsUpdate=!0)},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new oe.Box3);var e=this.attributes.position.array;if(e){var t=this.boundingBox;e.length>=3&&(t.min.x=t.max.x=e[0],t.min.y=t.max.y=e[1],t.min.z=t.max.z=e[2]);for(var i=3,r=e.length;i<r;i+=3){var o=e[i],n=e[i+1],l=e[i+2];o<t.min.x?t.min.x=o:o>t.max.x&&(t.max.x=o),n<t.min.y?t.min.y=n:n>t.max.y&&(t.max.y=n),l<t.min.z?t.min.z=l:l>t.max.z&&(t.max.z=l)}}void 0!==e&&0!==e.length||(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0))},computeBoundingSphere:function(){var e=new oe.Box3,t=new oe.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new oe.Sphere);var r=this.attributes.position.array;if(r){e.makeEmpty();for(var o=this.boundingSphere.center,i=0,n=r.length;i<n;i+=3)t.set(r[i],r[i+1],r[i+2]),e.addPoint(t);e.center(o);var l=0;for(i=0,n=r.length;i<n;i+=3)t.set(r[i],r[i+1],r[i+2]),l=Math.max(l,o.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(l)}}}(),computeVertexNormals:function(){if(this.attributes.position){var i,e,t,r,o=this.attributes.position.array.length;if(void 0===this.attributes.normal)this.attributes.normal={itemSize:3,array:new Float32Array(o)};else for(i=0,e=this.attributes.normal.array.length;i<e;i++)this.attributes.normal.array[i]=0;var n,l,h,c,f,d,m=this.attributes.position.array,v=this.attributes.normal.array,y=new oe.Vector3,x=new oe.Vector3,_=new oe.Vector3,M=new oe.Vector3,w=new oe.Vector3;if(this.attributes.index){var S=this.attributes.index.array,A=this.offsets;for(t=0,r=A.length;t<r;++t){var T=A[t].start,C=A[t].count,E=A[t].index;for(i=T,e=T+C;i<e;i+=3)n=E+S[i],l=E+S[i+1],h=E+S[i+2],c=m[3*n],f=m[3*n+1],d=m[3*n+2],y.set(c,f,d),c=m[3*l],f=m[3*l+1],d=m[3*l+2],x.set(c,f,d),c=m[3*h],f=m[3*h+1],d=m[3*h+2],_.set(c,f,d),M.subVectors(_,x),w.subVectors(y,x),M.cross(w),v[3*n]+=M.x,v[3*n+1]+=M.y,v[3*n+2]+=M.z,v[3*l]+=M.x,v[3*l+1]+=M.y,v[3*l+2]+=M.z,v[3*h]+=M.x,v[3*h+1]+=M.y,v[3*h+2]+=M.z}}else for(i=0,e=m.length;i<e;i+=9)c=m[i],f=m[i+1],d=m[i+2],y.set(c,f,d),c=m[i+3],f=m[i+4],d=m[i+5],x.set(c,f,d),c=m[i+6],f=m[i+7],d=m[i+8],_.set(c,f,d),M.subVectors(_,x),w.subVectors(y,x),M.cross(w),v[i]=M.x,v[i+1]=M.y,v[i+2]=M.z,v[i+3]=M.x,v[i+4]=M.y,v[i+5]=M.z,v[i+6]=M.x,v[i+7]=M.y,v[i+8]=M.z;this.normalizeNormals(),this.normalsNeedUpdate=!0}},normalizeNormals:function(){for(var e,t,r,o,n=this.attributes.normal.array,i=0,l=n.length;i<l;i+=3)e=n[i],t=n[i+1],r=n[i+2],o=1/Math.sqrt(e*e+t*t+r*r),n[i]*=o,n[i+1]*=o,n[i+2]*=o},computeTangents:function(){if(void 0!==this.attributes.index&&void 0!==this.attributes.position&&void 0!==this.attributes.normal&&void 0!==this.attributes.uv){var e=this.attributes.index.array,t=this.attributes.position.array,r=this.attributes.normal.array,o=this.attributes.uv.array,n=t.length/3;if(void 0===this.attributes.tangent){var l=4*n;this.attributes.tangent={itemSize:4,array:new Float32Array(l)}}for(var h,c,f,d,m,v,y,x,_,M,w,S,A,T,C,E,L,P,R,D,U,F,V,N,O,z,I=this.attributes.tangent.array,B=[],k=[],G=0;G<n;G++)B[G]=new oe.Vector3,k[G]=new oe.Vector3;var i,H,j,W,X,Y,K,a,b,$,Q=new oe.Vector3,Z=new oe.Vector3,J=this.offsets;for(j=0,W=J.length;j<W;++j){var ee=J[j].start,te=J[j].count,re=J[j].index;for(i=ee,H=ee+te;i<H;i+=3)X=re+e[i],Y=re+e[i+1],K=re+e[i+2],b=Y,$=K,h=t[3*(a=X)],c=t[3*a+1],f=t[3*a+2],d=t[3*b],m=t[3*b+1],v=t[3*b+2],y=t[3*$],x=t[3*$+1],_=t[3*$+2],M=o[2*a],w=o[2*a+1],S=o[2*b],A=o[2*b+1],T=o[2*$],C=o[2*$+1],E=d-h,L=y-h,P=m-c,R=x-c,D=v-f,U=_-f,z=1/((F=S-M)*(O=C-w)-(V=T-M)*(N=A-w)),Q.set((O*E-N*L)*z,(O*P-N*R)*z,(O*D-N*U)*z),Z.set((F*L-V*E)*z,(F*R-V*P)*z,(F*U-V*D)*z),B[a].add(Q),B[b].add(Q),B[$].add(Q),k[a].add(Z),k[b].add(Z),k[$].add(Z)}var ie,ae,ne,se=new oe.Vector3,le=new oe.Vector3,he=new oe.Vector3,ce=new oe.Vector3;for(j=0,W=J.length;j<W;++j){ee=J[j].start,te=J[j].count,re=J[j].index;for(i=ee,H=ee+te;i<H;i+=3)X=re+e[i],Y=re+e[i+1],K=re+e[i+2],ue(X),ue(Y),ue(K)}}else oe.onwarning("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");function ue(e){he.x=r[3*e],he.y=r[3*e+1],he.z=r[3*e+2],ce.copy(he),ae=B[e],se.copy(ae),se.sub(he.multiplyScalar(he.dot(ae))).normalize(),le.crossVectors(ce,ae),ne=le.dot(k[e]),ie=ne<0?-1:1,I[4*e]=se.x,I[4*e+1]=se.y,I[4*e+2]=se.z,I[4*e+3]=ie}},computeOffsets:function(e){var t=e;void 0===e&&(t=65535);Date.now();for(var r=this.attributes.index.array,o=this.attributes.position.array,n=(o.length,r.length/3),l=new Uint16Array(r.length),h=0,c=0,f=[{start:0,count:0,index:0}],d=f[0],m=0,v=new Int32Array(6),y=new Int32Array(o.length),x=new Int32Array(o.length),_=0;_<o.length;_++)y[_]=-1,x[_]=-1;for(var M=0;M<n;M++){m=0;for(var w=0;w<3;w++){-1==y[C=r[3*M+w]]?(v[2*w]=C,v[2*w+1]=-1,m++):y[C]<d.index?(v[2*w]=C,v[2*w+1]=-1):(v[2*w]=C,v[2*w+1]=y[C])}if(c+m>d.index+t){var S={start:h,count:0,index:c};f.push(S),d=S;for(var A=0;A<6;A+=2){(T=v[A+1])>-1&&T<d.index&&(v[A+1]=-1)}}for(A=0;A<6;A+=2){var T,C=v[A];-1===(T=v[A+1])&&(T=c++),y[C]=T,x[T]=C,l[h++]=T-d.index,d.count++}}return this.reorderBuffers(l,x,c),this.offsets=f,f},reorderBuffers:function(e,t,r){var o={},n=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];for(var l in this.attributes)if("index"!=l)for(var h=this.attributes[l].array,i=0,c=n.length;i<c;i++){var f=n[i];if(h instanceof f){o[l]=new f(this.attributes[l].itemSize*r);break}}for(var d=0;d<r;d++){var m=t[d];for(var l in this.attributes)if("index"!=l)for(var v=this.attributes[l].array,y=this.attributes[l].itemSize,x=o[l],_=0;_<y;_++)x[d*y+_]=v[m*y+_]}for(var l in this.attributes.index.array=e,this.attributes)"index"!=l&&(this.attributes[l].array=o[l],this.attributes[l].numItems=this.attributes[l].itemSize*r)},clone:function(){var e=new oe.BufferGeometry,t=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];for(var r in this.attributes){for(var o=this.attributes[r],n=o.array,l={itemSize:o.itemSize,array:null},i=0,h=t.length;i<h;i++){var c=t[i];if(n instanceof c){l.array=new c(n);break}}e.attributes[r]=l}for(i=0,h=this.offsets.length;i<h;i++){var f=this.offsets[i];e.offsets.push({start:f.start,index:f.index,count:f.count})}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},oe.EventDispatcher.prototype.apply(oe.BufferGeometry.prototype),oe.Geometry=function(){this.id=oe.GeometryIdCount++,this.uuid=oe.Math.generateUUID(),this.className="Geometry",this.name="",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!0,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.tangentsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.buffersNeedUpdate=!1},oe.Geometry.prototype={constructor:oe.Geometry,applyMatrix:function(e){for(var t=(new oe.Matrix3).getNormalMatrix(e),i=0,r=this.vertices.length;i<r;i++){this.vertices[i].applyMatrix4(e)}for(i=0,r=this.faces.length;i<r;i++){var o=this.faces[i];o.normal.applyMatrix3(t).normalize();for(var n=0,l=o.vertexNormals.length;n<l;n++)o.vertexNormals[n].applyMatrix3(t).normalize();o.centroid.applyMatrix4(e)}this.boundingBox instanceof oe.Box3&&this.computeBoundingBox(),this.boundingSphere instanceof oe.Sphere&&this.computeBoundingSphere()},computeCentroids:function(){var e,t,r;for(e=0,t=this.faces.length;e<t;e++)(r=this.faces[e]).centroid.set(0,0,0),r.centroid.add(this.vertices[r.a]),r.centroid.add(this.vertices[r.b]),r.centroid.add(this.vertices[r.c]),r.centroid.divideScalar(3)},computeFaceNormals:function(){for(var e=new oe.Vector3,t=new oe.Vector3,r=0,o=this.faces.length;r<o;r++){var n=this.faces[r],l=this.vertices[n.a],h=this.vertices[n.b],c=this.vertices[n.c];e.subVectors(c,h),t.subVectors(l,h),e.cross(t),e.normalize(),n.normal.copy(e)}},computeVertexNormals:function(e){var t,r,o,n,l,h;for(h=new Array(this.vertices.length),t=0,r=this.vertices.length;t<r;t++)h[t]=new oe.Vector3;if(e){var c,f,d,m=new oe.Vector3,v=new oe.Vector3;new oe.Vector3,new oe.Vector3,new oe.Vector3;for(o=0,n=this.faces.length;o<n;o++)l=this.faces[o],c=this.vertices[l.a],f=this.vertices[l.b],d=this.vertices[l.c],m.subVectors(d,f),v.subVectors(c,f),m.cross(v),h[l.a].add(m),h[l.b].add(m),h[l.c].add(m)}else for(o=0,n=this.faces.length;o<n;o++)h[(l=this.faces[o]).a].add(l.normal),h[l.b].add(l.normal),h[l.c].add(l.normal);for(t=0,r=this.vertices.length;t<r;t++)h[t].normalize();for(o=0,n=this.faces.length;o<n;o++)(l=this.faces[o]).vertexNormals[0]=h[l.a].clone(),l.vertexNormals[1]=h[l.b].clone(),l.vertexNormals[2]=h[l.c].clone()},computeMorphNormals:function(){var i,e,t,r,o;for(t=0,r=this.faces.length;t<r;t++)for((o=this.faces[t]).__originalFaceNormal?o.__originalFaceNormal.copy(o.normal):o.__originalFaceNormal=o.normal.clone(),o.__originalVertexNormals||(o.__originalVertexNormals=[]),i=0,e=o.vertexNormals.length;i<e;i++)o.__originalVertexNormals[i]?o.__originalVertexNormals[i].copy(o.vertexNormals[i]):o.__originalVertexNormals[i]=o.vertexNormals[i].clone();var n=new oe.Geometry;for(n.faces=this.faces,i=0,e=this.morphTargets.length;i<e;i++){if(!this.morphNormals[i]){this.morphNormals[i]={},this.morphNormals[i].faceNormals=[],this.morphNormals[i].vertexNormals=[];var l=this.morphNormals[i].faceNormals,h=this.morphNormals[i].vertexNormals;for(t=0,r=this.faces.length;t<r;t++)o=this.faces[t],c=new oe.Vector3,f={a:new oe.Vector3,b:new oe.Vector3,c:new oe.Vector3},l.push(c),h.push(f)}var c,f,d=this.morphNormals[i];for(n.vertices=this.morphTargets[i].vertices,n.computeFaceNormals(),n.computeVertexNormals(),t=0,r=this.faces.length;t<r;t++)o=this.faces[t],c=d.faceNormals[t],f=d.vertexNormals[t],c.copy(o.normal),f.a.copy(o.vertexNormals[0]),f.b.copy(o.vertexNormals[1]),f.c.copy(o.vertexNormals[2])}for(t=0,r=this.faces.length;t<r;t++)(o=this.faces[t]).normal=o.__originalFaceNormal,o.vertexNormals=o.__originalVertexNormals},computeTangents:function(){var e,t,r,o,i,n,l,h,c,f,d,m,v,y,x,_,M,w,S,A,T,C,E,L,P,R,D,U,a,b,F,V,N,O,z=[],I=[],B=new oe.Vector3,k=new oe.Vector3,G=new oe.Vector3,H=new oe.Vector3,j=new oe.Vector3;for(r=0,o=this.vertices.length;r<o;r++)z[r]=new oe.Vector3,I[r]=new oe.Vector3;for(e=0,t=this.faces.length;e<t;e++)l=this.faces[e],h=this.faceVertexUvs[0][e],U=this,a=l.a,b=l.b,F=l.c,V=0,N=1,O=2,c=U.vertices[a],f=U.vertices[b],d=U.vertices[F],m=h[V],v=h[N],y=h[O],x=f.x-c.x,_=d.x-c.x,M=f.y-c.y,w=d.y-c.y,S=f.z-c.z,A=d.z-c.z,T=v.x-m.x,C=y.x-m.x,E=v.y-m.y,L=y.y-m.y,P=1/(T*L-C*E),B.set((L*x-E*_)*P,(L*M-E*w)*P,(L*S-E*A)*P),k.set((T*_-C*x)*P,(T*w-C*M)*P,(T*A-C*S)*P),z[a].add(B),z[b].add(B),z[F].add(B),I[a].add(k),I[b].add(k),I[F].add(k);var W=["a","b","c","d"];for(e=0,t=this.faces.length;e<t;e++)for(l=this.faces[e],i=0;i<Math.min(l.vertexNormals.length,3);i++)j.copy(l.vertexNormals[i]),n=l[W[i]],R=z[n],G.copy(R),G.sub(j.multiplyScalar(j.dot(R))).normalize(),H.crossVectors(l.vertexNormals[i],R),D=H.dot(I[n])<0?-1:1,l.vertexTangents[i]=new oe.Vector4(G.x,G.y,G.z,D);this.hasTangents=!0},computeLineDistances:function(){for(var e=0,t=this.vertices,i=0,r=t.length;i<r;i++)i>0&&(e+=t[i].distanceTo(t[i-1])),this.lineDistances[i]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new oe.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new oe.Sphere),this.boundingSphere.setFromPoints(this.vertices)},mergeVertices:function(){var e,t,i,r,o,n,l,h,c={},f=[],d=[],m=Math.pow(10,4);for(i=0,r=this.vertices.length;i<r;i++)e=this.vertices[i],void 0===c[t=Math.round(e.x*m)+"_"+Math.round(e.y*m)+"_"+Math.round(e.z*m)]?(c[t]=i,f.push(this.vertices[i]),d[i]=f.length-1):d[i]=d[c[t]];var v=[];for(i=0,r=this.faces.length;i<r;i++){(o=this.faces[i]).a=d[o.a],o.b=d[o.b],o.c=d[o.c],n=[o.a,o.b,o.c];for(var y=0;y<3;y++)if(n[y]==n[(y+1)%3]){y,v.push(i);break}}for(i=v.length-1;i>=0;i--){var x=v[i];for(this.faces.splice(x,1),l=0,h=this.faceVertexUvs.length;l<h;l++)this.faceVertexUvs[l].splice(x,1)}var _=this.vertices.length-f.length;return this.vertices=f,_},makeGroups:(k=0,function(e){var t,r,o,n,l,h={},c=this.morphTargets.length,f=this.morphNormals.length;for(this.geometryGroups={},t=0,r=this.faces.length;t<r;t++)o=this.faces[t],(n=e?o.materialIndex:0)in h||(h[n]={hash:n,counter:0}),(l=h[n].hash+"_"+h[n].counter)in this.geometryGroups||(this.geometryGroups[l]={faces3:[],materialIndex:n,vertices:0,numMorphTargets:c,numMorphNormals:f}),this.geometryGroups[l].vertices+3>65535&&(h[n].counter+=1,(l=h[n].hash+"_"+h[n].counter)in this.geometryGroups||(this.geometryGroups[l]={faces3:[],materialIndex:n,vertices:0,numMorphTargets:c,numMorphNormals:f})),this.geometryGroups[l].faces3.push(t),this.geometryGroups[l].vertices+=3;for(var g in this.geometryGroupsList=[],this.geometryGroups)this.geometryGroups[g].id=k++,this.geometryGroupsList.push(this.geometryGroups[g])}),clone:function(){for(var e=new oe.Geometry,t=this.vertices,i=0,r=t.length;i<r;i++)e.vertices.push(t[i].clone());var o=this.faces;for(i=0,r=o.length;i<r;i++)e.faces.push(o[i].clone());var n=this.faceVertexUvs[0];for(i=0,r=n.length;i<r;i++){for(var l=n[i],h=[],c=0,f=l.length;c<f;c++)h.push(new oe.Vector2(l[c].x,l[c].y));e.faceVertexUvs[0].push(h)}return e.morphTargets=this.morphTargets.slice(0),e.morphColors=this.morphColors.slice(0),e.morphNormals=this.morphNormals.slice(0),e.skinWeights=this.skinWeights.slice(0),e.skinIndices=this.skinIndices.slice(0),e.lineDistances=this.lineDistances.slice(0),this.boundingBox&&(e.boundingBox=this.boundingBox.clone()),this.boundingSphere&&(e.boundingSphere=this.boundingSphere.clone()),e.hasTangents=this.hasTangents,e.dynamic=this.dynamic,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},oe.EventDispatcher.prototype.apply(oe.Geometry.prototype),oe.GeometryIdCount=0,oe.Geometry2=function(e){oe.BufferGeometry.call(this),this.className="Geometry2",this.vertices=this.addAttribute("position",Float32Array,e,3).array,this.normals=this.addAttribute("normal",Float32Array,e,3).array,this.uvs=this.addAttribute("uv",Float32Array,e,2).array,this.boundingBox=null,this.boundingSphere=null},oe.Geometry2.prototype=Object.create(oe.BufferGeometry.prototype),oe.Camera=function(){oe.Object3D.call(this),this.matrixWorldInverse=new oe.Matrix4,this.projectionMatrix=new oe.Matrix4},oe.Camera.prototype=Object.create(oe.Object3D.prototype),oe.Camera.prototype.lookAt=function(){var e=new oe.Matrix4;return function(t){e.lookAt(this.position,t,this.up),this.quaternion.setFromRotationMatrix(e)}}(),oe.Camera.prototype.clone=function(e){return void 0===e&&(e=new oe.Camera),oe.Object3D.prototype.clone.call(this,e),e.matrixWorldInverse.copy(this.matrixWorldInverse),e.projectionMatrix.copy(this.projectionMatrix),e},oe.OrthographicCamera=function(e,t,r,o,n,l){oe.Camera.call(this),this.left=e,this.right=t,this.top=r,this.bottom=o,this.near=void 0!==n?n:.1,this.far=void 0!==l?l:2e3,this.updateProjectionMatrix()},oe.OrthographicCamera.prototype=Object.create(oe.Camera.prototype),oe.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)},oe.OrthographicCamera.prototype.clone=function(){var e=new oe.OrthographicCamera;return oe.Camera.prototype.clone.call(this,e),e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e},oe.PerspectiveCamera=function(e,t,r,o){oe.Camera.call(this),this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==r?r:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()},oe.PerspectiveCamera.prototype=Object.create(oe.Camera.prototype),oe.PerspectiveCamera.prototype.setLens=function(e,t){void 0===t&&(t=24),this.fov=2*oe.Math.radToDeg(Math.atan(t/(2*e))),this.updateProjectionMatrix()},oe.PerspectiveCamera.prototype.setViewOffset=function(e,t,r,o,n,l){this.fullWidth=e,this.fullHeight=t,this.x=r,this.y=o,this.width=n,this.height=l,this.updateProjectionMatrix()},oe.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var e=this.fullWidth/this.fullHeight,t=Math.tan(oe.Math.degToRad(.5*this.fov))*this.near,r=-t,o=e*r,n=e*t,l=Math.abs(n-o),h=Math.abs(t-r);this.projectionMatrix.makeFrustum(o+this.x*l/this.fullWidth,o+(this.x+this.width)*l/this.fullWidth,t-(this.y+this.height)*h/this.fullHeight,t-this.y*h/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},oe.PerspectiveCamera.prototype.clone=function(){var e=new oe.PerspectiveCamera;return oe.Camera.prototype.clone.call(this,e),e.fov=this.fov,e.aspect=this.aspect,e.near=this.near,e.far=this.far,e},oe.Light=function(e){oe.Object3D.call(this),this.color=new oe.Color(e)},oe.Light.prototype=Object.create(oe.Object3D.prototype),oe.Light.prototype.clone=function(e){return void 0===e&&(e=new oe.Light),oe.Object3D.prototype.clone.call(this,e),e.color.copy(this.color),e},oe.AmbientLight=function(e){oe.Light.call(this,e)},oe.AmbientLight.prototype=Object.create(oe.Light.prototype),oe.AmbientLight.prototype.clone=function(){var e=new oe.AmbientLight;return oe.Light.prototype.clone.call(this,e),e},oe.AreaLight=function(e,t,r,o){oe.Light.call(this,e),this.position.set(0,1,0),this.target=new oe.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==r?r:0,this.decayExponent=void 0!==o?o:0,this.width=1,this.height=1},oe.AreaLight.prototype=Object.create(oe.Light.prototype),oe.AreaLight.prototype.clone=function(){var e=new oe.AreaLight;return oe.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.distance=this.distance,e.decayExponent=this.decayExponent,e.width=this.width,e.height=this.height,e},oe.DirectionalLight=function(e,t){oe.Light.call(this,e),this.position.set(0,1,0),this.target=new oe.Object3D,this.intensity=void 0!==t?t:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new oe.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},oe.DirectionalLight.prototype=Object.create(oe.Light.prototype),oe.DirectionalLight.prototype.clone=function(){var e=new oe.DirectionalLight;return oe.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e},oe.HemisphereLight=function(e,t,r){oe.Light.call(this,e),this.position.set(0,100,0),this.groundColor=new oe.Color(t),this.intensity=void 0!==r?r:1},oe.HemisphereLight.prototype=Object.create(oe.Light.prototype),oe.HemisphereLight.prototype.clone=function(){var e=new oe.HemisphereLight;return oe.Light.prototype.clone.call(this,e),e.groundColor.copy(this.groundColor),e.intensity=this.intensity,e},oe.PointLight=function(e,t,r,o){oe.Light.call(this,e),this.intensity=void 0!==t?t:1,this.distance=void 0!==r?r:0,this.decayExponent=void 0!==o?o:0},oe.PointLight.prototype=Object.create(oe.Light.prototype),oe.PointLight.prototype.clone=function(){var e=new oe.PointLight;return oe.Light.prototype.clone.call(this,e),e.intensity=this.intensity,e.distance=this.distance,e.decayExponent=this.decayExponent,e},oe.SpotLight=function(e,t,r,o,n,l){oe.Light.call(this,e),this.position.set(0,1,0),this.target=new oe.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==r?r:0,this.decayExponent=void 0!==l?l:0,this.angle=void 0!==o?o:Math.PI/3,this.exponent=void 0!==n?n:10,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},oe.SpotLight.prototype=Object.create(oe.Light.prototype),oe.SpotLight.prototype.clone=function(){var e=new oe.SpotLight;return oe.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.distance=this.distance,e.angle=this.angle,e.exponent=this.exponent,e.decayExponent=this.decayExponent,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e},oe.Loader=function(e){this.showStatus=e,this.statusDomElement=e?oe.Loader.prototype.addStatusElement():null,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},oe.Loader.prototype={constructor:oe.Loader,crossOrigin:void 0,addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(progress){var e="Loaded ";progress.total?e+=(100*progress.loaded/progress.total).toFixed(0)+"%":e+=(progress.loaded/1e3).toFixed(2)+" KB",this.statusDomElement.innerHTML=e},extractUrlBase:function(e){var t=e.split("/");return 1===t.length?"./":(t.pop(),t.join("/")+"/")},initMaterials:function(e,t){for(var r=[],i=0;i<e.length;++i)r[i]=oe.Loader.prototype.createMaterial(e[i],t);return r},needsTangents:function(e){for(var i=0,t=e.length;i<t;i++){if(e[i]instanceof oe.ShaderMaterial)return!0}return!1},createMaterial:function(e,t){var r=this;function o(e){var t=Math.log(e)/Math.LN2;return Math.floor(t)==t}function n(e){var t=Math.log(e)/Math.LN2;return Math.pow(2,Math.round(t))}function l(e,l,h,c,f,d,m){var v=/\.dds$/i.test(h),y=t+h;if(v){var x=oe.ImageUtils.loadCompressedTexture(y);e[l]=x}else{x=document.createElement("canvas");e[l]=new oe.Texture(x)}if(e[l].sourceFile=h,c&&(e[l].repeat.set(c[0],c[1]),1!==c[0]&&(e[l].wrapS=oe.RepeatWrapping),1!==c[1]&&(e[l].wrapT=oe.RepeatWrapping)),f&&e[l].offset.set(f[0],f[1]),d){var _={repeat:oe.RepeatWrapping,mirror:oe.MirroredRepeatWrapping};void 0!==_[d[0]]&&(e[l].wrapS=_[d[0]]),void 0!==_[d[1]]&&(e[l].wrapT=_[d[1]])}m&&(e[l].anisotropy=m),v||function(e,t){var image=new Image;image.onload=function(){if(o(this.width)&&o(this.height))e.image=this;else{var t=n(this.width),r=n(this.height);e.image.width=t,e.image.height=r,e.image.getContext("2d").drawImage(this,0,0,t,r)}e.needsUpdate=!0},void 0!==r.crossOrigin&&(image.crossOrigin=r.crossOrigin),image.src=t}(e[l],y)}function h(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]}var c="MeshLambertMaterial",f={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(e.shading){var d=e.shading.toLowerCase();"phong"===d?c="MeshPhongMaterial":"basic"===d?c="MeshBasicMaterial":"physical"===d&&(c="MeshPhysicalMaterial")}if(void 0!==e.blending&&void 0!==oe[e.blending]&&(f.blending=oe[e.blending]),(void 0!==e.transparent||e.opacity<1)&&(f.transparent=e.transparent),void 0!==e.depthTest&&(f.depthTest=e.depthTest),void 0!==e.depthWrite&&(f.depthWrite=e.depthWrite),void 0!==e.visible&&(f.visible=e.visible),void 0!==e.flipSided&&(f.side=oe.BackSide),void 0!==e.doubleSided&&(f.side=oe.DoubleSide),void 0!==e.wireframe&&(f.wireframe=e.wireframe),void 0!==e.vertexColors&&("face"===e.vertexColors?f.vertexColors=oe.FaceColors:e.vertexColors&&(f.vertexColors=oe.VertexColors)),e.colorDiffuse?f.color=h(e.colorDiffuse):e.DbgColor&&(f.color=e.DbgColor),e.colorSpecular&&(f.specular=h(e.colorSpecular)),e.colorAmbient&&(f.ambient=h(e.colorAmbient)),e.transparency&&(f.opacity=e.transparency),e.specularCoef&&(f.shininess=e.specularCoef),e.mapDiffuse&&t&&l(f,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy),e.mapLight&&t&&l(f,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy),e.mapBump&&t&&l(f,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy),e.mapNormal&&t&&l(f,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy),e.mapSpecular&&t&&l(f,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy),e.mapBumpScale&&(f.bumpScale=e.mapBumpScale),e.mapNormal){var m=oe.ShaderLib.normalmap,v=oe.UniformsUtils.clone(m.uniforms);v.tNormal.value=f.normalMap,e.mapNormalFactor&&v.uNormalScale.value.set(e.mapNormalFactor,e.mapNormalFactor),f.map&&(v.tDiffuse.value=f.map,v.enableDiffuse.value=!0),f.specularMap&&(v.tSpecular.value=f.specularMap,v.enableSpecular.value=!0),f.lightMap&&(v.tAO.value=f.lightMap,v.enableAO.value=!0),v.diffuse.value.setHex(f.color),v.specular.value.setHex(f.specular),v.ambient.value.setHex(f.ambient),v.shininess.value=f.shininess,void 0!==f.opacity&&(v.opacity.value=f.opacity);var y={fragmentShader:m.fragmentShader,vertexShader:m.vertexShader,uniforms:v,lights:!0,fog:!0},x=new oe.ShaderMaterial(y);f.transparent&&(x.transparent=!0)}else x=new oe[c](f);return void 0!==e.DbgName&&(x.name=e.DbgName),x}},oe.XHRLoader=function(e){this.manager=void 0!==e?e:oe.DefaultLoadingManager},oe.XHRLoader.prototype={constructor:oe.XHRLoader,load:function(e,t,r,o){var n=this,l=new XMLHttpRequest;void 0!==t&&l.addEventListener("load",(function(r){t(r.target.responseText),n.manager.itemEnd(e)}),!1),void 0!==r&&l.addEventListener("progress",(function(e){r(e)}),!1),void 0!==o&&l.addEventListener("error",(function(e){o(e)}),!1),void 0!==this.crossOrigin&&(l.crossOrigin=this.crossOrigin),l.open("GET",e,!0),l.send(null),n.manager.itemStart(e)},setCrossOrigin:function(e){this.crossOrigin=e}},oe.ImageLoader=function(e){this.manager=void 0!==e?e:oe.DefaultLoadingManager},oe.ImageLoader.prototype={constructor:oe.ImageLoader,load:function(e,t,r,o){var n=this,image=document.createElement("img");return void 0!==t&&image.addEventListener("load",(function(r){n.manager.itemEnd(e),t(this)}),!1),void 0!==r&&image.addEventListener("progress",(function(e){r(e)}),!1),void 0!==o&&image.addEventListener("error",(function(e){o(e)}),!1),void 0!==this.crossOrigin&&(image.crossOrigin=this.crossOrigin),image.src=e,n.manager.itemStart(e),image},setCrossOrigin:function(e){this.crossOrigin=e}},oe.JSONLoader=function(e){oe.Loader.call(this,e),this.withCredentials=!1},oe.JSONLoader.prototype=Object.create(oe.Loader.prototype),oe.JSONLoader.prototype.load=function(e,t,r){r=r&&"string"==typeof r?r:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,r)},oe.JSONLoader.prototype.loadAjaxJSON=function(e,t,r,o,n){var l=new XMLHttpRequest,h=0;l.onreadystatechange=function(){if(l.readyState===l.DONE)if(200===l.status||0===l.status){if(l.responseText){var c=JSON.parse(l.responseText);if("scene"===c.metadata.type)return void oe.onerror('THREE.JSONLoader: "'+t+'" seems to be a Scene. Use THREE.SceneLoader instead.');var f=e.parse(c,o);r(f.geometry,f.materials)}else oe.onerror('THREE.JSONLoader: "'+t+'" seems to be unreachable or the file is empty.');e.onLoadComplete()}else oe.onerror("THREE.JSONLoader: Couldn't load \""+t+'" ('+l.status+")");else l.readyState===l.LOADING?n&&(0===h&&(h=l.getResponseHeader("Content-Length")),n({total:h,loaded:l.responseText.length})):l.readyState===l.HEADERS_RECEIVED&&void 0!==n&&(h=l.getResponseHeader("Content-Length"))},l.open("GET",t,!0),l.withCredentials=this.withCredentials,l.send(null)},oe.JSONLoader.prototype.parse=function(e,t){var r=new oe.Geometry,o=void 0!==e.scale?1/e.scale:1;if(function(t){function o(e,t){return e&1<<t}var i,n,l,h,c,f,d,m,v,y,x,_,M,w,S,A,T,C,E,L,P,R,D,U,F,u,V,N=e.faces,O=e.vertices,z=e.normals,I=e.colors,B=0;if(void 0!==e.uvs){for(i=0;i<e.uvs.length;i++)e.uvs[i].length&&B++;for(i=0;i<B;i++)r.faceVertexUvs[i]=[]}h=0,c=O.length;for(;h<c;)(C=new oe.Vector3).x=O[h++]*t,C.y=O[h++]*t,C.z=O[h++]*t,r.vertices.push(C);h=0,c=N.length;for(;h<c;)if(y=N[h++],x=o(y,0),_=o(y,1),M=o(y,3),w=o(y,4),S=o(y,5),A=o(y,6),T=o(y,7),x){if((L=new oe.Face3).a=N[h],L.b=N[h+1],L.c=N[h+3],(P=new oe.Face3).a=N[h+1],P.b=N[h+2],P.c=N[h+3],h+=4,_&&(v=N[h++],L.materialIndex=v,P.materialIndex=v),l=r.faces.length,M)for(i=0;i<B;i++)for(U=e.uvs[i],r.faceVertexUvs[i][l]=[],r.faceVertexUvs[i][l+1]=[],n=0;n<4;n++)m=N[h++],u=U[2*m],V=U[2*m+1],F=new oe.Vector2(u,V),2!==n&&r.faceVertexUvs[i][l].push(F),0!==n&&r.faceVertexUvs[i][l+1].push(F);if(w&&(d=3*N[h++],L.normal.set(z[d++],z[d++],z[d]),P.normal.copy(L.normal)),S)for(i=0;i<4;i++)d=3*N[h++],D=new oe.Vector3(z[d++],z[d++],z[d]),2!==i&&L.vertexNormals.push(D),0!==i&&P.vertexNormals.push(D);if(A&&(f=N[h++],R=I[f],L.color.setHex(R),P.color.setHex(R)),T)for(i=0;i<4;i++)f=N[h++],R=I[f],2!==i&&L.vertexColors.push(new oe.Color(R)),0!==i&&P.vertexColors.push(new oe.Color(R));r.faces.push(L),r.faces.push(P)}else{if((E=new oe.Face3).a=N[h++],E.b=N[h++],E.c=N[h++],_&&(v=N[h++],E.materialIndex=v),l=r.faces.length,M)for(i=0;i<B;i++)for(U=e.uvs[i],r.faceVertexUvs[i][l]=[],n=0;n<3;n++)m=N[h++],u=U[2*m],V=U[2*m+1],F=new oe.Vector2(u,V),r.faceVertexUvs[i][l].push(F);if(w&&(d=3*N[h++],E.normal.set(z[d++],z[d++],z[d])),S)for(i=0;i<3;i++)d=3*N[h++],D=new oe.Vector3(z[d++],z[d++],z[d]),E.vertexNormals.push(D);if(A&&(f=N[h++],E.color.setHex(I[f])),T)for(i=0;i<3;i++)f=N[h++],E.vertexColors.push(new oe.Color(I[f]));r.faces.push(E)}}(o),function(){if(e.skinWeights)for(var i=0,t=e.skinWeights.length;i<t;i+=2){var o=e.skinWeights[i],n=e.skinWeights[i+1];r.skinWeights.push(new oe.Vector4(o,n,0,0))}if(e.skinIndices)for(i=0,t=e.skinIndices.length;i<t;i+=2){var a=e.skinIndices[i],b=e.skinIndices[i+1];r.skinIndices.push(new oe.Vector4(a,b,0,0))}r.bones=e.bones,r.bones&&r.bones.length>0&&(r.skinWeights.length!==r.skinIndices.length||r.skinIndices.length!==r.vertices.length)&&oe.onwarning("When skinning, number of vertices ("+r.vertices.length+"), skinIndices ("+r.skinIndices.length+"), and skinWeights ("+r.skinWeights.length+") should match.");r.animation=e.animation,r.animations=e.animations}(),function(t){var o,n,l,h,i,c,f,d,m,v,y;if(void 0!==e.morphTargets)for(i=0,c=e.morphTargets.length;i<c;i++)for(r.morphTargets[i]={},r.morphTargets[i].name=e.morphTargets[i].name,r.morphTargets[i].vertices=[],l=r.morphTargets[i].vertices,h=e.morphTargets[i].vertices,o=0,n=h.length;o<n;o+=3){var x=new oe.Vector3;x.x=h[o]*t,x.y=h[o+1]*t,x.z=h[o+2]*t,l.push(x)}if(void 0!==e.morphColors)for(i=0,c=e.morphColors.length;i<c;i++)for(r.morphColors[i]={},r.morphColors[i].name=e.morphColors[i].name,r.morphColors[i].colors=[],m=r.morphColors[i].colors,v=e.morphColors[i].colors,f=0,d=v.length;f<d;f+=3)(y=new oe.Color(16755200)).setRGB(v[f],v[f+1],v[f+2]),m.push(y)}(o),r.computeCentroids(),r.computeFaceNormals(),r.computeBoundingSphere(),void 0===e.materials)return{geometry:r};var n=this.initMaterials(e.materials,t);return this.needsTangents(n)&&r.computeTangents(),{geometry:r,materials:n}},oe.LoadingManager=function(e,t,r){var o=this,n=0,l=0;this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(e){l++},this.itemEnd=function(e){n++,void 0!==o.onProgress&&o.onProgress(e,n,l),n===l&&void 0!==o.onLoad&&o.onLoad()}},oe.DefaultLoadingManager=new oe.LoadingManager,oe.BufferGeometryLoader=function(e){this.manager=void 0!==e?e:oe.DefaultLoadingManager},oe.BufferGeometryLoader.prototype={constructor:oe.BufferGeometryLoader,load:function(e,t,r,o){var n=this,l=new oe.XHRLoader;l.setCrossOrigin(this.crossOrigin),l.load(e,(function(text){t(n.parse(JSON.parse(text)))}))},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new oe.BufferGeometry,r=e.attributes,o=e.offsets,n=e.boundingSphere;for(var l in r){var h=r[l];t.attributes[l]={itemSize:h.itemSize,array:new ae[h.type](h.array)}}return void 0!==o&&(t.offsets=JSON.parse(JSON.stringify(o))),void 0!==n&&(t.boundingSphere=new oe.Sphere((new oe.Vector3).fromArray(void 0!==n.center?n.center:[0,0,0]),n.radius)),t}},oe.Geometry2Loader=function(e){this.manager=void 0!==e?e:oe.DefaultLoadingManager},oe.Geometry2Loader.prototype={constructor:oe.Geometry2Loader,load:function(e,t,r,o){var n=this,l=new oe.XHRLoader;l.setCrossOrigin(this.crossOrigin),l.load(e,(function(text){t(n.parse(JSON.parse(text)))}))},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new oe.Geometry2(e.vertices.length/3),r=["vertices","normals","uvs"],o=e.boundingSphere;for(var n in r){var l=r[n];t[l].set(e[l])}return void 0!==o&&(t.boundingSphere=new oe.Sphere((new oe.Vector3).fromArray(void 0!==o.center?o.center:[0,0,0]),o.radius)),t}},oe.MaterialLoader=function(e){this.manager=void 0!==e?e:oe.DefaultLoadingManager},oe.MaterialLoader.prototype={constructor:oe.MaterialLoader,load:function(e,t,r,o){var n=this,l=new oe.XHRLoader;l.setCrossOrigin(this.crossOrigin),l.load(e,(function(text){t(n.parse(JSON.parse(text)))}))},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new oe[e.type];if(void 0!==e.color&&t.color.setHex(e.color),void 0!==e.ambient&&t.ambient.setHex(e.ambient),void 0!==e.emissive&&t.emissive.setHex(e.emissive),void 0!==e.specular&&t.specular.setHex(e.specular),void 0!==e.falloff&&(t.falloff=e.falloff),void 0!==e.falloffColor&&t.falloffColor.setHex(e.falloffColor),void 0!==e.roughness&&(t.roughness=e.roughness),void 0!==e.metallic&&(t.metallic=e.metallic),void 0!==e.clearCoat&&(t.clearCoat=e.clearCoat),void 0!==e.clearCoatRoughness&&(t.clearCoatRoughness=e.clearCoatRoughness),void 0!==e.anisotropy&&(t.anisotropy=e.anisotropy),void 0!==e.anisotropyRotation&&(t.anisotropyRotation=e.anisotropyRotation),void 0!==e.translucency&&t.translucency.setHex(e.translucency),void 0!==e.translucencyNormalAlpha&&(t.translucencyNormalAlpha=e.translucencyNormalAlpha),void 0!==e.translucencyNormalPower&&(t.translucencyNormalPower=e.translucencyNormalPower),void 0!==e.translucencyViewAlpha&&(t.translucencyViewAlpha=e.translucencyViewAlpha),void 0!==e.translucencyViewPower&&(t.translucencyViewPower=e.translucencyViewPower),void 0!==e.shininess&&(t.shininess=e.shininess),void 0!==e.vertexColors&&(t.vertexColors=e.vertexColors),void 0!==e.blending&&(t.blending=e.blending),void 0!==e.side&&(t.side=e.side),void 0!==e.opacity&&(t.opacity=e.opacity),void 0!==e.transparent&&(t.transparent=e.transparent),void 0!==e.wireframe&&(t.wireframe=e.wireframe),void 0!==e.materials)for(var i=0,r=e.materials.length;i<r;i++)t.materials.push(this.parse(e.materials[i]));return t}},oe.ObjectLoader=function(e){this.manager=void 0!==e?e:oe.DefaultLoadingManager},oe.ObjectLoader.prototype={constructor:oe.ObjectLoader,load:function(e,t,r,o){var n=this,l=new oe.XHRLoader(n.manager);l.setCrossOrigin(this.crossOrigin),l.load(e,(function(text){t(n.parse(JSON.parse(text)))}))},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=this.parseGeometries(e.geometries),r=this.parseMaterials(e.materials);return this.parseObject(e.object,t,r)},parseGeometries:function(e){var t={};if(void 0!==e)for(var r=new oe.JSONLoader,o=new oe.Geometry2Loader,n=new oe.BufferGeometryLoader,i=0,l=e.length;i<l;i++){var h,data=e[i];switch(data.type){case"PlaneGeometry":h=new oe.PlaneGeometry(data.width,data.height,data.widthSegments,data.heightSegments);break;case"BoxGeometry":case"CubeGeometry":h=new oe.BoxGeometry(data.width,data.height,data.depth,data.widthSegments,data.heightSegments,data.depthSegments);break;case"CircleGeometry":h=new oe.CircleGeometry(data.radius,data.segments);break;case"CylinderGeometry":h=new oe.CylinderGeometry(data.radiusTop,data.radiusBottom,data.height,data.radialSegments,data.heightSegments,data.openEnded);break;case"SphereGeometry":h=new oe.SphereGeometry(data.radius,data.widthSegments,data.heightSegments,data.phiStart,data.phiLength,data.thetaStart,data.thetaLength);break;case"IcosahedronGeometry":h=new oe.IcosahedronGeometry(data.radius,data.detail);break;case"TorusGeometry":h=new oe.TorusGeometry(data.radius,data.tube,data.radialSegments,data.tubularSegments,data.arc);break;case"TorusKnotGeometry":h=new oe.TorusKnotGeometry(data.radius,data.tube,data.radialSegments,data.tubularSegments,data.p,data.q,data.heightScale);break;case"BufferGeometry":h=n.parse(data.data);break;case"Geometry2":h=o.parse(data.data);break;case"Geometry":h=r.parse(data.data).geometry}h.uuid=data.uuid,void 0!==data.name&&(h.name=data.name),t[data.uuid]=h}return t},parseMaterials:function(e){var t={};if(void 0!==e)for(var r=new oe.MaterialLoader,i=0,o=e.length;i<o;i++){var data=e[i],n=r.parse(data);n.uuid=data.uuid,void 0!==data.name&&(n.name=data.name),t[data.uuid]=n}return t},parseObject:function(){var e=new oe.Matrix4;return function(data,t,r){var object;switch(data.type){case"Scene":object=new oe.Scene;break;case"PerspectiveCamera":object=new oe.PerspectiveCamera(data.fov,data.aspect,data.near,data.far);break;case"OrthographicCamera":object=new oe.OrthographicCamera(data.left,data.right,data.top,data.bottom,data.near,data.far);break;case"AmbientLight":object=new oe.AmbientLight(data.color);break;case"DirectionalLight":object=new oe.DirectionalLight(data.color,data.intensity);break;case"PointLight":(object=new oe.PointLight(data.color,data.intensity,data.distance)).decayExponent=data.decayExponent||0;break;case"SpotLight":(object=new oe.SpotLight(data.color,data.intensity,data.distance,data.angle,data.exponent)).decayExponent=data.decayExponent||0;break;case"HemisphereLight":object=new oe.HemisphereLight(data.color,data.groundColor,data.intensity);break;case"AreaLight":(object=new oe.AreaLight(data.color,data.intensity,data.distance,data.decayExponent)).width=data.width||1,object.height=data.height||1;break;case"Mesh":var o=t[data.geometry],n=r[data.material];void 0===o&&oe.onerror("THREE.ObjectLoader: Undefined geometry "+data.geometry),void 0===n&&oe.onerror("THREE.ObjectLoader: Undefined material "+data.material),object=new oe.Mesh(o,n);break;case"Sprite":void 0===(n=r[data.material])&&oe.onerror("THREE.ObjectLoader: Undefined material "+data.material),object=new oe.Sprite(n);break;default:object=new oe.Object3D}if(object.uuid=data.uuid,void 0!==data.name&&(object.name=data.name),void 0!==data.matrix?(e.fromArray(data.matrix),e.decompose(object.position,object.quaternion,object.scale)):(void 0!==data.position&&object.position.fromArray(data.position),void 0!==data.rotation&&object.rotation.fromArray(data.rotation),void 0!==data.scale&&object.scale.fromArray(data.scale)),void 0!==data.visible&&(object.visible=data.visible),void 0!==data.userData&&(object.userData=data.userData),void 0!==data.children)for(var l in data.children)object.add(this.parseObject(data.children[l],t,r));return object}}()},oe.SceneLoader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){},this.geometryHandlers={},this.hierarchyHandlers={},this.addGeometryHandler("ascii",oe.JSONLoader)},oe.SceneLoader.prototype={constructor:oe.SceneLoader,load:function(e,t,r,o){var n=this,l=new oe.XHRLoader(n.manager);l.setCrossOrigin(this.crossOrigin),l.load(e,(function(text){n.parse(JSON.parse(text),t,e)}))},setCrossOrigin:function(e){this.crossOrigin=e},addGeometryHandler:function(e,t){this.geometryHandlers[e]={loaderClass:t}},addHierarchyHandler:function(e,t){this.hierarchyHandlers[e]={loaderClass:t}},parse:function(e,t,r){var o,n,l,h,c,f,d,m,v,y,x,_,M=this,w=oe.Loader.prototype.extractUrlBase(r),S=[],data=e;for(var A in this.geometryHandlers){var T=this.geometryHandlers[A].loaderClass;this.geometryHandlers[A].loaderObject=new T}for(var A in this.hierarchyHandlers){T=this.hierarchyHandlers[A].loaderClass;this.hierarchyHandlers[A].loaderObject=new T}if(m=0,v=0,_={scene:new oe.Scene,geometries:{},face_materials:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{},groups:{}},data.transform){var C=data.transform.position,E=data.transform.rotation,L=data.transform.scale;C&&_.scene.position.fromArray(C),E&&_.scene.rotation.fromArray(E),L&&_.scene.scale.fromArray(L),(C||E||L)&&(_.scene.updateMatrix(),_.scene.updateMatrixWorld())}function P(e,t){return"relativeToHTML"==t?e:w+e}function R(){!function e(t,r){var h,c,f,m,v;for(var y in r){var object=_.objects[y],x=r[y];if(void 0===object){if(x.type&&x.type in M.hierarchyHandlers){if(void 0===x.loading){var w={type:1,url:1,material:1,position:1,rotation:1,scale:1,visible:1,children:1,userData:1,skin:1,morph:1,mirroredLoop:1,duration:1},S={};for(var A in x)A in w||(S[A]=x[A]);n=_.materials[x.material],x.loading=!0;var T=M.hierarchyHandlers[x.type].loaderObject;T.options?T.load(P(x.url,data.urlBaseType),F(y,t,n,x)):T.load(P(x.url,data.urlBaseType),F(y,t,n,x),S)}}else if(void 0!==x.geometry){if(o=_.geometries[x.geometry]){var C=!1;if(n=_.materials[x.material],C=n instanceof oe.ShaderMaterial,c=x.position,f=x.rotation,m=x.scale,h=x.matrix,v=x.quaternion,x.material||(n=new oe.MeshFaceMaterial(_.face_materials[x.geometry])),n instanceof oe.MeshFaceMaterial&&0===n.materials.length&&(n=new oe.MeshFaceMaterial(_.face_materials[x.geometry])),n instanceof oe.MeshFaceMaterial)for(var i=0;i<n.materials.length;i++)C=C||n.materials[i]instanceof oe.ShaderMaterial;C&&o.computeTangents(),x.skin?object=new oe.SkinnedMesh(o,n):x.morph?(object=new oe.MorphAnimMesh(o,n),void 0!==x.duration&&(object.duration=x.duration),void 0!==x.time&&(object.time=x.time),void 0!==x.mirroredLoop&&(object.mirroredLoop=x.mirroredLoop),n.morphNormals&&o.computeMorphNormals()):object=new oe.Mesh(o,n),object.name=y,h?(object.matrixAutoUpdate=!1,object.matrix.set(h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7],h[8],h[9],h[10],h[11],h[12],h[13],h[14],h[15])):(object.position.fromArray(c),v?object.quaternion.fromArray(v):object.rotation.fromArray(f),object.scale.fromArray(m)),object.visible=x.visible,object.castShadow=x.castShadow,object.receiveShadow=x.receiveShadow,t.add(object),_.objects[y]=object}}else if("AmbientLight"===x.type||"PointLight"===x.type||"DirectionalLight"===x.type||"SpotLight"===x.type||"HemisphereLight"===x.type||"AreaLight"===x.type){var E=x.color,L=x.intensity,R=x.distance,D=x.position,U=x.rotation;switch(x.type){case"AmbientLight":d=new oe.AmbientLight(E);break;case"PointLight":(d=new oe.PointLight(E,L,R)).position.fromArray(D);break;case"DirectionalLight":(d=new oe.DirectionalLight(E,L)).position.fromArray(x.direction);break;case"SpotLight":(d=new oe.SpotLight(E,L,R,1)).angle=x.angle,d.position.fromArray(D),d.target.set(D[0],D[1]-R,D[2]),d.target.applyEuler(new oe.Euler(U[0],U[1],U[2],"XYZ"));break;case"HemisphereLight":(d=new oe.DirectionalLight(E,L,R)).target.set(D[0],D[1]-R,D[2]),d.target.applyEuler(new oe.Euler(U[0],U[1],U[2],"XYZ"));break;case"AreaLight":(d=new oe.AreaLight(E,L)).position.fromArray(D),d.width=x.size,d.height=x.size_y}t.add(d),d.name=y,_.lights[y]=d,_.objects[y]=d}else"PerspectiveCamera"===x.type||"OrthographicCamera"===x.type?(c=x.position,f=x.rotation,v=x.quaternion,"PerspectiveCamera"===x.type?l=new oe.PerspectiveCamera(x.fov,x.aspect,x.near,x.far):"OrthographicCamera"===x.type&&(l=new oe.OrthographicCamera(x.left,x.right,x.top,x.bottom,x.near,x.far)),l.name=y,l.position.fromArray(c),void 0!==v?l.quaternion.fromArray(v):void 0!==f&&l.rotation.fromArray(f),t.add(l),_.cameras[y]=l,_.objects[y]=l):(c=x.position,f=x.rotation,m=x.scale,v=x.quaternion,(object=new oe.Object3D).name=y,object.position.fromArray(c),v?object.quaternion.fromArray(v):object.rotation.fromArray(f),object.scale.fromArray(m),object.visible=void 0!==x.visible&&x.visible,t.add(object),_.objects[y]=object,_.empties[y]=object);if(object){if(void 0!==x.userData)for(var V in x.userData){var N=x.userData[V];object.userData[V]=N}if(void 0!==x.groups)for(i=0;i<x.groups.length;i++){var O=x.groups[i];void 0===_.groups[O]&&(_.groups[O]=[]),_.groups[O].push(y)}}}void 0!==object&&void 0!==x.children&&e(object,x.children)}}(_.scene,data.objects)}function D(e,t,r,o,n){var p=n.position,l=n.rotation,q=n.quaternion,s=n.scale;e.position.fromArray(p),q?e.quaternion.fromArray(q):e.rotation.fromArray(l),e.scale.fromArray(s),o&&e.traverse((function(e){e.material=o}));var h=void 0===n.visible||n.visible;e.traverse((function(e){e.visible=h})),r.add(e),e.name=t,_.objects[t]=e,R()}function U(e){return function(t,r){t.name=e,function(e,t,r){_.geometries[r]=e,_.face_materials[r]=t,R()}(t,r,e),m-=1,M.onLoadComplete(),N()}}function F(e,t,r,o){return function(n){D(n.content?n.content:n.dae?n.scene:n,e,t,r,o),m-=1,M.onLoadComplete(),N()}}function V(e){return function(t,r){t.name=e,_.geometries[e]=t,_.face_materials[e]=r}}function N(){var progress={totalModels:y,totalTextures:x,loadedModels:y-m,loadedTextures:x-v};M.callbackProgress(progress,_),M.onLoadProgress(),0===m&&0===v&&(!function(){for(var i=0;i<S.length;i++){var e=S[i],t=_.objects[e.targetName];t?e.object.target=t:(e.object.target=new oe.Object3D,_.scene.add(e.object.target)),e.object.target.userData.targetInverse=e.object}}(),t(_))}var O,z,I,B,k,G,H,j,W,X=function(e){return function(){!function(e){v-=e,N(),M.onLoadComplete()}(e)}};function Y(e,t){if(t(e),void 0!==e.children)for(var r in e.children)Y(e.children[r],t)}for(O in data.fogs)"linear"===(z=data.fogs[O]).type?h=new oe.Fog(0,z.near,z.far):"exp2"===z.type&&(h=new oe.FogExp2(0,z.density)),f=z.color,h.color.setRGB(f[0],f[1],f[2]),_.fogs[O]=h;for(I in data.geometries)(B=data.geometries[I]).type in this.geometryHandlers&&(m+=1,M.onLoadStart());for(var K in data.objects)Y(data.objects[K],(function(e){e.type&&e.type in M.hierarchyHandlers&&(m+=1,M.onLoadStart())}));for(I in y=m,data.geometries)if("cube"===(B=data.geometries[I]).type)(o=new oe.BoxGeometry(B.width,B.height,B.depth,B.widthSegments,B.heightSegments,B.depthSegments)).name=I,_.geometries[I]=o;else if("plane"===B.type)(o=new oe.PlaneGeometry(B.width,B.height,B.widthSegments,B.heightSegments)).name=I,_.geometries[I]=o;else if("sphere"===B.type)(o=new oe.SphereGeometry(B.radius,B.widthSegments,B.heightSegments)).name=I,_.geometries[I]=o;else if("cylinder"===B.type)(o=new oe.CylinderGeometry(B.topRad,B.botRad,B.height,B.radSegs,B.heightSegs)).name=I,_.geometries[I]=o;else if("torus"===B.type)(o=new oe.TorusGeometry(B.radius,B.tube,B.segmentsR,B.segmentsT)).name=I,_.geometries[I]=o;else if("icosahedron"===B.type)(o=new oe.IcosahedronGeometry(B.radius,B.subdivisions)).name=I,_.geometries[I]=o;else if(B.type in this.geometryHandlers){var $={};for(var Q in B)"type"!==Q&&"url"!==Q&&($[Q]=B[Q]);this.geometryHandlers[B.type].loaderObject.load(P(B.url,data.urlBaseType),U(I),$)}else if("embedded"===B.type){var Z=data.embeds[B.id];if(Z.metadata=data.metadata,Z){var J=this.geometryHandlers.ascii.loaderObject.parse(Z,"");V(I)(J.geometry,J.materials)}}for(k in data.textures)if((G=data.textures[k]).url instanceof Array){v+=G.url.length;for(var ee=0;ee<G.url.length;ee++)M.onLoadStart()}else v+=1,M.onLoadStart();for(k in x=v,data.textures){if(void 0!==(G=data.textures[k]).mapping&&void 0!==oe[G.mapping]&&(G.mapping=new oe[G.mapping]),G.url instanceof Array){for(var te=G.url.length,re=[],i=0;i<te;i++)re[i]=P(G.url[i],data.urlBaseType);c=(ie=/\.dds$/i.test(re[0]))?oe.ImageUtils.loadCompressedTextureCube(re,G.mapping,X(te)):oe.ImageUtils.loadTextureCube(re,G.mapping,X(te))}else{var ie=/\.dds$/i.test(G.url),ae=P(G.url,data.urlBaseType),ne=X(1);if(c=ie?oe.ImageUtils.loadCompressedTexture(ae,G.mapping,ne):oe.ImageUtils.loadTexture(ae,G.mapping,ne),void 0!==oe[G.minFilter]&&(c.minFilter=oe[G.minFilter]),void 0!==oe[G.magFilter]&&(c.magFilter=oe[G.magFilter]),G.anisotropy&&(c.anisotropy=G.anisotropy),G.repeat&&(c.repeat.set(G.repeat[0],G.repeat[1]),1!==G.repeat[0]&&(c.wrapS=oe.RepeatWrapping),1!==G.repeat[1]&&(c.wrapT=oe.RepeatWrapping)),G.offset&&c.offset.set(G.offset[0],G.offset[1]),G.wrap){var se={repeat:oe.RepeatWrapping,mirror:oe.MirroredRepeatWrapping};void 0!==se[G.wrap[0]]&&(c.wrapS=se[G.wrap[0]]),void 0!==se[G.wrap[1]]&&(c.wrapT=se[G.wrap[1]])}}_.textures[k]=c}for(H in data.materials){for(W in(j=data.materials[H]).parameters)if("envMap"===W||"map"===W||"lightMap"===W||"bumpMap"===W)j.parameters[W]=_.textures[j.parameters[W]];else if("shading"===W)j.parameters[W]="flat"===j.parameters[W]?oe.FlatShading:oe.SmoothShading;else if("side"===W)"double"==j.parameters[W]?j.parameters[W]=oe.DoubleSide:"back"==j.parameters[W]?j.parameters[W]=oe.BackSide:j.parameters[W]=oe.FrontSide;else if("blending"===W)j.parameters[W]=j.parameters[W]in oe?oe[j.parameters[W]]:oe.NormalBlending;else if("combine"===W)j.parameters[W]=j.parameters[W]in oe?oe[j.parameters[W]]:oe.MultiplyOperation;else if("vertexColors"===W)"face"==j.parameters[W]?j.parameters[W]=oe.FaceColors:j.parameters[W]&&(j.parameters[W]=oe.VertexColors);else if("wrapRGB"===W){var le=j.parameters[W];j.parameters[W]=new oe.Vector3(le[0],le[1],le[2])}if(void 0!==j.parameters.opacity&&j.parameters.opacity<1&&(j.parameters.transparent=!0),j.parameters.normalMap){var he=oe.ShaderLib.normalmap,ce=oe.UniformsUtils.clone(he.uniforms),ue=j.parameters.color,fe=j.parameters.specular,pe=j.parameters.ambient,de=j.parameters.shininess;ce.tNormal.value=_.textures[j.parameters.normalMap],j.parameters.normalScale&&ce.uNormalScale.value.set(j.parameters.normalScale[0],j.parameters.normalScale[1]),j.parameters.map&&(ce.tDiffuse.value=j.parameters.map,ce.enableDiffuse.value=!0),j.parameters.envMap&&(ce.tCube.value=j.parameters.envMap,ce.enableReflection.value=!0,ce.reflectivity.value=j.parameters.reflectivity),j.parameters.lightMap&&(ce.tAO.value=j.parameters.lightMap,ce.enableAO.value=!0),j.parameters.specularMap&&(ce.tSpecular.value=_.textures[j.parameters.specularMap],ce.enableSpecular.value=!0),j.parameters.displacementMap&&(ce.tDisplacement.value=_.textures[j.parameters.displacementMap],ce.enableDisplacement.value=!0,ce.uDisplacementBias.value=j.parameters.displacementBias,ce.uDisplacementScale.value=j.parameters.displacementScale),ce.diffuse.value.setHex(ue),ce.specular.value.setHex(fe),ce.ambient.value.setHex(pe),ce.shininess.value=de,j.parameters.opacity&&(ce.opacity.value=j.parameters.opacity);var me={fragmentShader:he.fragmentShader,vertexShader:he.vertexShader,uniforms:ce,lights:!0,fog:!0};n=new oe.ShaderMaterial(me)}else n=new oe[j.type](j.parameters);n.name=H,_.materials[H]=n}for(H in data.materials)if((j=data.materials[H]).parameters.materials){var ge=[];for(i=0;i<j.parameters.materials.length;i++){var label=j.parameters.materials[i];ge.push(_.materials[label])}_.materials[H].materials=ge}R(),_.cameras&&data.defaults.camera&&(_.currentCamera=_.cameras[data.defaults.camera]),_.fogs&&data.defaults.fog&&(_.scene.fog=_.fogs[data.defaults.fog]),M.callbackSync(_),N()}},oe.TextureLoader=function(e){this.manager=void 0!==e?e:oe.DefaultLoadingManager},oe.TextureLoader.prototype={constructor:oe.TextureLoader,load:function(e,t,r,o){var n=new oe.ImageLoader(this.manager);n.setCrossOrigin(this.crossOrigin),n.load(e,(function(image){var e=new oe.Texture(image);e.needsUpdate=!0,void 0!==t&&t(e)}))},setCrossOrigin:function(e){this.crossOrigin=e}},oe.Material=function(){this.id=oe.MaterialIdCount++,this.uuid=oe.Math.generateUUID(),this.name="",this.side=oe.FrontSide,this.opacity=1,this.transparent=!1,this.blending=oe.NormalBlending,this.blendSrc=oe.SrcAlphaFactor,this.blendDst=oe.OneMinusSrcAlphaFactor,this.blendEquation=oe.AddEquation,this.depthTest=!0,this.depthWrite=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.overdraw=0,this.visible=!0,this.needsUpdate=!0},oe.Material.prototype={constructor:oe.Material,setValues:function(e){if(void 0!==e)for(var t in e){var r=e[t];if(void 0!==r){if(t in this){var o=this[t];o instanceof oe.Color?o.set(r):o instanceof oe.Vector3&&r instanceof oe.Vector3?o.copy(r):this[t]="overdraw"==t?Number(r):r}}else oe.onwarning("THREE.Material: '"+t+"' parameter is undefined.")}},clone:function(e){return void 0===e&&(e=new oe.Material),e.name=this.name,e.side=this.side,e.opacity=this.opacity,e.transparent=this.transparent,e.blending=this.blending,e.blendSrc=this.blendSrc,e.blendDst=this.blendDst,e.blendEquation=this.blendEquation,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.overdraw=this.overdraw,e.visible=this.visible,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},oe.EventDispatcher.prototype.apply(oe.Material.prototype),oe.MaterialIdCount=0,oe.LineBasicMaterial=function(e){oe.Material.call(this),this.color=new oe.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=!1,this.fog=!0,this.setValues(e)},oe.LineBasicMaterial.prototype=Object.create(oe.Material.prototype),oe.LineBasicMaterial.prototype.clone=function(){var e=new oe.LineBasicMaterial;return oe.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.linecap=this.linecap,e.linejoin=this.linejoin,e.vertexColors=this.vertexColors,e.fog=this.fog,e},oe.LineDashedMaterial=function(e){oe.Material.call(this),this.color=new oe.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},oe.LineDashedMaterial.prototype=Object.create(oe.Material.prototype),oe.LineDashedMaterial.prototype.clone=function(){var e=new oe.LineDashedMaterial;return oe.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.scale=this.scale,e.dashSize=this.dashSize,e.gapSize=this.gapSize,e.vertexColors=this.vertexColors,e.fog=this.fog,e},oe.MeshBasicMaterial=function(e){oe.Material.call(this),this.color=new oe.Color(16777215),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=oe.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=oe.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=oe.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(e)},oe.MeshBasicMaterial.prototype=Object.create(oe.Material.prototype),oe.MeshBasicMaterial.prototype.clone=function(){var e=new oe.MeshBasicMaterial;return oe.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e},oe.MeshLambertMaterial=function(e){oe.Material.call(this),this.color=new oe.Color(16777215),this.ambient=new oe.Color(16777215),this.emissive=new oe.Color(0),this.wrapAround=!1,this.wrapRGB=new oe.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=oe.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=oe.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=oe.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},oe.MeshLambertMaterial.prototype=Object.create(oe.Material.prototype),oe.MeshLambertMaterial.prototype.clone=function(){var e=new oe.MeshLambertMaterial;return oe.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},oe.MeshPhongMaterial=function(e){oe.Material.call(this),this.color=new oe.Color(16777215),this.ambient=new oe.Color(0),this.emissive=new oe.Color(0),this.specular=new oe.Color(16777215),this.shininess=30,this.wrapAround=!1,this.wrapRGB=new oe.Vector3(1,1,1),this.map=null,this.opacityMap=null,this.lightMap=null,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new oe.Vector2(1,1),this.specularMap=null,this.envMap=null,this.combine=oe.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=oe.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=oe.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},oe.MeshPhongMaterial.prototype=Object.create(oe.Material.prototype),oe.MeshPhongMaterial.prototype.clone=function(){var e=new oe.MeshPhongMaterial;return oe.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.opacityMap=this.opacityMap,e.lightMap=this.lightMap,e.emissiveMap=this.emissiveMap,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},oe.MeshPhysicalMaterial=function(e){oe.Material.call(this),this.color=new oe.Color(16777215),this.map=null,this.opacityMap=null,this.falloff=!1,this.falloffColor=new oe.Color(16777215),this.falloffMap=null,this.falloffBlendParams=new oe.Vector4(1,0,0,1),this.specular=new oe.Color(16777215),this.specularMap=null,this.roughness=.5,this.roughnessMap=null,this.metallic=0,this.metallicMap=null,this.clearCoat=0,this.clearCoatRoughness=.2,this.anisotropy=0,this.anisotropyMap=null,this.anisotropyRotation=0,this.anisotropyRotationMap=null,this.translucency=new oe.Color(0),this.translucencyMap=null,this.translucencyNormalAlpha=.75,this.translucencyNormalPower=1,this.translucencyViewPower=2,this.translucencyViewAlpha=.75,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new oe.Vector2(1,1),this.emissive=new oe.Color(0),this.emissiveMap=null,this.ambient=new oe.Color(0),this.lightMap=null,this.envMap=null,this.diffuseEnvMap=null,this.combine=oe.AddOperation,this.shading=oe.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.blending=oe.CustomBlending,this.blendSrc=oe.OneFactor,this.blendDst=oe.OneMinusSrcAlphaFactor,this.blendEquation=oe.AddEquation,this.vertexColors=oe.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},oe.MeshPhysicalMaterial.prototype=Object.create(oe.Material.prototype),oe.MeshPhysicalMaterial.prototype.clone=function(){var e=new oe.MeshPhysicalMaterial;return oe.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.opacityMap=this.opacityMap,e.falloff=this.falloff,e.falloffColor.copy(this.falloffColor),e.falloffMap=this.falloffMap,e.falloffBlendParams.copy(this.falloffBlendParams),e.specular.copy(this.specular),e.specularMap=this.specularMap,e.roughness=this.roughness,e.roughnessMap=this.roughnessMap,e.metallic=this.metallic,e.metallicMap=this.metallicMap,e.shading=this.shading,e.translucency.copy(this.translucency),e.translucencyMap=this.translucencyMap,e.translucencyNormalAlpha=this.translucencyNormalAlpha,e.translucencyNormalPower=this.translucencyNormalPower,e.translucencyViewPower=this.translucencyViewPower,e.translucencyViewAlpha=this.translucencyViewAlpha,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.emissive.copy(this.emissive),e.emissiveMap=this.emissiveMap,e.ambient.copy(this.ambient),e.lightMap=this.lightMap,e.envMap=this.envMap,e.diffuseEnvMap=this.diffuseEnvMap,e.combine=this.combine,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},oe.MeshDepthMaterial=function(e){oe.Material.call(this),this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},oe.MeshDepthMaterial.prototype=Object.create(oe.Material.prototype),oe.MeshDepthMaterial.prototype.clone=function(){var e=new oe.MeshDepthMaterial;return oe.Material.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},oe.MeshNormalMaterial=function(e){oe.Material.call(this,e),this.shading=oe.FlatShading,this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(e)},oe.MeshNormalMaterial.prototype=Object.create(oe.Material.prototype),oe.MeshNormalMaterial.prototype.clone=function(){var e=new oe.MeshNormalMaterial;return oe.Material.prototype.clone.call(this,e),e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},oe.MeshFaceMaterial=function(e){this.materials=e instanceof Array?e:[]},oe.MeshFaceMaterial.prototype.clone=function(){for(var e=new oe.MeshFaceMaterial,i=0;i<this.materials.length;i++)e.materials.push(this.materials[i].clone());return e},oe.ParticleSystemMaterial=function(e){oe.Material.call(this),this.color=new oe.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=!1,this.fog=!0,this.setValues(e)},oe.ParticleSystemMaterial.prototype=Object.create(oe.Material.prototype),oe.ParticleSystemMaterial.prototype.clone=function(){var e=new oe.ParticleSystemMaterial;return oe.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.vertexColors=this.vertexColors,e.fog=this.fog,e},oe.ParticleBasicMaterial=oe.ParticleSystemMaterial,oe.ShaderMaterial=function(e){oe.Material.call(this),this.fragmentShader="void main() {}",this.vertexShader="void main() {}",this.uniforms={},this.defines={},this.attributes=null,this.shading=oe.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=oe.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName="position",this.setValues(e)},oe.ShaderMaterial.prototype=Object.create(oe.Material.prototype),oe.ShaderMaterial.prototype.clone=function(){var e=new oe.ShaderMaterial;return oe.Material.prototype.clone.call(this,e),e.fragmentShader=this.fragmentShader,e.vertexShader=this.vertexShader,e.uniforms=oe.UniformsUtils.clone(this.uniforms),e.attributes=this.attributes,e.defines=this.defines,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.fog=this.fog,e.lights=this.lights,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},oe.SpriteMaterial=function(e){oe.Material.call(this),this.color=new oe.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.setValues(e)},oe.SpriteMaterial.prototype=Object.create(oe.Material.prototype),oe.SpriteMaterial.prototype.clone=function(){var e=new oe.SpriteMaterial;return oe.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.rotation=this.rotation,e.fog=this.fog,e},oe.SpriteCanvasMaterial=function(e){oe.Material.call(this),this.color=new oe.Color(16777215),this.program=function(e,t){},this.setValues(e)},oe.SpriteCanvasMaterial.prototype=Object.create(oe.Material.prototype),oe.SpriteCanvasMaterial.prototype.clone=function(){var e=new oe.SpriteCanvasMaterial;return oe.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.program=this.program,e},oe.ParticleCanvasMaterial=oe.SpriteCanvasMaterial,oe.Texture=function(image,e,t,r,o,n,l,h,c){this.id=oe.TextureIdCount++,this.uuid=oe.Math.generateUUID(),this.name="",this.image=image,this.mipmaps=[],this.mapping=void 0!==e?e:new oe.UVMapping,this.wrapS=void 0!==t?t:oe.ClampToEdgeWrapping,this.wrapT=void 0!==r?r:oe.ClampToEdgeWrapping,this.magFilter=void 0!==o?o:oe.LinearFilter,this.minFilter=void 0!==n?n:oe.LinearMipMapLinearFilter,this.anisotropy=void 0!==c?c:1,this.format=void 0!==l?l:oe.RGBAFormat,this.type=void 0!==h?h:oe.UnsignedByteType,this.offset=new oe.Vector2(0,0),this.repeat=new oe.Vector2(1,1),this.gainPivot=0,this.gain=1,this.brightness=0,this.encoding=oe.None,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this._needsUpdate=!1,this.onUpdate=null},oe.Texture.prototype={constructor:oe.Texture,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){!0===e&&this.update(),this._needsUpdate=e},clone:function(e){return void 0===e&&(e=new oe.Texture),e.image=this.image,e.mipmaps=this.mipmaps.slice(0),e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.gainPivot=this.gainPivot,e.gain=this.gain,e.brightness=this.brightness,e.encoding=this.encoding,e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e.unpackAlignment=this.unpackAlignment,e},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},oe.EventDispatcher.prototype.apply(oe.Texture.prototype),oe.TextureIdCount=0,oe.CompressedTexture=function(e,t,r,o,n,l,h,c,f,d,m){oe.Texture.call(this,null,l,h,c,f,d,o,n,m),this.image={width:t,height:r},this.mipmaps=e,this.generateMipmaps=!1},oe.CompressedTexture.prototype=Object.create(oe.Texture.prototype),oe.CompressedTexture.prototype.clone=function(){var e=new oe.CompressedTexture;return oe.Texture.prototype.clone.call(this,e),e},oe.DataTexture=function(data,e,t,r,o,n,l,h,c,f,d){oe.Texture.call(this,null,n,l,h,c,f,r,o,d),this.image={data:data,width:e,height:t}},oe.DataTexture.prototype=Object.create(oe.Texture.prototype),oe.DataTexture.prototype.clone=function(){var e=new oe.DataTexture;return oe.Texture.prototype.clone.call(this,e),e},oe.ParticleSystem=function(e,t){oe.Object3D.call(this),this.geometry=void 0!==e?e:new oe.Geometry,this.material=void 0!==t?t:new oe.ParticleSystemMaterial({color:16777215*Math.random()}),this.sortParticles=!1,this.frustumCulled=!1},oe.ParticleSystem.prototype=Object.create(oe.Object3D.prototype),oe.ParticleSystem.prototype.clone=function(object){return void 0===object&&(object=new oe.ParticleSystem(this.geometry,this.material)),object.sortParticles=this.sortParticles,oe.Object3D.prototype.clone.call(this,object),object},oe.Line=function(e,t,r){oe.Object3D.call(this),this.geometry=void 0!==e?e:new oe.Geometry,this.material=void 0!==t?t:new oe.LineBasicMaterial({color:16777215*Math.random()}),this.type=void 0!==r?r:oe.LineStrip},oe.LineStrip=0,oe.LinePieces=1,oe.Line.prototype=Object.create(oe.Object3D.prototype),oe.Line.prototype.clone=function(object){return void 0===object&&(object=new oe.Line(this.geometry,this.material,this.type)),oe.Object3D.prototype.clone.call(this,object),object},oe.Mesh=function(e,t){oe.Object3D.call(this),this.geometry=void 0!==e?e:new oe.Geometry,this.material=void 0!==t?t:new oe.MeshBasicMaterial({color:16777215*Math.random()}),this.updateMorphTargets()},oe.Mesh.prototype=Object.create(oe.Object3D.prototype),oe.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;e<t;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},oe.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(oe.onwarning("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},oe.Mesh.prototype.clone=function(object){return void 0===object&&(object=new oe.Mesh(this.geometry,this.material)),oe.Object3D.prototype.clone.call(this,object),object},oe.Bone=function(e){oe.Object3D.call(this),this.skin=e,this.skinMatrix=new oe.Matrix4},oe.Bone.prototype=Object.create(oe.Object3D.prototype),oe.Bone.prototype.update=function(e,t){this.matrixAutoUpdate&&(t|=this.updateMatrix()),(t||this.matrixWorldNeedsUpdate)&&(e?this.skinMatrix.multiplyMatrices(e,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);var i,r=this.children.length;for(i=0;i<r;i++)this.children[i].update(this.skinMatrix,t)},oe.SkinnedMesh=function(e,t,r){var b,o,n,p,q,s;if(oe.Mesh.call(this,e,t),this.useVertexTexture=void 0===r||r,this.identityMatrix=new oe.Matrix4,this.bones=[],this.boneMatrices=[],this.geometry&&void 0!==this.geometry.bones){for(b=0;b<this.geometry.bones.length;b++)p=(n=this.geometry.bones[b]).pos,q=n.rotq,s=n.scl,(o=this.addBone()).name=n.name,o.position.set(p[0],p[1],p[2]),o.quaternion.set(q[0],q[1],q[2],q[3]),void 0!==s?o.scale.set(s[0],s[1],s[2]):o.scale.set(1,1,1);for(b=0;b<this.bones.length;b++)n=this.geometry.bones[b],o=this.bones[b],-1===n.parent?this.add(o):this.bones[n.parent].add(o);var l,h=this.bones.length;if(this.useVertexTexture)l=h>256?64:h>64?32:h>16?16:8,this.boneTextureWidth=l,this.boneTextureHeight=l,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new oe.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,oe.RGBAFormat,oe.FloatType),this.boneTexture.minFilter=oe.NearestFilter,this.boneTexture.magFilter=oe.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1;else this.boneMatrices=new Float32Array(16*h);this.pose()}},oe.SkinnedMesh.prototype=Object.create(oe.Mesh.prototype),oe.SkinnedMesh.prototype.addBone=function(e){return void 0===e&&(e=new oe.Bone(this)),this.bones.push(e),e},oe.SkinnedMesh.prototype.updateMatrixWorld=(G=new oe.Matrix4,function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var i=0,t=this.children.length;i<t;i++){var r=this.children[i];r instanceof oe.Bone?r.update(this.identityMatrix,!1):r.updateMatrixWorld(!0)}if(null==this.boneInverses){this.boneInverses=[];for(var b=0,o=this.bones.length;b<o;b++){var n=new oe.Matrix4;n.getInverse(this.bones[b].skinMatrix),this.boneInverses.push(n)}}for(b=0,o=this.bones.length;b<o;b++)G.multiplyMatrices(this.bones[b].skinMatrix,this.boneInverses[b]),G.flattenToArrayOffset(this.boneMatrices,16*b);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}),oe.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0),this.normalizeSkinWeights()},oe.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof oe.Geometry)for(var i=0;i<this.geometry.skinIndices.length;i++){var e=this.geometry.skinWeights[i],t=1/e.lengthManhattan();t!==1/0?e.multiplyScalar(t):e.set(1)}},oe.SkinnedMesh.prototype.clone=function(object){return void 0===object&&(object=new oe.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),oe.Mesh.prototype.clone.call(this,object),object},oe.MorphAnimMesh=function(e,t){oe.Mesh.call(this,e,t),this.duration=1e3,this.mirroredLoop=!1,this.time=0,this.lastKeyframe=0,this.currentKeyframe=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},oe.MorphAnimMesh.prototype=Object.create(oe.Mesh.prototype),oe.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},oe.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},oe.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},oe.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});for(var t,r=e.animations,pattern=/([a-z]+)(\d+)/,i=0,o=e.morphTargets.length;i<o;i++){var n=e.morphTargets[i].name.match(pattern);if(n&&n.length>1){var label=n[1];n[2];r[label]||(r[label]={start:1/0,end:-1/0});var l=r[label];i<l.start&&(l.start=i),i>l.end&&(l.end=i),t||(t=label)}}e.firstAnimation=t},oe.MorphAnimMesh.prototype.setAnimationLabel=function(label,e,t){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[label]={start:e,end:t}},oe.MorphAnimMesh.prototype.playAnimation=function(label,e){var t=this.geometry.animations[label];t?(this.setFrameRange(t.start,t.end),this.duration=(t.end-t.start)/e*1e3,this.time=0):oe.onwarning("animation["+label+"] undefined")},oe.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time+=this.direction*e,this.mirroredLoop?(this.time>this.duration||this.time<0)&&(this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),this.time<0&&(this.time=0,this.directionBackwards=!1)):(this.time=this.time%this.duration,this.time<0&&(this.time+=this.duration));var r=this.startKeyframe+oe.Math.clamp(Math.floor(this.time/t),0,this.length-1);r!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[r]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=r);var o=this.time%t/t;this.directionBackwards&&(o=1-o),this.morphTargetInfluences[this.currentKeyframe]=o,this.morphTargetInfluences[this.lastKeyframe]=1-o},oe.MorphAnimMesh.prototype.clone=function(object){return void 0===object&&(object=new oe.MorphAnimMesh(this.geometry,this.material)),object.duration=this.duration,object.mirroredLoop=this.mirroredLoop,object.time=this.time,object.lastKeyframe=this.lastKeyframe,object.currentKeyframe=this.currentKeyframe,object.direction=this.direction,object.directionBackwards=this.directionBackwards,oe.Mesh.prototype.clone.call(this,object),object},oe.LOD=function(){oe.Object3D.call(this),this.objects=[]},oe.LOD.prototype=Object.create(oe.Object3D.prototype),oe.LOD.prototype.addLevel=function(object,e){void 0===e&&(e=0),e=Math.abs(e);for(var t=0;t<this.objects.length&&!(e<this.objects[t].distance);t++);this.objects.splice(t,0,{distance:e,object:object}),this.add(object)},oe.LOD.prototype.getObjectForDistance=function(e){for(var i=1,t=this.objects.length;i<t&&!(e<this.objects[i].distance);i++);return this.objects[i-1].object},oe.LOD.prototype.update=function(){var e=new oe.Vector3,t=new oe.Vector3;return function(r){if(this.objects.length>1){e.setFromMatrixPosition(r.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var o=e.distanceTo(t);this.objects[0].object.visible=!0;for(var i=1,n=this.objects.length;i<n&&o>=this.objects[i].distance;i++)this.objects[i-1].object.visible=!1,this.objects[i].object.visible=!0;for(;i<n;i++)this.objects[i].object.visible=!1}}}(),oe.LOD.prototype.clone=function(object){void 0===object&&(object=new oe.LOD),oe.Object3D.prototype.clone.call(this,object);for(var i=0,e=this.objects.length;i<e;i++){var t=this.objects[i].object.clone();t.visible=0===i,object.addLevel(t,this.objects[i].distance)}return object},oe.Sprite=((H=new oe.Geometry2(3)).vertices.set([-.5,-.5,0,.5,-.5,0,.5,.5,0]),function(e){oe.Object3D.call(this),this.geometry=H,this.material=void 0!==e?e:new oe.SpriteMaterial}),oe.Sprite.prototype=Object.create(oe.Object3D.prototype),oe.Sprite.prototype.updateMatrix=function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},oe.Sprite.prototype.clone=function(object){return void 0===object&&(object=new oe.Sprite(this.material)),oe.Object3D.prototype.clone.call(this,object),object},oe.Particle=oe.Sprite,oe.Scene=function(){oe.Object3D.call(this),this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,this.matrixAutoUpdate=!1,this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},oe.Scene.prototype=Object.create(oe.Object3D.prototype),oe.Scene.prototype.__addObject=function(object){if(object instanceof oe.Light)-1===this.__lights.indexOf(object)&&this.__lights.push(object),object.target&&void 0===object.target.parent&&this.add(object.target);else if(!(object instanceof oe.Camera||object instanceof oe.Bone)){this.__objectsAdded.push(object);var i=this.__objectsRemoved.indexOf(object);-1!==i&&this.__objectsRemoved.splice(i,1)}this.dispatchEvent({type:"objectAdded",object:object}),object.dispatchEvent({type:"addedToScene",scene:this});for(var e=0;e<object.children.length;e++)this.__addObject(object.children[e])},oe.Scene.prototype.__removeObject=function(object){if(object instanceof oe.Light){if(-1!==(i=this.__lights.indexOf(object))&&this.__lights.splice(i,1),object.shadowCascadeArray)for(var e=0;e<object.shadowCascadeArray.length;e++)this.__removeObject(object.shadowCascadeArray[e])}else if(!(object instanceof oe.Camera)){var i;this.__objectsRemoved.push(object),-1!==(i=this.__objectsAdded.indexOf(object))&&this.__objectsAdded.splice(i,1)}this.dispatchEvent({type:"objectRemoved",object:object}),object.dispatchEvent({type:"removedFromScene",scene:this});for(var t=0;t<object.children.length;t++)this.__removeObject(object.children[t])},oe.Scene.prototype.clone=function(object){return void 0===object&&(object=new oe.Scene),oe.Object3D.prototype.clone.call(this,object),null!==this.fog&&(object.fog=this.fog.clone()),null!==this.overrideMaterial&&(object.overrideMaterial=this.overrideMaterial.clone()),object.autoUpdate=this.autoUpdate,object.matrixAutoUpdate=this.matrixAutoUpdate,object},oe.Fog=function(e,t,r){this.name="",this.color=new oe.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==r?r:1e3},oe.Fog.prototype.clone=function(){return new oe.Fog(this.color.getHex(),this.near,this.far)},oe.FogExp2=function(e,t){this.name="",this.color=new oe.Color(e),this.density=void 0!==t?t:25e-5},oe.FogExp2.prototype.clone=function(){return new oe.FogExp2(this.color.getHex(),this.density)},oe.CanvasRenderer=function(e){console.log("THREE.CanvasRenderer",oe.REVISION);var t=oe.Math.smoothstep;e=e||{};var r,o,n,l,h,c,f,d,m,v,y,x,_,M,w,S,A,T,C,E,L,P,R,D,U,F,V,N,O,z=this,I=new oe.Projector,B=void 0!==e.canvas?e.canvas:document.createElement("canvas"),k=B.width,G=B.height,H=Math.floor(k/2),j=Math.floor(G/2),W=B.getContext("2d",{alpha:!0===e.alpha}),X=new oe.Color(0),Y=0,K=1,$=0,Q=null,Z=null,J=null,ee=null,te=null,re=null,ie=0,ne=(new oe.RenderableVertex,new oe.RenderableVertex,new oe.Color),se=new oe.Color,le=new oe.Color,he=new oe.Color,ce=new oe.Color,ue=new oe.Color,fe=new oe.Color,pe=new oe.Color,de={},me=new oe.Box2,ge=new oe.Box2,ve=new oe.Box2,ye=new oe.Color,xe=new oe.Color,_e=new oe.Color,Me=new oe.Vector3,be=new oe.Vector3,we=new oe.Matrix3,Se=16;function Ae(e,t,r){for(var o=0,l=n.length;o<l;o++){var h=n[o];if(pe.copy(h.color),h instanceof oe.DirectionalLight){var c=Me.setFromMatrixPosition(h.matrixWorld).normalize();if((f=t.dot(c))<=0)continue;f*=h.intensity,r.add(pe.multiplyScalar(f))}else if(h instanceof oe.PointLight){var f;c=Me.setFromMatrixPosition(h.matrixWorld);if((f=t.dot(Me.subVectors(c,e).normalize()))<=0)continue;if(0==(f*=0==h.distance?1:1-Math.min(e.distanceTo(c)/h.distance,1)))continue;f*=h.intensity,r.add(pe.multiplyScalar(f))}}}function Te(e,element,t){Oe(t.opacity),ze(t.blending);var r=element.scale.x*H,o=element.scale.y*j,n=.5*Math.sqrt(r*r+o*o);if(ve.min.set(e.x-n,e.y-n),ve.max.set(e.x+n,e.y+n),t instanceof oe.SpriteMaterial||t instanceof oe.ParticleSystemMaterial){var l=t.map;if(null!==l){!1===l.hasEventListener("update",Re)&&(void 0!==l.image&&l.image.width>0&&De(l),l.addEventListener("update",Re));var pattern=de[l.id];He(void 0!==pattern?pattern:"rgba( 0, 0, 0, 1 )");var h=l.image,c=h.width*l.offset.x,f=h.height*l.offset.y,d=h.width*l.repeat.x,m=h.height*l.repeat.y,v=r/d,y=o/m;W.save(),W.translate(e.x,e.y),0!==t.rotation&&W.rotate(t.rotation),W.translate(-r/2,-o/2),W.scale(v,y),W.translate(-c,-f),W.fillRect(c,f,d,m),W.restore()}else He(t.color.getStyle()),W.save(),W.translate(e.x,e.y),0!==t.rotation&&W.rotate(t.rotation),W.scale(r,-o),W.fillRect(-.5,-.5,1,1),W.restore()}else t instanceof oe.SpriteCanvasMaterial&&(Ge(t.color.getStyle()),He(t.color.getStyle()),W.save(),W.translate(e.x,e.y),0!==t.rotation&&W.rotate(t.rotation),W.scale(r,o),t.program(W),W.restore())}function Ce(e,t,element,r){if(Oe(r.opacity),ze(r.blending),W.beginPath(),W.moveTo(e.positionScreen.x,e.positionScreen.y),W.lineTo(t.positionScreen.x,t.positionScreen.y),r instanceof oe.LineBasicMaterial){if(Ie(r.linewidth),Be(r.linecap),ke(r.linejoin),r.vertexColors!==oe.VertexColors)Ge(r.color.getStyle());else{var o=element.vertexColors[0].getStyle(),n=element.vertexColors[1].getStyle();if(o===n)Ge(o);else{try{var l=W.createLinearGradient(e.positionScreen.x,e.positionScreen.y,t.positionScreen.x,t.positionScreen.y);l.addColorStop(0,o),l.addColorStop(1,n)}catch(e){l=o}Ge(l)}}W.stroke(),ve.expandByScalar(2*r.linewidth)}else r instanceof oe.LineDashedMaterial&&(Ie(r.linewidth),Be(r.linecap),ke(r.linejoin),Ge(r.color.getStyle()),je(r.dashSize,r.gapSize),W.stroke(),ve.expandByScalar(2*r.linewidth),je(null,null))}function Ee(e,r,o,n,h,c,element,f){var D,U,F,V,N,O;z.info.render.vertices+=3,z.info.render.faces++,Oe(f.opacity),ze(f.blending),d=e.positionScreen.x,m=e.positionScreen.y,v=r.positionScreen.x,y=r.positionScreen.y,x=o.positionScreen.x,_=o.positionScreen.y,D=d,U=m,F=v,V=y,N=x,O=_,W.beginPath(),W.moveTo(D,U),W.lineTo(F,V),W.lineTo(N,O),W.closePath(),(f instanceof oe.MeshLambertMaterial||f instanceof oe.MeshPhongMaterial||f instanceof oe.MeshPhysicalMaterial)&&null===f.map?(ue.copy(f.color),fe.copy(f.emissive),f.vertexColors===oe.FaceColors&&ue.multiply(element.color),!1===f.wireframe&&f.shading===oe.SmoothShading&&3===element.vertexNormalsLength?(se.copy(ye),le.copy(ye),he.copy(ye),Ae(element.v1.positionWorld,element.vertexNormalsModel[0],se),Ae(element.v2.positionWorld,element.vertexNormalsModel[1],le),Ae(element.v3.positionWorld,element.vertexNormalsModel[2],he),se.multiply(ue).add(fe),le.multiply(ue).add(fe),he.multiply(ue).add(fe),ce.addColors(le,he).multiplyScalar(.5),S=Ve(se,le,he,ce),Fe(d,m,v,y,x,_,0,0,1,0,0,1,S)):(ne.copy(ye),Ae(element.centroidModel,element.normalModel,ne),ne.multiply(ue).add(fe),!0===f.wireframe?Le(ne,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):Pe(ne))):f instanceof oe.MeshBasicMaterial||f instanceof oe.MeshLambertMaterial||f instanceof oe.MeshPhongMaterial?null!==f.map?f.map.mapping instanceof oe.UVMapping&&(A=element.uvs[0],Ue(d,m,v,y,x,_,A[n].x,A[n].y,A[h].x,A[h].y,A[c].x,A[c].y,f.map)):null!==f.envMap?f.envMap.mapping instanceof oe.SphericalReflectionMapping&&(be.copy(element.vertexNormalsModel[n]).applyMatrix3(we),T=.5*be.x+.5,C=.5*be.y+.5,be.copy(element.vertexNormalsModel[h]).applyMatrix3(we),E=.5*be.x+.5,L=.5*be.y+.5,be.copy(element.vertexNormalsModel[c]).applyMatrix3(we),P=.5*be.x+.5,R=.5*be.y+.5,Ue(d,m,v,y,x,_,T,C,E,L,P,R,f.envMap)):(ne.copy(f.color),f.vertexColors===oe.FaceColors&&ne.multiply(element.color),!0===f.wireframe?Le(ne,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):Pe(ne)):f instanceof oe.MeshDepthMaterial?(M=l.near,w=l.far,se.r=se.g=se.b=1-t(e.positionScreen.z*e.positionScreen.w,M,w),le.r=le.g=le.b=1-t(r.positionScreen.z*r.positionScreen.w,M,w),he.r=he.g=he.b=1-t(o.positionScreen.z*o.positionScreen.w,M,w),ce.addColors(le,he).multiplyScalar(.5),S=Ve(se,le,he,ce),Fe(d,m,v,y,x,_,0,0,1,0,0,1,S)):f instanceof oe.MeshNormalMaterial&&(f.shading===oe.FlatShading?(be.copy(element.normalModel).applyMatrix3(we),ne.setRGB(be.x,be.y,be.z).multiplyScalar(.5).addScalar(.5),!0===f.wireframe?Le(ne,f.wireframeLinewidth,f.wireframeLinecap,f.wireframeLinejoin):Pe(ne)):f.shading===oe.SmoothShading&&(be.copy(element.vertexNormalsModel[n]).applyMatrix3(we),se.setRGB(be.x,be.y,be.z).multiplyScalar(.5).addScalar(.5),be.copy(element.vertexNormalsModel[h]).applyMatrix3(we),le.setRGB(be.x,be.y,be.z).multiplyScalar(.5).addScalar(.5),be.copy(element.vertexNormalsModel[c]).applyMatrix3(we),he.setRGB(be.x,be.y,be.z).multiplyScalar(.5).addScalar(.5),ce.addColors(le,he).multiplyScalar(.5),S=Ve(se,le,he,ce),Fe(d,m,v,y,x,_,0,0,1,0,0,1,S)))}function Le(e,t,r,o){Ie(t),Be(r),ke(o),Ge(e.getStyle()),W.stroke(),ve.expandByScalar(2*t)}function Pe(e){He(e.getStyle()),W.fill()}function Re(e){De(e.target)}function De(e){var t=e.wrapS===oe.RepeatWrapping,r=e.wrapT===oe.RepeatWrapping,image=e.image,canvas=document.createElement("canvas");canvas.width=image.width,canvas.height=image.height;var o=canvas.getContext("2d");o.setTransform(1,0,0,-1,0,image.height),o.drawImage(image,0,0),de[e.id]=W.createPattern(canvas,!0===t&&!0===r?"repeat":!0===t&&!1===r?"repeat-x":!1===t&&!0===r?"repeat-y":"no-repeat")}function Ue(e,t,r,o,n,l,h,c,f,d,m,v,y){if(!(y instanceof oe.DataTexture)){!1===y.hasEventListener("update",Re)&&(void 0!==y.image&&y.image.width>0&&De(y),y.addEventListener("update",Re));var pattern=de[y.id];if(void 0===pattern)return He("rgba(0,0,0,1)"),void W.fill();He(pattern);var a,b,x,_,M,w,S,A,T=y.offset.x/y.repeat.x,C=y.offset.y/y.repeat.y,E=y.image.width*y.repeat.x,L=y.image.height*y.repeat.y;f=(f+T)*E,d=(d+C)*L,m=(m+T)*E,v=(v+C)*L,r-=e,o-=t,n-=e,l-=t,0!==(S=(f-=h=(h+T)*E)*(v-=c=(c+C)*L)-(m-=h)*(d-=c))&&(M=e-(a=(v*r-d*n)*(A=1/S))*h-(x=(f*n-m*r)*A)*c,w=t-(b=(v*o-d*l)*A)*h-(_=(f*l-m*o)*A)*c,W.save(),W.transform(a,b,x,_,M,w),W.fill(),W.restore())}}function Fe(e,t,r,o,n,l,h,c,f,d,m,v,image){var a,b,y,x,_,M,w,S=image.width-1,A=image.height-1;f*=S,d*=A,m*=S,v*=A,_=e-(a=((v-=c*=A)*(r-=e)-(d-=c)*(n-=e))*(w=1/((f-=h*=S)*v-(m-=h)*d)))*h-(y=(f*n-m*r)*w)*c,M=t-(b=(v*(o-=t)-d*(l-=t))*w)*h-(x=(f*l-m*o)*w)*c,W.save(),W.transform(a,b,y,x,_,M),W.clip(),W.drawImage(image,0,0),W.restore()}function Ve(e,t,r,o){return V[0]=255*e.r|0,V[1]=255*e.g|0,V[2]=255*e.b|0,V[4]=255*t.r|0,V[5]=255*t.g|0,V[6]=255*t.b|0,V[8]=255*r.r|0,V[9]=255*r.g|0,V[10]=255*r.b|0,V[12]=255*o.r|0,V[13]=255*o.g|0,V[14]=255*o.b|0,U.putImageData(F,0,0),O.drawImage(D,0,0),N}function Ne(e,t,r){var o,n=t.x-e.x,l=t.y-e.y,h=n*n+l*l;0!==h&&(n*=o=r/Math.sqrt(h),l*=o,t.x+=n,t.y+=l,e.x-=n,e.y-=l)}function Oe(e){K!==e&&(W.globalAlpha=e,K=e)}function ze(e){$!==e&&(e===oe.NormalBlending?W.globalCompositeOperation="source-over":e===oe.AdditiveBlending?W.globalCompositeOperation="lighter":e===oe.SubtractiveBlending&&(W.globalCompositeOperation="darker"),$=e)}function Ie(e){J!==e&&(W.lineWidth=e,J=e)}function Be(e){ee!==e&&(W.lineCap=e,ee=e)}function ke(e){te!==e&&(W.lineJoin=e,te=e)}function Ge(e){Q!==e&&(W.strokeStyle=e,Q=e)}function He(e){Z!==e&&(W.fillStyle=e,Z=e)}function je(e,t){re===e&&ie===t||(W.setLineDash([e,t]),re=e,ie=t)}(D=document.createElement("canvas")).width=D.height=2,(U=D.getContext("2d")).fillStyle="rgba(0,0,0,1)",U.fillRect(0,0,2,2),F=U.getImageData(0,0,2,2),V=F.data,(N=document.createElement("canvas")).width=N.height=Se,(O=N.getContext("2d")).translate(-Se/2,-Se/2),O.scale(Se,Se),Se--,void 0===W.setLineDash&&(void 0!==W.mozDash?W.setLineDash=function(e){W.mozDash=null!==e[0]?e:null}:W.setLineDash=function(){}),this.domElement=B,this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==ae.devicePixelRatio?ae.devicePixelRatio:1,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.setSize=function(e,t,r){k=e*this.devicePixelRatio,G=t*this.devicePixelRatio,H=Math.floor(k/2),j=Math.floor(G/2),B.width=k,B.height=G,1!==this.devicePixelRatio&&!1!==r&&(B.style.width=e+"px",B.style.height=t+"px"),me.min.set(-H,-j),me.max.set(H,j),ge.min.set(-H,-j),ge.max.set(H,j),K=1,$=0,Q=null,Z=null,J=null,ee=null,te=null},this.setClearColor=function(e,t){X.set(e),Y=void 0!==t?t:1,ge.min.set(-H,-j),ge.max.set(H,j)},this.setClearColorHex=function(e,t){oe.onwarning("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getMaxAnisotropy=function(){return 0},this.clear=function(){W.setTransform(1,0,0,-1,H,j),!1===ge.empty()&&(ge.intersect(me),ge.expandByScalar(2),Y<1&&W.clearRect(0|ge.min.x,0|ge.min.y,ge.max.x-ge.min.x|0,ge.max.y-ge.min.y|0),Y>0&&(ze(oe.NormalBlending),Oe(1),He("rgba("+Math.floor(255*X.r)+","+Math.floor(255*X.g)+","+Math.floor(255*X.b)+","+Y+")"),W.fillRect(0|ge.min.x,0|ge.min.y,ge.max.x-ge.min.x|0,ge.max.y-ge.min.y|0)),ge.makeEmpty())},this.clearColor=function(){},this.clearDepth=function(){},this.clearStencil=function(){},this.render=function(e,t){if(t instanceof oe.Camera!=!1){!0===this.autoClear&&this.clear(),W.setTransform(1,0,0,-1,H,j),z.info.render.vertices=0,z.info.render.faces=0,r=I.projectScene(e,t,this.sortObjects,this.sortElements),o=r.elements,n=r.lights,l=t,we.getNormalMatrix(t.matrixWorldInverse),function(){ye.setRGB(0,0,0),xe.setRGB(0,0,0),_e.setRGB(0,0,0);for(var e=0,t=n.length;e<t;e++){var r=n[e],o=r.color;r instanceof oe.AmbientLight?ye.add(o):r instanceof oe.DirectionalLight?xe.add(o):r instanceof oe.PointLight&&_e.add(o)}}();for(var d=0,m=o.length;d<m;d++){var element=o[d],v=element.material;if(void 0!==v&&!1!==v.visible){if(ve.makeEmpty(),element instanceof oe.RenderableSprite)(h=element).x*=H,h.y*=j,Te(h,element,v);else if(element instanceof oe.RenderableLine)h=element.v1,c=element.v2,h.positionScreen.x*=H,h.positionScreen.y*=j,c.positionScreen.x*=H,c.positionScreen.y*=j,ve.setFromPoints([h.positionScreen,c.positionScreen]),!0===me.isIntersectionBox(ve)&&Ce(h,c,element,v);else if(element instanceof oe.RenderableFace){if(h=element.v1,c=element.v2,f=element.v3,h.positionScreen.z<-1||h.positionScreen.z>1)continue;if(c.positionScreen.z<-1||c.positionScreen.z>1)continue;if(f.positionScreen.z<-1||f.positionScreen.z>1)continue;h.positionScreen.x*=H,h.positionScreen.y*=j,c.positionScreen.x*=H,c.positionScreen.y*=j,f.positionScreen.x*=H,f.positionScreen.y*=j,v.overdraw>0&&(Ne(h.positionScreen,c.positionScreen,v.overdraw),Ne(c.positionScreen,f.positionScreen,v.overdraw),Ne(f.positionScreen,h.positionScreen,v.overdraw)),ve.setFromPoints([h.positionScreen,c.positionScreen,f.positionScreen]),!0===me.isIntersectionBox(ve)&&Ee(h,c,f,0,1,2,element,v)}ge.union(ve)}}W.setTransform(1,0,0,1,0,0)}else oe.onerror("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.")}},oe.ShaderChunk={common:["#define PI 3.14159","#define PI2 6.28318","#define LOG2 1.442695","float square( in float a ) { return a*a; }","vec2  square( in vec2 a )  { return vec2( a.x*a.x, a.y*a.y ); }","vec3  square( in vec3 a )  { return vec3( a.x*a.x, a.y*a.y, a.z*a.z ); }","vec4  square( in vec4 a )  { return vec4( a.x*a.x, a.y*a.y, a.z*a.z, a.w*a.w ); }","float saturate( in float a ) { return clamp( a, 0.0, 1.0 ); }","vec2  saturate( in vec2 a )  { return clamp( a, 0.0, 1.0 ); }","vec3  saturate( in vec3 a )  { return clamp( a, 0.0, 1.0 ); }","vec4  saturate( in vec4 a )  { return clamp( a, 0.0, 1.0 ); }","float average( in float a ) { return a; }","float average( in vec2 a )  { return ( a.x + a.y) * 0.5; }","float average( in vec3 a )  { return ( a.x + a.y + a.z) * 0.3333333333; }","float average( in vec4 a )  { return ( a.x + a.y + a.z + a.w) * 0.25; }","float whiteCompliment( in float a ) { return saturate( 1.0 - a ); }","vec2  whiteCompliment( in vec2 a )  { return saturate( vec2(1.0) - a ); }","vec3  whiteCompliment( in vec3 a )  { return saturate( vec3(1.0) - a ); }","vec4  whiteCompliment( in vec4 a )  { return saturate( vec4(1.0) - a ); }","vec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal) {","float distance = dot( planeNormal, point-pointOnPlane );","return point - distance * planeNormal;","}","float sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {","return sign( dot( point - pointOnPlane, planeNormal ) );","}","vec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {","return pointOnLine + lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) );","}","vec4 texelDecode( vec4 texel, int encoding ) {","if( encoding == 3001 ) {","texel = vec4( square( texel.xyz ), texel.w );","}","else if( encoding == 3002 ) {","texel = vec4( texel.xyz * pow( 2.0, texel.w*256.0 - 128.0 ), 1.0 );","}","else if( encoding == 3004 ) {","texel = vec4( texel.xyz * texel.w * 7.0, 1.0 );","}","else if( encoding == 3005 ) {","texel = vec4( texel.xyz * texel.w * 16.0, 1.0 );","}","if( encoding == 0 ) {","#ifdef GAMMA_INPUT","texel.xyz *= texel.xyz;","#endif","}","return texel;","}"].join("\n"),fog_pars_fragment:["#ifdef USE_FOG","uniform vec3 fogColor;","#ifdef FOG_EXP2","uniform float fogDensity;","#else","uniform float fogNear;","uniform float fogFar;","#endif","#endif"].join("\n"),fog_fragment:["#ifdef USE_FOG","float depth = gl_FragCoord.z / gl_FragCoord.w;","#ifdef FOG_EXP2","float fogFactor = exp2( - square( fogDensity ) * square( depth ) * LOG2 );","fogFactor = 1.0 - saturate( fogFactor );","#else","float fogFactor = smoothstep( fogNear, fogFar, depth );","#endif","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","#endif"].join("\n"),diffuseenvmap_pars_fragment:["#if defined( USE_DIFFUSEENVMAP )","uniform samplerCube diffuseEnvMap;","uniform int diffuseEnvEncoding;","#endif"].join("\n"),envmap_pars_fragment:["#if defined( USE_ENVMAP )","uniform float reflectivity;","#endif","#if defined( USE_DIFFUSEENVMAP ) || defined( USE_ENVMAP )","uniform float flipEnvMap;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","uniform bool useRefract;","uniform float refractionRatio;","#else","varying vec3 vReflect;","#endif","#endif","#ifdef USE_ENVMAP","uniform samplerCube envMap;","uniform int combine;","uniform int envEncoding;","#endif"].join("\n"),envmap_fragment:["#if defined( USE_ENVMAP ) && ! defined( PHYSICAL )","vec3 reflectVec = vReflect;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","vec3 worldNormal = vec3( normalize( ( vec4( normal, 0.0 ) * viewMatrix ).xyz ) );","vec3 worldView = -vec3( normalize( ( vec4( viewPosition, 0.0 ) * viewMatrix ).xyz ) );","if ( useRefract ) {","reflectVec = refract( worldView, worldNormal, refractionRatio );","} else { ","reflectVec = reflect( worldView, worldNormal );","}","#else","#endif","#ifdef DOUBLE_SIDED","float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );","vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#else","vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#endif","cubeColor = texelDecode( cubeColor, envEncoding );","if( envEncoding == 0 ) {","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","}","float fresnelReflectivity = saturate( reflectivity );","if ( combine == 1 ) {","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, fresnelReflectivity );","} else if ( combine == 2 ) {","gl_FragColor.xyz += cubeColor.xyz * fresnelReflectivity;","} else {","gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, fresnelReflectivity );","}","#endif"].join("\n"),envmap_pars_vertex:["#if ( defined( USE_ENVMAP ) || defined( USE_DIFFUSEENVMAP ) ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","varying vec3 vReflect;","uniform float refractionRatio;","uniform bool useRefract;","#endif"].join("\n"),worldpos_vertex:["#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )","#ifdef USE_SKINNING","vec4 worldPosition = modelMatrix * skinned;","#endif","#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );","#endif","#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","#endif","#endif"].join("\n"),envmap_vertex:["#if ( defined( USE_ENVMAP ) || defined( USE_DIFFUSEENVMAP ) ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;","worldNormal = normalize( worldNormal );","vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, worldNormal, refractionRatio );","} else {","vReflect = reflect( cameraToVertex, worldNormal );","}","#endif"].join("\n"),map_particle_pars_fragment:["#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_particle_fragment:["#ifdef USE_MAP","gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );","#endif"].join("\n"),map_pars_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_REFLECTIVITYMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALLICMAP ) || defined( USE_OPACITYMAP ) || defined( USE_FALLOFFMAP ) || defined( USE_TRANSLUCENCYMAP ) || defined( USE_ANISOTROPYMAP ) || defined( USE_ANISOTROPYROTATIONMAP )","varying vec2 vUv;","#endif"].join("\n"),map_pars_fragment:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_REFLECTIVITYMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALLICMAP ) || defined( USE_OPACITYMAP ) || defined( USE_FALLOFFMAP ) || defined( USE_TRANSLUCENCYMAP ) || defined( USE_ANISOTROPYMAP ) || defined( USE_ANISOTROPYROTATIONMAP )","varying vec2 vUv;","uniform vec4 offsetRepeat;","uniform vec4 gainBrightness;","vec4 applyGainBrightness( vec4 texel, vec4 gainBrightnessCoeff ) {","texel.xyz = ( texel.xyz - vec3( gainBrightnessCoeff.x ) ) * gainBrightnessCoeff.y + vec3( gainBrightnessCoeff.z + gainBrightnessCoeff.x );","return texel;","}","#endif","#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_REFLECTIVITYMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALLICMAP ) || defined( USE_OPACITYMAP ) || defined( USE_FALLOFFMAP ) || defined( USE_TRANSLUCENCYMAP ) || defined( USE_ANISOTROPYMAP ) || defined( USE_ANISOTROPYROTATIONMAP )","vUv = uv;","#endif"].join("\n"),map_fragment:["#if defined( USE_MAP ) || defined( USE_FALLOFFMAP )","vec2 vUvLocal = vUv * offsetRepeat.zw + offsetRepeat.xy;","#endif","#ifdef USE_MAP","vec4 texelColor = applyGainBrightness( texture2D( map, vUvLocal ), gainBrightness );","#ifdef GAMMA_INPUT","texelColor.xyz *= texelColor.xyz;","#endif","gl_FragColor = gl_FragColor * texelColor;","#if defined( PHYSICAL ) || defined( PHONG )","diffuseColor *= texelColor.xyz;","#endif","#endif"].join("\n"),falloffmap_pars_fragment:["#ifdef USE_FALLOFFMAP","uniform sampler2D falloffMap;","#endif"].join("\n"),opacitymap_pars_vertex:["#ifdef USE_OPACITYMAP","#endif"].join("\n"),opacitymap_vertex:["#ifdef USE_OPACITYMAP","#endif"].join("\n"),opacitymap_pars_fragment:["#ifdef USE_OPACITYMAP","uniform sampler2D opacityMap;","uniform vec4 opacityOffsetRepeat;","uniform vec4 opacityGainBrightness;","#endif"].join("\n"),opacitymap_fragment:["#ifdef USE_OPACITYMAP","vec2 vOpacityUv = vUv * opacityOffsetRepeat.zw + opacityOffsetRepeat.xy;","vec4 texelOpacity = applyGainBrightness( texture2D( opacityMap, vOpacityUv ), opacityGainBrightness );","gl_FragColor.w = gl_FragColor.w * texelOpacity.r;","#endif"].join("\n"),translucencymap_pars_vertex:["#ifdef USE_TRANSLUCENCYMAP","#endif"].join("\n"),translucencymap_vertex:["#ifdef USE_TRANSLUCENCYMAP","#endif"].join("\n"),translucencymap_pars_fragment:["#ifdef USE_TRANSLUCENCYMAP","uniform sampler2D translucencyMap;","uniform vec4 translucencyOffsetRepeat;","uniform vec4 translucencyGainBrightness;","#endif"].join("\n"),translucencymap_fragment:["#ifdef USE_TRANSLUCENCYMAP","vec2 vTranslucencyUv = vUv * translucencyOffsetRepeat.zw + translucencyOffsetRepeat.xy;","vec4 texelTranslucency = applyGainBrightness( texture2D( translucencyMap, vTranslucencyUv ), translucencyGainBrightness );","#ifdef GAMMA_INPUT","texelTranslucency.xyz *= texelTranslucency.xyz;","#endif","translucencyColor.xyz *= texelTranslucency.xyz;","#endif"].join("\n"),lightmap_pars_fragment:["#if defined( USE_LIGHTMAP ) || defined( USE_EMISSIVEMAP )","varying vec2 vUv2;","#endif","#if defined( USE_LIGHTMAP )","uniform sampler2D lightMap;","#endif","#if defined( USE_EMISSIVEMAP )","uniform sampler2D emissiveMap;","#endif"].join("\n"),lightmap_pars_vertex:["#if defined( USE_LIGHTMAP ) || defined( USE_EMISSIVEMAP )","varying vec2 vUv2;","#endif"].join("\n"),lightmap_fragment:["#ifdef USE_LIGHTMAP","#endif"].join("\n"),lightmap_vertex:["#if defined( USE_LIGHTMAP ) || defined( USE_EMISSIVEMAP )","vUv2 = uv2;","#endif"].join("\n"),bumpmap_pars_vertex:["#ifdef USE_BUMPMAP","#endif"].join("\n"),bumpmap_vertex:["#ifdef USE_BUMPMAP","#endif"].join("\n"),bumpmap_pars_fragment:["#ifdef USE_BUMPMAP","uniform sampler2D bumpMap;","uniform vec4 bumpOffsetRepeat;","uniform float bumpScale;","vec2 dHdxy_fwd() {","vec2 vBumpUv = vUv * bumpOffsetRepeat.zw + bumpOffsetRepeat.xy;","vec2 dSTdx = dFdx( vBumpUv );","vec2 dSTdy = dFdy( vBumpUv );","float Hll = bumpScale * texture2D( bumpMap, vBumpUv ).x;","float dBx = bumpScale * texture2D( bumpMap, vBumpUv + dSTdx ).x - Hll;","float dBy = bumpScale * texture2D( bumpMap, vBumpUv + dSTdy ).x - Hll;","return vec2( dBx, dBy );","}","vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","vec3 vSigmaX = dFdx( surf_pos );","vec3 vSigmaY = dFdy( surf_pos );","vec3 vN = surf_norm;","vec3 R1 = cross( vSigmaY, vN );","vec3 R2 = cross( vN, vSigmaX );","float fDet = dot( vSigmaX, R1 );","vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","return normalize( abs( fDet ) * surf_norm - vGrad );","}","#endif"].join("\n"),lightattenuation_func_fragment:["float calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {","float distanceAttenuation = 1.0 / pow( lightDistance, decayExponent );","if ( cutoffDistance > 0.0 ) {","distanceAttenuation *= 1.0 - min( lightDistance / cutoffDistance, 1.0 );","}","return distanceAttenuation;","}"].join("\n"),normalmap_pars_vertex:["#ifdef USE_NORMALMAP","#endif"].join("\n"),normalmap_vertex:["#ifdef USE_NORMALMAP","#endif"].join("\n"),normalmap_pars_fragment:["#ifdef USE_NORMALMAP","uniform sampler2D normalMap;","uniform vec4 normalOffsetRepeat;","uniform vec2 normalScale;","vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {","vec2 vNormalUv = vUv * normalOffsetRepeat.zw + normalOffsetRepeat.xy;","vec3 q0 = dFdx( eye_pos.xyz );","vec3 q1 = dFdy( eye_pos.xyz );","vec2 st0 = dFdx( vNormalUv.st );","vec2 st1 = dFdy( vNormalUv.st );","vec3 S = normalize(  q0 * st1.t - q1 * st0.t );","vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","vec3 N = normalize( surf_norm );","vec3 mapN = texture2D( normalMap, vNormalUv ).xyz * 2.0 - 1.0;","mapN.xy = normalScale * mapN.xy;","mat3 tsn = mat3( S, T, N );","return normalize( tsn * mapN );","}","#endif"].join("\n"),anisotropymap_pars_vertex:["#ifdef USE_ANISOTROPYMAP","#else","#ifdef ANISOTROPY","#endif","#endif"].join("\n"),anisotropymap_vertex:[].join("\n"),anisotropymap_pars_fragment:["#ifdef USE_ANISOTROPYMAP","uniform sampler2D anisotropyMap;","uniform vec4 anisotropyGainBrightness;","uniform vec4 anisotropyOffsetRepeat;","#else","#ifdef ANISOTROPY","#endif","#endif"].join("\n"),anisotropymap_fragment:["#ifdef USE_ANISOTROPYMAP","vec2 vAnisotropyUv = vUv * anisotropyOffsetRepeat.zw + anisotropyOffsetRepeat.xy;","#else","#ifdef ANISOTROPY","#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_REFLECTIVITYMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALLICMAP ) || defined( USE_OPACITYMAP ) || defined( USE_FALLOFFMAP ) || defined( USE_TRANSLUCENCYMAP ) || defined( USE_ANISOTROPYMAP ) || defined( USE_ANISOTROPYROTATIONMAP )","vec2 vAnisotropyUv = vUv;","#else","vec2 vAnisotropyUv = vec2( 0, 0 );","#endif","#endif","#endif","float anisotropyStrength = anisotropy;","#ifdef USE_ANISOTROPYMAP","vec4 texelAnisotropy = applyGainBrightness( texture2D( anisotropyMap, vAnisotropyUv ), anisotropyGainBrightness );","anisotropyStrength += texelAnisotropy.r;","#endif"].join("\n"),anisotropyrotationmap_pars_vertex:["#ifdef USE_ANISOTROPYROTATIONMAP","#endif"].join("\n"),anisotropyrotationmap_vertex:["#ifdef USE_ANISOTROPYROTATIONMAP","#endif"].join("\n"),anisotropyrotationmap_pars_fragment:["#ifdef USE_ANISOTROPYROTATIONMAP","uniform sampler2D anisotropyRotationMap;","uniform vec4 anisotropyRotationGainBrightness;","uniform vec4 anisotropyRotationOffsetRepeat;","#endif"].join("\n"),anisotropyrotationmap_fragment:["float anisotropyRotationStrength = anisotropyRotation;","#ifdef USE_ANISOTROPYROTATIONMAP","vec2 vAnisotropyRotationUv = vUv * anisotropyRotationOffsetRepeat.zw + anisotropyRotationOffsetRepeat.xy;","vec4 texelAnisotropyRotation = applyGainBrightness( texture2D( anisotropyRotationMap, vAnisotropyRotationUv ), anisotropyRotationGainBrightness );","anisotropyRotationStrength += texelAnisotropyRotation.r;","#endif"].join("\n"),metallicmap_pars_vertex:["#ifdef USE_METALLICMAP","#endif"].join("\n"),metallicmap_vertex:["#ifdef USE_METALLICMAP","#endif"].join("\n"),metallicmap_pars_fragment:["#ifdef USE_METALLICMAP","uniform sampler2D metallicMap;","uniform vec4 metallicGainBrightness;","uniform vec4 metallicOffsetRepeat;","#endif"].join("\n"),metallicmap_fragment:["float metallicStrength = metallic;","#ifdef USE_METALLICMAP","vec2 vMetallicUv = vUv * metallicOffsetRepeat.zw + metallicOffsetRepeat.xy;","vec4 texelMetallic = applyGainBrightness( texture2D( metallicMap, vMetallicUv ), metallicGainBrightness );","metallicStrength *= texelMetallic.r;","#endif"].join("\n"),roughnessmap_pars_vertex:["#ifdef USE_ROUGHNESSMAP","#endif"].join("\n"),roughnessmap_vertex:["#ifdef USE_ROUGHNESSMAP","#endif"].join("\n"),roughnessmap_pars_fragment:["#ifdef USE_ROUGHNESSMAP","uniform sampler2D roughnessMap;","uniform vec4 roughnessOffsetRepeat;","uniform vec4 roughnessGainBrightness;","#endif"].join("\n"),roughnessmap_fragment:["float roughnessStrength = roughness;","#ifdef USE_ROUGHNESSMAP","vec2 vRoughnessUv = vUv * roughnessOffsetRepeat.zw + roughnessOffsetRepeat.xy;","vec4 texelRoughness = applyGainBrightness( texture2D( roughnessMap, vRoughnessUv ), roughnessGainBrightness );","roughnessStrength *= texelRoughness.r;","#endif"].join("\n"),specularmap_pars_vertex:["#ifdef USE_SPECULARMAP","#endif"].join("\n"),specularmap_vertex:["#ifdef USE_SPECULARMAP","#endif"].join("\n"),specularmap_pars_fragment:["#ifdef USE_SPECULARMAP","uniform sampler2D specularMap;","uniform vec4 specularGainBrightness;","uniform vec4 specularOffsetRepeat;","#endif"].join("\n"),specularmap_fragment:["float specularStrength;","#ifdef USE_SPECULARMAP","vec2 vSpecularUv = vUv * specularOffsetRepeat.zw + specularOffsetRepeat.xy;","vec4 texelSpecular = applyGainBrightness( texture2D( specularMap, vSpecularUv ), specularGainBrightness );","specularStrength = texelSpecular.r;","#else","specularStrength = 1.0;","#endif"].join("\n"),lights_lambert_pars_vertex:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","uniform float pointLightDecayExponent[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDecayExponent[ MAX_SPOT_LIGHTS ];","#endif","#if MAX_AREA_LIGHTS > 0","uniform vec3 areaLightColor[ MAX_AREA_LIGHTS ];","uniform vec3 areaLightPosition[ MAX_AREA_LIGHTS ];","uniform vec3 areaLightWidth[ MAX_AREA_LIGHTS ];","uniform vec3 areaLightHeight[ MAX_AREA_LIGHTS ];","uniform float areaLightDistance[ MAX_AREA_LIGHTS ];","uniform float areaLightDecayExponent[ MAX_AREA_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif"].join("\n"),lights_lambert_vertex:["vLightFront = vec3( 0.0 );","#ifdef DOUBLE_SIDED","vLightBack = vec3( 0.0 );","#endif","transformedNormal = normalize( transformedNormal );","#if MAX_DIR_LIGHTS > 0","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, dirVector );","vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += directionalLightColor[ i ] * directionalLightWeighting;","#ifdef DOUBLE_SIDED","vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;","#endif","}","#endif","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float distanceAttenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecayExponent[i] );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += pointLightColor[ i ] * pointLightWeighting * distanceAttenuation;","#ifdef DOUBLE_SIDED","vLightBack += pointLightColor[ i ] * pointLightWeightingBack * distanceAttenuation;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float distanceAttenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecayExponent[i] );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += spotLightColor[ i ] * spotLightWeighting * distanceAttenuation * spotEffect;","#ifdef DOUBLE_SIDED","vLightBack += spotLightColor[ i ] * spotLightWeightingBack * distanceAttenuation * spotEffect;","#endif","}","}","#endif","#if MAX_HEMI_LIGHTS > 0","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;","vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","#ifdef DOUBLE_SIDED","vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );","#endif","}","#endif","vLightFront = ( vLightFront + ambientLightColor + ambient) * diffuse + emissive;","#ifdef DOUBLE_SIDED","vLightBack = ( vLightFront + ambientLightColor + ambient) * diffuse + emissive;","#endif"].join("\n"),lights_physical_pars_vertex:["#if MAX_SPOT_LIGHTS > 0 || MAX_AREA_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )","varying vec3 vWorldPosition;","#endif"].join("\n"),lights_physical_vertex:["#if MAX_SPOT_LIGHTS > 0 || MAX_AREA_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )","vWorldPosition = worldPosition.xyz;","#endif","#ifdef USE_SKINNING","vNormal = normalize( normalMatrix * skinnedNormal.xyz );","vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","vTangent = normalize( normalMatrix * skinnedTangent.xyz );","#else","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","#endif","vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );"].join("\n"),lights_physical_pars_fragment:["uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","uniform float pointLightDecayExponent[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","uniform float spotLightDecayExponent[ MAX_SPOT_LIGHTS ];","#endif","#if MAX_AREA_LIGHTS > 0","uniform vec3 areaLightColor[ MAX_AREA_LIGHTS ];","uniform vec3 areaLightPosition[ MAX_AREA_LIGHTS ];","uniform vec3 areaLightWidth[ MAX_AREA_LIGHTS ];","uniform vec3 areaLightHeight[ MAX_AREA_LIGHTS ];","uniform float areaLightDistance[ MAX_AREA_LIGHTS ];","uniform float areaLightDecayExponent[ MAX_AREA_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0 || MAX_AREA_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vViewPosition;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","vec3 Fresnel_Schlick_SpecularBlendToWhite(vec3 specularColor, float hDotV) {","float Fc = pow(1.0 - hDotV, 5.0);","return saturate( 50.0 * average( specularColor ) ) * Fc + (1.0 - Fc) * specularColor;","}","vec3 Fresnel_Schlick_SpecularBlendToWhiteRoughness(vec3 specularColor, float hDotV, float roughness) {","float Fc = pow(1.0 - hDotV, 5.0) / ( 1.0 + 3.0 * roughness );","return saturate( 50.0 * average( specularColor ) ) * Fc + (1.0 - Fc) * specularColor;","}","float Distribution_GGX( float roughness2, float nDotH ) {","float denom = nDotH * nDotH * (roughness2 - 1.0) + 1.0;","return roughness2 / ( PI * square( denom ) + 0.0000001 );","}","float Distribution_GGXAniso( vec2 anisotropicM, vec2 xyDotH, float nDotH ) {","float anisoTerm = ( xyDotH.x * xyDotH.x / ( anisotropicM.x * anisotropicM.x ) + xyDotH.y * xyDotH.y / ( anisotropicM.y * anisotropicM.y ) + nDotH * nDotH );","return 1.0 / ( PI * anisotropicM.x * anisotropicM.y * anisoTerm * anisoTerm + 0.0000001 );","}","float Visibility_Kelemen( float vDotH ) {","return 1.0 / ( 4.0 * vDotH * vDotH + 0.0000001 );","}","float Visibility_Schlick(in float roughness2, in float nDotL, in float nDotV) {","float termL = (nDotL + sqrt(roughness2 + (1.0 - roughness2) * nDotL * nDotL));","float termV = (nDotV + sqrt(roughness2 + (1.0 - roughness2) * nDotV * nDotV));","return 1.0 / ( abs( termL * termV ) + 0.0000001 );","}","float Diffuse_Lambert() {","return 1.0 / PI;","}","float Diffuse_OrenNayer(in float m2, in float nDotV, in float nDotL, in float vDotH ) {","float termA = 1.0 - 0.5 * m2 / (m2 + 0.33);","float Cosri = 2.0 * vDotH - 1.0 - nDotV * nDotL;","float termB = 0.45 * m2 / (m2 + 0.09) * Cosri * ( Cosri >= 0.0 ? min( 1.0, nDotL / nDotV ) : nDotL );","return 1.0 / PI * ( nDotL * termA + termB );","}","mat2 createRotationMat2(in float rads) {","float cos_rads = cos( rads );","float sin_rads = sin( rads );","return mat2( vec2( cos_rads, sin_rads ), vec2( -sin_rads, cos_rads ) );","}","vec2 calcAnisotropyUV(in float anisotropyLocal) {","float oneMinusAbsAnisotropy = 1.0 - min( abs( anisotropyLocal ) * 0.9, 0.9 );","vec2 anisotropyUV = vec2 ( 1.0 / oneMinusAbsAnisotropy, oneMinusAbsAnisotropy );","if( anisotropy < 0.0 ) {","anisotropyUV.xy = anisotropyUV.yx;","}","return anisotropyUV;","}"].join("\n"),lights_physical_fragment:["mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normal );","#ifdef USE_NORMALMAP","normal = perturbNormal2Arb( -vViewPosition, normal );","#endif","#if defined( USE_BUMPMAP )","normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","#ifdef DOUBLE_SIDED","normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","#ifdef FALLOFF","vec3 modulatedFalloffColor = falloffColor;","#ifdef USE_FALLOFFMAP","vec4 falloffTexelColor = texture2D( falloffMap, vUvLocal );","#ifdef GAMMA_INPUT","falloffTexelColor.xyz *= falloffTexelColor.xyz;","#endif","modulatedFalloffColor = modulatedFalloffColor * falloffTexelColor.xyz;","#endif","float fm = abs( dot( normal, viewPosition ) );","fm = /*falloffBlendParams.x * fm + falloffBlendParams.y * */ ( fm * fm * ( 3.0 - 2.0 * fm ) );","diffuseColor = mix( modulatedFalloffColor, diffuseColor, fm );","#endif","float nDotV = saturate( dot( normal, viewPosition ) );","float m2 = pow( clamp( roughnessStrength, 0.02, 1.0 ), 4.0 );","float m2ClearCoat = pow( clamp( clearCoatRoughness, 0.02, 1.0 ), 4.0 );","vec3 specularColor = mix( specular * 0.18, diffuseColor, metallicStrength );","diffuseColor *= ( 1.0 - metallicStrength );","#ifdef ANISOTROPY","vec2 anisotropicM = calcAnisotropyUV( anisotropyStrength ) * sqrt( m2 );","#ifdef ANISOTROPYROTATION","mat2 anisotropicRotationMatrix = createRotationMat2( anisotropyRotationStrength * 2.0 * PI );","#endif","vec3 anisotropicS = tsb[1];","vec3 anisotropicT = tsb[0];","#endif","vec3 totalLighting  = vec3( 0.0 );","#if ( defined( USE_ENVMAP ) || defined( USE_DIFFUSEENVMAP ) ) && defined( PHYSICAL )","{","vec3 reflectVec;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","vec3 worldNormal = vec3( normalize( ( vec4( normal, 0.0 ) * viewMatrix ).xyz ) );","vec3 worldView = -vec3( normalize( ( vec4( viewPosition, 0.0 ) * viewMatrix ).xyz ) );","if ( useRefract ) {","reflectVec = refract( worldView, worldNormal, refractionRatio );","} else { ","reflectVec = reflect( worldView, worldNormal );","}","#else","reflectVec = vReflect;","#endif","vec3 hVector = normal;//normalize( viewPosition.xyz + lVector.xyz );","float nDotH = saturate( dot( normal, normal ) );","float hDotV = saturate( dot( normal, viewPosition ) );","float nDotL = hDotV;//saturate( dot( normal, lVector ) );","vec3 queryVector = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );","#ifdef DOUBLE_SIDED","queryVector *= ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","vec3 worldEnvNormal = vec3( normalize( ( vec4( normal, 0.0 ) * viewMatrix ).xyz ) );","worldEnvNormal = vec3( flipEnvMap * worldEnvNormal.x, worldEnvNormal.yz );","#ifdef DOUBLE_SIDED","worldEnvNormal *= ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","vec4 diffuseEnvColor = vec4( 0.0, 0.0, 0.0, 1.0 );","int diffuseEnvColorDecoding = 0;","#if defined( USE_DIFFUSEENVMAP )","diffuseEnvColor = textureCube( diffuseEnvMap, worldEnvNormal );","diffuseEnvColorDecoding = diffuseEnvEncoding;","#elif defined( USE_ENVMAP )","#if defined( TEXTURE_CUBE_LOD_EXT )","diffuseEnvColor = textureCubeLodEXT( envMap, worldEnvNormal, 9.5 );","#endif","diffuseEnvColorDecoding = envEncoding;","#endif","vec4 specularEnvColor = vec4( 0.0, 0.0, 0.0, 1.0 );","int specularEnvColorDecoding = 0;","#if defined( USE_ENVMAP )","#if defined( TEXTURE_CUBE_LOD_EXT )","specularEnvColor = textureCubeLodEXT( envMap, queryVector, roughnessStrength * 9.5 );","#else","specularEnvColor = textureCube( envMap, queryVector ) * ( 0.2 + ( 1.0 - roughnessStrength ) * 0.8 );","#endif","specularEnvColorDecoding = envEncoding;","#endif","diffuseEnvColor = texelDecode( diffuseEnvColor, diffuseEnvColorDecoding );","specularEnvColor = texelDecode( specularEnvColor, specularEnvColorDecoding );","vec3 specClearCoat = vec3(0, 0, 0);","#if defined( CLEARCOAT ) && defined( USE_ENVMAP )","#if defined( TEXTURE_CUBE_LOD_EXT )","vec4 specularClearCoatEnvColor = textureCubeLodEXT( envMap, queryVector, clearCoatRoughness * 9.5 );","#else","vec4 specularClearCoatEnvColor = textureCube( envMap, queryVector ) * ( 0.2 + ( 1.0 - clearCoatRoughness ) * 0.8 );","#endif","specularClearCoatEnvColor = texelDecode( specularClearCoatEnvColor, envEncoding );","vec3 fresnelClearCoat = Fresnel_Schlick_SpecularBlendToWhiteRoughness( vec3( 0.18 ), nDotL, m2ClearCoat );","specClearCoat = specularClearCoatEnvColor.rgb * fresnelClearCoat;","#endif","vec3 fresnelColor = Fresnel_Schlick_SpecularBlendToWhiteRoughness( specularColor, nDotL, m2 );","vec3 spec = fresnelColor * specularEnvColor.rgb;","vec3 diff = diffuseColor * diffuseEnvColor.rgb;","vec3 shadingResult = spec + diff;","#ifdef CLEARCOAT","shadingResult = mix( shadingResult, specClearCoat, clearCoat );","#endif","totalLighting  += shadingResult;","}","#endif","#if MAX_POINT_LIGHTS > 0","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float distanceAttenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecayExponent[i] );","vec3 incidentLight = pointLightColor[ i ] * distanceAttenuation;","lVector = normalize( lVector );","vec3 hVector = normalize( viewPosition.xyz + lVector.xyz );","float nDotH = saturate( dot( normal, hVector ) );","float nDotL = saturate( dot( normal, lVector ) );","float hDotV = saturate( dot( hVector, viewPosition ) );","#ifdef CLEARCOAT","float dClearCoat = Distribution_GGX( m2ClearCoat, nDotH );","float visClearCoat = Visibility_Kelemen( hDotV );","vec3 fresnelClearCoat = Fresnel_Schlick_SpecularBlendToWhite( vec3( 0.18 ), hDotV );","vec3 specClearCoat = clamp( nDotL * dClearCoat * visClearCoat, 0.0, 10.0 ) * fresnelClearCoat;","#endif","#ifdef ANISOTROPY","vec2 xyDotH = vec2( dot( anisotropicS, hVector ), dot( anisotropicT, hVector ) );","#ifdef ANISOTROPYROTATION","xyDotH = anisotropicRotationMatrix * xyDotH;","#endif","float d = Distribution_GGXAniso( anisotropicM, xyDotH, nDotH );","#else","float d = Distribution_GGX( m2, nDotH );","#endif","float vis = Visibility_Schlick(m2, nDotL, nDotV);","vec3 fresnelColor = Fresnel_Schlick_SpecularBlendToWhite( specularColor, hDotV );","vec3 spec = clamp( nDotL * d * vis, 0.0, 10.0 ) * fresnelColor;","vec3 diff = nDotL * Diffuse_Lambert() * diffuseColor;","#ifdef TRANSLUCENCY","diff *= whiteCompliment( translucencyColor.xyz );","#endif","vec3 shadingResult = spec + diff;","#ifdef CLEARCOAT","shadingResult = mix( shadingResult, specClearCoat, clearCoat );","#endif","totalLighting  += incidentLight * shadingResult;","#ifdef TRANSLUCENCY","float lightNormalTL = mix( 1.0, pow( abs( dot( lVector.xyz, normal ) ), translucencyNormalPower ), translucencyNormalAlpha );","float viewNormalTL = mix( 1.0, pow( abs( dot( viewPosition.xyz, lVector.xyz) ), translucencyViewPower ), translucencyViewAlpha );","totalLighting += lightNormalTL * viewNormalTL * translucencyColor.rgb * incidentLight;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float distanceAttenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecayExponent[i] );","vec3 incidentLight = spotLightColor[ i ] * distanceAttenuation;","lVector = normalize( lVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","incidentLight *= spotEffect;","vec3 hVector = normalize( viewPosition.xyz + lVector.xyz );","float nDotH = saturate( dot( normal, hVector ) );","float nDotL = saturate( dot( normal, lVector ) );","float hDotV = saturate( dot( hVector, viewPosition ) );","#ifdef CLEARCOAT","float dClearCoat = Distribution_GGX( m2ClearCoat, nDotH );","float visClearCoat = Visibility_Kelemen( hDotV );","vec3 fresnelClearCoat = Fresnel_Schlick_SpecularBlendToWhite( vec3( 0.18 ), hDotV );","vec3 specClearCoat = clamp( nDotL * dClearCoat * visClearCoat, 0.0, 10.0 ) * fresnelClearCoat;","#endif","#ifdef ANISOTROPY","vec2 xyDotH = vec2( dot( anisotropicS, hVector ), dot( anisotropicT, hVector ) );","#ifdef ANISOTROPYROTATION","xyDotH = anisotropicRotationMatrix * xyDotH;","#endif","float d = Distribution_GGXAniso( anisotropicM, xyDotH, nDotH );","#else","float d = Distribution_GGX( m2, nDotH );","#endif","float vis = Visibility_Schlick(m2, nDotL, nDotV);","vec3 fresnelColor = Fresnel_Schlick_SpecularBlendToWhite( specularColor, hDotV );","vec3 spec = clamp( nDotL * d * vis, 0.0, 10.0 ) * fresnelColor;","vec3 diff = nDotL * Diffuse_Lambert() * diffuseColor;","#ifdef TRANSLUCENCY","diff *= whiteCompliment( translucencyColor.xyz );","#endif","vec3 shadingResult = spec + diff;","#ifdef CLEARCOAT","shadingResult = mix( shadingResult, specClearCoat, clearCoat );","#endif","totalLighting  += incidentLight * shadingResult;","#ifdef TRANSLUCENCY","float lightNormalTL = mix( 1.0, pow( abs( dot( lVector.xyz, normal ) ), translucencyNormalPower ), translucencyNormalAlpha );","float viewNormalTL = mix( 1.0, pow( abs( dot( viewPosition.xyz, lVector.xyz) ), translucencyViewPower ), translucencyViewAlpha );","totalLighting += lightNormalTL * viewNormalTL * translucencyColor.rgb * incidentLight;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","vec3 incidentLight = directionalLightColor[ i ];","vec3 hVector = normalize( viewPosition.xyz + lVector.xyz );","float nDotH = saturate( dot( normal, hVector ) );","float nDotL = saturate( dot( normal, lVector ) );","float hDotV = saturate( dot( hVector, viewPosition ) );","#ifdef CLEARCOAT","float dClearCoat = Distribution_GGX( m2ClearCoat, nDotH );","float visClearCoat = Visibility_Kelemen( hDotV );","vec3 fresnelClearCoat = Fresnel_Schlick_SpecularBlendToWhite( vec3( 0.18 ), hDotV );","vec3 specClearCoat = clamp( nDotL * dClearCoat * visClearCoat, 0.0, 10.0 ) * fresnelClearCoat;","#endif","#ifdef ANISOTROPY","vec2 xyDotH = vec2( dot( anisotropicS, hVector ), dot( anisotropicT, hVector ) );","#ifdef ANISOTROPYROTATION","xyDotH = anisotropicRotationMatrix * xyDotH;","#endif","float d = Distribution_GGXAniso( anisotropicM, xyDotH, nDotH );","#else","float d = Distribution_GGX( m2, nDotH );","#endif","float vis = Visibility_Schlick(m2, nDotL, nDotV);","vec3 fresnelColor = Fresnel_Schlick_SpecularBlendToWhite( specularColor, hDotV );","vec3 spec = clamp( nDotL * d * vis, 0.0, 10.0 ) * fresnelColor;","vec3 diff = nDotL * Diffuse_Lambert() * diffuseColor;","#ifdef TRANSLUCENCY","diff *= whiteCompliment( translucencyColor.xyz );","#endif","vec3 shadingResult = spec + diff;","#ifdef CLEARCOAT","shadingResult = mix( shadingResult, specClearCoat, clearCoat );","#endif","totalLighting  += incidentLight * shadingResult;","#ifdef TRANSLUCENCY","float lightNormalTL = mix( 1.0, pow( abs( dot( lVector.xyz, normal ) ), translucencyNormalPower ), translucencyNormalAlpha );","float viewNormalTL = mix( 1.0, pow( abs( dot( viewPosition.xyz, lVector.xyz) ), translucencyViewPower ), translucencyViewAlpha );","totalLighting += lightNormalTL * viewNormalTL * translucencyColor.rgb * incidentLight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float nDotL = dot( normal, lVector );","vec3 hemiColor = ( PI / 2.0 ) * ( ( 1.0 + nDotL ) * hemisphereLightSkyColor[ i ] + ( 1.0 - nDotL ) * hemisphereLightGroundColor[ i ] );","totalLighting += diffuseColor * hemiColor;","}","#endif","#if MAX_AREA_LIGHTS > 0","for( int i = 0; i < MAX_AREA_LIGHTS; i ++ ) {","vec3 lPosition = ( viewMatrix * vec4( areaLightPosition[ i ], 1.0 ) ).xyz;","vec3 width = areaLightWidth[ i ];","vec3 height = areaLightHeight[ i ];","vec3 up = normalize( ( viewMatrix * vec4( height, 0.0 ) ).xyz );","vec3 right = normalize( ( viewMatrix * vec4( width, 0.0 ) ).xyz );","vec3 pnormal = normalize( cross( right, up ) );","float widthScalar = length( width );","float heightScalar = length( height );","vec3 projection = projectOnPlane( -vViewPosition.xyz, lPosition, pnormal );","vec3 dir = projection - lPosition;","vec2 diagonal = vec2( dot( dir, right ), dot( dir, up ) );","vec2 nearest2D = vec2( clamp( diagonal.x, -widthScalar, widthScalar ), clamp( diagonal.y, -heightScalar, heightScalar ) );","vec3 nearestPointInside = lPosition + ( right *nearest2D.x + up * nearest2D.y );","vec3 lVector = ( nearestPointInside + vViewPosition.xyz );","float distanceAttenuation = calcLightAttenuation( length( lVector ), areaLightDistance[ i ], areaLightDecayExponent[i] );","lVector = normalize( lVector );","vec3 incidentLight = areaLightColor[ i ] * distanceAttenuation * 0.01;","float nDotLDiffuse = saturate( dot( normal, lVector ) );","vec3 diff = Diffuse_Lambert() * diffuseColor * widthScalar * heightScalar;","vec3 viewReflection = reflect( viewPosition.xyz, normal );","vec3 reflectionLightPlaneIntersection = linePlaneIntersect( -vViewPosition.xyz, viewReflection, lPosition, pnormal );","float specAngle = dot( viewReflection, pnormal );","if ( specAngle < 0.0 ) {","vec3 dirSpec = reflectionLightPlaneIntersection - lPosition;","vec2 dirSpec2D = vec2( dot( dirSpec, right ), dot( dirSpec, up ) );","vec2 nearestSpec2D = vec2( clamp( dirSpec2D.x, -widthScalar, widthScalar ), clamp( dirSpec2D.y, -heightScalar, heightScalar ) );","lVector = normalize( lPosition + ( right *nearestSpec2D.x + up * nearestSpec2D.y ) + vViewPosition.xyz );","} else { ","lVector = vec3( 0 );","}","vec3 hVector = normalize( viewPosition.xyz + lVector.xyz );","float nDotH = saturate( dot( normal, hVector ) );","float nDotL = saturate( dot( normal, lVector ) );","float hDotV = saturate( dot( hVector, viewPosition ) );","#ifdef CLEARCOAT","float dClearCoat = Distribution_GGX( m2ClearCoat, nDotH );","float visClearCoat = Visibility_Kelemen( hDotV );","vec3 fresnelClearCoat = Fresnel_Schlick_SpecularBlendToWhite( vec3( 0.18 ), hDotV );","vec3 specClearCoat = clamp( nDotL * dClearCoat * visClearCoat, 0.0, 10.0 ) * fresnelClearCoat;","#endif","#ifdef TRANSLUCENCY","diff *= whiteCompliment( translucencyColor.xyz );","#endif","#ifdef CLEARCOAT","diff = mix( diff, specClearCoat, clearCoat );","#endif","#ifdef ANISOTROPY","vec2 xyDotH = vec2( dot( anisotropicS, hVector ), dot( anisotropicT, hVector ) );","#ifdef ANISOTROPYROTATION","xyDotH = anisotropicRotationMatrix * xyDotH;","#endif","float d = Distribution_GGXAniso( anisotropicM, xyDotH, nDotH );","#else","float d = Distribution_GGX( m2, nDotH );","#endif","float vis = Visibility_Schlick(m2, nDotL, nDotV);","vec3 fresnelColor = Fresnel_Schlick_SpecularBlendToWhite( specularColor, hDotV );","vec3 spec = clamp( nDotL * d * vis, 0.0, 10.0 ) * fresnelColor;","totalLighting  += incidentLight * spec;","totalLighting  += incidentLight * nDotLDiffuse * diff;","#ifdef TRANSLUCENCY","float lightNormalTL = mix( 1.0, pow( abs( dot( lVector.xyz, normal ) ), translucencyNormalPower ), translucencyNormalAlpha );","float viewNormalTL = mix( 1.0, pow( abs( dot( viewPosition.xyz, lVector.xyz) ), translucencyViewPower ), translucencyViewAlpha );","totalLighting += lightNormalTL * viewNormalTL * translucencyColor.rgb * incidentLight;","#endif","}","#endif","#ifdef CLEARCOAT","totalLighting += diffuseColor * ( ambientLightColor * ( 1.0 - clearCoat ) );","#else","totalLighting += diffuseColor * ambientLightColor;","#endif","gl_FragColor.xyz += totalLighting;","vec3 emissiveLocal = emissive;","#ifdef USE_EMISSIVEMAP","vec3 emissiveColor = texture2D( emissiveMap, vUv2 ).xyz;","#ifdef GAMMA_INPUT","emissiveColor *= emissiveColor;","#endif","emissiveLocal *= emissiveColor;","#endif","gl_FragColor.xyz += emissiveLocal;","vec3 ambientLocal = ambient;","#ifdef USE_LIGHTMAP","vec3 ambientColor = texture2D( lightMap, vUv2 ).xyz;","#ifdef GAMMA_INPUT","ambientColor *= ambientColor;","#endif","ambientLocal *= ambientColor;","#ifdef CLEARCOAT","ambientLocal *= ( 1.0 - clearCoat );","#endif","#endif","gl_FragColor.xyz += diffuseColor * ambientLocal;"].join("\n"),lights_phong_pars_vertex:["#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )","varying vec3 vWorldPosition;","#endif"].join("\n"),lights_phong_vertex:["#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )","vWorldPosition = worldPosition.xyz;","#endif"].join("\n"),lights_phong_pars_fragment:["uniform vec3 ambientLightColor;","#ifndef USE_ENVMAP","uniform float reflectivity;","#endif","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","uniform float pointLightDecayExponent[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","uniform float spotLightDecayExponent[ MAX_SPOT_LIGHTS ];","#endif","#if MAX_AREA_LIGHTS > 0","uniform vec3 areaLightColor[ MAX_AREA_LIGHTS ];","uniform vec3 areaLightPosition[ MAX_AREA_LIGHTS ];","uniform vec3 areaLightWidth[ MAX_AREA_LIGHTS ];","uniform vec3 areaLightHeight[ MAX_AREA_LIGHTS ];","uniform float areaLightDistance[ MAX_AREA_LIGHTS ];","uniform float areaLightDecayExponent[ MAX_AREA_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0 || MAX_AREA_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vViewPosition;","varying vec3 vNormal;"].join("\n"),lights_phong_fragment:["vec3 normal = normalize( vNormal );","vec3 viewPosition = normalize( vViewPosition );","#ifdef DOUBLE_SIDED","normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","#ifdef USE_NORMALMAP","normal = perturbNormal2Arb( -vViewPosition, normal );","#elif defined( USE_BUMPMAP )","normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse  = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float distanceAttenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecayExponent[i] );","lVector = normalize( lVector );","float dotProduct = dot( normal, lVector );","float pointDiffuseWeight = max( dotProduct, 0.0 );","pointDiffuse  += pointLightColor[ i ] * pointDiffuseWeight * distanceAttenuation;","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * distanceAttenuation * specularNormalization;","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse  = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float distanceAttenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecayExponent[i] );","lVector = normalize( lVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dotProduct, 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dotProduct, 0.0 );","#endif","spotDiffuse += spotLightColor[ i ] * spotDiffuseWeight * distanceAttenuation * spotEffect;","vec3 spotHalfVector = normalize( lVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * distanceAttenuation * specularNormalization * spotEffect;","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse  = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, dirVector );","#ifdef WRAP_AROUND","float dirDiffuseWeightFull = max( dotProduct, 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dotProduct, 0.0 );","#endif","dirDiffuse  += directionalLightColor[ i ] * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );","vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","}","#endif","#if MAX_AREA_LIGHTS > 0","vec3 areaDiffuse  = vec3( 0.0 );","vec3 areaSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_AREA_LIGHTS; i ++ ) {","vec3 lPosition = ( viewMatrix * vec4( areaLightPosition[ i ], 1.0 ) ).xyz;","vec3 width = areaLightWidth[ i ];","vec3 height = areaLightHeight[ i ];","vec3 up = normalize( ( viewMatrix * vec4( height, 0.0 ) ).xyz );","vec3 right = normalize( ( viewMatrix * vec4( width, 0.0 ) ).xyz );","vec3 pnormal = normalize( cross( right, up ) );","float widthScalar = length( width );","float heightScalar = length( height );","vec3 projection = projectOnPlane( -vViewPosition.xyz, lPosition, pnormal );","vec3 dir = projection - lPosition;","vec2 diagonal = vec2( dot( dir, right ), dot( dir, up ) );","vec2 nearest2D = vec2( clamp( diagonal.x, -widthScalar, widthScalar ), clamp( diagonal.y, -heightScalar, heightScalar ) );","vec3 nearestPointInside = lPosition + ( right *nearest2D.x + up * nearest2D.y );","vec3 lVector = ( nearestPointInside + vViewPosition.xyz );","float distanceAttenuation = calcLightAttenuation( length( lVector ), areaLightDistance[ i ], areaLightDecayExponent[i] );","lVector = normalize( lVector );","float nDotLDiffuse = saturate( dot( normal, lVector ) );","vec3 viewReflection = reflect( viewPosition.xyz, normal );","vec3 reflectionLightPlaneIntersection = linePlaneIntersect( -vViewPosition.xyz, viewReflection, lPosition, pnormal );","float specAngle = dot( viewReflection, pnormal );","if ( specAngle < 0.0 ) {","vec3 dirSpec = reflectionLightPlaneIntersection - lPosition;","vec2 dirSpec2D = vec2( dot( dirSpec, right ), dot( dirSpec, up ) );","vec2 nearestSpec2D = vec2( clamp( dirSpec2D.x, -widthScalar, widthScalar ), clamp( dirSpec2D.y, -heightScalar, heightScalar ) );","lVector = normalize( lPosition + ( right *nearestSpec2D.x + up * nearestSpec2D.y ) + vViewPosition.xyz );","} else { ","lVector = vec3( 0 );","}","float dotProduct = nDotLDiffuse;","float areaDiffuseWeight = max( dotProduct, 0.0 );","areaDiffuse  += areaLightColor[ i ] * areaDiffuseWeight * distanceAttenuation * widthScalar * heightScalar * 0.01;","vec3 areaHalfVector = normalize( lVector + viewPosition );","float areaDotNormalHalf = max( dot( normal, areaHalfVector ), 0.0 );","float areaSpecularWeight = specularStrength * max( pow( areaDotNormalHalf, shininess ), 0.0 );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, areaHalfVector ), 0.0 ), 5.0 );","areaSpecular += schlick * areaLightColor[ i ] * areaSpecularWeight * areaDiffuseWeight * distanceAttenuation * specularNormalization * 0.01;","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#if MAX_AREA_LIGHTS > 0","totalDiffuse += areaDiffuse;","totalSpecular += areaSpecular;","#endif","vec3 ambientLocal = ambient;","#ifdef USE_LIGHTMAP","vec3 ambientColor = texture2D( lightMap, vUv2 ).xyz;","#ifdef GAMMA_INPUT","ambientColor *= ambientColor;","#endif","ambientLocal *= ambientColor;","#endif","gl_FragColor.xyz = diffuseColor * ( totalDiffuse + ambientLightColor + ambientLocal ) + totalSpecular;","vec3 emissiveLocal = emissive;","#ifdef USE_EMISSIVEMAP","vec3 emissiveColor = texture2D( emissiveMap, vUv2 ).xyz;","#ifdef GAMMA_INPUT","emissiveColor *= emissiveColor;","#endif","emissiveLocal *= emissiveColor;","#endif","gl_FragColor.xyz += emissiveLocal.xyz;"].join("\n"),color_pars_fragment:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_fragment:["#ifdef USE_COLOR","gl_FragColor = gl_FragColor * vec4( vColor, 1.0 );","#endif"].join("\n"),color_pars_vertex:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_vertex:["#ifdef USE_COLOR","#ifdef GAMMA_INPUT","vColor = color * color;","#else","vColor = color;","#endif","#endif"].join("\n"),skinning_pars_vertex:["#ifdef USE_SKINNING","#ifdef BONE_TEXTURE","uniform sampler2D boneTexture;","uniform int boneTextureWidth;","uniform int boneTextureHeight;","mat4 getBoneMatrix( const in float i ) {","float j = i * 4.0;","float x = mod( j, float( boneTextureWidth ) );","float y = floor( j / float( boneTextureWidth ) );","float dx = 1.0 / float( boneTextureWidth );","float dy = 1.0 / float( boneTextureHeight );","y = dy * ( y + 0.5 );","vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );","vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );","vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );","vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );","mat4 bone = mat4( v1, v2, v3, v4 );","return bone;","}","#else","uniform mat4 boneGlobalMatrices[ MAX_BONES ];","mat4 getBoneMatrix( const in float i ) {","mat4 bone = boneGlobalMatrices[ int(i) ];","return bone;","}","#endif","#endif"].join("\n"),skinbase_vertex:["#ifdef USE_SKINNING","mat4 boneMatX = getBoneMatrix( skinIndex.x );","mat4 boneMatY = getBoneMatrix( skinIndex.y );","mat4 boneMatZ = getBoneMatrix( skinIndex.z );","mat4 boneMatW = getBoneMatrix( skinIndex.w );","#endif"].join("\n"),skinning_vertex:["#ifdef USE_SKINNING","#ifdef USE_MORPHTARGETS","vec4 skinVertex = vec4( morphed, 1.0 );","#else","vec4 skinVertex = vec4( position, 1.0 );","#endif","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned      += boneMatY * skinVertex * skinWeight.y;","skinned      += boneMatZ * skinVertex * skinWeight.z;","skinned      += boneMatW * skinVertex * skinWeight.w;","#endif"].join("\n"),morphtarget_pars_vertex:["#ifdef USE_MORPHTARGETS","#ifndef USE_MORPHNORMALS","uniform float morphTargetInfluences[ 8 ];","#else","uniform float morphTargetInfluences[ 4 ];","#endif","#endif"].join("\n"),morphtarget_vertex:["#ifdef USE_MORPHTARGETS","vec3 morphed = vec3( 0.0 );","morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];","morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];","morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];","morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];","#ifndef USE_MORPHNORMALS","morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];","morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];","morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];","morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];","#endif","morphed += position;","#endif"].join("\n"),default_vertex:["vec4 mvPosition;","#ifdef USE_SKINNING","mvPosition = modelViewMatrix * skinned;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( morphed, 1.0 );","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;"].join("\n"),morphnormal_vertex:["#ifdef USE_MORPHNORMALS","vec3 morphedNormal = vec3( 0.0 );","morphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];","morphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];","morphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];","morphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];","morphedNormal += normal;","#endif"].join("\n"),skinnormal_vertex:["#ifdef USE_SKINNING","mat4 skinMatrix = skinWeight.x * boneMatX;","skinMatrix \t+= skinWeight.y * boneMatY;","#ifdef USE_MORPHNORMALS","vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );","#else","vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );","#endif","#endif"].join("\n"),defaultnormal_vertex:["vec3 objectNormal;","#ifdef USE_SKINNING","objectNormal = skinnedNormal.xyz;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )","objectNormal = morphedNormal;","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )","objectNormal = normal;","#endif","#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","vec3 transformedNormal = normalMatrix * objectNormal;"].join("\n"),shadowmap_pars_fragment:["#ifdef USE_SHADOWMAP","uniform sampler2D shadowMap[ MAX_SHADOWS ];","uniform vec2 shadowMapSize[ MAX_SHADOWS ];","uniform float shadowDarkness[ MAX_SHADOWS ];","uniform float shadowBias[ MAX_SHADOWS ];","varying vec4 vShadowCoord[ MAX_SHADOWS ];","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","#endif"].join("\n"),shadowmap_fragment:["#ifdef USE_SHADOWMAP","#ifdef SHADOWMAP_DEBUG","vec3 frustumColors[3];","frustumColors[0] = vec3( 1.0, 0.5, 0.0 );","frustumColors[1] = vec3( 0.0, 1.0, 0.8 );","frustumColors[2] = vec3( 0.0, 0.5, 1.0 );","#endif","#ifdef SHADOWMAP_CASCADE","int inFrustumCount = 0;","#endif","float fDepth;","vec3 shadowColor = vec3( 1.0 );","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;","bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );","bool inFrustum = all( inFrustumVec );","#ifdef SHADOWMAP_CASCADE","inFrustumCount += int( inFrustum );","bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );","#else","bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );","#endif","bool frustumTest = all( frustumTestVec );","if ( frustumTest ) {","shadowCoord.z += shadowBias[ i ];","#if defined( SHADOWMAP_TYPE_PCF )","float shadow = 0.0;","const float shadowDelta = 1.0 / 9.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.25 * xPixelOffset;","float dy0 = -1.25 * yPixelOffset;","float dx1 = 1.25 * xPixelOffset;","float dy1 = 1.25 * yPixelOffset;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#elif defined( SHADOWMAP_TYPE_PCF_SOFT )","float shadow = 0.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.0 * xPixelOffset;","float dy0 = -1.0 * yPixelOffset;","float dx1 = 1.0 * xPixelOffset;","float dy1 = 1.0 * yPixelOffset;","mat3 shadowKernel;","mat3 depthKernel;","depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","vec3 shadowZ = vec3( shadowCoord.z );","shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));","shadowKernel[0] *= vec3(0.25);","shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));","shadowKernel[1] *= vec3(0.25);","shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));","shadowKernel[2] *= vec3(0.25);","vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );","shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );","shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );","vec4 shadowValues;","shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );","shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );","shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );","shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );","shadow = dot( shadowValues, vec4( 1.0 ) );","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#else","vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );","float fDepth = unpackDepth( rgbaDepth );","if ( fDepth < shadowCoord.z )","shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );","#endif","}","#ifdef SHADOWMAP_DEBUG","#ifdef SHADOWMAP_CASCADE","if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];","#else","if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];","#endif","#endif","}","#ifdef GAMMA_OUTPUT","shadowColor *= shadowColor;","#endif","gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;","#endif"].join("\n"),shadowmap_pars_vertex:["#ifdef USE_SHADOWMAP","varying vec4 vShadowCoord[ MAX_SHADOWS ];","uniform mat4 shadowMatrix[ MAX_SHADOWS ];","#endif"].join("\n"),shadowmap_vertex:["#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif"].join("\n"),alphatest_fragment:["#ifdef ALPHATEST","if ( gl_FragColor.a < ALPHATEST ) discard;","#endif"].join("\n"),linear_to_gamma_fragment:["#ifdef GAMMA_OUTPUT","gl_FragColor.xyz = sqrt( gl_FragColor.xyz );","#endif"].join("\n")},oe.UniformsUtils={merge:function(e){var u,p,t,r={};for(u=0;u<e.length;u++)for(p in t=this.clone(e[u]))r[p]=t[p];return r},clone:function(e){var u,p,t,r={};for(u in e)for(p in r[u]={},e[u])(t=e[u][p])instanceof oe.Color||t instanceof oe.Vector2||t instanceof oe.Vector3||t instanceof oe.Vector4||t instanceof oe.Matrix4||t instanceof oe.Texture?r[u][p]=t.clone():r[u][p]=t instanceof Array?t.slice():t;return r}},oe.UniformsLib={common:{diffuse:{type:"c",value:new oe.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new oe.Vector4(0,0,1,1)},gainBrightness:{type:"v4",value:new oe.Vector4(0,1,0,1)},lightMap:{type:"t",value:null},emissiveMap:{type:"t",value:null},envMap:{type:"t",value:null},envEncoding:{type:"i",value:0},diffuseEnvMap:{type:"t",value:null},diffuseEnvEncoding:{type:"i",value:0},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},specularmap:{specularMap:{type:"t",value:null},specularOffsetRepeat:{type:"v4",value:new oe.Vector4(0,0,1,1)},specularGainBrightness:{type:"v4",value:new oe.Vector4(0,1,0,1)}},bumpmap:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1},bumpOffsetRepeat:{type:"v4",value:new oe.Vector4(0,0,1,1)}},opacitymap:{opacityMap:{type:"t",value:null},opacityOffsetRepeat:{type:"v4",value:new oe.Vector4(0,0,1,1)},opacityGainBrightness:{type:"v4",value:new oe.Vector4(0,1,0,1)}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new oe.Vector2(1,1)},normalOffsetRepeat:{type:"v4",value:new oe.Vector4(0,0,1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new oe.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},pointLightDecayExponent:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightDecayExponent:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]},areaLightColor:{type:"fv",value:[]},areaLightPosition:{type:"fv",value:[]},areaLightDistance:{type:"fv1",value:[]},areaLightDecayExponent:{type:"fv1",value:[]},areaLightWidth:{type:"fv",value:[]},areaLightHeight:{type:"fv",value:[]}},particle:{psColor:{type:"c",value:new oe.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new oe.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},oe.ShaderLib={physical:{uniforms:oe.UniformsUtils.merge([oe.UniformsLib.common,oe.UniformsLib.bumpmap,oe.UniformsLib.normalmap,oe.UniformsLib.fog,oe.UniformsLib.lights,oe.UniformsLib.shadowmap,oe.UniformsLib.opacitymap,oe.UniformsLib.specularmap,{ambient:{type:"c",value:new oe.Color(16777215)},emissive:{type:"c",value:new oe.Color(0)},specular:{type:"c",value:new oe.Color(16777215)},falloffColor:{type:"c",value:new oe.Color(16777215)},falloffMap:{type:"t",value:null},falloffBlendParams:{type:"v4",value:new oe.Vector4(1,0,0,1)},clearCoat:{type:"f",value:0},clearCoatRoughness:{type:"f",value:.25},roughness:{type:"f",value:.5},roughnessMap:{type:"t",value:null},roughnessOffsetRepeat:{type:"v4",value:new oe.Vector4(0,0,1,1)},roughnessGainBrightness:{type:"v4",value:new oe.Vector4(0,1,0,1)},metallic:{type:"f",value:.5},metallicMap:{type:"t",value:null},metallicOffsetRepeat:{type:"v4",value:new oe.Vector4(0,0,1,1)},metallicGainBrightness:{type:"v4",value:new oe.Vector4(0,1,0,1)},anisotropy:{type:"f",value:0},anisotropyMap:{type:"t",value:null},anisotropyOffsetRepeat:{type:"v4",value:new oe.Vector4(0,0,1,1)},anisotropyGainBrightness:{type:"v4",value:new oe.Vector4(0,1,0,1)},anisotropyRotation:{type:"f",value:0},anisotropyRotationMap:{type:"t",value:null},anisotropyRotationOffsetRepeat:{type:"v4",value:new oe.Vector4(0,0,1,1)},anisotropyRotationGainBrightness:{type:"v4",value:new oe.Vector4(0,1,0,1)},translucency:{type:"c",value:new oe.Color(0)},translucencyMap:{type:"t",value:null},translucencyNormalAlpha:{type:"f",value:.75},translucencyNormalPower:{type:"f",value:2},translucencyViewAlpha:{type:"f",value:.75},translucencyViewPower:{type:"f",value:2}}]),vertexShader:["attribute vec4 tangent;","#define PHONG","#define PHYSICAL","varying vec3 vViewPosition;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;",oe.ShaderChunk.common,oe.ShaderChunk.map_pars_vertex,oe.ShaderChunk.normalmap_pars_vertex,oe.ShaderChunk.roughnessmap_pars_vertex,oe.ShaderChunk.specularmap_pars_vertex,oe.ShaderChunk.opacitymap_pars_vertex,oe.ShaderChunk.anisotropymap_pars_vertex,oe.ShaderChunk.anisotropyrotationmap_pars_vertex,oe.ShaderChunk.metallicmap_pars_vertex,oe.ShaderChunk.translucencymap_pars_vertex,oe.ShaderChunk.bumpmap_pars_vertex,oe.ShaderChunk.lightmap_pars_vertex,oe.ShaderChunk.envmap_pars_vertex,oe.ShaderChunk.lights_physical_pars_vertex,oe.ShaderChunk.color_pars_vertex,oe.ShaderChunk.morphtarget_pars_vertex,oe.ShaderChunk.skinning_pars_vertex,oe.ShaderChunk.shadowmap_pars_vertex,"void main() {",oe.ShaderChunk.map_vertex,oe.ShaderChunk.normalmap_vertex,oe.ShaderChunk.roughnessmap_vertex,oe.ShaderChunk.opacitymap_vertex,oe.ShaderChunk.specularmap_vertex,oe.ShaderChunk.anisotropymap_vertex,oe.ShaderChunk.anisotropyrotationmap_vertex,oe.ShaderChunk.metallicmap_vertex,oe.ShaderChunk.translucencymap_vertex,oe.ShaderChunk.bumpmap_vertex,oe.ShaderChunk.lightmap_vertex,oe.ShaderChunk.color_vertex,oe.ShaderChunk.morphnormal_vertex,oe.ShaderChunk.skinbase_vertex,oe.ShaderChunk.skinnormal_vertex,oe.ShaderChunk.defaultnormal_vertex,"vNormal = normalize( transformedNormal );",oe.ShaderChunk.morphtarget_vertex,oe.ShaderChunk.skinning_vertex,oe.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",oe.ShaderChunk.worldpos_vertex,oe.ShaderChunk.envmap_vertex,oe.ShaderChunk.lights_physical_vertex,oe.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["#ifdef TEXTURE_CUBE_LOD_EXT","#extension GL_EXT_shader_texture_lod : enable","#endif","#define PHYSICAL","uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 falloffColor;","uniform vec4 falloffBlendParams;","uniform vec3 specular;","uniform float roughness;","uniform float metallic;","uniform float clearCoat;","uniform float clearCoatRoughness;","uniform vec3 translucency;","uniform float translucencyNormalAlpha;","uniform float translucencyNormalPower;","uniform float translucencyViewPower;","uniform float translucencyViewAlpha;","uniform float anisotropy;","uniform float anisotropyRotation;",oe.ShaderChunk.common,oe.ShaderChunk.color_pars_fragment,oe.ShaderChunk.map_pars_fragment,oe.ShaderChunk.falloffmap_pars_fragment,oe.ShaderChunk.opacitymap_pars_fragment,oe.ShaderChunk.translucencymap_pars_fragment,oe.ShaderChunk.lightmap_pars_fragment,oe.ShaderChunk.envmap_pars_fragment,oe.ShaderChunk.diffuseenvmap_pars_fragment,oe.ShaderChunk.fog_pars_fragment,oe.ShaderChunk.lights_physical_pars_fragment,oe.ShaderChunk.shadowmap_pars_fragment,oe.ShaderChunk.bumpmap_pars_fragment,oe.ShaderChunk.normalmap_pars_fragment,oe.ShaderChunk.specularmap_pars_fragment,oe.ShaderChunk.anisotropymap_pars_fragment,oe.ShaderChunk.anisotropyrotationmap_pars_fragment,oe.ShaderChunk.metallicmap_pars_fragment,oe.ShaderChunk.roughnessmap_pars_fragment,oe.ShaderChunk.reflectivitymap_pars_fragment,oe.ShaderChunk.lightattenuation_func_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 0.0 ), opacity );","vec3 diffuseColor = diffuse;","vec3 translucencyColor = translucency;","vec3 normal = normalize( vNormal );","vec3 viewPosition = normalize( vViewPosition );",oe.ShaderChunk.map_fragment,oe.ShaderChunk.opacitymap_fragment,oe.ShaderChunk.alphatest_fragment,oe.ShaderChunk.specularmap_fragment,oe.ShaderChunk.anisotropymap_fragment,oe.ShaderChunk.anisotropyrotationmap_fragment,oe.ShaderChunk.roughnessmap_fragment,oe.ShaderChunk.metallicmap_fragment,oe.ShaderChunk.translucencymap_fragment,oe.ShaderChunk.reflectivitymap_fragment,oe.ShaderChunk.lights_physical_fragment,oe.ShaderChunk.lightmap_fragment,oe.ShaderChunk.color_fragment,oe.ShaderChunk.envmap_fragment,oe.ShaderChunk.shadowmap_fragment,oe.ShaderChunk.linear_to_gamma_fragment,oe.ShaderChunk.fog_fragment,"gl_FragColor.xyz *= gl_FragColor.w;","}"].join("\n")},basic:{uniforms:oe.UniformsUtils.merge([oe.UniformsLib.common,oe.UniformsLib.fog,oe.UniformsLib.shadowmap]),vertexShader:[oe.ShaderChunk.common,oe.ShaderChunk.map_pars_vertex,oe.ShaderChunk.lightmap_pars_vertex,oe.ShaderChunk.envmap_pars_vertex,oe.ShaderChunk.color_pars_vertex,oe.ShaderChunk.morphtarget_pars_vertex,oe.ShaderChunk.skinning_pars_vertex,oe.ShaderChunk.shadowmap_pars_vertex,"void main() {",oe.ShaderChunk.map_vertex,oe.ShaderChunk.lightmap_vertex,oe.ShaderChunk.color_vertex,oe.ShaderChunk.skinbase_vertex,"#ifdef USE_ENVMAP",oe.ShaderChunk.morphnormal_vertex,oe.ShaderChunk.skinnormal_vertex,oe.ShaderChunk.defaultnormal_vertex,"#endif",oe.ShaderChunk.morphtarget_vertex,oe.ShaderChunk.skinning_vertex,oe.ShaderChunk.default_vertex,oe.ShaderChunk.worldpos_vertex,oe.ShaderChunk.envmap_vertex,oe.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",oe.ShaderChunk.common,oe.ShaderChunk.color_pars_fragment,oe.ShaderChunk.map_pars_fragment,oe.ShaderChunk.lightmap_pars_fragment,oe.ShaderChunk.envmap_pars_fragment,oe.ShaderChunk.fog_pars_fragment,oe.ShaderChunk.shadowmap_pars_fragment,oe.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( diffuse, opacity );",oe.ShaderChunk.map_fragment,oe.ShaderChunk.alphatest_fragment,oe.ShaderChunk.specularmap_fragment,oe.ShaderChunk.lightmap_fragment,oe.ShaderChunk.color_fragment,oe.ShaderChunk.envmap_fragment,oe.ShaderChunk.shadowmap_fragment,oe.ShaderChunk.linear_to_gamma_fragment,oe.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:oe.UniformsUtils.merge([oe.UniformsLib.common,oe.UniformsLib.fog,oe.UniformsLib.lights,oe.UniformsLib.shadowmap,{ambient:{type:"c",value:new oe.Color(16777215)},emissive:{type:"c",value:new oe.Color(0)},wrapRGB:{type:"v3",value:new oe.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",oe.ShaderChunk.common,oe.ShaderChunk.map_pars_vertex,oe.ShaderChunk.lightmap_pars_vertex,oe.ShaderChunk.envmap_pars_vertex,oe.ShaderChunk.lights_lambert_pars_vertex,oe.ShaderChunk.color_pars_vertex,oe.ShaderChunk.morphtarget_pars_vertex,oe.ShaderChunk.skinning_pars_vertex,oe.ShaderChunk.shadowmap_pars_vertex,oe.ShaderChunk.lightattenuation_func_fragment,"void main() {",oe.ShaderChunk.map_vertex,oe.ShaderChunk.lightmap_vertex,oe.ShaderChunk.color_vertex,oe.ShaderChunk.morphnormal_vertex,oe.ShaderChunk.skinbase_vertex,oe.ShaderChunk.skinnormal_vertex,oe.ShaderChunk.defaultnormal_vertex,oe.ShaderChunk.morphtarget_vertex,oe.ShaderChunk.skinning_vertex,oe.ShaderChunk.default_vertex,oe.ShaderChunk.worldpos_vertex,oe.ShaderChunk.envmap_vertex,oe.ShaderChunk.lights_lambert_vertex,oe.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",oe.ShaderChunk.common,oe.ShaderChunk.color_pars_fragment,oe.ShaderChunk.map_pars_fragment,oe.ShaderChunk.lightmap_pars_fragment,oe.ShaderChunk.envmap_pars_fragment,oe.ShaderChunk.fog_pars_fragment,oe.ShaderChunk.shadowmap_pars_fragment,oe.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",oe.ShaderChunk.map_fragment,oe.ShaderChunk.alphatest_fragment,oe.ShaderChunk.specularmap_fragment,"#ifdef DOUBLE_SIDED","if ( gl_FrontFacing )","gl_FragColor.xyz *= vLightFront;","else","gl_FragColor.xyz *= vLightBack;","#else","gl_FragColor.xyz *= vLightFront;","#endif",oe.ShaderChunk.lightmap_fragment,oe.ShaderChunk.color_fragment,oe.ShaderChunk.envmap_fragment,oe.ShaderChunk.shadowmap_fragment,oe.ShaderChunk.linear_to_gamma_fragment,oe.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:oe.UniformsUtils.merge([oe.UniformsLib.common,oe.UniformsLib.bumpmap,oe.UniformsLib.normalmap,oe.UniformsLib.specularmap,oe.UniformsLib.fog,oe.UniformsLib.lights,oe.UniformsLib.shadowmap,oe.UniformsLib.opacitymap,{ambient:{type:"c",value:new oe.Color(16777215)},emissive:{type:"c",value:new oe.Color(0)},specular:{type:"c",value:new oe.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new oe.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;",oe.ShaderChunk.common,oe.ShaderChunk.map_pars_vertex,oe.ShaderChunk.normalmap_pars_vertex,oe.ShaderChunk.bumpmap_pars_vertex,oe.ShaderChunk.specularmap_pars_vertex,oe.ShaderChunk.opacitymap_pars_vertex,oe.ShaderChunk.lightmap_pars_vertex,oe.ShaderChunk.envmap_pars_vertex,oe.ShaderChunk.lights_phong_pars_vertex,oe.ShaderChunk.color_pars_vertex,oe.ShaderChunk.morphtarget_pars_vertex,oe.ShaderChunk.skinning_pars_vertex,oe.ShaderChunk.shadowmap_pars_vertex,"void main() {",oe.ShaderChunk.map_vertex,oe.ShaderChunk.normalmap_vertex,oe.ShaderChunk.bumpmap_vertex,oe.ShaderChunk.opacitymap_vertex,oe.ShaderChunk.specularmap_vertex,oe.ShaderChunk.lightmap_vertex,oe.ShaderChunk.color_vertex,oe.ShaderChunk.morphnormal_vertex,oe.ShaderChunk.skinbase_vertex,oe.ShaderChunk.skinnormal_vertex,oe.ShaderChunk.defaultnormal_vertex,"vNormal = normalize( transformedNormal );",oe.ShaderChunk.morphtarget_vertex,oe.ShaderChunk.skinning_vertex,oe.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",oe.ShaderChunk.worldpos_vertex,oe.ShaderChunk.envmap_vertex,oe.ShaderChunk.lights_phong_vertex,oe.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;",oe.ShaderChunk.common,oe.ShaderChunk.color_pars_fragment,oe.ShaderChunk.map_pars_fragment,oe.ShaderChunk.opacitymap_pars_fragment,oe.ShaderChunk.lightmap_pars_fragment,oe.ShaderChunk.envmap_pars_fragment,oe.ShaderChunk.fog_pars_fragment,oe.ShaderChunk.lights_phong_pars_fragment,oe.ShaderChunk.shadowmap_pars_fragment,oe.ShaderChunk.bumpmap_pars_fragment,oe.ShaderChunk.normalmap_pars_fragment,oe.ShaderChunk.specularmap_pars_fragment,oe.ShaderChunk.lightattenuation_func_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );","vec3 diffuseColor = diffuse;",oe.ShaderChunk.map_fragment,oe.ShaderChunk.opacitymap_fragment,oe.ShaderChunk.alphatest_fragment,oe.ShaderChunk.specularmap_fragment,oe.ShaderChunk.lights_phong_fragment,oe.ShaderChunk.lightmap_fragment,oe.ShaderChunk.color_fragment,oe.ShaderChunk.envmap_fragment,oe.ShaderChunk.shadowmap_fragment,oe.ShaderChunk.linear_to_gamma_fragment,oe.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:oe.UniformsUtils.merge([oe.UniformsLib.particle,oe.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",oe.ShaderChunk.common,oe.ShaderChunk.color_pars_vertex,oe.ShaderChunk.shadowmap_pars_vertex,"void main() {",oe.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#ifdef USE_SIZEATTENUATION","gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","#else","gl_PointSize = size;","#endif","gl_Position = projectionMatrix * mvPosition;",oe.ShaderChunk.worldpos_vertex,oe.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",oe.ShaderChunk.common,oe.ShaderChunk.color_pars_fragment,oe.ShaderChunk.map_particle_pars_fragment,oe.ShaderChunk.fog_pars_fragment,oe.ShaderChunk.shadowmap_pars_fragment,"void main() {","gl_FragColor = vec4( psColor, opacity );",oe.ShaderChunk.map_particle_fragment,oe.ShaderChunk.alphatest_fragment,oe.ShaderChunk.color_fragment,oe.ShaderChunk.shadowmap_fragment,oe.ShaderChunk.fog_fragment,"}"].join("\n")},dashed:{uniforms:oe.UniformsUtils.merge([oe.UniformsLib.common,oe.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",oe.ShaderChunk.common,oe.ShaderChunk.color_pars_vertex,"void main() {",oe.ShaderChunk.color_vertex,"vLineDistance = scale * lineDistance;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",oe.ShaderChunk.common,oe.ShaderChunk.color_pars_fragment,oe.ShaderChunk.fog_pars_fragment,"void main() {","if ( mod( vLineDistance, totalSize ) > dashSize ) {","discard;","}","gl_FragColor = vec4( diffuse, opacity );",oe.ShaderChunk.color_fragment,oe.ShaderChunk.fog_fragment,"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;","void main() {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float color = clamp( ( depth - mNear ) / ( mFar - mNear ), 0.0, 1.0 );","gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",oe.ShaderChunk.common,oe.ShaderChunk.morphtarget_pars_vertex,"void main() {","vNormal = normalize( normalMatrix * normal );",oe.ShaderChunk.morphtarget_vertex,oe.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;","void main() {","gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );","}"].join("\n")},normalmap:{uniforms:oe.UniformsUtils.merge([oe.UniformsLib.fog,oe.UniformsLib.lights,oe.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new oe.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},diffuse:{type:"c",value:new oe.Color(16777215)},specular:{type:"c",value:new oe.Color(1118481)},ambient:{type:"c",value:new oe.Color(16777215)},shininess:{type:"f",value:30},opacity:{type:"f",value:1},useRefract:{type:"i",value:0},refractionRatio:{type:"f",value:.98},reflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new oe.Vector2(0,0)},uRepeat:{type:"v2",value:new oe.Vector2(1,1)},wrapRGB:{type:"v3",value:new oe.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float refractionRatio;","uniform float reflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",oe.ShaderChunk.common,oe.ShaderChunk.shadowmap_pars_fragment,oe.ShaderChunk.fog_pars_fragment,"void main() {","gl_FragColor = vec4( vec3( 1.0 ), opacity );","vec3 specularTex = vec3( 1.0 );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse ) {","#ifdef GAMMA_INPUT","vec4 texelColor = texture2D( tDiffuse, vUv );","texelColor.xyz *= texelColor.xyz;","gl_FragColor = gl_FragColor * texelColor;","#else","gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","#endif","}","if( enableAO ) {","#ifdef GAMMA_INPUT","vec4 aoColor = texture2D( tAO, vUv );","aoColor.xyz *= aoColor.xyz;","gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","#else","gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","#endif","}","if( enableSpecular )","specularTex = texture2D( tSpecular, vUv ).xyz;","mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","vec3 finalNormal = tsb * normalTex;","#ifdef FLIP_SIDED","finalNormal = -finalNormal;","#endif","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 pointVector = lPosition.xyz + vViewPosition.xyz;","float pointDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","pointVector = normalize( pointVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","#endif","pointDiffuse += pointDistance * pointLightColor[ i ] * diffuse * pointDiffuseWeight;","vec3 pointHalfVector = normalize( pointVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, shininess ), 0.0 );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 spotVector = lPosition.xyz + vViewPosition.xyz;","float spotDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","spotVector = normalize( spotVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","#endif","spotDiffuse += spotDistance * spotLightColor[ i ] * diffuse * spotDiffuseWeight * spotEffect;","vec3 spotHalfVector = normalize( spotVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, shininess ), 0.0 );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","#ifdef WRAP_AROUND","float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","#endif","dirDiffuse += directionalLightColor[ i ] * diffuse * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, shininess ), 0.0 );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += diffuse * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient ) + totalSpecular;","#endif","if ( enableReflection ) {","vec3 vReflect;","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, normal, refractionRatio );","} else {","vReflect = reflect( cameraToVertex, normal );","}","vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * reflectivity );","}",oe.ShaderChunk.shadowmap_fragment,oe.ShaderChunk.linear_to_gamma_fragment,oe.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",oe.ShaderChunk.common,oe.ShaderChunk.skinning_pars_vertex,oe.ShaderChunk.shadowmap_pars_vertex,"void main() {",oe.ShaderChunk.skinbase_vertex,oe.ShaderChunk.skinnormal_vertex,"#ifdef USE_SKINNING","vNormal = normalize( normalMatrix * skinnedNormal.xyz );","vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","vTangent = normalize( normalMatrix * skinnedTangent.xyz );","#else","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","#endif","vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","vUv = uv * uRepeat + uOffset;","vec3 displacedPosition;","#ifdef VERTEX_TEXTURES","if ( enableDisplacement ) {","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","displacedPosition = position + normalize( normal ) * df;","} else {","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned \t  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","}","#else","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned \t  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","#endif","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vWorldPosition = worldPosition.xyz;","vViewPosition = -mvPosition.xyz;","#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif","}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1},tEncoding:{type:"i",value:0},blurring:{type:"f",value:0}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#ifdef TEXTURE_CUBE_LOD_EXT","#extension GL_EXT_shader_texture_lod : enable","#endif",oe.ShaderChunk.common,"uniform samplerCube tCube;","uniform float tFlip;","uniform int tEncoding;","uniform float blurring;","varying vec3 vWorldPosition;","void main() {","vec3 queryVector = vec3( tFlip * vWorldPosition.x, vWorldPosition.yz );","#if defined( TEXTURE_CUBE_LOD_EXT )","vec4 color = textureCubeLodEXT( tCube, queryVector, blurring );","#else","vec4 color = textureCube( tCube, queryVector );","#endif","color = texelDecode( color, tEncoding );","#ifdef GAMMA_OUTPUT","color.xyz = sqrt( color.xyz );","#endif","gl_FragColor = color;","}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[oe.ShaderChunk.common,oe.ShaderChunk.morphtarget_pars_vertex,oe.ShaderChunk.skinning_pars_vertex,"void main() {",oe.ShaderChunk.skinbase_vertex,oe.ShaderChunk.morphtarget_vertex,oe.ShaderChunk.skinning_vertex,oe.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:["vec4 pack_depth( const in float depth ) {","\t\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","\tconst vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","\tvec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );","\tres -= res.xxyz * bit_mask;","\treturn res;","}","void main() {","gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","}"].join("\n")}},oe.WebGLRenderer=function(e){console.log("THREE.WebGLRenderer",oe.REVISION);var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElement("canvas"),r=void 0!==e.context?e.context:null,o=void 0!==e.precision?e.precision:"mediump",n=void 0!==e.alpha&&e.alpha,l=void 0===e.premultipliedAlpha||e.premultipliedAlpha,h=void 0!==e.antialias&&e.antialias,c=void 0===e.stencil||e.stencil,f=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,d=new oe.Color(0),m=0;this.domElement=t,this.context=null,this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==ae.devicePixelRatio?ae.devicePixelRatio:1,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.autoUpdateObjects=!0,this.gammaInput=!0,this.gammaOutput=!0,this.shadowMapEnabled=!1,this.shadowMapAutoUpdate=!0,this.shadowMapType=oe.PCFShadowMap,this.shadowMapCullFace=oe.CullFaceFront,this.shadowMapDebug=!1,this.shadowMapCascade=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var v,y,x,_,M,w,S=this,A=[],T=0,C=null,E=null,L=-1,P=null,R=null,D=0,U=-1,F=-1,V=-1,N=-1,O=-1,z=-1,I=-1,B=-1,k=null,G=null,H=null,j=null,W=0,X=0,Y=t.width,K=t.height,$=0,Q=0,Z=new Uint8Array(16),J=new oe.Frustum,ee=new oe.Matrix4,te=new oe.Matrix4,re=new oe.Vector3,ie=new oe.Vector3,ne=new oe.Vector3,se=new oe.Vector3,le=!0,he={ambient:[0,0,0],directional:{length:0,colors:new Array,positions:new Array},point:{length:0,colors:new Array,positions:new Array,distances:new Array,decayExponents:new Array},spot:{length:0,colors:new Array,positions:new Array,distances:new Array,decayExponents:new Array,directions:new Array,anglesCos:new Array,exponents:new Array},hemi:{length:0,skyColors:new Array,groundColors:new Array,positions:new Array},area:{length:0,colors:new Array,positions:new Array,distances:new Array,decayExponents:new Array,widths:new Array,heights:new Array}};!function(){try{var e={alpha:n,premultipliedAlpha:l,antialias:h,stencil:c,preserveDrawingBuffer:f};null===(v=r||t.getContext("webgl",e)||t.getContext("experimental-webgl",e))&&oe.onerror("Error creating WebGL context.")}catch(e){oe.onerror(e)}y=v.getExtension("OES_texture_float"),v.getExtension("OES_texture_float_linear"),x=v.getExtension("OES_standard_derivatives"),_=v.getExtension("EXT_shader_texture_lod"),M=v.getExtension("EXT_texture_filter_anisotropic")||v.getExtension("MOZ_EXT_texture_filter_anisotropic")||v.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),w=v.getExtension("WEBGL_compressed_texture_s3tc")||v.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||v.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),y||console.log("THREE.WebGLRenderer: Float textures not supported.");x||console.log("THREE.WebGLRenderer: Standard derivatives not supported.");_||console.log("THREE.WebGLRenderer: Shader texture LOD not supported.");M||console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported.");w||console.log("THREE.WebGLRenderer: S3TC compressed textures not supported.");void 0===v.getShaderPrecisionFormat&&(v.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}(),v.clearColor(0,0,0,1),v.clearDepth(1),v.clearStencil(0),v.enable(v.DEPTH_TEST),v.depthFunc(v.LEQUAL),v.frontFace(v.CCW),v.cullFace(v.BACK),v.enable(v.CULL_FACE),v.enable(v.BLEND),v.blendEquation(v.FUNC_ADD),v.blendFunc(v.SRC_ALPHA,v.ONE_MINUS_SRC_ALPHA),v.viewport(W,X,Y,K),v.clearColor(d.r,d.g,d.b,m),this.context=v;var ce=v.getParameter(v.MAX_TEXTURE_IMAGE_UNITS),ue=v.getParameter(v.MAX_VERTEX_TEXTURE_IMAGE_UNITS),fe=(v.getParameter(v.MAX_TEXTURE_SIZE),v.getParameter(v.MAX_CUBE_MAP_TEXTURE_SIZE)),pe=M?v.getParameter(M.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,de=ue>0,me=de&&y,ge=(w&&v.getParameter(v.COMPRESSED_TEXTURE_FORMATS),v.getShaderPrecisionFormat(v.VERTEX_SHADER,v.HIGH_FLOAT)),ve=v.getShaderPrecisionFormat(v.VERTEX_SHADER,v.MEDIUM_FLOAT),ye=(v.getShaderPrecisionFormat(v.VERTEX_SHADER,v.LOW_FLOAT),v.getShaderPrecisionFormat(v.FRAGMENT_SHADER,v.HIGH_FLOAT)),xe=v.getShaderPrecisionFormat(v.FRAGMENT_SHADER,v.MEDIUM_FLOAT),_e=(v.getShaderPrecisionFormat(v.FRAGMENT_SHADER,v.LOW_FLOAT),v.getShaderPrecisionFormat(v.VERTEX_SHADER,v.HIGH_INT),v.getShaderPrecisionFormat(v.VERTEX_SHADER,v.MEDIUM_INT),v.getShaderPrecisionFormat(v.VERTEX_SHADER,v.LOW_INT),v.getShaderPrecisionFormat(v.FRAGMENT_SHADER,v.HIGH_INT),v.getShaderPrecisionFormat(v.FRAGMENT_SHADER,v.MEDIUM_INT),v.getShaderPrecisionFormat(v.FRAGMENT_SHADER,v.LOW_INT),ge.precision>0&&ye.precision>0),Me=ve.precision>0&&xe.precision>0;function be(e){var t,r;if(e.__webglVertexBuffer=v.createBuffer(),e.__webglNormalBuffer=v.createBuffer(),e.__webglTangentBuffer=v.createBuffer(),e.__webglColorBuffer=v.createBuffer(),e.__webglUVBuffer=v.createBuffer(),e.__webglUV2Buffer=v.createBuffer(),e.__webglSkinIndicesBuffer=v.createBuffer(),e.__webglSkinWeightsBuffer=v.createBuffer(),e.__webglFaceBuffer=v.createBuffer(),e.__webglLineBuffer=v.createBuffer(),e.numMorphTargets)for(e.__webglMorphTargetsBuffers=[],t=0,r=e.numMorphTargets;t<r;t++)e.__webglMorphTargetsBuffers.push(v.createBuffer());if(e.numMorphNormals)for(e.__webglMorphNormalsBuffers=[],t=0,r=e.numMorphNormals;t<r;t++)e.__webglMorphNormalsBuffers.push(v.createBuffer());S.info.memory.geometries++}"highp"!==o||_e||(Me?(o="mediump",oe.onwarning("WebGLRenderer: highp not supported, using mediump")):(o="lowp",oe.onwarning("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"!==o||Me||(o="lowp",oe.onwarning("WebGLRenderer: mediump not supported, using lowp")),this.getContext=function(){return v},this.supportsVertexTextures=function(){return de},this.supportsFloatTextures=function(){return y},this.supportsStandardDerivatives=function(){return x},this.supportsCompressedTextureS3TC=function(){return w},this.getMaxAnisotropy=function(){return pe},this.getPrecision=function(){return o},this.setSize=function(e,r,o){t.width=e*this.devicePixelRatio,t.height=r*this.devicePixelRatio,1!==this.devicePixelRatio&&!1!==o&&(t.style.width=e+"px",t.style.height=r+"px"),this.setViewport(0,0,e,r)},this.setViewport=function(e,t,r,o){W=e*this.devicePixelRatio,X=t*this.devicePixelRatio,Y=r*this.devicePixelRatio,K=o*this.devicePixelRatio,v.viewport(W,X,Y,K)},this.setScissor=function(e,t,r,o){v.scissor(e*this.devicePixelRatio,t*this.devicePixelRatio,r*this.devicePixelRatio,o*this.devicePixelRatio)},this.enableScissorTest=function(e){e?v.enable(v.SCISSOR_TEST):v.disable(v.SCISSOR_TEST)},this.setClearColor=function(e,t){d.set(e),m=void 0!==t?t:1,v.clearColor(d.r,d.g,d.b,m)},this.setClearColorHex=function(e,t){oe.onwarning("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return d},this.getClearAlpha=function(){return m},this.clear=function(e,t,r){var o=0;(void 0===e||e)&&(o|=v.COLOR_BUFFER_BIT),(void 0===t||t)&&(o|=v.DEPTH_BUFFER_BIT),(void 0===r||r)&&(o|=v.STENCIL_BUFFER_BIT),v.clear(o)},this.clearColor=function(){v.clear(v.COLOR_BUFFER_BIT)},this.clearDepth=function(){v.clear(v.DEPTH_BUFFER_BIT)},this.clearStencil=function(){v.clear(v.STENCIL_BUFFER_BIT)},this.clearTarget=function(e,t,r,o){this.setRenderTarget(e),this.clear(t,r,o)},this.addPostPlugin=function(e){e.init(this),this.renderPluginsPost.push(e)},this.addPrePlugin=function(e){e.init(this),this.renderPluginsPre.push(e)},this.updateShadowMap=function(e,t){C=null,V=-1,I=-1,B=-1,P=-1,L=-1,le=!0,U=-1,F=-1,this.shadowMapPlugin.update(e,t)};var we=function(e){var t=e.target;t.removeEventListener("dispose",we),Ee(t)},Se=function(e){var t=e.target;t.removeEventListener("dispose",Se),Le(t),S.info.memory.textures--},Ae=function(e){var t=e.target;t.removeEventListener("dispose",Ae),Pe(t),S.info.memory.textures--},Te=function(e){var t=e.target;t.removeEventListener("dispose",Te),Re(t)},Ce=function(e){if(void 0!==e.__webglVertexBuffer&&v.deleteBuffer(e.__webglVertexBuffer),void 0!==e.__webglNormalBuffer&&v.deleteBuffer(e.__webglNormalBuffer),void 0!==e.__webglTangentBuffer&&v.deleteBuffer(e.__webglTangentBuffer),void 0!==e.__webglColorBuffer&&v.deleteBuffer(e.__webglColorBuffer),void 0!==e.__webglUVBuffer&&v.deleteBuffer(e.__webglUVBuffer),void 0!==e.__webglUV2Buffer&&v.deleteBuffer(e.__webglUV2Buffer),void 0!==e.__webglSkinIndicesBuffer&&v.deleteBuffer(e.__webglSkinIndicesBuffer),void 0!==e.__webglSkinWeightsBuffer&&v.deleteBuffer(e.__webglSkinWeightsBuffer),void 0!==e.__webglFaceBuffer&&v.deleteBuffer(e.__webglFaceBuffer),void 0!==e.__webglLineBuffer&&v.deleteBuffer(e.__webglLineBuffer),void 0!==e.__webglLineDistanceBuffer&&v.deleteBuffer(e.__webglLineDistanceBuffer),void 0!==e.__webglCustomAttributesList)for(var t in e.__webglCustomAttributesList)v.deleteBuffer(e.__webglCustomAttributesList[t].buffer);S.info.memory.geometries--},Ee=function(e){if(e.__webglInit=void 0,e instanceof oe.BufferGeometry){var t=e.attributes;for(var r in t)void 0!==t[r].buffer&&v.deleteBuffer(t[r].buffer);S.info.memory.geometries--}else if(void 0!==e.geometryGroups)for(var g in e.geometryGroups){var o=e.geometryGroups[g];if(void 0!==o.numMorphTargets)for(var n=0,l=o.numMorphTargets;n<l;n++)v.deleteBuffer(o.__webglMorphTargetsBuffers[n]);if(void 0!==o.numMorphNormals)for(n=0,l=o.numMorphNormals;n<l;n++)v.deleteBuffer(o.__webglMorphNormalsBuffers[n]);Ce(o)}else Ce(e)},Le=function(e){if(e.image&&e.image.__webglTextureCube)v.deleteTexture(e.image.__webglTextureCube);else{if(!e.__webglInit)return;e.__webglInit=!1,v.deleteTexture(e.__webglTexture)}},Pe=function(e){if(e&&e.__webglTexture)if(v.deleteTexture(e.__webglTexture),e instanceof oe.WebGLRenderTargetCube)for(var i=0;i<6;i++)v.deleteFramebuffer(e.__webglFramebuffer[i]),v.deleteRenderbuffer(e.__webglRenderbuffer[i]);else v.deleteFramebuffer(e.__webglFramebuffer),v.deleteRenderbuffer(e.__webglRenderbuffer)},Re=function(e,t){var r=t||e.program;if(void 0!==r){var i,o,n;t||(e.program=void 0);var l=!1;for(i=0,o=A.length;i<o;i++)if((n=A[i]).program===r){n.usedTimes--,0===n.usedTimes&&(l=!0);break}if(!0===l){var h=[];for(i=0,o=A.length;i<o;i++)(n=A[i]).program!==r&&h.push(n);A=h,v.deleteProgram(r),S.info.memory.programs--}}};function De(e,object){var t=e.vertices.length,r=object.material;if(r.attributes)for(var a in void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]),r.attributes){var o=r.attributes[a];if(!o.__webglInitialized||o.createUniqueBuffers){o.__webglInitialized=!0;var n=1;"v2"===o.type?n=2:"v3"===o.type?n=3:"v4"===o.type?n=4:"c"===o.type&&(n=3),o.size=n,o.array=new Float32Array(t*n),o.buffer=v.createBuffer(),o.buffer.belongsToAttribute=a,o.needsUpdate=!0}e.__webglCustomAttributesList.push(o)}}function Ue(e,object){var t,r,o=object.geometry,n=e.faces3,l=3*n.length,h=1*n.length,c=3*n.length,f=Fe(object,e),d=Oe(f),m=Ve(f),y=Ne(f);if(e.__vertexArray=new Float32Array(3*l),m&&(e.__normalArray=new Float32Array(3*l)),o.hasTangents&&(e.__tangentArray=new Float32Array(4*l)),y&&(e.__colorArray=new Float32Array(3*l)),d&&(o.faceVertexUvs.length>0&&(e.__uvArray=new Float32Array(2*l)),o.faceVertexUvs.length>1&&(e.__uv2Array=new Float32Array(2*l))),object.geometry.skinWeights.length&&object.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(4*l),e.__skinWeightArray=new Float32Array(4*l)),e.__faceArray=new Uint16Array(3*h),e.__lineArray=new Uint16Array(2*c),e.numMorphTargets)for(e.__morphTargetsArrays=[],t=0,r=e.numMorphTargets;t<r;t++)e.__morphTargetsArrays.push(new Float32Array(3*l));if(e.numMorphNormals)for(e.__morphNormalsArrays=[],t=0,r=e.numMorphNormals;t<r;t++)e.__morphNormalsArrays.push(new Float32Array(3*l));if(e.__webglFaceCount=3*h,e.__webglLineCount=2*c,f.attributes)for(var a in void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]),f.attributes){var x=f.attributes[a],_={};for(var M in x)_[M]=x[M];if(!_.__webglInitialized||_.createUniqueBuffers){_.__webglInitialized=!0;var w=1;"v2"===_.type?w=2:"v3"===_.type?w=3:"v4"===_.type?w=4:"c"===_.type&&(w=3),_.size=w,_.array=new Float32Array(l*w),_.buffer=v.createBuffer(),_.buffer.belongsToAttribute=a,x.needsUpdate=!0,_.__original=x}e.__webglCustomAttributesList.push(_)}e.__inittedArrays=!0}function Fe(object,e){return object.material instanceof oe.MeshFaceMaterial?object.material.materials[e.materialIndex]:object.material}function Ve(e){return!(e instanceof oe.MeshBasicMaterial&&!e.envMap||e instanceof oe.MeshDepthMaterial)&&(function(e){return e&&void 0!==e.shading&&e.shading===oe.SmoothShading}(e)?oe.SmoothShading:oe.FlatShading)}function Ne(e){return!!e.vertexColors&&e.vertexColors}function Oe(e){return!!(e.map||e.opacityMap||e.lightMap||e.emissiveMap||e.bumpMap||e.normalMap||e.specularMap||e.reflectivityMap||e.roughnessMap||e.falloffMap||e.anisotropyMap||e.anisotropyRotationMap||e.metallicMap||e.translucencyMap||e.anisotropy&&0!==e.anisotropy||e instanceof oe.ShaderMaterial)}function ze(e,object,t,r,o){if(e.__inittedArrays){var n,l,h,c,f,d,m,y,x,_,M,w,S,A,T,C,E,L,P,R,D,U,F,V,N,O,z,I,i,B,k,G,H,j,W,X,Y,K,$,Q,Z,J=Ve(o),ee=Ne(o),te=Oe(o),re=J===oe.SmoothShading,ie=0,ae=0,ne=0,se=0,le=0,he=0,ce=0,ue=0,fe=0,pe=0,de=0,me=0,ge=e.__vertexArray,ve=e.__uvArray,ye=e.__uv2Array,xe=e.__normalArray,_e=e.__tangentArray,Me=e.__colorArray,be=e.__skinIndexArray,we=e.__skinWeightArray,Se=e.__morphTargetsArrays,Ae=e.__morphNormalsArrays,Te=e.__webglCustomAttributesList,Ce=e.__faceArray,Ee=e.__lineArray,Le=object.geometry,Pe=Le.verticesNeedUpdate,Re=Le.elementsNeedUpdate,De=Le.uvsNeedUpdate,Ue=Le.normalsNeedUpdate,Fe=Le.tangentsNeedUpdate,ze=Le.colorsNeedUpdate,Ie=Le.morphTargetsNeedUpdate,Be=Le.vertices,ke=e.faces3,Ge=Le.faces,He=Le.faceVertexUvs[0],je=Le.faceVertexUvs[1],We=(Le.colors,Le.skinIndices),Xe=Le.skinWeights,Ye=Le.morphTargets,qe=Le.morphNormals;if(Pe){for(n=0,l=ke.length;n<l;n++)M=Be[(h=Ge[ke[n]]).a],w=Be[h.b],S=Be[h.c],ge[ae]=M.x,ge[ae+1]=M.y,ge[ae+2]=M.z,ge[ae+3]=w.x,ge[ae+4]=w.y,ge[ae+5]=w.z,ge[ae+6]=S.x,ge[ae+7]=S.y,ge[ae+8]=S.z,ae+=9;v.bindBuffer(v.ARRAY_BUFFER,e.__webglVertexBuffer),v.bufferData(v.ARRAY_BUFFER,ge,t)}if(Ie)for(j=0,W=Ye.length;j<W;j++){for(de=0,n=0,l=ke.length;n<l;n++)h=Ge[K=ke[n]],M=Ye[j].vertices[h.a],w=Ye[j].vertices[h.b],S=Ye[j].vertices[h.c],(X=Se[j])[de]=M.x,X[de+1]=M.y,X[de+2]=M.z,X[de+3]=w.x,X[de+4]=w.y,X[de+5]=w.z,X[de+6]=S.x,X[de+7]=S.y,X[de+8]=S.z,o.morphNormals&&(re?(E=($=qe[j].vertexNormals[K]).a,L=$.b,P=$.c):(L=E=qe[j].faceNormals[K],P=E),(Y=Ae[j])[de]=E.x,Y[de+1]=E.y,Y[de+2]=E.z,Y[de+3]=L.x,Y[de+4]=L.y,Y[de+5]=L.z,Y[de+6]=P.x,Y[de+7]=P.y,Y[de+8]=P.z),de+=9;v.bindBuffer(v.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[j]),v.bufferData(v.ARRAY_BUFFER,Se[j],t),o.morphNormals&&(v.bindBuffer(v.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[j]),v.bufferData(v.ARRAY_BUFFER,Ae[j],t))}if(Xe.length){for(n=0,l=ke.length;n<l;n++)F=Xe[(h=Ge[ke[n]]).a],V=Xe[h.b],N=Xe[h.c],we[pe]=F.x,we[pe+1]=F.y,we[pe+2]=F.z,we[pe+3]=F.w,we[pe+4]=V.x,we[pe+5]=V.y,we[pe+6]=V.z,we[pe+7]=V.w,we[pe+8]=N.x,we[pe+9]=N.y,we[pe+10]=N.z,we[pe+11]=N.w,O=We[h.a],z=We[h.b],I=We[h.c],be[pe]=O.x,be[pe+1]=O.y,be[pe+2]=O.z,be[pe+3]=O.w,be[pe+4]=z.x,be[pe+5]=z.y,be[pe+6]=z.z,be[pe+7]=z.w,be[pe+8]=I.x,be[pe+9]=I.y,be[pe+10]=I.z,be[pe+11]=I.w,pe+=12;pe>0&&(v.bindBuffer(v.ARRAY_BUFFER,e.__webglSkinIndicesBuffer),v.bufferData(v.ARRAY_BUFFER,be,t),v.bindBuffer(v.ARRAY_BUFFER,e.__webglSkinWeightsBuffer),v.bufferData(v.ARRAY_BUFFER,we,t))}if(ze&&ee){for(n=0,l=ke.length;n<l;n++)d=(h=Ge[ke[n]]).vertexColors,m=h.color,3===d.length&&ee===oe.VertexColors?(R=d[0],D=d[1],U=d[2]):(R=m,D=m,U=m),Me[fe]=R.r,Me[fe+1]=R.g,Me[fe+2]=R.b,Me[fe+3]=D.r,Me[fe+4]=D.g,Me[fe+5]=D.b,Me[fe+6]=U.r,Me[fe+7]=U.g,Me[fe+8]=U.b,fe+=9;fe>0&&(v.bindBuffer(v.ARRAY_BUFFER,e.__webglColorBuffer),v.bufferData(v.ARRAY_BUFFER,Me,t))}if(Fe&&Le.hasTangents){var Ke=new oe.Vector3(0,0,0);for(n=0,l=ke.length;n<l;n++)A=(y=(h=Ge[ke[n]]).vertexTangents)[0]||Ke,T=y[1]||Ke,C=y[2]||Ke,_e[ce]=A.x,_e[ce+1]=A.y,_e[ce+2]=A.z,_e[ce+3]=A.w,_e[ce+4]=T.x,_e[ce+5]=T.y,_e[ce+6]=T.z,_e[ce+7]=T.w,_e[ce+8]=C.x,_e[ce+9]=C.y,_e[ce+10]=C.z,_e[ce+11]=C.w,ce+=12;v.bindBuffer(v.ARRAY_BUFFER,e.__webglTangentBuffer),v.bufferData(v.ARRAY_BUFFER,_e,t)}if(Ue&&J){for(n=0,l=ke.length;n<l;n++)if(c=(h=Ge[ke[n]]).vertexNormals,f=h.normal,3===c.length&&re)for(i=0;i<3;i++)k=c[i],xe[he]=k.x,xe[he+1]=k.y,xe[he+2]=k.z,he+=3;else for(i=0;i<3;i++)xe[he]=f.x,xe[he+1]=f.y,xe[he+2]=f.z,he+=3;v.bindBuffer(v.ARRAY_BUFFER,e.__webglNormalBuffer),v.bufferData(v.ARRAY_BUFFER,xe,t)}if(De&&He&&te){for(n=0,l=ke.length;n<l;n++)if(void 0!==(x=He[ke[n]]))for(i=0;i<3;i++)G=x[i],ve[ne]=G.x,ve[ne+1]=G.y,ne+=2;ne>0&&(v.bindBuffer(v.ARRAY_BUFFER,e.__webglUVBuffer),v.bufferData(v.ARRAY_BUFFER,ve,t))}if(De&&je&&te){for(n=0,l=ke.length;n<l;n++)if(void 0!==(_=je[ke[n]]))for(i=0;i<3;i++)H=_[i],ye[se]=H.x,ye[se+1]=H.y,se+=2;se>0&&(v.bindBuffer(v.ARRAY_BUFFER,e.__webglUV2Buffer),v.bufferData(v.ARRAY_BUFFER,ye,t))}if(Re){for(n=0,l=ke.length;n<l;n++)Ce[le]=ie,Ce[le+1]=ie+1,Ce[le+2]=ie+2,le+=3,Ee[ue]=ie,Ee[ue+1]=ie+1,Ee[ue+2]=ie,Ee[ue+3]=ie+2,Ee[ue+4]=ie+1,Ee[ue+5]=ie+2,ue+=6,ie+=3;v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,Ce,t),v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,Ee,t)}if(Te)for(i=0,B=Te.length;i<B;i++)if((Z=Te[i]).__original.needsUpdate){if(me=0,0,1===Z.size){if(void 0===Z.boundTo||"vertices"===Z.boundTo)for(n=0,l=ke.length;n<l;n++)h=Ge[ke[n]],Z.array[me]=Z.value[h.a],Z.array[me+1]=Z.value[h.b],Z.array[me+2]=Z.value[h.c],me+=3;else if("faces"===Z.boundTo)for(n=0,l=ke.length;n<l;n++)Q=Z.value[ke[n]],Z.array[me]=Q,Z.array[me+1]=Q,Z.array[me+2]=Q,me+=3}else if(2===Z.size){if(void 0===Z.boundTo||"vertices"===Z.boundTo)for(n=0,l=ke.length;n<l;n++)h=Ge[ke[n]],M=Z.value[h.a],w=Z.value[h.b],S=Z.value[h.c],Z.array[me]=M.x,Z.array[me+1]=M.y,Z.array[me+2]=w.x,Z.array[me+3]=w.y,Z.array[me+4]=S.x,Z.array[me+5]=S.y,me+=6;else if("faces"===Z.boundTo)for(n=0,l=ke.length;n<l;n++)M=Q=Z.value[ke[n]],w=Q,S=Q,Z.array[me]=M.x,Z.array[me+1]=M.y,Z.array[me+2]=w.x,Z.array[me+3]=w.y,Z.array[me+4]=S.x,Z.array[me+5]=S.y,me+=6}else if(3===Z.size){var $e;if($e="c"===Z.type?["r","g","b"]:["x","y","z"],void 0===Z.boundTo||"vertices"===Z.boundTo)for(n=0,l=ke.length;n<l;n++)h=Ge[ke[n]],M=Z.value[h.a],w=Z.value[h.b],S=Z.value[h.c],Z.array[me]=M[$e[0]],Z.array[me+1]=M[$e[1]],Z.array[me+2]=M[$e[2]],Z.array[me+3]=w[$e[0]],Z.array[me+4]=w[$e[1]],Z.array[me+5]=w[$e[2]],Z.array[me+6]=S[$e[0]],Z.array[me+7]=S[$e[1]],Z.array[me+8]=S[$e[2]],me+=9;else if("faces"===Z.boundTo)for(n=0,l=ke.length;n<l;n++)M=Q=Z.value[ke[n]],w=Q,S=Q,Z.array[me]=M[$e[0]],Z.array[me+1]=M[$e[1]],Z.array[me+2]=M[$e[2]],Z.array[me+3]=w[$e[0]],Z.array[me+4]=w[$e[1]],Z.array[me+5]=w[$e[2]],Z.array[me+6]=S[$e[0]],Z.array[me+7]=S[$e[1]],Z.array[me+8]=S[$e[2]],me+=9;else if("faceVertices"===Z.boundTo)for(n=0,l=ke.length;n<l;n++)M=(Q=Z.value[ke[n]])[0],w=Q[1],S=Q[2],Z.array[me]=M[$e[0]],Z.array[me+1]=M[$e[1]],Z.array[me+2]=M[$e[2]],Z.array[me+3]=w[$e[0]],Z.array[me+4]=w[$e[1]],Z.array[me+5]=w[$e[2]],Z.array[me+6]=S[$e[0]],Z.array[me+7]=S[$e[1]],Z.array[me+8]=S[$e[2]],me+=9}else if(4===Z.size)if(void 0===Z.boundTo||"vertices"===Z.boundTo)for(n=0,l=ke.length;n<l;n++)h=Ge[ke[n]],M=Z.value[h.a],w=Z.value[h.b],S=Z.value[h.c],Z.array[me]=M.x,Z.array[me+1]=M.y,Z.array[me+2]=M.z,Z.array[me+3]=M.w,Z.array[me+4]=w.x,Z.array[me+5]=w.y,Z.array[me+6]=w.z,Z.array[me+7]=w.w,Z.array[me+8]=S.x,Z.array[me+9]=S.y,Z.array[me+10]=S.z,Z.array[me+11]=S.w,me+=12;else if("faces"===Z.boundTo)for(n=0,l=ke.length;n<l;n++)M=Q=Z.value[ke[n]],w=Q,S=Q,Z.array[me]=M.x,Z.array[me+1]=M.y,Z.array[me+2]=M.z,Z.array[me+3]=M.w,Z.array[me+4]=w.x,Z.array[me+5]=w.y,Z.array[me+6]=w.z,Z.array[me+7]=w.w,Z.array[me+8]=S.x,Z.array[me+9]=S.y,Z.array[me+10]=S.z,Z.array[me+11]=S.w,me+=12;else if("faceVertices"===Z.boundTo)for(n=0,l=ke.length;n<l;n++)M=(Q=Z.value[ke[n]])[0],w=Q[1],S=Q[2],Z.array[me]=M.x,Z.array[me+1]=M.y,Z.array[me+2]=M.z,Z.array[me+3]=M.w,Z.array[me+4]=w.x,Z.array[me+5]=w.y,Z.array[me+6]=w.z,Z.array[me+7]=w.w,Z.array[me+8]=S.x,Z.array[me+9]=S.y,Z.array[me+10]=S.z,Z.array[me+11]=S.w,me+=12;v.bindBuffer(v.ARRAY_BUFFER,Z.buffer),v.bufferData(v.ARRAY_BUFFER,Z.array,t)}r&&(delete e.__inittedArrays,delete e.__colorArray,delete e.__normalArray,delete e.__tangentArray,delete e.__uvArray,delete e.__uv2Array,delete e.__faceArray,delete e.__vertexArray,delete e.__lineArray,delete e.__skinIndexArray,delete e.__skinWeightArray)}}function Ie(e,t,r,o){var n,l,h,c;for(l in t)h=t[l],n=r[l],h>=0&&(n?(c=n.itemSize,v.bindBuffer(v.ARRAY_BUFFER,n.buffer),Be(h),v.vertexAttribPointer(h,c,v.FLOAT,!1,0,o*c*4)):e.defaultAttributeValues&&(2===e.defaultAttributeValues[l].length?v.vertexAttrib2fv(h,e.defaultAttributeValues[l]):3===e.defaultAttributeValues[l].length&&v.vertexAttrib3fv(h,e.defaultAttributeValues[l])))}function Be(e){0===Z[e]&&(v.enableVertexAttribArray(e),Z[e]=1)}function ke(){for(var e in Z)1===Z[e]&&(v.disableVertexAttribArray(e),Z[e]=0)}function Ge(a,b){return a.z!==b.z?b.z-a.z:a.id-b.id}function He(a,b){return b[0]-a[0]}function je(e,t,r){if(e.length)for(var i=0,o=e.length;i<o;i++)C=null,R=null,V=-1,I=-1,B=-1,U=-1,F=-1,P=-1,L=-1,le=!0,e[i].render(t,r,$,Q),C=null,R=null,V=-1,I=-1,B=-1,U=-1,F=-1,P=-1,L=-1,le=!0}function We(e,t,r,o,n,l,h,c){var f,object,d,m,v,y,x;t?(v=e.length-1,y=-1,x=-1):(v=0,y=e.length,x=1);for(var i=v;i!==y;i+=x)if((f=e[i]).render){if(object=f.object,d=f.buffer,c)m=c;else{if(!(m=f[r]))continue;h&&S.setBlending(m.blending,m.blendEquation,m.blendSrc,m.blendDst),S.setDepthTest(m.depthTest),S.setDepthWrite(m.depthWrite),ut(m.polygonOffset,m.polygonOffsetFactor,m.polygonOffsetUnits)}S.setMaterialFaces(m),d instanceof oe.BufferGeometry?S.renderBufferDirect(o,n,l,m,d,object):S.renderBuffer(o,n,l,m,d,object)}}function Xe(e,t,r,o,n,l,h){for(var c,object,f,i=0,d=e.length;i<d;i++)if((object=(c=e[i]).object).visible){if(h)f=h;else{if(!(f=c[t]))continue;l&&S.setBlending(f.blending,f.blendEquation,f.blendSrc,f.blendDst),S.setDepthTest(f.depthTest),S.setDepthWrite(f.depthWrite),ut(f.polygonOffset,f.polygonOffsetFactor,f.polygonOffsetUnits)}S.renderImmediateObject(r,o,n,f,object)}}function Ye(e){var t=e.object.material;t.transparent?(e.transparent=t,e.opaque=null):(e.opaque=t,e.transparent=null)}function qe(e){var object=e.object,t=e.buffer,r=object.geometry,o=object.material;if(o instanceof oe.MeshFaceMaterial){var n=r instanceof oe.BufferGeometry?0:t.materialIndex;(o=o.materials[n]).transparent?(e.transparent=o,e.opaque=null):(e.opaque=o,e.transparent=null)}else o&&(o.transparent?(e.transparent=o,e.opaque=null):(e.opaque=o,e.transparent=null))}function Ke(object,e){var g,t,r,o;if(void 0===object.__webglInit)if(object.__webglInit=!0,object._modelViewMatrix=new oe.Matrix4,object._normalMatrix=new oe.Matrix3,void 0!==object.geometry&&void 0===object.geometry.__webglInit&&(object.geometry.__webglInit=!0,object.geometry.addEventListener("dispose",we)),void 0===(t=object.geometry));else if(t instanceof oe.BufferGeometry)!function(e){var a,t,r;for(a in e.attributes)r="index"===a?v.ELEMENT_ARRAY_BUFFER:v.ARRAY_BUFFER,(t=e.attributes[a]).buffer=v.createBuffer(),v.bindBuffer(r,t.buffer),v.bufferData(r,t.array,v.STATIC_DRAW)}(t);else if(object instanceof oe.Mesh)for(g in r=object.material,void 0===t.geometryGroups&&t.makeGroups(r instanceof oe.MeshFaceMaterial),t.geometryGroups)(o=t.geometryGroups[g]).__webglVertexBuffer||(be(o),Ue(o,object),t.verticesNeedUpdate=!0,t.morphTargetsNeedUpdate=!0,t.elementsNeedUpdate=!0,t.uvsNeedUpdate=!0,t.normalsNeedUpdate=!0,t.tangentsNeedUpdate=!0,t.colorsNeedUpdate=!0);else object instanceof oe.Line?t.__webglVertexBuffer||(!function(e){e.__webglVertexBuffer=v.createBuffer(),e.__webglColorBuffer=v.createBuffer(),e.__webglLineDistanceBuffer=v.createBuffer(),S.info.memory.geometries++}(t),function(e,object){var t=e.vertices.length;e.__vertexArray=new Float32Array(3*t),e.__colorArray=new Float32Array(3*t),e.__lineDistanceArray=new Float32Array(1*t),e.__webglLineCount=t,De(e,object)}(t,object),t.verticesNeedUpdate=!0,t.colorsNeedUpdate=!0,t.lineDistancesNeedUpdate=!0):object instanceof oe.ParticleSystem&&(t.__webglVertexBuffer||(!function(e){e.__webglVertexBuffer=v.createBuffer(),e.__webglColorBuffer=v.createBuffer(),S.info.memory.geometries++}(t),function(e,object){var t=e.vertices.length;e.__vertexArray=new Float32Array(3*t),e.__colorArray=new Float32Array(3*t),e.__sortArray=[],e.__webglParticleCount=t,De(e,object)}(t,object),t.verticesNeedUpdate=!0,t.colorsNeedUpdate=!0));if(void 0===object.__webglActive){if(object instanceof oe.Mesh){if((t=object.geometry)instanceof oe.BufferGeometry)$e(e.__webglObjects,t,object);else if(t instanceof oe.Geometry)for(g in t.geometryGroups)o=t.geometryGroups[g],$e(e.__webglObjects,o,object)}else object instanceof oe.Line||object instanceof oe.ParticleSystem?(t=object.geometry,$e(e.__webglObjects,t,object)):object instanceof oe.ImmediateRenderObject||object.immediateRenderCallback?function(e,object){e.push({id:null,object:object,opaque:null,transparent:null,z:0})}(e.__webglObjectsImmediate,object):object instanceof oe.Sprite?e.__webglSprites.push(object):object instanceof oe.LensFlare&&e.__webglFlares.push(object);object.__webglActive=!0}}function $e(e,t,object){e.push({id:null,buffer:t,object:object,opaque:null,transparent:null,z:0})}function Qe(object){var e,t,r,o=object.geometry;if(o instanceof oe.BufferGeometry)!function(e,t){var r,o,n=e.attributes;for(r in n)(o=n[r]).needsUpdate&&("index"===r?(v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,o.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,o.array,t)):(v.bindBuffer(v.ARRAY_BUFFER,o.buffer),v.bufferData(v.ARRAY_BUFFER,o.array,t)),o.needsUpdate=!1)}(o,v.DYNAMIC_DRAW);else if(object instanceof oe.Mesh){for(var i=0,n=o.geometryGroupsList.length;i<n;i++)r=Fe(object,e=o.geometryGroupsList[i]),o.buffersNeedUpdate&&Ue(e,object),t=r.attributes&&Ze(r),(o.verticesNeedUpdate||o.morphTargetsNeedUpdate||o.elementsNeedUpdate||o.uvsNeedUpdate||o.normalsNeedUpdate||o.colorsNeedUpdate||o.tangentsNeedUpdate||t)&&ze(e,object,v.DYNAMIC_DRAW,!o.dynamic,r);o.verticesNeedUpdate=!1,o.morphTargetsNeedUpdate=!1,o.elementsNeedUpdate=!1,o.uvsNeedUpdate=!1,o.normalsNeedUpdate=!1,o.colorsNeedUpdate=!1,o.tangentsNeedUpdate=!1,o.buffersNeedUpdate=!1,r.attributes&&Je(r)}else object instanceof oe.Line?(t=(r=Fe(object,o)).attributes&&Ze(r),(o.verticesNeedUpdate||o.colorsNeedUpdate||o.lineDistancesNeedUpdate||t)&&function(e,t){var r,o,n,l,h,c,i,f,d,m,y,x,_=e.vertices,M=e.colors,w=e.lineDistances,S=_.length,A=M.length,dl=w.length,T=e.__vertexArray,C=e.__colorArray,E=e.__lineDistanceArray,L=e.verticesNeedUpdate,P=e.colorsNeedUpdate,R=e.lineDistancesNeedUpdate,D=e.__webglCustomAttributesList;if(L){for(r=0;r<S;r++)l=_[r],T[h=3*r]=l.x,T[h+1]=l.y,T[h+2]=l.z;v.bindBuffer(v.ARRAY_BUFFER,e.__webglVertexBuffer),v.bufferData(v.ARRAY_BUFFER,T,t)}if(P){for(o=0;o<A;o++)c=M[o],C[h=3*o]=c.r,C[h+1]=c.g,C[h+2]=c.b;v.bindBuffer(v.ARRAY_BUFFER,e.__webglColorBuffer),v.bufferData(v.ARRAY_BUFFER,C,t)}if(R){for(n=0;n<dl;n++)E[n]=w[n];v.bindBuffer(v.ARRAY_BUFFER,e.__webglLineDistanceBuffer),v.bufferData(v.ARRAY_BUFFER,E,t)}if(D)for(i=0,f=D.length;i<f;i++)if((x=D[i]).needsUpdate&&(void 0===x.boundTo||"vertices"===x.boundTo)){if(h=0,m=x.value.length,1===x.size)for(d=0;d<m;d++)x.array[d]=x.value[d];else if(2===x.size)for(d=0;d<m;d++)y=x.value[d],x.array[h]=y.x,x.array[h+1]=y.y,h+=2;else if(3===x.size)if("c"===x.type)for(d=0;d<m;d++)y=x.value[d],x.array[h]=y.r,x.array[h+1]=y.g,x.array[h+2]=y.b,h+=3;else for(d=0;d<m;d++)y=x.value[d],x.array[h]=y.x,x.array[h+1]=y.y,x.array[h+2]=y.z,h+=3;else if(4===x.size)for(d=0;d<m;d++)y=x.value[d],x.array[h]=y.x,x.array[h+1]=y.y,x.array[h+2]=y.z,x.array[h+3]=y.w,h+=4;v.bindBuffer(v.ARRAY_BUFFER,x.buffer),v.bufferData(v.ARRAY_BUFFER,x.array,t)}}(o,v.DYNAMIC_DRAW),o.verticesNeedUpdate=!1,o.colorsNeedUpdate=!1,o.lineDistancesNeedUpdate=!1,r.attributes&&Je(r)):object instanceof oe.ParticleSystem&&(t=(r=Fe(object,o)).attributes&&Ze(r),(o.verticesNeedUpdate||o.colorsNeedUpdate||object.sortParticles||t)&&function(e,t,object){var r,o,n,l,h,c,i,f,d,m,y,x,_=e.vertices,M=_.length,w=e.colors,S=w.length,A=e.__vertexArray,T=e.__colorArray,C=e.__sortArray,E=e.verticesNeedUpdate,L=(e.elementsNeedUpdate,e.colorsNeedUpdate),P=e.__webglCustomAttributesList;if(object.sortParticles){for(te.copy(ee),te.multiply(object.matrixWorld),r=0;r<M;r++)n=_[r],re.copy(n),re.applyProjection(te),C[r]=[re.z,r];for(C.sort(He),r=0;r<M;r++)n=_[C[r][1]],A[l=3*r]=n.x,A[l+1]=n.y,A[l+2]=n.z;for(o=0;o<S;o++)l=3*o,c=w[C[o][1]],T[l]=c.r,T[l+1]=c.g,T[l+2]=c.b;if(P)for(i=0,f=P.length;i<f;i++)if(void 0===(x=P[i]).boundTo||"vertices"===x.boundTo)if(l=0,m=x.value.length,1===x.size)for(d=0;d<m;d++)h=C[d][1],x.array[d]=x.value[h];else if(2===x.size)for(d=0;d<m;d++)h=C[d][1],y=x.value[h],x.array[l]=y.x,x.array[l+1]=y.y,l+=2;else if(3===x.size)if("c"===x.type)for(d=0;d<m;d++)h=C[d][1],y=x.value[h],x.array[l]=y.r,x.array[l+1]=y.g,x.array[l+2]=y.b,l+=3;else for(d=0;d<m;d++)h=C[d][1],y=x.value[h],x.array[l]=y.x,x.array[l+1]=y.y,x.array[l+2]=y.z,l+=3;else if(4===x.size)for(d=0;d<m;d++)h=C[d][1],y=x.value[h],x.array[l]=y.x,x.array[l+1]=y.y,x.array[l+2]=y.z,x.array[l+3]=y.w,l+=4}else{if(E)for(r=0;r<M;r++)n=_[r],A[l=3*r]=n.x,A[l+1]=n.y,A[l+2]=n.z;if(L)for(o=0;o<S;o++)c=w[o],T[l=3*o]=c.r,T[l+1]=c.g,T[l+2]=c.b;if(P)for(i=0,f=P.length;i<f;i++)if((x=P[i]).needsUpdate&&(void 0===x.boundTo||"vertices"===x.boundTo))if(m=x.value.length,l=0,1===x.size)for(d=0;d<m;d++)x.array[d]=x.value[d];else if(2===x.size)for(d=0;d<m;d++)y=x.value[d],x.array[l]=y.x,x.array[l+1]=y.y,l+=2;else if(3===x.size)if("c"===x.type)for(d=0;d<m;d++)y=x.value[d],x.array[l]=y.r,x.array[l+1]=y.g,x.array[l+2]=y.b,l+=3;else for(d=0;d<m;d++)y=x.value[d],x.array[l]=y.x,x.array[l+1]=y.y,x.array[l+2]=y.z,l+=3;else if(4===x.size)for(d=0;d<m;d++)y=x.value[d],x.array[l]=y.x,x.array[l+1]=y.y,x.array[l+2]=y.z,x.array[l+3]=y.w,l+=4}if((E||object.sortParticles)&&(v.bindBuffer(v.ARRAY_BUFFER,e.__webglVertexBuffer),v.bufferData(v.ARRAY_BUFFER,A,t)),(L||object.sortParticles)&&(v.bindBuffer(v.ARRAY_BUFFER,e.__webglColorBuffer),v.bufferData(v.ARRAY_BUFFER,T,t)),P)for(i=0,f=P.length;i<f;i++)((x=P[i]).needsUpdate||object.sortParticles)&&(v.bindBuffer(v.ARRAY_BUFFER,x.buffer),v.bufferData(v.ARRAY_BUFFER,x.array,t))}(o,v.DYNAMIC_DRAW,object),o.verticesNeedUpdate=!1,o.colorsNeedUpdate=!1,r.attributes&&Je(r))}function Ze(e){for(var a in e.attributes)if(e.attributes[a].needsUpdate)return!0;return!1}function Je(e){for(var a in e.attributes)e.attributes[a].needsUpdate=!1}function et(object,e){object instanceof oe.Mesh||object instanceof oe.ParticleSystem||object instanceof oe.Line?tt(e.__webglObjects,object):object instanceof oe.Sprite?it(e.__webglSprites,object):object instanceof oe.LensFlare?it(e.__webglFlares,object):(object instanceof oe.ImmediateRenderObject||object.immediateRenderCallback)&&tt(e.__webglObjectsImmediate,object),delete object.__webglActive}function tt(e,object){for(var t=e.length-1;t>=0;t--)e[t].object===object&&e.splice(t,1)}function it(e,object){for(var t=e.length-1;t>=0;t--)e[t]===object&&e.splice(t,1)}function at(e,r,o,n,object){if(D=0,n.needsUpdate){var l=n.program;S.initMaterial(n,r,o,object),n.needsUpdate=!1,l&&Re(n,l)}n.morphTargets&&(object.__webglMorphTargetInfluences||(object.__webglMorphTargetInfluences=new Float32Array(S.maxMorphTargets)));var h=!1,c=n.program,f=c.uniforms,d=n.uniforms;if(c!==C&&(v.useProgram(c),C=c,h=!0),n.id!==L&&(L=n.id,h=!0),(h||e!==R)&&(v.uniformMatrix4fv(f.projectionMatrix,!1,e.projectionMatrix.elements),e!==R&&(R=e)),n.skinning)if(me&&object.useVertexTexture){if(null!==f.boneTexture){var m=nt();v.uniform1i(f.boneTexture,m),S.setTexture(object.boneTexture,m)}null!==f.boneTextureWidth&&v.uniform1i(f.boneTextureWidth,object.boneTextureWidth),null!==f.boneTextureHeight&&v.uniform1i(f.boneTextureHeight,object.boneTextureHeight)}else null!==f.boneGlobalMatrices&&v.uniformMatrix4fv(f.boneGlobalMatrices,!1,object.boneMatrices);return h&&(o&&n.fog&&function(e,t){e.fogColor.value=t.color,t instanceof oe.Fog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t instanceof oe.FogExp2&&(e.fogDensity.value=t.density)}(d,o),(n instanceof oe.MeshPhongMaterial||n instanceof oe.MeshLambertMaterial||n instanceof oe.MeshPhysicalMaterial||n.lights)&&(le&&(!function(e,t){var r,o,n,l,h,c,f,d,m,v=0,g=0,b=0,y=he,x=y.directional.colors,_=y.directional.positions,M=y.point.colors,w=y.point.positions,A=y.point.distances,T=y.point.decayExponents,C=y.spot.colors,E=y.spot.positions,L=y.spot.distances,P=y.spot.decayExponents,R=y.spot.directions,D=y.spot.anglesCos,U=y.spot.exponents,F=y.hemi.skyColors,V=y.hemi.groundColors,N=y.hemi.positions,O=y.area.colors,z=y.area.positions,I=y.area.distances,B=y.area.decayExponents,k=y.area.widths,G=y.area.heights,H=0,j=0,W=0,X=0,Y=0,K=0,$=0,Q=0,Z=0,J=0,ee=0,te=0,ae=0,le=0,ce=0;for(r=0,o=t.length;r<o;r++)if(!(n=t[r]).onlyShadow)if(l=n.color,f=n.intensity,m=n.distance,n instanceof oe.AmbientLight){if(!n.visible)continue;S.gammaInput?(v+=l.r*l.r,g+=l.g*l.g,b+=l.b*l.b):(v+=l.r,g+=l.g,b+=l.b)}else if(n instanceof oe.DirectionalLight){if(K+=1,!n.visible)continue;if(se.setFromMatrixPosition(n.matrixWorld),re.setFromMatrixPosition(n.target.matrixWorld),se.sub(re),se.normalize(),0===se.x&&0===se.y&&0===se.z)continue;_[ee=3*H]=se.x,_[ee+1]=se.y,_[ee+2]=se.z,S.gammaInput?lt(x,ee,l,f*f):ht(x,ee,l,f),H+=1}else if(n instanceof oe.PointLight){if($+=1,!n.visible)continue;te=3*j,S.gammaInput?lt(M,te,l,f*f):ht(M,te,l,f),re.setFromMatrixPosition(n.matrixWorld),w[te]=re.x,w[te+1]=re.y,w[te+2]=re.z,A[j]=m,T[j]=n.decayExponent,j+=1}else if(n instanceof oe.SpotLight){if(Q+=1,!n.visible)continue;ae=3*W,S.gammaInput?lt(C,ae,l,f*f):ht(C,ae,l,f),re.setFromMatrixPosition(n.matrixWorld),E[ae]=re.x,E[ae+1]=re.y,E[ae+2]=re.z,L[W]=m,P[W]=n.decayExponent,se.copy(re),re.setFromMatrixPosition(n.target.matrixWorld),se.sub(re),se.normalize(),R[ae]=se.x,R[ae+1]=se.y,R[ae+2]=se.z,D[W]=Math.cos(n.angle),U[W]=n.exponent,W+=1}else if(n instanceof oe.HemisphereLight){if(Z+=1,!n.visible)continue;if(se.setFromMatrixPosition(n.matrixWorld),se.normalize(),0===se.x&&0===se.y&&0===se.z)continue;N[le=3*X]=se.x,N[le+1]=se.y,N[le+2]=se.z,h=n.color,c=n.groundColor,S.gammaInput?(lt(F,le,h,d=f*f),lt(V,le,c,d)):(ht(F,le,h,f),ht(V,le,c,f)),X+=1}else if(n instanceof oe.AreaLight){if(J+=1,!n.visible)continue;ce=3*Y,S.gammaInput?lt(O,ce,l,f*f):ht(O,ce,l,f),re.setFromMatrixPosition(n.matrixWorld),z[ce]=re.x,z[ce+1]=re.y,z[ce+2]=re.z,I[Y]=m,B[Y]=n.decayExponent,n.matrixWorld.extractBasis(ie,ne,re),ie.multiplyScalar(n.width),ne.multiplyScalar(n.height),k[ce]=ie.x,k[ce+1]=ie.y,k[ce+2]=ie.z,G[ce]=ne.x,G[ce+1]=ne.y,G[ce+2]=ne.z,Y+=1}for(r=3*H,o=Math.max(x.length,3*K);r<o;r++)x[r]=0;for(r=3*j,o=Math.max(M.length,3*$);r<o;r++)M[r]=0;for(r=3*W,o=Math.max(C.length,3*Q);r<o;r++)C[r]=0;for(r=3*X,o=Math.max(F.length,3*Z);r<o;r++)F[r]=0;for(r=3*X,o=Math.max(V.length,3*Z);r<o;r++)V[r]=0;for(r=3*Y,o=Math.max(O.length,3*J);r<o;r++)O[r]=0;y.directional.length=H,y.point.length=j,y.spot.length=W,y.hemi.length=X,y.area.length=Y,y.ambient[0]=v,y.ambient[1]=g,y.ambient[2]=b}(0,r),le=!1),function(e,t){e.ambientLightColor.value=t.ambient,e.directionalLightColor.value=t.directional.colors,e.directionalLightDirection.value=t.directional.positions,e.pointLightColor.value=t.point.colors,e.pointLightPosition.value=t.point.positions,e.pointLightDistance.value=t.point.distances,e.pointLightDecayExponent.value=t.point.decayExponents,e.spotLightColor.value=t.spot.colors,e.spotLightPosition.value=t.spot.positions,e.spotLightDistance.value=t.spot.distances,e.spotLightDecayExponent.value=t.spot.decayExponents,e.spotLightDirection.value=t.spot.directions,e.spotLightAngleCos.value=t.spot.anglesCos,e.spotLightExponent.value=t.spot.exponents,e.hemisphereLightSkyColor.value=t.hemi.skyColors,e.hemisphereLightGroundColor.value=t.hemi.groundColors,e.hemisphereLightDirection.value=t.hemi.positions,e.areaLightColor.value=t.area.colors,e.areaLightPosition.value=t.area.positions,e.areaLightDistance.value=t.area.distances,e.areaLightDecayExponent.value=t.area.decayExponents,e.areaLightWidth.value=t.area.widths,e.areaLightHeight.value=t.area.heights}(d,he)),(n instanceof oe.MeshBasicMaterial||n instanceof oe.MeshLambertMaterial||n instanceof oe.MeshPhysicalMaterial||n instanceof oe.MeshPhongMaterial)&&function(e,t){e.opacity.value=t.opacity,S.gammaInput?e.diffuse.value.copyGammaToLinear(t.color):e.diffuse.value=t.color;e.map.value=t.map,e.lightMap.value=t.lightMap,e.emissiveMap.value=t.emissiveMap,t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale);t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale));if(t.map){var map=t.map;e.offsetRepeat.value.set(map.offset.x,map.offset.y,map.repeat.x,map.repeat.y),e.gainBrightness.value.set(map.gainPivot,map.gain,map.brightness,1)}if(t.specularMap){var r=t.specularMap;e.specularMap.value=r,e.specularOffsetRepeat.value.set(r.offset.x,r.offset.y,r.repeat.x,r.repeat.y),e.specularGainBrightness.value.set(r.gainPivot,r.gain,r.brightness,1)}if(t.opacityMap){var o=t.opacityMap;e.opacityMap.value=o,e.opacityOffsetRepeat.value.set(o.offset.x,o.offset.y,o.repeat.x,o.repeat.y),e.opacityGainBrightness.value.set(o.gainPivot,o.gain,o.brightness,1)}if(t.bumpMap){var n=t.bumpMap;e.bumpOffsetRepeat.value.set(n.offset.x,n.offset.y,n.repeat.x,n.repeat.y)}if(t.normalMap){var l=t.normalMap;e.normalOffsetRepeat.value.set(l.offset.x,l.offset.y,l.repeat.x,l.repeat.y)}if(t.anisotropyMap){var h=t.anisotropyMap;e.anisotropyOffsetRepeat.value.set(h.offset.x,h.offset.y,h.repeat.x,h.repeat.y),e.anisotropyGainBrightness.value.set(h.gainPivot,h.gain,h.brightness,1)}if(t.anisotropyRotationMap){var c=t.anisotropyRotationMap;e.anisotropyRotationOffsetRepeat.value.set(c.offset.x,c.offset.y,c.repeat.x,c.repeat.y),e.anisotropyRotationGainBrightness.value.set(c.gainPivot,c.gain,c.brightness,1)}if(t.roughnessMap){var f=t.roughnessMap;e.roughnessOffsetRepeat.value.set(f.offset.x,f.offset.y,f.repeat.x,f.repeat.y),e.roughnessGainBrightness.value.set(f.gainPivot,f.gain,f.brightness,1)}if(t.metallicMap){var d=t.metallicMap;e.metallicOffsetRepeat.value.set(d.offset.x,d.offset.y,d.repeat.x,d.repeat.y),e.metallicGainBrightness.value.set(d.gainPivot,d.gain,d.brightness,1)}if(t.translucencyMap){var m=t.translucencyMap;e.translucencyMap.value=m}e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap instanceof oe.WebGLRenderTargetCube?1:-1,e.envEncoding.value=t.envMap?t.envMap.encoding:0,e.diffuseEnvMap.value=t.diffuseEnvMap,e.diffuseEnvEncoding.value=t.diffuseEnvMap?t.diffuseEnvMap.encoding:0,S.gammaInput,e.reflectivity.value=t.reflectivity;e.refractionRatio.value=t.refractionRatio,e.combine.value=t.combine,e.useRefract.value=t.envMap&&t.envMap.mapping instanceof oe.CubeRefractionMapping}(d,n),n instanceof oe.LineBasicMaterial?ot(d,n):n instanceof oe.LineDashedMaterial?(ot(d,n),function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(d,n)):n instanceof oe.ParticleSystemMaterial?function(e,r){e.psColor.value=r.color,e.opacity.value=r.opacity,e.size.value=r.size,e.scale.value=t.height/2,e.map.value=r.map}(d,n):n instanceof oe.MeshPhongMaterial?function(e,t){e.opacityMap.value=t.opacityMap,e.shininess.value=t.shininess,S.gammaInput?(e.ambient.value.copyGammaToLinear(t.ambient),e.emissive.value.copyGammaToLinear(t.emissive),e.specular.value.copyGammaToLinear(t.specular)):(e.ambient.value=t.ambient,e.emissive.value=t.emissive,e.specular.value=t.specular);t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}(d,n):n instanceof oe.MeshPhysicalMaterial?function(e,t){e.opacityMap.value=t.opacityMap,e.falloffBlendParams.value=t.falloffBlendParams,e.falloffMap.value=t.falloffMap,e.roughness.value=t.roughness,e.metallic.value=t.metallic,e.clearCoat.value=t.clearCoat,e.clearCoatRoughness.value=t.clearCoatRoughness,e.roughnessMap.value=t.roughnessMap,e.metallicMap.value=t.metallicMap,e.translucencyMap.value=t.translucencyMap,e.translucencyNormalAlpha.value=t.translucencyNormalAlpha,e.translucencyNormalPower.value=t.translucencyNormalPower,e.translucencyViewAlpha.value=t.translucencyViewAlpha,e.translucencyViewPower.value=t.translucencyViewPower,e.anisotropyMap.value=t.anisotropyMap,e.anisotropy.value=t.anisotropy,e.anisotropyRotation.value=t.anisotropyRotation,e.anisotropyRotationMap.value=t.anisotropyRotationMap,S.gammaInput?(e.ambient.value.copyGammaToLinear(t.ambient),e.emissive.value.copyGammaToLinear(t.emissive),e.falloffColor.value.copyGammaToLinear(t.falloffColor),e.specular.value.copyGammaToLinear(t.specular),e.translucency.value.copyGammaToLinear(t.translucency)):(e.ambient.value=t.ambient,e.emissive.value=t.emissive,e.falloffColor.value=t.falloffColor,e.specular.value=t.specular,e.translucency.value=t.translucency)}(d,n):n instanceof oe.MeshLambertMaterial?function(e,t){S.gammaInput?(e.ambient.value.copyGammaToLinear(t.ambient),e.emissive.value.copyGammaToLinear(t.emissive)):(e.ambient.value=t.ambient,e.emissive.value=t.emissive);t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}(d,n):n instanceof oe.MeshDepthMaterial?(d.mNear.value=e.near,d.mFar.value=e.far,d.opacity.value=n.opacity):n instanceof oe.MeshNormalMaterial&&(d.opacity.value=n.opacity),object.receiveShadow&&!n._shadowPass&&function(e,t){if(e.shadowMatrix)for(var r=0,i=0,o=t.length;i<o;i++){var n=t[i];n.castShadow&&((n instanceof oe.SpotLight||n instanceof oe.DirectionalLight&&!n.shadowCascade)&&(e.shadowMap.value[r]=n.shadowMap,e.shadowMapSize.value[r]=n.shadowMapSize,e.shadowMatrix.value[r]=n.shadowMatrix,e.shadowDarkness.value[r]=n.shadowDarkness,e.shadowBias.value[r]=n.shadowBias,r++))}}(d,r),function(e,t){var r,o,n,l,h,c,i,f,d,m,y;for(d=0,m=t.length;d<m;d++)if(l=e.uniforms[t[d][1]])if(r=t[d][0],n=r.type,o=r.value,"i"===n)v.uniform1i(l,o);else if("f"===n)v.uniform1f(l,o);else if("v2"===n)v.uniform2f(l,o.x,o.y);else if("v3"===n)v.uniform3f(l,o.x,o.y,o.z);else if("v4"===n)v.uniform4f(l,o.x,o.y,o.z,o.w);else if("c"===n)v.uniform3f(l,o.r,o.g,o.b);else if("iv1"===n)v.uniform1iv(l,o);else if("iv"===n)v.uniform3iv(l,o);else if("fv1"===n)v.uniform1fv(l,o);else if("fv"===n)v.uniform3fv(l,o);else if("v2v"===n){for(void 0===r._array&&(r._array=new Float32Array(2*o.length)),i=0,f=o.length;i<f;i++)y=2*i,r._array[y]=o[i].x,r._array[y+1]=o[i].y;v.uniform2fv(l,r._array)}else if("v3v"===n){for(void 0===r._array&&(r._array=new Float32Array(3*o.length)),i=0,f=o.length;i<f;i++)y=3*i,r._array[y]=o[i].x,r._array[y+1]=o[i].y,r._array[y+2]=o[i].z;v.uniform3fv(l,r._array)}else if("v4v"===n){for(void 0===r._array&&(r._array=new Float32Array(4*o.length)),i=0,f=o.length;i<f;i++)y=4*i,r._array[y]=o[i].x,r._array[y+1]=o[i].y,r._array[y+2]=o[i].z,r._array[y+3]=o[i].w;v.uniform4fv(l,r._array)}else if("m4"===n)void 0===r._array&&(r._array=new Float32Array(16)),o.flattenToArray(r._array),v.uniformMatrix4fv(l,!1,r._array);else if("m4v"===n){for(void 0===r._array&&(r._array=new Float32Array(16*o.length)),i=0,f=o.length;i<f;i++)o[i].flattenToArrayOffset(r._array,16*i);v.uniformMatrix4fv(l,!1,r._array)}else if("t"===n){if(h=o,c=nt(),v.uniform1i(l,c),!h)continue;h.image instanceof Array&&6===h.image.length?vt(h,c):h instanceof oe.WebGLRenderTargetCube?yt(h,c):S.setTexture(h,c)}else if("tv"===n){for(void 0===r._array&&(r._array=[]),i=0,f=r.value.length;i<f;i++)r._array[i]=nt();for(v.uniform1iv(l,r._array),i=0,f=r.value.length;i<f;i++)h=r.value[i],c=r._array[i],h&&S.setTexture(h,c)}else oe.onwarning("THREE.WebGLRenderer: Unknown uniform type: "+n)}(c,n.uniformsList),(n instanceof oe.ShaderMaterial||n instanceof oe.MeshPhongMaterial||n instanceof oe.MeshPhysicalMaterial||n.envMap||n.diffuseEnvMap)&&null!==f.cameraPosition&&(re.setFromMatrixPosition(e.matrixWorld),v.uniform3f(f.cameraPosition,re.x,re.y,re.z)),(n instanceof oe.MeshPhongMaterial||n instanceof oe.MeshLambertMaterial||n instanceof oe.MeshPhysicalMaterial||n instanceof oe.ShaderMaterial||n.skinning)&&null!==f.viewMatrix&&v.uniformMatrix4fv(f.viewMatrix,!1,e.matrixWorldInverse.elements)),function(e,object){v.uniformMatrix4fv(e.modelViewMatrix,!1,object._modelViewMatrix.elements),e.normalMatrix&&v.uniformMatrix3fv(e.normalMatrix,!1,object._normalMatrix.elements)}(f,object),null!==f.modelMatrix&&v.uniformMatrix4fv(f.modelMatrix,!1,object.matrixWorld.elements),c}function ot(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function nt(){var e=D;return e>=ce&&oe.onwarning("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+ce),D+=1,e}function st(object,e){object._modelViewMatrix.multiplyMatrices(e.matrixWorldInverse,object.matrixWorld),object._normalMatrix.getNormalMatrix(object._modelViewMatrix)}function lt(e,t,r,o){e[t]=r.r*r.r*o,e[t+1]=r.g*r.g*o,e[t+2]=r.b*r.b*o}function ht(e,t,r,o){e[t]=r.r*o,e[t+1]=r.g*o,e[t+2]=r.b*o}function ct(e){e!==j&&(v.lineWidth(e),j=e)}function ut(e,t,r){k!==e&&(e?v.enable(v.POLYGON_OFFSET_FILL):v.disable(v.POLYGON_OFFSET_FILL),k=e),!e||G===t&&H===r||(v.polygonOffset(t,r),G=t,H=r)}function ft(e){for(var t=e.split("\n"),i=0,r=t.length;i<r;i++)t[i]=i+1+": "+t[i];return t.join("\n")}function pt(e,t,r,o){var n;return"fragment"===e?n=v.createShader(v.FRAGMENT_SHADER):"vertex"===e&&(n=v.createShader(v.VERTEX_SHADER)),v.shaderSource(n,t),v.compileShader(n),v.getShaderParameter(n,v.COMPILE_STATUS)?n:(oe.onerror("shader error: "+r+"."+e,{getShaderParameter:v.getShaderParameter(n,v.COMPILE_STATUS),shaderInfoLog:v.getShaderInfoLog(n),shaderCode:ft(t),getError:v.getError(),simpleCode:o,gl_MAX_VARYING_VECTORS:v.getParameter(v.MAX_VARYING_VECTORS),gl_MAX_VERTEX_ATTRIBS:v.getParameter(v.MAX_VERTEX_ATTRIBS),gl_MAX_VERTEX_UNIFORM_VECTORS:v.getParameter(v.MAX_VERTEX_UNIFORM_VECTORS),gl_MAX_VERTEX_TEXTURE_IMAGE_UNITS:v.getParameter(v.MAX_VERTEX_TEXTURE_IMAGE_UNITS),gl_MAX_FRAGMENT_UNIFORM_VECTORS:v.getParameter(v.MAX_FRAGMENT_UNIFORM_VECTORS),gl_MAX_TEXTURE_IMAGE_UNITS:v.getParameter(v.MAX_TEXTURE_IMAGE_UNITS)}),null)}function mt(e,t,r){r?(v.texParameteri(e,v.TEXTURE_WRAP_S,bt(t.wrapS)),v.texParameteri(e,v.TEXTURE_WRAP_T,bt(t.wrapT)),v.texParameteri(e,v.TEXTURE_MAG_FILTER,bt(t.magFilter)),v.texParameteri(e,v.TEXTURE_MIN_FILTER,bt(t.minFilter))):(v.texParameteri(e,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(e,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),v.texParameteri(e,v.TEXTURE_MAG_FILTER,Mt(t.magFilter)),v.texParameteri(e,v.TEXTURE_MIN_FILTER,Mt(t.minFilter))),M&&t.type!==oe.FloatType&&(t.anisotropy>1||t.__oldAnisotropy)&&(v.texParameterf(e,M.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,pe)),t.__oldAnisotropy=t.anisotropy)}function gt(image,e){if(image.width<=e&&image.height<=e)return image;var t=Math.max(image.width,image.height),r=Math.floor(image.width*e/t),o=Math.floor(image.height*e/t),canvas=document.createElement("canvas");return canvas.width=r,canvas.height=o,canvas.getContext("2d").drawImage(image,0,0,image.width,image.height,0,0,r,o),canvas}function vt(e,slot){if(6===e.image.length)if(e.needsUpdate){e.image.__webglTextureCube||(e.addEventListener("dispose",Se),e.image.__webglTextureCube=v.createTexture(),S.info.memory.textures++),v.activeTexture(v.TEXTURE0+slot),v.bindTexture(v.TEXTURE_CUBE_MAP,e.image.__webglTextureCube),v.pixelStorei(v.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var t=e instanceof oe.CompressedTexture,r=[],i=0;i<6;i++)S.autoScaleCubemaps&&!t?r[i]=gt(e.image[i],fe):r[i]=e.image[i];var image=r[0],o=oe.Math.isPowerOfTwo(image.width)&&oe.Math.isPowerOfTwo(image.height),n=bt(e.format),l=bt(e.type);mt(v.TEXTURE_CUBE_MAP,e,o);for(i=0;i<6;i++)if(t)for(var h,c=r[i].mipmaps,f=0,d=c.length;f<d;f++)h=c[f],e.format!==oe.RGBAFormat?v.compressedTexImage2D(v.TEXTURE_CUBE_MAP_POSITIVE_X+i,f,n,h.width,h.height,0,h.data):v.texImage2D(v.TEXTURE_CUBE_MAP_POSITIVE_X+i,f,n,h.width,h.height,0,n,l,h.data);else v.texImage2D(v.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,n,n,l,r[i]);e.generateMipmaps&&o&&v.generateMipmap(v.TEXTURE_CUBE_MAP),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else v.activeTexture(v.TEXTURE0+slot),v.bindTexture(v.TEXTURE_CUBE_MAP,e.image.__webglTextureCube)}function yt(e,slot){v.activeTexture(v.TEXTURE0+slot),v.bindTexture(v.TEXTURE_CUBE_MAP,e.__webglTexture)}function xt(e,t,r){v.bindFramebuffer(v.FRAMEBUFFER,e),v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,r,t.__webglTexture,0)}function _t(e,t){v.bindRenderbuffer(v.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(v.renderbufferStorage(v.RENDERBUFFER,v.DEPTH_COMPONENT16,t.width,t.height),v.framebufferRenderbuffer(v.FRAMEBUFFER,v.DEPTH_ATTACHMENT,v.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(v.renderbufferStorage(v.RENDERBUFFER,v.DEPTH_STENCIL,t.width,t.height),v.framebufferRenderbuffer(v.FRAMEBUFFER,v.DEPTH_STENCIL_ATTACHMENT,v.RENDERBUFFER,e)):v.renderbufferStorage(v.RENDERBUFFER,v.RGBA4,t.width,t.height)}function Mt(e){return e===oe.NearestFilter||e===oe.NearestMipMapNearestFilter||e===oe.NearestMipMapLinearFilter?v.NEAREST:v.LINEAR}function bt(p){if(p===oe.RepeatWrapping)return v.REPEAT;if(p===oe.ClampToEdgeWrapping)return v.CLAMP_TO_EDGE;if(p===oe.MirroredRepeatWrapping)return v.MIRRORED_REPEAT;if(p===oe.NearestFilter)return v.NEAREST;if(p===oe.NearestMipMapNearestFilter)return v.NEAREST_MIPMAP_NEAREST;if(p===oe.NearestMipMapLinearFilter)return v.NEAREST_MIPMAP_LINEAR;if(p===oe.LinearFilter)return v.LINEAR;if(p===oe.LinearMipMapNearestFilter)return v.LINEAR_MIPMAP_NEAREST;if(p===oe.LinearMipMapLinearFilter)return v.LINEAR_MIPMAP_LINEAR;if(p===oe.UnsignedByteType)return v.UNSIGNED_BYTE;if(p===oe.UnsignedShort4444Type)return v.UNSIGNED_SHORT_4_4_4_4;if(p===oe.UnsignedShort5551Type)return v.UNSIGNED_SHORT_5_5_5_1;if(p===oe.UnsignedShort565Type)return v.UNSIGNED_SHORT_5_6_5;if(p===oe.ByteType)return v.BYTE;if(p===oe.ShortType)return v.SHORT;if(p===oe.UnsignedShortType)return v.UNSIGNED_SHORT;if(p===oe.IntType)return v.INT;if(p===oe.UnsignedIntType)return v.UNSIGNED_INT;if(p===oe.FloatType)return v.FLOAT;if(p===oe.AlphaFormat)return v.ALPHA;if(p===oe.RGBFormat)return v.RGB;if(p===oe.RGBAFormat)return v.RGBA;if(p===oe.LuminanceFormat)return v.LUMINANCE;if(p===oe.LuminanceAlphaFormat)return v.LUMINANCE_ALPHA;if(p===oe.AddEquation)return v.FUNC_ADD;if(p===oe.SubtractEquation)return v.FUNC_SUBTRACT;if(p===oe.ReverseSubtractEquation)return v.FUNC_REVERSE_SUBTRACT;if(p===oe.ZeroFactor)return v.ZERO;if(p===oe.OneFactor)return v.ONE;if(p===oe.SrcColorFactor)return v.SRC_COLOR;if(p===oe.OneMinusSrcColorFactor)return v.ONE_MINUS_SRC_COLOR;if(p===oe.SrcAlphaFactor)return v.SRC_ALPHA;if(p===oe.OneMinusSrcAlphaFactor)return v.ONE_MINUS_SRC_ALPHA;if(p===oe.DstAlphaFactor)return v.DST_ALPHA;if(p===oe.OneMinusDstAlphaFactor)return v.ONE_MINUS_DST_ALPHA;if(p===oe.DstColorFactor)return v.DST_COLOR;if(p===oe.OneMinusDstColorFactor)return v.ONE_MINUS_DST_COLOR;if(p===oe.SrcAlphaSaturateFactor)return v.SRC_ALPHA_SATURATE;if(void 0!==w){if(p===oe.RGB_S3TC_DXT1_Format)return w.COMPRESSED_RGB_S3TC_DXT1_EXT;if(p===oe.RGBA_S3TC_DXT1_Format)return w.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(p===oe.RGBA_S3TC_DXT3_Format)return w.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(p===oe.RGBA_S3TC_DXT5_Format)return w.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}this.renderBufferImmediate=function(object,e,t){if(object.hasPositions&&!object.__webglVertexBuffer&&(object.__webglVertexBuffer=v.createBuffer()),object.hasNormals&&!object.__webglNormalBuffer&&(object.__webglNormalBuffer=v.createBuffer()),object.hasUvs&&!object.__webglUvBuffer&&(object.__webglUvBuffer=v.createBuffer()),object.hasColors&&!object.__webglColorBuffer&&(object.__webglColorBuffer=v.createBuffer()),object.hasPositions&&(v.bindBuffer(v.ARRAY_BUFFER,object.__webglVertexBuffer),v.bufferData(v.ARRAY_BUFFER,object.positionArray,v.DYNAMIC_DRAW),v.enableVertexAttribArray(e.attributes.position),v.vertexAttribPointer(e.attributes.position,3,v.FLOAT,!1,0,0)),object.hasNormals){if(v.bindBuffer(v.ARRAY_BUFFER,object.__webglNormalBuffer),t.shading===oe.FlatShading){var r,o,n,l,h,c,f,d,m,y,i,x=3*object.count;for(i=0;i<x;i+=9)l=(y=object.normalArray)[i],c=y[i+1],d=y[i+2],h=y[i+3],f=y[i+4],m=y[i+5],r=(l+h+y[i+6])/3,o=(c+f+y[i+7])/3,n=(d+m+y[i+8])/3,y[i]=r,y[i+1]=o,y[i+2]=n,y[i+3]=r,y[i+4]=o,y[i+5]=n,y[i+6]=r,y[i+7]=o,y[i+8]=n}v.bufferData(v.ARRAY_BUFFER,object.normalArray,v.DYNAMIC_DRAW),v.enableVertexAttribArray(e.attributes.normal),v.vertexAttribPointer(e.attributes.normal,3,v.FLOAT,!1,0,0)}object.hasUvs&&t.map&&(v.bindBuffer(v.ARRAY_BUFFER,object.__webglUvBuffer),v.bufferData(v.ARRAY_BUFFER,object.uvArray,v.DYNAMIC_DRAW),v.enableVertexAttribArray(e.attributes.uv),v.vertexAttribPointer(e.attributes.uv,2,v.FLOAT,!1,0,0)),object.hasColors&&t.vertexColors!==oe.NoColors&&(v.bindBuffer(v.ARRAY_BUFFER,object.__webglColorBuffer),v.bufferData(v.ARRAY_BUFFER,object.colorArray,v.DYNAMIC_DRAW),v.enableVertexAttribArray(e.attributes.color),v.vertexAttribPointer(e.attributes.color,3,v.FLOAT,!1,0,0)),v.drawArrays(v.TRIANGLES,0,object.count),object.count=0},this.renderBufferDirect=function(e,t,r,o,n,object){if(!1!==o.visible){var l,h,c,f,d=at(e,t,r,o,object),m=d.attributes,y=n.attributes,x=!1,_=o.wireframe?1:0,M=16777215*n.id+2*d.id+_;if(M!==P&&(P=M,x=!0),x&&ke(),object instanceof oe.Mesh)if(C=y.index){(L=n.offsets).length>1&&(x=!0);for(var i=0,w=L.length;i<w;i++){var A=L[i].index;if(x){for(h in m)c=m[h],l=y[h],c>=0&&(l?(f=l.itemSize,v.bindBuffer(v.ARRAY_BUFFER,l.buffer),Be(c),v.vertexAttribPointer(c,f,v.FLOAT,!1,0,A*f*4)):o.defaultAttributeValues&&(2===o.defaultAttributeValues[h].length?v.vertexAttrib2fv(c,o.defaultAttributeValues[h]):3===o.defaultAttributeValues[h].length&&v.vertexAttrib3fv(c,o.defaultAttributeValues[h])));v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,C.buffer)}v.drawElements(v.TRIANGLES,L[i].count,v.UNSIGNED_SHORT,2*L[i].start),S.info.render.calls++,S.info.render.vertices+=L[i].count,S.info.render.faces+=L[i].count/3}}else{if(x)for(h in m)"index"!==h&&(c=m[h],l=y[h],c>=0&&(l?(f=l.itemSize,v.bindBuffer(v.ARRAY_BUFFER,l.buffer),Be(c),v.vertexAttribPointer(c,f,v.FLOAT,!1,0,0)):o.defaultAttributeValues&&o.defaultAttributeValues[h]&&(2===o.defaultAttributeValues[h].length?v.vertexAttrib2fv(c,o.defaultAttributeValues[h]):3===o.defaultAttributeValues[h].length&&v.vertexAttrib3fv(c,o.defaultAttributeValues[h]))));var T=n.attributes.position;v.drawArrays(v.TRIANGLES,0,T.array.length/3),S.info.render.calls++,S.info.render.vertices+=T.array.length/3,S.info.render.faces+=T.array.length/3/3}else if(object instanceof oe.ParticleSystem){if(x)for(h in m)c=m[h],l=y[h],c>=0&&(l?(f=l.itemSize,v.bindBuffer(v.ARRAY_BUFFER,l.buffer),Be(c),v.vertexAttribPointer(c,f,v.FLOAT,!1,0,0)):o.defaultAttributeValues&&o.defaultAttributeValues[h]&&(2===o.defaultAttributeValues[h].length?v.vertexAttrib2fv(c,o.defaultAttributeValues[h]):3===o.defaultAttributeValues[h].length&&v.vertexAttrib3fv(c,o.defaultAttributeValues[h])));T=y.position;v.drawArrays(v.POINTS,0,T.array.length/3),S.info.render.calls++,S.info.render.points+=T.array.length/3}else if(object instanceof oe.Line){var C,E=object.type===oe.LineStrip?v.LINE_STRIP:v.LINES;if(ct(o.linewidth),C=y.index){var L;(L=n.offsets).length>1&&(x=!0);for(i=0,w=L.length;i<w;i++){A=L[i].index;x&&(Ie(o,m,y,A),v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,C.buffer)),v.drawElements(v.LINES,L[i].count,v.UNSIGNED_SHORT,2*L[i].start),S.info.render.calls++,S.info.render.vertices+=L[i].count}}else{x&&Ie(o,m,y,0);T=y.position;v.drawArrays(E,0,T.array.length/3),S.info.render.calls++,S.info.render.points+=T.array.length}}}},this.renderBuffer=function(e,t,r,o,n,object){if(!1!==o.visible){var l,i,h,c=at(e,t,r,o,object),f=c.attributes,d=!1,m=o.wireframe?1:0,y=16777215*n.id+2*c.id+m;if(y!==P&&(P=y,d=!0),d&&ke(),!o.morphTargets&&f.position>=0?d&&(v.bindBuffer(v.ARRAY_BUFFER,n.__webglVertexBuffer),Be(f.position),v.vertexAttribPointer(f.position,3,v.FLOAT,!1,0,0)):object.morphTargetBase&&function(e,t,object){var r=e.program.attributes;-1!==object.morphTargetBase&&r.position>=0?(v.bindBuffer(v.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[object.morphTargetBase]),Be(r.position),v.vertexAttribPointer(r.position,3,v.FLOAT,!1,0,0)):r.position>=0&&(v.bindBuffer(v.ARRAY_BUFFER,t.__webglVertexBuffer),Be(r.position),v.vertexAttribPointer(r.position,3,v.FLOAT,!1,0,0));if(object.morphTargetForcedOrder.length)for(var o=0,n=object.morphTargetForcedOrder,l=object.morphTargetInfluences;o<e.numSupportedMorphTargets&&o<n.length;)r["morphTarget"+o]>=0&&(v.bindBuffer(v.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[n[o]]),Be(r["morphTarget"+o]),v.vertexAttribPointer(r["morphTarget"+o],3,v.FLOAT,!1,0,0)),r["morphNormal"+o]>=0&&e.morphNormals&&(v.bindBuffer(v.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[n[o]]),Be(r["morphNormal"+o]),v.vertexAttribPointer(r["morphNormal"+o],3,v.FLOAT,!1,0,0)),object.__webglMorphTargetInfluences[o]=l[n[o]],o++;else{var h,i,c=[],f=(l=object.morphTargetInfluences).length;for(i=0;i<f;i++)(h=l[i])>0&&c.push([h,i]);c.length>e.numSupportedMorphTargets?(c.sort(He),c.length=e.numSupportedMorphTargets):c.length>e.numSupportedMorphNormals?c.sort(He):0===c.length&&c.push([0,0]);var d;for(o=0;o<e.numSupportedMorphTargets;)c[o]?(d=c[o][1],r["morphTarget"+o]>=0&&(v.bindBuffer(v.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[d]),Be(r["morphTarget"+o]),v.vertexAttribPointer(r["morphTarget"+o],3,v.FLOAT,!1,0,0)),r["morphNormal"+o]>=0&&e.morphNormals&&(v.bindBuffer(v.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[d]),Be(r["morphNormal"+o]),v.vertexAttribPointer(r["morphNormal"+o],3,v.FLOAT,!1,0,0)),object.__webglMorphTargetInfluences[o]=l[d]):object.__webglMorphTargetInfluences[o]=0,o++}null!==e.program.uniforms.morphTargetInfluences&&v.uniform1fv(e.program.uniforms.morphTargetInfluences,object.__webglMorphTargetInfluences)}(o,n,object),d){if(n.__webglCustomAttributesList)for(i=0,h=n.__webglCustomAttributesList.length;i<h;i++)f[(l=n.__webglCustomAttributesList[i]).buffer.belongsToAttribute]>=0&&(v.bindBuffer(v.ARRAY_BUFFER,l.buffer),Be(f[l.buffer.belongsToAttribute]),v.vertexAttribPointer(f[l.buffer.belongsToAttribute],l.size,v.FLOAT,!1,0,0));f.color>=0&&(object.geometry.colors.length>0||object.geometry.faces.length>0?(v.bindBuffer(v.ARRAY_BUFFER,n.__webglColorBuffer),Be(f.color),v.vertexAttribPointer(f.color,3,v.FLOAT,!1,0,0)):o.defaultAttributeValues&&v.vertexAttrib3fv(f.color,o.defaultAttributeValues.color)),f.normal>=0&&(v.bindBuffer(v.ARRAY_BUFFER,n.__webglNormalBuffer),Be(f.normal),v.vertexAttribPointer(f.normal,3,v.FLOAT,!1,0,0)),f.tangent>=0&&(v.bindBuffer(v.ARRAY_BUFFER,n.__webglTangentBuffer),Be(f.tangent),v.vertexAttribPointer(f.tangent,4,v.FLOAT,!1,0,0)),f.uv>=0&&(object.geometry.faceVertexUvs[0]?(v.bindBuffer(v.ARRAY_BUFFER,n.__webglUVBuffer),Be(f.uv),v.vertexAttribPointer(f.uv,2,v.FLOAT,!1,0,0)):o.defaultAttributeValues&&v.vertexAttrib2fv(f.uv,o.defaultAttributeValues.uv)),f.uv2>=0&&(object.geometry.faceVertexUvs[1]?(v.bindBuffer(v.ARRAY_BUFFER,n.__webglUV2Buffer),Be(f.uv2),v.vertexAttribPointer(f.uv2,2,v.FLOAT,!1,0,0)):o.defaultAttributeValues&&v.vertexAttrib2fv(f.uv2,o.defaultAttributeValues.uv2)),o.skinning&&f.skinIndex>=0&&f.skinWeight>=0&&(v.bindBuffer(v.ARRAY_BUFFER,n.__webglSkinIndicesBuffer),Be(f.skinIndex),v.vertexAttribPointer(f.skinIndex,4,v.FLOAT,!1,0,0),v.bindBuffer(v.ARRAY_BUFFER,n.__webglSkinWeightsBuffer),Be(f.skinWeight),v.vertexAttribPointer(f.skinWeight,4,v.FLOAT,!1,0,0)),f.lineDistance>=0&&(v.bindBuffer(v.ARRAY_BUFFER,n.__webglLineDistanceBuffer),Be(f.lineDistance),v.vertexAttribPointer(f.lineDistance,1,v.FLOAT,!1,0,0))}if(object instanceof oe.Mesh)o.wireframe?(ct(o.wireframeLinewidth),d&&v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,n.__webglLineBuffer),v.drawElements(v.LINES,n.__webglLineCount,v.UNSIGNED_SHORT,0)):(d&&v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,n.__webglFaceBuffer),v.drawElements(v.TRIANGLES,n.__webglFaceCount,v.UNSIGNED_SHORT,0)),S.info.render.calls++,S.info.render.vertices+=n.__webglFaceCount,S.info.render.faces+=n.__webglFaceCount/3;else if(object instanceof oe.Line){var x=object.type===oe.LineStrip?v.LINE_STRIP:v.LINES;ct(o.linewidth),v.drawArrays(x,0,n.__webglLineCount),S.info.render.calls++}else object instanceof oe.ParticleSystem&&(v.drawArrays(v.POINTS,0,n.__webglParticleCount),S.info.render.calls++,S.info.render.points+=n.__webglParticleCount)}},this.render=function(e,t,r,o){if(t instanceof oe.Camera!=!1){var i,n,l,object,h,c=e.__lights,f=e.fog;for(L=-1,le=!0,!0===e.autoUpdate&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),ee.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),J.setFromMatrix(ee),this.autoUpdateObjects&&this.initWebGLObjects(e),je(this.renderPluginsPre,e,t),S.info.render.calls=0,S.info.render.vertices=0,S.info.render.faces=0,S.info.render.points=0,this.setRenderTarget(r),(this.autoClear||o)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),i=0,n=(h=e.__webglObjects).length;i<n;i++)object=(l=h[i]).object,l.id=i,l.render=!1,object.visible&&((object instanceof oe.Mesh||object instanceof oe.ParticleSystem)&&object.frustumCulled&&!J.intersectsObject(object)||(st(object,t),qe(l),l.render=!0,!0===this.sortObjects&&(null!==object.renderDepth?l.z=object.renderDepth:(re.setFromMatrixPosition(object.matrixWorld),re.applyProjection(ee),l.z=re.z))));for(this.sortObjects&&h.sort(Ge),i=0,n=(h=e.__webglObjectsImmediate).length;i<n;i++)(object=(l=h[i]).object).visible&&(st(object,t),Ye(l));if(e.overrideMaterial){var d=e.overrideMaterial;this.setBlending(d.blending,d.blendEquation,d.blendSrc,d.blendDst),this.setDepthTest(d.depthTest),this.setDepthWrite(d.depthWrite),ut(d.polygonOffset,d.polygonOffsetFactor,d.polygonOffsetUnits),We(e.__webglObjects,!1,"",t,c,f,!0,d),Xe(e.__webglObjectsImmediate,"",t,c,f,!1,d)}else{d=null;this.setBlending(oe.NoBlending),We(e.__webglObjects,!0,"opaque",t,c,f,!1,d),Xe(e.__webglObjectsImmediate,"opaque",t,c,f,!1,d),We(e.__webglObjects,!1,"transparent",t,c,f,!0,d),Xe(e.__webglObjectsImmediate,"transparent",t,c,f,!0,d)}je(this.renderPluginsPost,e,t),r&&r.generateMipmaps&&r.minFilter!==oe.NearestFilter&&r.minFilter!==oe.LinearFilter&&function(e){e instanceof oe.WebGLRenderTargetCube?(v.bindTexture(v.TEXTURE_CUBE_MAP,e.__webglTexture),v.generateMipmap(v.TEXTURE_CUBE_MAP),v.bindTexture(v.TEXTURE_CUBE_MAP,null)):(v.bindTexture(v.TEXTURE_2D,e.__webglTexture),v.generateMipmap(v.TEXTURE_2D),v.bindTexture(v.TEXTURE_2D,null))}(r),this.setDepthTest(!0),this.setDepthWrite(!0)}else oe.onerror("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.renderImmediateObject=function(e,t,r,o,object){var n=at(e,t,r,o,object);P=-1,S.setMaterialFaces(o),object.immediateRenderCallback?object.immediateRenderCallback(n,v,J):object.render((function(object){S.renderBufferImmediate(object,n,o)}))},this.initWebGLObjects=function(e){for(e.__webglObjects||(e.__webglObjects=[],e.__webglObjectsImmediate=[],e.__webglSprites=[],e.__webglFlares=[]);e.__objectsAdded.length;)Ke(e.__objectsAdded[0],e),e.__objectsAdded.splice(0,1);for(;e.__objectsRemoved.length;)et(e.__objectsRemoved[0],e),e.__objectsRemoved.splice(0,1);for(var t=0,ol=e.__webglObjects.length;t<ol;t++){var object=e.__webglObjects[t].object;void 0===object.__webglInit&&(void 0!==object.__webglActive&&et(object,e),Ke(object,e)),Qe(object)}},this.initMaterial=function(e,t,r,object){var u,i,n,l,h,c,f;e.addEventListener("dispose",Te),e instanceof oe.MeshDepthMaterial?f="depth":e instanceof oe.MeshNormalMaterial?f="normal":e instanceof oe.MeshBasicMaterial?f="basic":e instanceof oe.MeshLambertMaterial?f="lambert":e instanceof oe.MeshPhongMaterial?f="phong":e instanceof oe.MeshPhysicalMaterial?f="physical":e instanceof oe.LineBasicMaterial?f="basic":e instanceof oe.LineDashedMaterial?f="dashed":e instanceof oe.ParticleSystemMaterial&&(f="particle_basic"),f&&function(e,t){e.uniforms=oe.UniformsUtils.clone(t.uniforms),e.vertexShader=t.vertexShader,e.fragmentShader=t.fragmentShader}(e,oe.ShaderLib[f]),l=function(e){for(var t=0,r=0,o=0,n=0,l=0,h=0,c=e.length;h<c;h++){var f=e[h];f.onlyShadow||!1===f.visible||(f instanceof oe.DirectionalLight&&t++,f instanceof oe.PointLight&&r++,f instanceof oe.SpotLight&&o++,f instanceof oe.HemisphereLight&&n++,f instanceof oe.AreaLight&&l++)}return{directional:t,point:r,spot:o,hemi:n,area:l}}(t),c=function(e){for(var t=0,r=0,o=e.length;r<o;r++){var n=e[r];n.castShadow&&(n instanceof oe.SpotLight&&t++,n instanceof oe.DirectionalLight&&!n.shadowCascade&&t++)}return t}(t),h=function(object){if(me&&object&&object.useVertexTexture)return 1024;var e=v.getParameter(v.MAX_VERTEX_UNIFORM_VECTORS),t=Math.floor((e-20)/4);return void 0!==object&&object instanceof oe.SkinnedMesh&&(t=Math.min(object.bones.length,t))<object.bones.length&&oe.onwarning("WebGLRenderer: too many bones - "+object.bones.length+", this GPU supports just "+t+" (try OpenGL instead of ANGLE)"),t}(object),n={map:!!e.map,opacityMap:!!e.opacityMap,envMap:!!e.envMap,diffuseEnvMap:!!e.diffuseEnvMap,lightMap:!!e.lightMap,emissiveMap:!!e.emissiveMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,reflectivityMap:!!e.reflectivityMap,roughnessMap:!!e.roughnessMap,translucencyMap:!!e.translucencyMap,metallicMap:!!e.metallicMap,falloffMap:!!e.falloffMap,clearCoat:void 0!==e.clearCoat&&0!==e.clearCoat,anisotropy:void 0!==e.anisotropy&&0!==e.anisotropy||!!e.anisotropyMap,anisotropyMap:!!e.anisotropyMap,anisotropyRotation:void 0!==e.anisotropyRotation&&0!==e.anisotropyRotation||!!e.anisotropyRotationMap,anisotropyRotationMap:!!e.anisotropyRotationMap,vertexColors:e.vertexColors,fog:r,useFog:e.fog,fogExp:r instanceof oe.FogExp2,sizeAttenuation:!!e.sizeAttenuation,skinning:e.skinning,maxBones:h,useVertexTexture:me&&object&&object.useVertexTexture,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:l.directional,maxPointLights:l.point,maxSpotLights:l.spot,maxHemiLights:l.hemi,maxAreaLights:l.area,maxShadows:c,shadowMapEnabled:this.shadowMapEnabled&&object.receiveShadow&&c>0,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,translucency:e.translucency&&e.translucency.getHex()>0,alphaTest:e.alphaTest,falloff:e.falloff||!1,wrapAround:e.wrapAround,doubleSided:e.side===oe.DoubleSide,flipSided:e.side===oe.BackSide},e.program=function(e,t,r,n,l,h,c,f){var p,d,m,y,code,x=[],M=[];e?(M.push(e),x.push(e)):(M.push(t),M.push(r));for(m in h)M.push(m),M.push(h[m]),x.push(m),x.push(h[m]);for(p in c)M.push(p),M.push(c[p]),x.push(p),x.push(c[p]);code=M.join();var w=x.join();for(p=0,d=A.length;p<d;p++){var C=A[p];if(C.code.length===code.length&&C.code===code)return C.usedTimes++,C.program}var E="SHADOWMAP_TYPE_BASIC";c.shadowMapType===oe.PCFShadowMap?E="SHADOWMAP_TYPE_PCF":c.shadowMapType===oe.PCFSoftShadowMap&&(E="SHADOWMAP_TYPE_PCF_SOFT");var L=function(e){var t,r,o=[];for(var n in e)!1!==(t=e[n])&&(r="#define "+n+" "+t,o.push(r));return o.join("\n")}(h);y=v.createProgram();var P=null!==_,R=["precision "+o+" float;","precision "+o+" int;",L,de?"#define VERTEX_TEXTURES":"",S.gammaInput?"#define GAMMA_INPUT":"",S.gammaOutput?"#define GAMMA_OUTPUT":"","#define MAX_DIR_LIGHTS "+c.maxDirLights,"#define MAX_POINT_LIGHTS "+c.maxPointLights,"#define MAX_SPOT_LIGHTS "+c.maxSpotLights,"#define MAX_HEMI_LIGHTS "+c.maxHemiLights,"#define MAX_AREA_LIGHTS "+c.maxAreaLights,"#define MAX_SHADOWS "+c.maxShadows,"#define MAX_BONES "+c.maxBones,c.map?"#define USE_MAP":"",c.opacityMap?"#define USE_OPACITYMAP":"",c.falloffMap?"#define USE_FALLOFFMAP":"",c.translucencyMap?"#define USE_TRANSLUCENCYMAP":"",c.envMap?"#define USE_ENVMAP":"",c.diffuseEnvMap?"#define USE_DIFFUSEENVMAP":"",c.lightMap?"#define USE_LIGHTMAP":"",c.emissiveMap?"#define USE_EMISSIVEMAP":"",c.bumpMap?"#define USE_BUMPMAP":"",c.reflectivityMap?"#define USE_REFLECTIVITYMAP":"",c.roughnessMap?"#define USE_ROUGHNESSMAP":"",c.metallicMap?"#define USE_METALLICMAP":"",c.normalMap?"#define USE_NORMALMAP":"",c.specularMap?"#define USE_SPECULARMAP":"",c.vertexColors?"#define USE_COLOR":"",c.clearCoat?"#define CLEARCOAT":"",c.anisotropy?"#define ANISOTROPY":"",c.anisotropyMap?"#define USE_ANISOTROPYMAP":"",c.anisotropy&&c.anisotropyRotation?"#define ANISOTROPYROTATION":"",c.anisotropy&&c.anisotropyRotationMap?"#define USE_ANISOTROPYROTATIONMAP":"",c.skinning?"#define USE_SKINNING":"",c.useVertexTexture?"#define BONE_TEXTURE":"",c.morphTargets?"#define USE_MORPHTARGETS":"",c.morphNormals?"#define USE_MORPHNORMALS":"",c.wrapAround?"#define WRAP_AROUND":"",c.doubleSided?"#define DOUBLE_SIDED":"",c.flipSided?"#define FLIP_SIDED":"",c.shadowMapEnabled?"#define USE_SHADOWMAP":"",c.shadowMapEnabled?"#define "+E:"",c.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",c.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",c.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","attribute vec3 morphTarget0;","attribute vec3 morphTarget1;","attribute vec3 morphTarget2;","attribute vec3 morphTarget3;","#ifdef USE_MORPHNORMALS","attribute vec3 morphNormal0;","attribute vec3 morphNormal1;","attribute vec3 morphNormal2;","attribute vec3 morphNormal3;","#else","attribute vec3 morphTarget4;","attribute vec3 morphTarget5;","attribute vec3 morphTarget6;","attribute vec3 morphTarget7;","#endif","#endif","#ifdef USE_SKINNING","attribute vec4 skinIndex;","attribute vec4 skinWeight;","#endif",""].join("\n"),D=["precision "+o+" float;","precision "+o+" int;",c.bumpMap||c.normalMap?"#extension GL_OES_standard_derivatives : enable":"",L,"#define MAX_DIR_LIGHTS "+c.maxDirLights,"#define MAX_POINT_LIGHTS "+c.maxPointLights,"#define MAX_SPOT_LIGHTS "+c.maxSpotLights,"#define MAX_HEMI_LIGHTS "+c.maxHemiLights,"#define MAX_AREA_LIGHTS "+c.maxAreaLights,"#define MAX_SHADOWS "+c.maxShadows,c.alphaTest?"#define ALPHATEST "+c.alphaTest:"",S.gammaInput?"#define GAMMA_INPUT":"",S.gammaOutput?"#define GAMMA_OUTPUT":"",c.useFog&&c.fog?"#define USE_FOG":"",c.useFog&&c.fogExp?"#define FOG_EXP2":"",c.map?"#define USE_MAP":"",c.opacityMap?"#define USE_OPACITYMAP":"",c.falloffMap?"#define USE_FALLOFFMAP":"",c.translucencyMap?"#define USE_TRANSLUCENCYMAP":"",c.envMap?"#define USE_ENVMAP":"",c.diffuseEnvMap?"#define USE_DIFFUSEENVMAP":"",c.lightMap?"#define USE_LIGHTMAP":"",c.emissiveMap?"#define USE_EMISSIVEMAP":"",c.bumpMap?"#define USE_BUMPMAP":"",c.reflectivityMap?"#define USE_REFLECTIVITYMAP":"",c.roughnessMap?"#define USE_ROUGHNESSMAP":"",c.metallicMap?"#define USE_METALLICMAP":"",c.normalMap?"#define USE_NORMALMAP":"",c.specularMap?"#define USE_SPECULARMAP":"",c.vertexColors?"#define USE_COLOR":"",c.clearCoat?"#define CLEARCOAT":"",c.translucency?"#define TRANSLUCENCY":"",c.anisotropy?"#define ANISOTROPY":"",c.anisotropyMap?"#define USE_ANISOTROPYMAP":"",c.anisotropy&&c.anisotropyRotation?"#define ANISOTROPYROTATION":"",c.anisotropy&&c.anisotropyRotationMap?"#define USE_ANISOTROPYROTATIONMAP":"",c.falloff?"#define FALLOFF":"",c.wrapAround?"#define WRAP_AROUND":"",c.doubleSided?"#define DOUBLE_SIDED":"",c.flipSided?"#define FLIP_SIDED":"",c.shadowMapEnabled?"#define USE_SHADOWMAP":"",c.shadowMapEnabled?"#define "+E:"",c.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",c.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",P?"#define TEXTURE_CUBE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n"),U=pt("vertex",R+r,e,w),F=pt("fragment",D+t,e,w);v.attachShader(y,U,code),v.attachShader(y,F,code),void 0!==f&&v.bindAttribLocation(y,0,f);v.linkProgram(y);var V,u,a,i,N=v.getProgramInfoLog(y);!1===v.getProgramParameter(y,v.LINK_STATUS)&&oe.onerror(e+" shader program error: "+v.getError()+"\n "+N,{programInfo:N,getProgramParameter_LINK_STATUS:v.getProgramParameter(y,v.LINK_STATUS),getProgramParameter_VALIDATE_STATUS:v.getProgramParameter(y,v.VALIDATE_STATUS),getProgramParameter_ATTACHED_SHADERS:v.getProgramParameter(y,v.ATTACHED_SHADERS),getProgramParameter_ACTIVE_ATTRIBUTES:v.getProgramParameter(y,v.ACTIVE_ATTRIBUTES),getProgramParameter_ACTIVE_UNIFORMS:v.getProgramParameter(y,v.ACTIVE_UNIFORMS),gl_MAX_VARYING_VECTORS:v.getParameter(v.MAX_VARYING_VECTORS),gl_MAX_VERTEX_ATTRIBS:v.getParameter(v.MAX_VERTEX_ATTRIBS),gl_MAX_VERTEX_UNIFORM_VECTORS:v.getParameter(v.MAX_VERTEX_UNIFORM_VECTORS),gl_MAX_VERTEX_TEXTURE_IMAGE_UNITS:v.getParameter(v.MAX_VERTEX_TEXTURE_IMAGE_UNITS),gl_MAX_FRAGMENT_UNIFORM_VECTORS:v.getParameter(v.MAX_FRAGMENT_UNIFORM_VECTORS),gl_MAX_TEXTURE_IMAGE_UNITS:v.getParameter(v.MAX_TEXTURE_IMAGE_UNITS)});v.deleteShader(F),v.deleteShader(U),y.uniforms={},y.attributes={},V=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences"],c.useVertexTexture?(V.push("boneTexture"),V.push("boneTextureWidth"),V.push("boneTextureHeight")):V.push("boneGlobalMatrices");for(u in n)V.push(u);for(function(e,t){var i,r,o;for(i=0,r=t.length;i<r;i++)o=t[i],e.uniforms[o]=v.getUniformLocation(e,o)}(y,V),V=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"],i=0;i<c.maxMorphTargets;i++)V.push("morphTarget"+i);for(i=0;i<c.maxMorphNormals;i++)V.push("morphNormal"+i);for(a in l)V.push(a);return function(e,t){var i,r,o;for(i=0,r=t.length;i<r;i++)o=t[i],e.attributes[o]=v.getAttribLocation(e,o)}(y,V),y.id=T++,A.push({program:y,code:code,usedTimes:1}),S.info.memory.programs=A.length,y}(f,e.fragmentShader,e.vertexShader,e.uniforms,e.attributes,e.defines,n,e.index0AttributeName);var d=e.program.attributes;if(e.morphTargets){e.numSupportedMorphTargets=0;var base="morphTarget";for(i=0;i<this.maxMorphTargets;i++)d[base+i]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;base="morphNormal";for(i=0;i<this.maxMorphNormals;i++)d[base+i]>=0&&e.numSupportedMorphNormals++}for(u in e.uniformsList=[],e.uniforms)e.uniformsList.push([e.uniforms[u],u])},this.setFaceCulling=function(e,t){e===oe.CullFaceNone?v.disable(v.CULL_FACE):(t===oe.FrontFaceDirectionCW?v.frontFace(v.CW):v.frontFace(v.CCW),e===oe.CullFaceBack?v.cullFace(v.BACK):e===oe.CullFaceFront?v.cullFace(v.FRONT):v.cullFace(v.FRONT_AND_BACK),v.enable(v.CULL_FACE))},this.setMaterialFaces=function(e){var t=e.side===oe.DoubleSide,r=e.side===oe.BackSide;U!==t&&(t?v.disable(v.CULL_FACE):v.enable(v.CULL_FACE),U=t),F!==r&&(r?v.frontFace(v.CW):v.frontFace(v.CCW),F=r)},this.setDepthTest=function(e){I!==e&&(e?v.enable(v.DEPTH_TEST):v.disable(v.DEPTH_TEST),I=e)},this.setDepthWrite=function(e){B!==e&&(v.depthMask(e),B=e)},this.setBlending=function(e,t,r,o){e!==V&&(e===oe.NoBlending?v.disable(v.BLEND):e===oe.AdditiveBlending?(v.enable(v.BLEND),v.blendEquation(v.FUNC_ADD),v.blendFunc(v.SRC_ALPHA,v.ONE)):e===oe.SubtractiveBlending?(v.enable(v.BLEND),v.blendEquation(v.FUNC_ADD),v.blendFunc(v.ZERO,v.ONE_MINUS_SRC_COLOR)):e===oe.MultiplyBlending?(v.enable(v.BLEND),v.blendEquation(v.FUNC_ADD),v.blendFunc(v.ZERO,v.SRC_COLOR)):e===oe.CustomBlending?v.enable(v.BLEND):(v.enable(v.BLEND),v.blendEquationSeparate(v.FUNC_ADD,v.FUNC_ADD),v.blendFuncSeparate(v.SRC_ALPHA,v.ONE_MINUS_SRC_ALPHA,v.ONE,v.ONE_MINUS_SRC_ALPHA)),V=e),e===oe.CustomBlending?(t!==N&&(v.blendEquation(bt(t)),N=t),r===O&&o===z||(v.blendFunc(bt(r),bt(o)),O=r,z=o)):(N=null,O=null,z=null)},this.setTexture=function(e,slot){if(e.needsUpdate){e.__webglInit||(e.__webglInit=!0,e.addEventListener("dispose",Se),e.__webglTexture=v.createTexture(),S.info.memory.textures++),v.activeTexture(v.TEXTURE0+slot),v.bindTexture(v.TEXTURE_2D,e.__webglTexture),v.pixelStorei(v.UNPACK_FLIP_Y_WEBGL,e.flipY),v.pixelStorei(v.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),v.pixelStorei(v.UNPACK_ALIGNMENT,e.unpackAlignment);var image=e.image,t=oe.Math.isPowerOfTwo(image.width)&&oe.Math.isPowerOfTwo(image.height),r=bt(e.format),o=bt(e.type);mt(v.TEXTURE_2D,e,t);var n,l=e.mipmaps;if(e instanceof oe.DataTexture)if(l.length>0&&t){for(var i=0,h=l.length;i<h;i++)n=l[i],v.texImage2D(v.TEXTURE_2D,i,r,n.width,n.height,0,r,o,n.data);e.generateMipmaps=!1}else v.texImage2D(v.TEXTURE_2D,0,r,image.width,image.height,0,r,o,image.data);else if(e instanceof oe.CompressedTexture)for(i=0,h=l.length;i<h;i++)n=l[i],e.format!==oe.RGBAFormat?v.compressedTexImage2D(v.TEXTURE_2D,i,r,n.width,n.height,0,n.data):v.texImage2D(v.TEXTURE_2D,i,r,n.width,n.height,0,r,o,n.data);else if(l.length>0&&t){for(i=0,h=l.length;i<h;i++)n=l[i],v.texImage2D(v.TEXTURE_2D,i,r,r,o,n);e.generateMipmaps=!1}else v.texImage2D(v.TEXTURE_2D,0,r,r,o,e.image);e.generateMipmaps&&t&&v.generateMipmap(v.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else v.activeTexture(v.TEXTURE0+slot),v.bindTexture(v.TEXTURE_2D,e.__webglTexture)},this.setRenderTarget=function(e){var t,r,o,n,l,h=e instanceof oe.WebGLRenderTargetCube;if(e&&!e.__webglFramebuffer){void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.addEventListener("dispose",Ae),e.__webglTexture=v.createTexture(),S.info.memory.textures++;var c=oe.Math.isPowerOfTwo(e.width)&&oe.Math.isPowerOfTwo(e.height),f=bt(e.format),d=bt(e.type);if(h){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],v.bindTexture(v.TEXTURE_CUBE_MAP,e.__webglTexture),mt(v.TEXTURE_CUBE_MAP,e,c);for(var i=0;i<6;i++)e.__webglFramebuffer[i]=v.createFramebuffer(),e.__webglRenderbuffer[i]=v.createRenderbuffer(),v.texImage2D(v.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,f,e.width,e.height,0,f,d,null),xt(e.__webglFramebuffer[i],e,v.TEXTURE_CUBE_MAP_POSITIVE_X+i),_t(e.__webglRenderbuffer[i],e);c&&v.generateMipmap(v.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=v.createFramebuffer(),e.shareDepthFrom?e.__webglRenderbuffer=e.shareDepthFrom.__webglRenderbuffer:e.__webglRenderbuffer=v.createRenderbuffer(),v.bindTexture(v.TEXTURE_2D,e.__webglTexture),mt(v.TEXTURE_2D,e,c),v.texImage2D(v.TEXTURE_2D,0,f,e.width,e.height,0,f,d,null),xt(e.__webglFramebuffer,e,v.TEXTURE_2D),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?v.framebufferRenderbuffer(v.FRAMEBUFFER,v.DEPTH_ATTACHMENT,v.RENDERBUFFER,e.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&v.framebufferRenderbuffer(v.FRAMEBUFFER,v.DEPTH_STENCIL_ATTACHMENT,v.RENDERBUFFER,e.__webglRenderbuffer):_t(e.__webglRenderbuffer,e),c&&v.generateMipmap(v.TEXTURE_2D);h?v.bindTexture(v.TEXTURE_CUBE_MAP,null):v.bindTexture(v.TEXTURE_2D,null),v.bindRenderbuffer(v.RENDERBUFFER,null),v.bindFramebuffer(v.FRAMEBUFFER,null)}e?(t=h?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,r=e.width,o=e.height,n=0,l=0):(t=null,r=Y,o=K,n=W,l=X),t!==E&&(v.bindFramebuffer(v.FRAMEBUFFER,t),v.viewport(n,l,r,o),E=t),$=r,Q=o},this.shadowMapPlugin=new oe.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin),this.addPostPlugin(new oe.SpritePlugin),this.addPostPlugin(new oe.LensFlarePlugin)},oe.WebGLRenderTarget=function(e,t,r){this.width=e,this.height=t,r=r||{},this.wrapS=void 0!==r.wrapS?r.wrapS:oe.ClampToEdgeWrapping,this.wrapT=void 0!==r.wrapT?r.wrapT:oe.ClampToEdgeWrapping,this.magFilter=void 0!==r.magFilter?r.magFilter:oe.LinearFilter,this.minFilter=void 0!==r.minFilter?r.minFilter:oe.LinearMipMapLinearFilter,this.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,this.offset=new oe.Vector2(0,0),this.repeat=new oe.Vector2(1,1),this.format=void 0!==r.format?r.format:oe.RGBAFormat,this.type=void 0!==r.type?r.type:oe.UnsignedByteType,this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0===r.stencilBuffer||r.stencilBuffer,this.generateMipmaps=!0,this.shareDepthFrom=null},oe.WebGLRenderTarget.prototype={constructor:oe.WebGLRenderTarget,clone:function(){var e=new oe.WebGLRenderTarget(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e.shareDepthFrom=this.shareDepthFrom,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},oe.EventDispatcher.prototype.apply(oe.WebGLRenderTarget.prototype),oe.WebGLRenderTargetCube=function(e,t,r){oe.WebGLRenderTarget.call(this,e,t,r),this.activeCubeFace=0},oe.WebGLRenderTargetCube.prototype=Object.create(oe.WebGLRenderTarget.prototype),oe.RenderableVertex=function(){this.position=new oe.Vector3,this.positionWorld=new oe.Vector3,this.positionScreen=new oe.Vector4,this.visible=!0},oe.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},oe.RenderableFace=function(){this.id=0,this.v1=new oe.RenderableVertex,this.v2=new oe.RenderableVertex,this.v3=new oe.RenderableVertex,this.centroidModel=new oe.Vector3,this.normalModel=new oe.Vector3,this.vertexNormalsModel=[new oe.Vector3,new oe.Vector3,new oe.Vector3],this.vertexNormalsLength=0,this.color=null,this.material=null,this.uvs=[[]],this.z=0},oe.RenderableObject=function(){this.id=0,this.object=null,this.z=0},oe.RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new oe.Vector2,this.material=null},oe.RenderableLine=function(){this.id=0,this.v1=new oe.RenderableVertex,this.v2=new oe.RenderableVertex,this.vertexColors=[new oe.Color,new oe.Color],this.material=null,this.z=0},oe.GeometryUtils={merge:function(e,t,r){var o,n,l=e.vertices.length,h=(e.faceVertexUvs[0].length,t instanceof oe.Mesh?t.geometry:t),c=e.vertices,f=h.vertices,d=e.faces,m=h.faces,v=e.faceVertexUvs[0],y=h.faceVertexUvs[0];void 0===r&&(r=0),t instanceof oe.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),o=t.matrix,n=(new oe.Matrix3).getNormalMatrix(o));for(var i=0,x=f.length;i<x;i++){var _=f[i].clone();o&&_.applyMatrix4(o),c.push(_)}for(i=0,x=m.length;i<x;i++){var M,w,S,A=m[i],T=A.vertexNormals,C=A.vertexColors;(M=new oe.Face3(A.a+l,A.b+l,A.c+l)).normal.copy(A.normal),n&&M.normal.applyMatrix3(n).normalize();for(var E=0,L=T.length;E<L;E++)w=T[E].clone(),n&&w.applyMatrix3(n).normalize(),M.vertexNormals.push(w);M.color.copy(A.color);for(E=0,L=C.length;E<L;E++)S=C[E],M.vertexColors.push(S.clone());M.materialIndex=A.materialIndex+r,M.centroid.copy(A.centroid),o&&M.centroid.applyMatrix4(o),d.push(M)}for(i=0,x=y.length;i<x;i++){var P=y[i],R=[];for(E=0,L=P.length;E<L;E++)R.push(new oe.Vector2(P[E].x,P[E].y));v.push(R)}},randomPointInTriangle:function(){var e=new oe.Vector3;return function(t,r,o){var n=new oe.Vector3,a=oe.Math.random16(),b=oe.Math.random16();a+b>1&&(a=1-a,b=1-b);var l=1-a-b;return n.copy(t),n.multiplyScalar(a),e.copy(r),e.multiplyScalar(b),n.add(e),e.copy(o),e.multiplyScalar(l),n.add(e),n}}(),randomPointInFace:function(e,t,r){var o,n,l;return o=t.vertices[e.a],n=t.vertices[e.b],l=t.vertices[e.c],oe.GeometryUtils.randomPointInTriangle(o,n,l)},randomPointsInGeometry:function(e,t){var r,i,o,n,l,h=e.faces,c=e.vertices,f=h.length,d=0,m=[];for(i=0;i<f;i++)o=c[(r=h[i]).a],n=c[r.b],l=c[r.c],r._area=oe.GeometryUtils.triangleArea(o,n,l),d+=r._area,m[i]=d;var v,y,x,_=[],M={};for(i=0;i<t;i++)v=oe.Math.random16()*d,x=v,y=function e(t,r){if(r<t)return t;var o=t+Math.floor((r-t)/2);return m[o]>x?e(t,o-1):m[o]<x?e(o+1,r):o}(0,m.length-1),_[i]=oe.GeometryUtils.randomPointInFace(h[y],e,!0),M[y]?M[y]+=1:M[y]=1;return _},triangleArea:(j=new oe.Vector3,W=new oe.Vector3,function(e,t,r){return j.subVectors(t,e),W.subVectors(r,e),j.cross(W),.5*j.length()}),center:function(e){e.computeBoundingBox();var t=e.boundingBox,r=new oe.Vector3;return r.addVectors(t.min,t.max),r.multiplyScalar(-.5),e.applyMatrix((new oe.Matrix4).makeTranslation(r.x,r.y,r.z)),e.computeBoundingBox(),r},triangulateQuads:function(e){var i,t,r,o,n=[],l=[];for(i=0,t=e.faceVertexUvs.length;i<t;i++)l[i]=[];for(i=0,t=e.faces.length;i<t;i++){var h=e.faces[i];for(n.push(h),r=0,o=e.faceVertexUvs.length;r<o;r++)l[r].push(e.faceVertexUvs[r][i])}e.faces=n,e.faceVertexUvs=l,e.computeCentroids(),e.computeFaceNormals(),e.computeVertexNormals(),e.hasTangents&&e.computeTangents()}},oe.ImageUtils={crossOrigin:void 0,loadTexture:function(e,t,r,o){var n=new oe.ImageLoader;n.crossOrigin=this.crossOrigin;var l=new oe.Texture(void 0,t),image=n.load(e,(function(){l.needsUpdate=!0,r&&r(l)}));return l.image=image,l.sourceFile=e,l},loadCompressedTexture:function(e,t,r,o){var n=new oe.CompressedTexture;n.mapping=t;var l=new XMLHttpRequest;return l.onload=function(){var e=l.response,t=oe.ImageUtils.parseDDS(e,!0);n.format=t.format,n.mipmaps=t.mipmaps,n.image.width=t.width,n.image.height=t.height,n.generateMipmaps=!1,n.needsUpdate=!0,r&&r(n)},l.onerror=o,l.open("GET",e,!0),l.responseType="arraybuffer",l.send(null),n},loadTextureCube:function(e,t,r,o){var n=[];n.loadCount=0;var l=new oe.Texture;l.image=n,void 0!==t&&(l.mapping=t),l.flipY=!1;for(var i=0,h=e.length;i<h;++i){var c=new Image;n[i]=c,c.onload=function(){n.loadCount+=1,6===n.loadCount&&(l.needsUpdate=!0,r&&r(l))},c.onerror=o,c.crossOrigin=this.crossOrigin,c.src=e[i]}return l},loadCompressedTextureCube:function(e,t,r,o){var n=[];n.loadCount=0;var l=new oe.CompressedTexture;l.image=n,void 0!==t&&(l.mapping=t),l.flipY=!1,l.generateMipmaps=!1;var h=function(e,img){return function(){var t=e.response,o=oe.ImageUtils.parseDDS(t,!0);img.format=o.format,img.mipmaps=o.mipmaps,img.width=o.width,img.height=o.height,n.loadCount+=1,6===n.loadCount&&(l.format=o.format,l.needsUpdate=!0,r&&r(l))}};if(e instanceof Array)for(var i=0,c=e.length;i<c;++i){var f={};n[i]=f,(m=new XMLHttpRequest).onload=h(m,f),m.onerror=o;var d=e[i];m.open("GET",d,!0),m.responseType="arraybuffer",m.send(null)}else{var m;d=e;(m=new XMLHttpRequest).onload=function(){var e=m.response,t=oe.ImageUtils.parseDDS(e,!0);if(t.isCubemap){for(var o=t.mipmaps.length/t.mipmapCount,h=0;h<o;h++){n[h]={mipmaps:[]};for(var i=0;i<t.mipmapCount;i++)n[h].mipmaps.push(t.mipmaps[h*t.mipmapCount+i]),n[h].format=t.format,n[h].width=t.width,n[h].height=t.height}l.format=t.format,l.needsUpdate=!0,r&&r(l)}},m.onerror=o,m.open("GET",d,!0),m.responseType="arraybuffer",m.send(null)}return l},loadDDSTexture:function(e,t,r,o){var n=[];n.loadCount=0;var l=new oe.CompressedTexture;l.image=n,void 0!==t&&(l.mapping=t),l.flipY=!1,l.generateMipmaps=!1;var h=new XMLHttpRequest;return h.onload=function(){var e=h.response,t=oe.ImageUtils.parseDDS(e,!0);if(t.isCubemap)for(var o=t.mipmaps.length/t.mipmapCount,c=0;c<o;c++){n[c]={mipmaps:[]};for(var i=0;i<t.mipmapCount;i++)n[c].mipmaps.push(t.mipmaps[c*t.mipmapCount+i]),n[c].format=t.format,n[c].width=t.width,n[c].height=t.height}else l.image.width=t.width,l.image.height=t.height,l.mipmaps=t.mipmaps;l.format=t.format,l.needsUpdate=!0,r&&r(l)},h.onerror=o,h.open("GET",e,!0),h.responseType="arraybuffer",h.send(null),l},parseDDS:function(e,t){var r={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};function o(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function n(e,t,r,o){for(var n=r*o*4,l=new Uint8Array(e,t,n),h=new Uint8Array(n),c=0,f=0,d=0;d<o;d++)for(var m=0;m<r;m++){var b=l[f],g=l[++f],v=l[++f],a=l[++f];f++,h[c]=v,h[++c]=g,h[++c]=b,h[++c]=a,c++}return h}var l,h=o("DXT1"),c=o("DXT3"),f=o("DXT5"),header=new Int32Array(e,0,31);if(542327876!==header[0])return oe.onerror("ImageUtils.parseDDS(): Invalid magic number in DDS header"),r;if(4&!header[20])return oe.onerror("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code"),r;var d,m=header[21],v=!1;switch(m){case h:l=8,r.format=oe.RGB_S3TC_DXT1_Format;break;case c:l=16,r.format=oe.RGBA_S3TC_DXT3_Format;break;case f:l=16,r.format=oe.RGBA_S3TC_DXT5_Format;break;default:if(!(32==header[22]&&16711680&header[23]&&65280&header[24]&&255&header[25]&&4278190080&header[26]))return oe.onerror("ImageUtils.parseDDS(): Unsupported FourCC code: ",(d=m,String.fromCharCode(255&d,d>>8&255,d>>16&255,d>>24&255))),r;v=!0,l=64,r.format=oe.RGBAFormat}r.mipmapCount=1,131072&header[2]&&!1!==t&&(r.mipmapCount=Math.max(1,header[7])),r.isCubemap=!!(512&header[28]),r.width=header[4],r.height=header[3];for(var y=header[1]+4,x=r.width,_=r.height,M=r.isCubemap?6:1,w=0;w<M;w++){for(var i=0;i<r.mipmapCount;i++){if(v)var S=(A=n(e,y,x,_)).length;else{S=Math.max(4,x)/4*Math.max(4,_)/4*l;var A=new Uint8Array(e,y,S)}var T={data:A,width:x,height:_};r.mipmaps.push(T),y+=S,x=Math.max(.5*x,1),_=Math.max(.5*_,1)}x=r.width,_=r.height}return r},getNormalMap:function(image,e){var t=function(a,b){return[a[0]-b[0],a[1]-b[1],a[2]-b[2]]},r=function(a){var e=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);return[a[0]/e,a[1]/e,a[2]/e]};e|=1;var o=image.width,n=image.height,canvas=document.createElement("canvas");canvas.width=o,canvas.height=n;var l=canvas.getContext("2d");l.drawImage(image,0,0);for(var a,b,data=l.getImageData(0,0,o,n).data,h=l.createImageData(o,n),output=h.data,c=0;c<o;c++)for(var f=0;f<n;f++){var d=f-1<0?0:f-1,m=f+1>n-1?n-1:f+1,v=c-1<0?0:c-1,y=c+1>o-1?o-1:c+1,x=[],_=[0,0,data[4*(f*o+c)]/255*e];x.push([-1,0,data[4*(f*o+v)]/255*e]),x.push([-1,-1,data[4*(d*o+v)]/255*e]),x.push([0,-1,data[4*(d*o+c)]/255*e]),x.push([1,-1,data[4*(d*o+y)]/255*e]),x.push([1,0,data[4*(f*o+y)]/255*e]),x.push([1,1,data[4*(m*o+y)]/255*e]),x.push([0,1,data[4*(m*o+c)]/255*e]),x.push([-1,1,data[4*(m*o+v)]/255*e]);for(var M=[],w=x.length,i=0;i<w;i++){var S=x[i],A=x[(i+1)%w];S=t(S,_),A=t(A,_),M.push(r((b=A,[(a=S)[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]])))}var T=[0,0,0];for(i=0;i<M.length;i++)T[0]+=M[i][0],T[1]+=M[i][1],T[2]+=M[i][2];T[0]/=M.length,T[1]/=M.length,T[2]/=M.length;var C=4*(f*o+c);output[C]=(T[0]+1)/2*255|0,output[C+1]=(T[1]+1)/2*255|0,output[C+2]=255*T[2]|0,output[C+3]=255}return l.putImageData(h,0,0),canvas},generateDataTexture:function(e,t,r){for(var o=e*t,data=new Uint8Array(3*o),n=Math.floor(255*r.r),g=Math.floor(255*r.g),b=Math.floor(255*r.b),i=0;i<o;i++)data[3*i]=n,data[3*i+1]=g,data[3*i+2]=b;var l=new oe.DataTexture(data,e,t,oe.RGBFormat);return l.needsUpdate=!0,l}},oe.SceneUtils={createMultiMaterialObject:function(e,t){for(var r=new oe.Object3D,i=0,o=t.length;i<o;i++)r.add(new oe.Mesh(e,t[i]));return r},detach:function(e,t,r){e.applyMatrix(t.matrixWorld),t.remove(e),r.add(e)},attach:function(e,t,r){var o=new oe.Matrix4;o.getInverse(r.matrixWorld),e.applyMatrix(o),t.remove(e),r.add(e)}},oe.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(data){var e=data.familyName.toLowerCase();this.faces[e]=this.faces[e]||{},this.faces[e][data.cssFontWeight]=this.faces[e][data.cssFontWeight]||{},this.faces[e][data.cssFontWeight][data.cssFontStyle]=data;this.faces[e][data.cssFontWeight][data.cssFontStyle]=data;return data},drawText:function(text){var i,e=this.getFace(),t=this.size/e.resolution,r=0,o=String(text).split(""),n=o.length,l=[];for(i=0;i<n;i++){var path=new oe.Path,h=this.extractGlyphPoints(o[i],e,t,r,path);r+=h.offset,l.push(h.path)}return{paths:l,offset:r/2}},extractGlyphPoints:function(e,t,r,o,path){var i,n,l,h,c,f,d,m,v,y,x,_,M,w,S,A,T,C,E=[],glyph=t.glyphs[e]||t.glyphs["?"];if(glyph){if(glyph.o)for(c=(h=glyph._cachedOutline||(glyph._cachedOutline=glyph.o.split(" "))).length,f=r,d=r,i=0;i<c;)switch(h[i++]){case"m":m=h[i++]*f+o,v=h[i++]*d,path.moveTo(m,v);break;case"l":m=h[i++]*f+o,v=h[i++]*d,path.lineTo(m,v);break;case"q":if(y=h[i++]*f+o,x=h[i++]*d,w=h[i++]*f+o,S=h[i++]*d,path.quadraticCurveTo(w,S,y,x),C=E[E.length-1])for(_=C.x,M=C.y,n=1,l=this.divisions;n<=l;n++){var L=n/l;oe.Shape.Utils.b2(L,_,w,y),oe.Shape.Utils.b2(L,M,S,x)}break;case"b":if(y=h[i++]*f+o,x=h[i++]*d,w=h[i++]*f+o,S=h[i++]*-d,A=h[i++]*f+o,T=h[i++]*-d,path.bezierCurveTo(y,x,w,S,A,T),C=E[E.length-1])for(_=C.x,M=C.y,n=1,l=this.divisions;n<=l;n++)L=n/l,oe.Shape.Utils.b3(L,_,w,A,y),oe.Shape.Utils.b3(L,M,S,T,x)}return{offset:glyph.ha*r,path:path}}}},oe.FontUtils.generateShapes=function(text,e){var t=void 0!==(e=e||{}).size?e.size:100,r=void 0!==e.curveSegments?e.curveSegments:4,o=void 0!==e.font?e.font:"helvetiker",n=void 0!==e.weight?e.weight:"normal",style=void 0!==e.style?e.style:"normal";oe.FontUtils.size=t,oe.FontUtils.divisions=r,oe.FontUtils.face=o,oe.FontUtils.weight=n,oe.FontUtils.style=style;for(var l=oe.FontUtils.drawText(text).paths,h=[],p=0,c=l.length;p<c;p++)Array.prototype.push.apply(h,l[p].toShapes());return h},X=oe.FontUtils,area=function(e){for(var t=e.length,a=0,p=t-1,q=0;q<t;p=q++)a+=e[p].x*e[q].y-e[q].x*e[p].y;return.5*a},Y=function(e,u,t,r,o,n){var p,l,h,c,f,d,m,v,y,x,_,M,w,S,A;if(l=e[n[u]].x,h=e[n[u]].y,c=e[n[t]].x,f=e[n[t]].y,d=e[n[r]].x,1e-10>(c-l)*((m=e[n[r]].y)-h)-(f-h)*(d-l))return!1;for(x=d-c,_=m-f,M=l-d,w=h-m,S=c-l,A=f-h,p=0;p<o;p++)if(v=e[n[p]].x,y=e[n[p]].y,!(v===l&&y===h||v===c&&y===f||v===d&&y===m)&&x*(y-f)-_*(v-c)>=-1e-10&&M*(y-m)-w*(v-d)>=-1e-10&&S*(y-h)-A*(v-l)>=-1e-10)return!1;return!0},X.Triangulate=function(e,t){var r=e.length;if(r<3)return null;var u,o,n,l=[],h=[],c=[];if(area(e)>0)for(o=0;o<r;o++)h[o]=o;else for(o=0;o<r;o++)h[o]=r-1-o;var f=r,d=2*f;for(o=f-1;f>2;){if(d--<=0)return oe.onwarning("Warning, unable to triangulate polygon!"),t?c:l;if(f<=(u=o)&&(u=0),f<=(o=u+1)&&(o=0),f<=(n=o+1)&&(n=0),Y(e,u,o,n,f,h)){var a,b,m,s,v;for(a=h[u],b=h[o],m=h[n],l.push([e[a],e[b],e[m]]),c.push([h[u],h[o],h[n]]),s=o,v=o+1;v<f;s++,v++)h[s]=h[v];d=2*--f}}return t?c:l},X.Triangulate.area=area,ae._typeface_js={faces:oe.FontUtils.faces,loadFace:oe.FontUtils.loadFace},oe.typeface_js=ae._typeface_js,oe.Curve=function(){},oe.Curve.prototype.getPoint=function(e){return oe.onwarning("Warning, getPoint() not implemented!"),null},oe.Curve.prototype.getPointAt=function(u){var e=this.getUtoTmapping(u);return this.getPoint(e)},oe.Curve.prototype.getPoints=function(e){e||(e=5);var t,r=[];for(t=0;t<=e;t++)r.push(this.getPoint(t/e));return r},oe.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,r=[];for(t=0;t<=e;t++)r.push(this.getPointAt(t/e));return r},oe.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},oe.Curve.prototype.getLengths=function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,p,r=[],o=this.getPoint(0),n=0;for(r.push(0),p=1;p<=e;p++)n+=(t=this.getPoint(p/e)).distanceTo(o),r.push(n),o=t;return this.cacheArcLengths=r,r},oe.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},oe.Curve.prototype.getUtoTmapping=function(u,e){var t,r=this.getLengths(),i=0,o=r.length;t=e||u*r[o-1];for(var n,l=0,h=o-1;l<=h;)if((n=r[i=Math.floor(l+(h-l)/2)]-t)<0)l=i+1;else{if(!(n>0)){h=i;break}h=i-1}if(r[i=h]==t)return i/(o-1);var c=r[i];return(i+(t-c)/(r[i+1]-c))/(o-1)},oe.Curve.prototype.getTangent=function(e){var t=e-1e-4,r=e+1e-4;t<0&&(t=0),r>1&&(r=1);var o=this.getPoint(t);return this.getPoint(r).clone().sub(o).normalize()},oe.Curve.prototype.getTangentAt=function(u){var e=this.getUtoTmapping(u);return this.getTangent(e)},oe.Curve.Utils={tangentQuadraticBezier:function(e,t,r,o){return 2*(1-e)*(r-t)+2*e*(o-r)},tangentCubicBezier:function(e,t,r,o,n){return-3*t*(1-e)*(1-e)+3*r*(1-e)*(1-e)-6*e*r*(1-e)+6*e*o*(1-e)-3*e*e*o+3*e*e*n},tangentSpline:function(e,t,r,o,n){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},interpolate:function(e,t,r,o,n){var l=.5*(r-e),h=.5*(o-t),c=n*n;return(2*t-2*r+l+h)*(n*c)+(-3*t+3*r-2*l-h)*c+l*n+t}},oe.Curve.create=function(e,t){return e.prototype=Object.create(oe.Curve.prototype),e.prototype.getPoint=t,e},oe.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},oe.CurvePath.prototype=Object.create(oe.Curve.prototype),oe.CurvePath.prototype.add=function(e){this.curves.push(e)},oe.CurvePath.prototype.checkConnection=function(){},oe.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new oe.LineCurve(t,e))},oe.CurvePath.prototype.getPoint=function(e){for(var t,r=e*this.getLength(),o=this.getCurveLengths(),i=0;i<o.length;){if(o[i]>=r){var u=1-(o[i]-r)/(t=this.curves[i]).getLength();return t.getPointAt(u)}i++}return null},oe.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},oe.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var i,e=[],t=0,r=this.curves.length;for(i=0;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e},oe.CurvePath.prototype.getBoundingBox=function(){var e,t,r,o,n,l,p,i,h,c,f=this.getPoints();e=t=Number.NEGATIVE_INFINITY,o=n=Number.POSITIVE_INFINITY;var d=f[0]instanceof oe.Vector3;for(c=d?new oe.Vector3:new oe.Vector2,i=0,h=f.length;i<h;i++)(p=f[i]).x>e?e=p.x:p.x<o&&(o=p.x),p.y>t?t=p.y:p.y<n&&(n=p.y),d&&(p.z>r?r=p.z:p.z<l&&(l=p.z)),c.add(p);var m={minX:o,minY:n,maxX:e,maxY:t,centroid:c.divideScalar(h)};return d&&(m.maxZ=r,m.minZ=l),m},oe.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,!0);return this.createGeometry(t)},oe.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,!0);return this.createGeometry(t)},oe.CurvePath.prototype.createGeometry=function(e){for(var t=new oe.Geometry,i=0;i<e.length;i++)t.vertices.push(new oe.Vector3(e[i].x,e[i].y,e[i].z||0));return t},oe.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},oe.CurvePath.prototype.getTransformedPoints=function(e,t){var i,r,o=this.getPoints(e);for(t||(t=this.bends),i=0,r=t.length;i<r;i++)o=this.getWrapPoints(o,t[i]);return o},oe.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var i,r,o=this.getSpacedPoints(e);for(t||(t=this.bends),i=0,r=t.length;i<r;i++)o=this.getWrapPoints(o,t[i]);return o},oe.CurvePath.prototype.getWrapPoints=function(e,path){var i,t,p,r,o,n,l=this.getBoundingBox();for(i=0,t=e.length;i<t;i++){r=(p=e[i]).x,o=p.y,n=r/l.maxX,n=path.getUtoTmapping(n,r);var h=path.getPoint(n),c=path.getTangent(n);c.set(-c.y,c.x).multiplyScalar(o),p.x=h.x+c.x,p.y=h.y+c.y}return e},oe.Gyroscope=function(){oe.Object3D.call(this)},oe.Gyroscope.prototype=Object.create(oe.Object3D.prototype),oe.Gyroscope.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.quaternionWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.quaternionObject,this.scaleObject),this.matrixWorld.compose(this.translationWorld,this.quaternionObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var i=0,t=this.children.length;i<t;i++)this.children[i].updateMatrixWorld(e)},oe.Gyroscope.prototype.translationWorld=new oe.Vector3,oe.Gyroscope.prototype.translationObject=new oe.Vector3,oe.Gyroscope.prototype.quaternionWorld=new oe.Quaternion,oe.Gyroscope.prototype.quaternionObject=new oe.Quaternion,oe.Gyroscope.prototype.scaleWorld=new oe.Vector3,oe.Gyroscope.prototype.scaleObject=new oe.Vector3,oe.Path=function(e){oe.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},oe.Path.prototype=Object.create(oe.CurvePath.prototype),oe.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},oe.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y)},oe.Path.prototype.moveTo=function(e,t){var r=Array.prototype.slice.call(arguments);this.actions.push({action:oe.PathActions.MOVE_TO,args:r})},oe.Path.prototype.lineTo=function(e,t){var r=Array.prototype.slice.call(arguments),o=this.actions[this.actions.length-1].args,n=o[o.length-2],l=o[o.length-1],h=new oe.LineCurve(new oe.Vector2(n,l),new oe.Vector2(e,t));this.curves.push(h),this.actions.push({action:oe.PathActions.LINE_TO,args:r})},oe.Path.prototype.quadraticCurveTo=function(e,t,r,o){var n=Array.prototype.slice.call(arguments),l=this.actions[this.actions.length-1].args,h=l[l.length-2],c=l[l.length-1],f=new oe.QuadraticBezierCurve(new oe.Vector2(h,c),new oe.Vector2(e,t),new oe.Vector2(r,o));this.curves.push(f),this.actions.push({action:oe.PathActions.QUADRATIC_CURVE_TO,args:n})},oe.Path.prototype.bezierCurveTo=function(e,t,r,o,n,l){var h=Array.prototype.slice.call(arguments),c=this.actions[this.actions.length-1].args,f=c[c.length-2],d=c[c.length-1],m=new oe.CubicBezierCurve(new oe.Vector2(f,d),new oe.Vector2(e,t),new oe.Vector2(r,o),new oe.Vector2(n,l));this.curves.push(m),this.actions.push({action:oe.PathActions.BEZIER_CURVE_TO,args:h})},oe.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,o=r[r.length-2],n=r[r.length-1],l=[new oe.Vector2(o,n)];Array.prototype.push.apply(l,e);var h=new oe.SplineCurve(l);this.curves.push(h),this.actions.push({action:oe.PathActions.CSPLINE_THRU,args:t})},oe.Path.prototype.arc=function(e,t,r,o,n,l){var h=this.actions[this.actions.length-1].args,c=h[h.length-2],f=h[h.length-1];this.absarc(e+c,t+f,r,o,n,l)},oe.Path.prototype.absarc=function(e,t,r,o,n,l){this.absellipse(e,t,r,r,o,n,l)},oe.Path.prototype.ellipse=function(e,t,r,o,n,l,h){var c=this.actions[this.actions.length-1].args,f=c[c.length-2],d=c[c.length-1];this.absellipse(e+f,t+d,r,o,n,l,h)},oe.Path.prototype.absellipse=function(e,t,r,o,n,l,h){var c=Array.prototype.slice.call(arguments),f=new oe.EllipseCurve(e,t,r,o,n,l,h);this.curves.push(f);var d=f.getPoint(1);c.push(d.x),c.push(d.y),this.actions.push({action:oe.PathActions.ELLIPSE,args:c})},oe.Path.prototype.getSpacedPoints=function(e,t){e||(e=40);for(var r=[],i=0;i<e;i++)r.push(this.getPoint(i/e));return r},oe.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,t);e=e||12;var i,r,o,n,l,h,c,f,d,m,v,y,x,_,M,w,S,A,T=[];for(i=0,r=this.actions.length;i<r;i++)switch(n=(o=this.actions[i]).action,l=o.args,n){case oe.PathActions.MOVE_TO:case oe.PathActions.LINE_TO:T.push(new oe.Vector2(l[0],l[1]));break;case oe.PathActions.QUADRATIC_CURVE_TO:for(h=l[2],c=l[3],m=l[0],v=l[1],T.length>0?(y=(_=T[T.length-1]).x,x=_.y):(y=(_=this.actions[i-1].args)[_.length-2],x=_[_.length-1]),M=1;M<=e;M++)w=M/e,S=oe.Shape.Utils.b2(w,y,m,h),A=oe.Shape.Utils.b2(w,x,v,c),T.push(new oe.Vector2(S,A));break;case oe.PathActions.BEZIER_CURVE_TO:for(h=l[4],c=l[5],m=l[0],v=l[1],f=l[2],d=l[3],T.length>0?(y=(_=T[T.length-1]).x,x=_.y):(y=(_=this.actions[i-1].args)[_.length-2],x=_[_.length-1]),M=1;M<=e;M++)w=M/e,S=oe.Shape.Utils.b3(w,y,m,f,h),A=oe.Shape.Utils.b3(w,x,v,d,c),T.push(new oe.Vector2(S,A));break;case oe.PathActions.CSPLINE_THRU:_=this.actions[i-1].args;var C=[new oe.Vector2(_[_.length-2],_[_.length-1])],E=e*l[0].length;C=C.concat(l[0]);var L=new oe.SplineCurve(C);for(M=1;M<=E;M++)T.push(L.getPointAt(M/E));break;case oe.PathActions.ARC:var P=l[0],R=l[1],D=l[2],U=l[3],F=l[4],V=!!l[5],N=F-U,O=2*e;for(M=1;M<=O;M++)w=M/O,V||(w=1-w),z=U+w*N,S=P+D*Math.cos(z),A=R+D*Math.sin(z),T.push(new oe.Vector2(S,A));break;case oe.PathActions.ELLIPSE:P=l[0],R=l[1];var z,I=l[2],B=l[3];U=l[4],F=l[5],V=!!l[6],N=F-U,O=2*e;for(M=1;M<=O;M++)w=M/O,V||(w=1-w),z=U+w*N,S=P+I*Math.cos(z),A=R+B*Math.sin(z),T.push(new oe.Vector2(S,A))}var k=T[T.length-1];return Math.abs(k.x-T[0].x)<1e-10&&Math.abs(k.y-T[0].y)<1e-10&&T.splice(T.length-1,1),t&&T.push(T[0]),T},oe.Path.prototype.toShapes=function(e){function t(e,t){for(var r=t.length,o=!1,p=r-1,q=0;q<r;p=q++){var n=t[p],l=t[q],h=l.x-n.x,c=l.y-n.y;if(Math.abs(c)>1e-10){if(c<0&&(n=t[q],h=-h,l=t[p],c=-c),e.y<n.y||e.y>l.y)continue;if(e.y==n.y){if(e.x==n.x)return!0}else{var f=c*(e.x-n.x)-h*(e.y-n.y);if(0==f)return!0;if(f<0)continue;o=!o}}else{if(e.y!=n.y)continue;if(l.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=l.x)return!0}}return o}var i,r,o,n,l,h=[],c=new oe.Path;for(i=0,r=this.actions.length;i<r;i++)l=(o=this.actions[i]).args,(n=o.action)==oe.PathActions.MOVE_TO&&0!=c.actions.length&&(h.push(c),c=new oe.Path),c[n].apply(c,l);if(0!=c.actions.length&&h.push(c),0==h.length)return[];var f,d,m,v=[];if(1==h.length)return d=h[0],(m=new oe.Shape).actions=d.actions,m.curves=d.curves,v.push(m),v;var y=!oe.Shape.Utils.isClockWise(h[0].getPoints());y=e?!y:y;var x,_,M,w,S=[],A=[],T=[],C=0;for(A[C]=void 0,T[C]=[],i=0,r=h.length;i<r;i++)x=(d=h[i]).getPoints(),f=oe.Shape.Utils.isClockWise(x),(f=e?!f:f)?(!y&&A[C]&&C++,A[C]={s:new oe.Shape,p:x},A[C].s.actions=d.actions,A[C].s.curves=d.curves,y&&C++,T[C]=[]):T[C].push({h:d,p:x[0]});if(A.length>1){for(var E=!1,L=[],P=0,R=A.length;P<R;P++)S[P]=[];for(P=0,R=A.length;P<R;P++){A[P];for(var D=T[P],U=0;U<D.length;U++){for(var F=D[U],V=!0,N=0;N<A.length;N++)t(F.p,A[N].p)&&(P!=N&&L.push({froms:P,tos:N,hole:U}),V?(V=!1,S[N].push(F)):E=!0);V&&S[P].push(F)}}L.length>0&&(E||(T=S))}for(i=0,r=A.length;i<r;i++)for(m=A[i].s,v.push(m),M=0,w=(_=T[i]).length;M<w;M++)m.holes.push(_[M].h);return v},oe.Shape=function(){oe.Path.apply(this,arguments),this.holes=[]},oe.Shape.prototype=Object.create(oe.Path.prototype),oe.Shape.prototype.extrude=function(e){return new oe.ExtrudeGeometry(this,e)},oe.Shape.prototype.makeGeometry=function(e){return new oe.ShapeGeometry(this,e)},oe.Shape.prototype.getPointsHoles=function(e){var i,t=this.holes.length,r=[];for(i=0;i<t;i++)r[i]=this.holes[i].getTransformedPoints(e,this.bends);return r},oe.Shape.prototype.getSpacedPointsHoles=function(e){var i,t=this.holes.length,r=[];for(i=0;i<t;i++)r[i]=this.holes[i].getTransformedSpacedPoints(e,this.bends);return r},oe.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},oe.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},oe.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},oe.Shape.Utils={triangulateShape:function(e,t){function r(e,t,r){return e.x!=t.x?e.x<t.x?e.x<=r.x&&r.x<=t.x:t.x<=r.x&&r.x<=e.x:e.y<t.y?e.y<=r.y&&r.y<=t.y:t.y<=r.y&&r.y<=e.y}function o(e,t,o,n,l){var h=t.x-e.x,c=t.y-e.y,f=n.x-o.x,d=n.y-o.y,m=e.x-o.x,v=e.y-o.y,y=c*f-h*d,x=c*m-h*v;if(Math.abs(y)>1e-10){var _;if(y>0){if(x<0||x>y)return[];if((_=d*m-f*v)<0||_>y)return[]}else{if(x>0||x<y)return[];if((_=d*m-f*v)>0||_<y)return[]}if(0==_)return!l||0!=x&&x!=y?[e]:[];if(_==y)return!l||0!=x&&x!=y?[t]:[];if(0==x)return[o];if(x==y)return[n];var M=_/y;return[{x:e.x+M*h,y:e.y+M*c}]}if(0!=x||d*m!=f*v)return[];var w,S,A,T,C,E,L,P,R=0==h&&0==c,D=0==f&&0==d;return R&&D?e.x!=o.x||e.y!=o.y?[]:[e]:R?r(o,n,e)?[e]:[]:D?r(e,t,o)?[o]:[]:(0!=h?(e.x<t.x?(w=e,A=e.x,S=t,T=t.x):(w=t,A=t.x,S=e,T=e.x),o.x<n.x?(C=o,L=o.x,E=n,P=n.x):(C=n,L=n.x,E=o,P=o.x)):(e.y<t.y?(w=e,A=e.y,S=t,T=t.y):(w=t,A=t.y,S=e,T=e.y),o.y<n.y?(C=o,L=o.y,E=n,P=n.y):(C=n,L=n.y,E=o,P=o.y)),A<=L?T<L?[]:T==L?l?[]:[C]:T<=P?[C,S]:[C,E]:A>P?[]:A==P?l?[]:[w]:T<=P?[w,S]:[w,E])}function n(e,t,r,o){var n=t.x-e.x,l=t.y-e.y,h=r.x-e.x,c=r.y-e.y,f=o.x-e.x,d=o.y-e.y,m=n*c-l*h,v=n*d-l*f;if(Math.abs(m)>1e-10){var y=f*c-d*h;return m>0?v>=0&&y>=0:v>=0||y>=0}return v>0}for(var i,l,h,c,f,d,m={},v=e.concat(),y=0,x=t.length;y<x;y++)Array.prototype.push.apply(v,t[y]);for(i=0,l=v.length;i<l;i++)void 0!==m[f=v[i].x+":"+v[i].y]&&console.log("Duplicate point",f),m[f]=i;var _=function(e,t){var r,l=e.concat();function h(e,t){var o=l.length-1,h=e-1;h<0&&(h=o);var c=e+1;c>o&&(c=0);var f=n(l[e],l[h],l[c],r[t]);if(!f)return!1;var d=r.length-1,m=t-1;m<0&&(m=d);var v=t+1;return v>d&&(v=0),!!(f=n(r[t],r[m],r[v],l[e]))}function c(e,t){var r,n;for(r=0;r<l.length;r++)if(n=r+1,n%=l.length,o(e,t,l[r],l[n],!0).length>0)return!0;return!1}var f=[];function d(e,r){var n,l,h,c;for(n=0;n<f.length;n++)for(l=t[f[n]],h=0;h<l.length;h++)if(c=h+1,c%=l.length,o(e,r,l[h],l[c],!0).length>0)return!0;return!1}for(var m,v,y,x,_,M,w,S,A,T,C=[],E=0,L=t.length;E<L;E++)f.push(E);for(var P=2*f.length;f.length>0;){if(--P<0){console.log("Infinite Loop! Holes left:"+f.length+", Probably Hole outside Shape!");break}for(v=0;v<l.length;v++){y=l[v],m=-1;for(E=0;E<f.length;E++)if(_=f[E],void 0===C[M=y.x+":"+y.y+":"+_]){r=t[_];for(var h2=0;h2<r.length;h2++)if(x=r[h2],h(v,h2)&&!c(y,x)&&!d(y,x)){m=h2,f.splice(E,1),w=l.slice(0,v+1),S=l.slice(v),A=r.slice(m),T=r.slice(0,m+1),l=w.concat(A).concat(T).concat(S);break}if(m>=0)break;C[M]=!0}if(m>=0)break}}return l}(e,t),M=oe.FontUtils.Triangulate(_,!1);for(i=0,l=M.length;i<l;i++)for(c=M[i],h=0;h<3;h++)void 0!==(d=m[f=c[h].x+":"+c[h].y])&&(c[h]=d);return M.concat()},isClockWise:function(e){return oe.FontUtils.Triangulate.area(e)<0},b2p0:function(e,p){var t=1-e;return t*t*p},b2p1:function(e,p){return 2*(1-e)*e*p},b2p2:function(e,p){return e*e*p},b2:function(e,t,r,o){return this.b2p0(e,t)+this.b2p1(e,r)+this.b2p2(e,o)},b3p0:function(e,p){var t=1-e;return t*t*t*p},b3p1:function(e,p){var t=1-e;return 3*t*t*e*p},b3p2:function(e,p){return 3*(1-e)*e*e*p},b3p3:function(e,p){return e*e*e*p},b3:function(e,t,r,o,n){return this.b3p0(e,t)+this.b3p1(e,r)+this.b3p2(e,o)+this.b3p3(e,n)}},oe.LineCurve=function(e,t){this.v1=e,this.v2=t},oe.LineCurve.prototype=Object.create(oe.Curve.prototype),oe.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},oe.LineCurve.prototype.getPointAt=function(u){return this.getPoint(u)},oe.LineCurve.prototype.getTangent=function(e){return this.v2.clone().sub(this.v1).normalize()},oe.QuadraticBezierCurve=function(e,t,r){this.v0=e,this.v1=t,this.v2=r},oe.QuadraticBezierCurve.prototype=Object.create(oe.Curve.prototype),oe.QuadraticBezierCurve.prototype.getPoint=function(e){var t,r;return t=oe.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),r=oe.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),new oe.Vector2(t,r)},oe.QuadraticBezierCurve.prototype.getTangent=function(e){var t,r;t=oe.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),r=oe.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y);var o=new oe.Vector2(t,r);return o.normalize(),o},oe.CubicBezierCurve=function(e,t,r,o){this.v0=e,this.v1=t,this.v2=r,this.v3=o},oe.CubicBezierCurve.prototype=Object.create(oe.Curve.prototype),oe.CubicBezierCurve.prototype.getPoint=function(e){var t,r;return t=oe.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),r=oe.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new oe.Vector2(t,r)},oe.CubicBezierCurve.prototype.getTangent=function(e){var t,r;t=oe.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),r=oe.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var o=new oe.Vector2(t,r);return o.normalize(),o},oe.SplineCurve=function(e){this.points=null==e?[]:e},oe.SplineCurve.prototype=Object.create(oe.Curve.prototype),oe.SplineCurve.prototype.getPoint=function(e){var t,r,o,n=new oe.Vector2,l=[],h=this.points;return o=(t=(h.length-1)*e)-(r=Math.floor(t)),l[0]=0==r?r:r-1,l[1]=r,l[2]=r>h.length-2?h.length-1:r+1,l[3]=r>h.length-3?h.length-1:r+2,n.x=oe.Curve.Utils.interpolate(h[l[0]].x,h[l[1]].x,h[l[2]].x,h[l[3]].x,o),n.y=oe.Curve.Utils.interpolate(h[l[0]].y,h[l[1]].y,h[l[2]].y,h[l[3]].y,o),n},oe.EllipseCurve=function(e,t,r,o,n,l,h){this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=o,this.aStartAngle=n,this.aEndAngle=l,this.aClockwise=h},oe.EllipseCurve.prototype=Object.create(oe.Curve.prototype),oe.EllipseCurve.prototype.getPoint=function(e){var t,r=this.aEndAngle-this.aStartAngle;r<0&&(r+=2*Math.PI),r>2*Math.PI&&(r-=2*Math.PI),t=!0===this.aClockwise?this.aEndAngle+(1-e)*(2*Math.PI-r):this.aStartAngle+e*r;var o=this.aX+this.xRadius*Math.cos(t),n=this.aY+this.yRadius*Math.sin(t);return new oe.Vector2(o,n)},oe.ArcCurve=function(e,t,r,o,n,l){oe.EllipseCurve.call(this,e,t,r,r,o,n,l)},oe.ArcCurve.prototype=Object.create(oe.EllipseCurve.prototype),oe.LineCurve3=oe.Curve.create((function(e,t){this.v1=e,this.v2=t}),(function(e){var t=new oe.Vector3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t})),oe.QuadraticBezierCurve3=oe.Curve.create((function(e,t,r){this.v0=e,this.v1=t,this.v2=r}),(function(e){var t,r,o;return t=oe.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),r=oe.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),o=oe.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),new oe.Vector3(t,r,o)})),oe.CubicBezierCurve3=oe.Curve.create((function(e,t,r,o){this.v0=e,this.v1=t,this.v2=r,this.v3=o}),(function(e){var t,r,o;return t=oe.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),r=oe.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),o=oe.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new oe.Vector3(t,r,o)})),oe.SplineCurve3=oe.Curve.create((function(e){this.points=null==e?[]:e}),(function(e){var t,r,o,n=new oe.Vector3,l=[],h=this.points;o=(t=(h.length-1)*e)-(r=Math.floor(t)),l[0]=0==r?r:r-1,l[1]=r,l[2]=r>h.length-2?h.length-1:r+1,l[3]=r>h.length-3?h.length-1:r+2;var c=h[l[0]],f=h[l[1]],d=h[l[2]],m=h[l[3]];return n.x=oe.Curve.Utils.interpolate(c.x,f.x,d.x,m.x,o),n.y=oe.Curve.Utils.interpolate(c.y,f.y,d.y,m.y,o),n.z=oe.Curve.Utils.interpolate(c.z,f.z,d.z,m.z,o),n})),oe.ClosedSplineCurve3=oe.Curve.create((function(e){this.points=null==e?[]:e}),(function(e){var t,r,o,n=new oe.Vector3,l=[],h=this.points;return o=(t=(h.length-0)*e)-(r=Math.floor(t)),r+=r>0?0:(Math.floor(Math.abs(r)/h.length)+1)*h.length,l[0]=(r-1)%h.length,l[1]=r%h.length,l[2]=(r+1)%h.length,l[3]=(r+2)%h.length,n.x=oe.Curve.Utils.interpolate(h[l[0]].x,h[l[1]].x,h[l[2]].x,h[l[3]].x,o),n.y=oe.Curve.Utils.interpolate(h[l[0]].y,h[l[1]].y,h[l[2]].y,h[l[3]].y,o),n.z=oe.Curve.Utils.interpolate(h[l[0]].z,h[l[1]].z,h[l[2]].z,h[l[3]].z,o),n})),oe.AnimationHandler=(K=[],$={},Q={update:function(e){for(var i=0;i<K.length;i++)K[i].update(e)},addToUpdate:function(e){-1===K.indexOf(e)&&K.push(e)},removeFromUpdate:function(e){var t=K.indexOf(e);-1!==t&&K.splice(t,1)},add:function(data){void 0!==$[data.name]&&oe.onwarning("THREE.AnimationHandler.add: Warning! "+data.name+" already exists in library. Overwriting."),$[data.name]=data,J(data)},get:function(e){if("string"==typeof e)return $[e]?$[e]:(oe.onwarning("THREE.AnimationHandler.get: Couldn't find animation "+e),null)},parse:function(e){var t=[];if(e instanceof oe.SkinnedMesh)for(var b=0;b<e.bones.length;b++)t.push(e.bones[b]);else Z(e,t);return t}},Z=function(e,t){t.push(e);for(var r=0;r<e.children.length;r++)Z(e.children[r],t)},J=function(data){if(!0!==data.initialized){for(var e=0;e<data.hierarchy.length;e++){for(var t=0;t<data.hierarchy[e].keys.length;t++)if(data.hierarchy[e].keys[t].time<0&&(data.hierarchy[e].keys[t].time=0),void 0!==data.hierarchy[e].keys[t].rot&&!(data.hierarchy[e].keys[t].rot instanceof oe.Quaternion)){var r=data.hierarchy[e].keys[t].rot;data.hierarchy[e].keys[t].rot=new oe.Quaternion(r[0],r[1],r[2],r[3])}if(data.hierarchy[e].keys.length&&void 0!==data.hierarchy[e].keys[0].morphTargets){var o={};for(t=0;t<data.hierarchy[e].keys.length;t++)for(var n=0;n<data.hierarchy[e].keys[t].morphTargets.length;n++)o[h=data.hierarchy[e].keys[t].morphTargets[n]]=-1;for(data.hierarchy[e].usedMorphTargets=o,t=0;t<data.hierarchy[e].keys.length;t++){var l={};for(var h in o){for(n=0;n<data.hierarchy[e].keys[t].morphTargets.length;n++)if(data.hierarchy[e].keys[t].morphTargets[n]===h){l[h]=data.hierarchy[e].keys[t].morphTargetsInfluences[n];break}n===data.hierarchy[e].keys[t].morphTargets.length&&(l[h]=0)}data.hierarchy[e].keys[t].morphTargetsInfluences=l}}for(t=1;t<data.hierarchy[e].keys.length;t++)data.hierarchy[e].keys[t].time===data.hierarchy[e].keys[t-1].time&&(data.hierarchy[e].keys.splice(t,1),t--);for(t=0;t<data.hierarchy[e].keys.length;t++)data.hierarchy[e].keys[t].index=t}data.initialized=!0}},Q.LINEAR=0,Q.CATMULLROM=1,Q.CATMULLROM_FORWARD=2,Q),oe.Animation=function(e,t){this.root=e,this.data=oe.AnimationHandler.get(t),this.hierarchy=oe.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.isPaused=!0,this.loop=!0,this.interpolationType=oe.AnimationHandler.LINEAR},oe.Animation.prototype.play=function(e){this.currentTime=void 0!==e?e:0,!1===this.isPlaying&&(this.isPlaying=!0,this.reset(),this.update(0)),this.isPaused=!1,oe.AnimationHandler.addToUpdate(this)},oe.Animation.prototype.pause=function(){!0===this.isPaused?oe.AnimationHandler.addToUpdate(this):oe.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},oe.Animation.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,oe.AnimationHandler.removeFromUpdate(this)},oe.Animation.prototype.reset=function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var object=this.hierarchy[e];object.matrixAutoUpdate=!0,void 0===object.animationCache&&(object.animationCache={},object.animationCache.prevKey={pos:0,rot:0,scl:0},object.animationCache.nextKey={pos:0,rot:0,scl:0},object.animationCache.originalMatrix=object instanceof oe.Bone?object.skinMatrix:object.matrix);var r=object.animationCache.prevKey,o=object.animationCache.nextKey;r.pos=this.data.hierarchy[e].keys[0],r.rot=this.data.hierarchy[e].keys[0],r.scl=this.data.hierarchy[e].keys[0],o.pos=this.getNextKeyWith("pos",e,1),o.rot=this.getNextKeyWith("rot",e,1),o.scl=this.getNextKeyWith("scl",e,1)}},oe.Animation.prototype.update=function(){var e=[],t=new oe.Vector3,r=function(e,t){var r,n,l,h,c,f,d,m,v,y=[],x=[];return l=(r=(e.length-1)*t)-(n=Math.floor(r)),y[0]=0===n?n:n-1,y[1]=n,y[2]=n>e.length-2?n:n+1,y[3]=n>e.length-3?n:n+2,f=e[y[0]],d=e[y[1]],m=e[y[2]],v=e[y[3]],c=l*(h=l*l),x[0]=o(f[0],d[0],m[0],v[0],l,h,c),x[1]=o(f[1],d[1],m[1],v[1],l,h,c),x[2]=o(f[2],d[2],m[2],v[2],l,h,c),x},o=function(e,t,r,o,n,l,h){var c=.5*(r-e),f=.5*(o-t);return(2*(t-r)+c+f)*h+(-3*(t-r)-2*c-f)*l+c*n+t};return function(o){if(!1!==this.isPlaying){var n;this.currentTime+=o*this.timeScale;var l=["pos","rot","scl"],h=this.data.length;if(!0===this.loop&&this.currentTime>h)this.currentTime%=h,this.reset();else if(!1===this.loop&&this.currentTime>h)return void this.stop();this.currentTime=Math.min(this.currentTime,h);for(var c=0,f=this.hierarchy.length;c<f;c++)for(var object=this.hierarchy[c],d=object.animationCache,m=0;m<3;m++){var v=l[m],y=d.prevKey[v],x=d.nextKey[v];if(x.time<=this.currentTime){for(y=this.data.hierarchy[c].keys[0],x=this.getNextKeyWith(v,c,1);x.time<this.currentTime&&x.index>y.index;)y=x,x=this.getNextKeyWith(v,c,x.index+1);d.prevKey[v]=y,d.nextKey[v]=x}object.matrixAutoUpdate=!0,object.matrixWorldNeedsUpdate=!0;var _=(this.currentTime-y.time)/(x.time-y.time),M=y[v],w=x[v];if(_<0&&(_=0),_>1&&(_=1),"pos"===v){if(n=object.position,this.interpolationType===oe.AnimationHandler.LINEAR)n.x=M[0]+(w[0]-M[0])*_,n.y=M[1]+(w[1]-M[1])*_,n.z=M[2]+(w[2]-M[2])*_;else if(this.interpolationType===oe.AnimationHandler.CATMULLROM||this.interpolationType===oe.AnimationHandler.CATMULLROM_FORWARD){e[0]=this.getPrevKeyWith("pos",c,y.index-1).pos,e[1]=M,e[2]=w,e[3]=this.getNextKeyWith("pos",c,x.index+1).pos;var S=r(e,_=.33*_+.33);if(n.x=S[0],n.y=S[1],n.z=S[2],this.interpolationType===oe.AnimationHandler.CATMULLROM_FORWARD){var A=r(e,1.01*_);t.set(A[0],A[1],A[2]),t.sub(n),t.y=0,t.normalize();var T=Math.atan2(t.x,t.z);object.rotation.set(0,T,0)}}}else"rot"===v?oe.Quaternion.slerp(M,w,object.quaternion,_):"scl"===v&&((n=object.scale).x=M[0]+(w[0]-M[0])*_,n.y=M[1]+(w[1]-M[1])*_,n.z=M[2]+(w[2]-M[2])*_)}}}}(),oe.Animation.prototype.getNextKeyWith=function(e,t,r){var o=this.data.hierarchy[t].keys;for(this.interpolationType===oe.AnimationHandler.CATMULLROM||this.interpolationType===oe.AnimationHandler.CATMULLROM_FORWARD?r=r<o.length-1?r:o.length-1:r%=o.length;r<o.length;r++)if(void 0!==o[r][e])return o[r];return this.data.hierarchy[t].keys[0]},oe.Animation.prototype.getPrevKeyWith=function(e,t,r){var o=this.data.hierarchy[t].keys;for(r=this.interpolationType===oe.AnimationHandler.CATMULLROM||this.interpolationType===oe.AnimationHandler.CATMULLROM_FORWARD?r>0?r:0:r>=0?r:r+o.length;r>=0;r--)if(void 0!==o[r][e])return o[r];return this.data.hierarchy[t].keys[o.length-1]},oe.KeyFrameAnimation=function(e,data){this.root=e,this.data=oe.AnimationHandler.get(data),this.hierarchy=oe.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.isPaused=!0,this.loop=!0;for(var t=0,r=this.hierarchy.length;t<r;t++){var o=this.data.hierarchy[t].keys,n=this.data.hierarchy[t].sids,l=this.hierarchy[t];if(o.length&&n){for(var s=0;s<n.length;s++){var h=n[s],c=this.getNextKeyWith(h,t,0);c&&c.apply(h)}l.matrixAutoUpdate=!1,this.data.hierarchy[t].node.updateMatrix(),l.matrixWorldNeedsUpdate=!0}}},oe.KeyFrameAnimation.prototype.play=function(e){if(this.currentTime=void 0!==e?e:0,!1===this.isPlaying){this.isPlaying=!0;var t,object,r,o=this.hierarchy.length;for(t=0;t<o;t++){object=this.hierarchy[t],void 0===(r=this.data.hierarchy[t]).animationCache&&(r.animationCache={},r.animationCache.prevKey=null,r.animationCache.nextKey=null,r.animationCache.originalMatrix=object instanceof oe.Bone?object.skinMatrix:object.matrix);var n=this.data.hierarchy[t].keys;n.length&&(r.animationCache.prevKey=n[0],r.animationCache.nextKey=n[1],this.startTime=Math.min(n[0].time,this.startTime),this.endTime=Math.max(n[n.length-1].time,this.endTime))}this.update(0)}this.isPaused=!1,oe.AnimationHandler.addToUpdate(this)},oe.KeyFrameAnimation.prototype.pause=function(){this.isPaused?oe.AnimationHandler.addToUpdate(this):oe.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},oe.KeyFrameAnimation.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,oe.AnimationHandler.removeFromUpdate(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e],r=this.data.hierarchy[e];if(void 0!==r.animationCache){var o=r.animationCache.originalMatrix;t instanceof oe.Bone?(o.copy(t.skinMatrix),t.skinMatrix=o):(o.copy(t.matrix),t.matrix=o),delete r.animationCache}}},oe.KeyFrameAnimation.prototype.update=function(e){if(!1!==this.isPlaying){this.currentTime+=e*this.timeScale;var t=this.data.length;!0===this.loop&&this.currentTime>t&&(this.currentTime%=t),this.currentTime=Math.min(this.currentTime,t);for(var r=0,o=this.hierarchy.length;r<o;r++){var object=this.hierarchy[r],n=this.data.hierarchy[r],l=n.keys,h=n.animationCache;if(l.length){var c=h.prevKey,f=h.nextKey;if(f.time<=this.currentTime){for(;f.time<this.currentTime&&f.index>c.index;)f=l[(c=f).index+1];h.prevKey=c,h.nextKey=f}f.time>=this.currentTime?c.interpolate(f,this.currentTime):c.interpolate(f,f.time),this.data.hierarchy[r].node.updateMatrix(),object.matrixWorldNeedsUpdate=!0}}}},oe.KeyFrameAnimation.prototype.getNextKeyWith=function(e,t,r){var o=this.data.hierarchy[t].keys;for(r%=o.length;r<o.length;r++)if(o[r].hasTarget(e))return o[r];return o[0]},oe.KeyFrameAnimation.prototype.getPrevKeyWith=function(e,t,r){var o=this.data.hierarchy[t].keys;for(r=r>=0?r:r+o.length;r>=0;r--)if(o[r].hasTarget(e))return o[r];return o[o.length-1]},oe.MorphAnimation=function(e){this.mesh=e,this.frames=e.morphTargetInfluences.length,this.currentTime=0,this.duration=1e3,this.loop=!0,this.isPlaying=!1},oe.MorphAnimation.prototype={play:function(){this.isPlaying=!0},pause:function(){this.isPlaying=!1},update:(ee=0,te=0,function(e){if(!1!==this.isPlaying){this.currentTime+=e,!0===this.loop&&this.currentTime>this.duration&&(this.currentTime%=this.duration),this.currentTime=Math.min(this.currentTime,this.duration);var t=this.duration/this.frames,r=Math.floor(this.currentTime/t);r!=te&&(this.mesh.morphTargetInfluences[ee]=0,this.mesh.morphTargetInfluences[te]=1,this.mesh.morphTargetInfluences[r]=0,ee=te,te=r),this.mesh.morphTargetInfluences[r]=this.currentTime%t/t,this.mesh.morphTargetInfluences[ee]=1-this.mesh.morphTargetInfluences[r]}})},oe.CubeCamera=function(e,t,r){oe.Object3D.call(this),this.className="CubeCamera";var o=new oe.PerspectiveCamera(90,1,e,t);o.up.set(0,-1,0),o.lookAt(new oe.Vector3(1,0,0)),this.add(o);var n=new oe.PerspectiveCamera(90,1,e,t);n.up.set(0,-1,0),n.lookAt(new oe.Vector3(-1,0,0)),this.add(n);var l=new oe.PerspectiveCamera(90,1,e,t);l.up.set(0,0,1),l.lookAt(new oe.Vector3(0,1,0)),this.add(l);var h=new oe.PerspectiveCamera(90,1,e,t);h.up.set(0,0,-1),h.lookAt(new oe.Vector3(0,-1,0)),this.add(h);var c=new oe.PerspectiveCamera(90,1,e,t);c.up.set(0,-1,0),c.lookAt(new oe.Vector3(0,0,1)),this.add(c);var f=new oe.PerspectiveCamera(90,1,e,t);f.up.set(0,-1,0),f.lookAt(new oe.Vector3(0,0,-1)),this.add(f),this.renderTarget=new oe.WebGLRenderTargetCube(r,r,{format:oe.RGBFormat,magFilter:oe.LinearFilter,minFilter:oe.LinearFilter}),this.updateCubeMap=function(e,t){var r=this.renderTarget,d=r.generateMipmaps;r.generateMipmaps=!1,r.activeCubeFace=0,e.render(t,o,r),r.activeCubeFace=1,e.render(t,n,r),r.activeCubeFace=2,e.render(t,l,r),r.activeCubeFace=3,e.render(t,h,r),r.activeCubeFace=4,e.render(t,c,r),r.generateMipmaps=d,r.activeCubeFace=5,e.render(t,f,r)}},oe.CubeCamera.prototype=Object.create(oe.Object3D.prototype),oe.CombinedCamera=function(e,t,r,o,n,l,h){oe.Camera.call(this),this.className="CombinedCamera",this.fov=r,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.cameraO=new oe.OrthographicCamera(e/-2,e/2,t/2,t/-2,l,h),this.cameraP=new oe.PerspectiveCamera(r,e/t,o,n),this.zoom=1,this.toPerspective()},oe.CombinedCamera.prototype=Object.create(oe.Camera.prototype),oe.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.fov=this.fov/this.zoom,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPerspectiveMode=!0,this.inOrthographicMode=!1},oe.CombinedCamera.prototype.toOrthographic=function(){var e=this.fov,t=this.cameraP.aspect,r=(this.cameraP.near+this.cameraP.far)/2,o=Math.tan(e/2)*r,n=2*o*t/2;o/=this.zoom,n/=this.zoom,this.cameraO.left=-n,this.cameraO.right=n,this.cameraO.top=o,this.cameraO.bottom=-o,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPerspectiveMode=!1,this.inOrthographicMode=!0},oe.CombinedCamera.prototype.setSize=function(e,t){this.cameraP.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2},oe.CombinedCamera.prototype.setFov=function(e){this.fov=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},oe.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},oe.CombinedCamera.prototype.setLens=function(e,t){void 0===t&&(t=24);var r=2*oe.Math.radToDeg(Math.atan(t/(2*e)));return this.setFov(r),r},oe.CombinedCamera.prototype.setZoom=function(e){this.zoom=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},oe.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},oe.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},oe.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},oe.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},oe.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},oe.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},oe.BoxGeometry=function(e,t,r,o,n,l){oe.Geometry.call(this),this.className="BoxGeometry";var h=this;this.width=e,this.height=t,this.depth=r,this.widthSegments=o||1,this.heightSegments=n||1,this.depthSegments=l||1;var c=this.width/2,f=this.height/2,d=this.depth/2;function m(u,e,t,r,o,n,l,c){var f,d,m,v=h.widthSegments,y=h.heightSegments,x=o/2,_=n/2,M=h.vertices.length;"x"===u&&"y"===e||"y"===u&&"x"===e?f="z":"x"===u&&"z"===e||"z"===u&&"x"===e?(f="y",y=h.depthSegments):("z"===u&&"y"===e||"y"===u&&"z"===e)&&(f="x",v=h.depthSegments);var w=v+1,S=y+1,A=o/v,T=n/y,C=new oe.Vector3;for(C[f]=l>0?1:-1,m=0;m<S;m++)for(d=0;d<w;d++){var E=new oe.Vector3;E[u]=(d*A-x)*t,E[e]=(m*T-_)*r,E[f]=l,h.vertices.push(E)}for(m=0;m<y;m++)for(d=0;d<v;d++){var a=d+w*m,b=d+w*(m+1),L=d+1+w*(m+1),P=d+1+w*m,R=new oe.Vector2(d/v,1-m/y),D=new oe.Vector2(d/v,1-(m+1)/y),U=new oe.Vector2((d+1)/v,1-(m+1)/y),F=new oe.Vector2((d+1)/v,1-m/y),V=new oe.Face3(a+M,b+M,P+M);V.normal.copy(C),V.vertexNormals.push(C.clone(),C.clone(),C.clone()),V.materialIndex=c,h.faces.push(V),h.faceVertexUvs[0].push([R,D,F]),(V=new oe.Face3(b+M,L+M,P+M)).normal.copy(C),V.vertexNormals.push(C.clone(),C.clone(),C.clone()),V.materialIndex=c,h.faces.push(V),h.faceVertexUvs[0].push([D.clone(),U,F.clone()])}}m("z","y",-1,-1,this.depth,this.height,c,0),m("z","y",1,-1,this.depth,this.height,-c,1),m("x","z",1,1,this.width,this.depth,f,2),m("x","z",1,-1,this.width,this.depth,-f,3),m("x","y",1,-1,this.width,this.height,d,4),m("x","y",-1,-1,this.width,this.height,-d,5),this.computeCentroids(),this.mergeVertices()},oe.BoxGeometry.prototype=Object.create(oe.Geometry.prototype),oe.CircleGeometry=function(e,t,r,o){oe.Geometry.call(this),this.className="CircleGeometry",this.radius=e=e||50,this.segments=t=void 0!==t?Math.max(3,t):8,this.thetaStart=r=void 0!==r?r:0,this.thetaLength=o=void 0!==o?o:2*Math.PI;var i,n=[],l=new oe.Vector3,h=new oe.Vector2(.5,.5);for(this.vertices.push(l),n.push(h),i=0;i<=t;i++){var c=new oe.Vector3,f=r+i/t*o;c.x=e*Math.cos(f),c.y=e*Math.sin(f),this.vertices.push(c),n.push(new oe.Vector2((c.x/e+1)/2,(c.y/e+1)/2))}var d=new oe.Vector3(0,0,1);for(i=1;i<=t;i++){var m=i,v=i+1;this.faces.push(new oe.Face3(m,v,0,[d.clone(),d.clone(),d.clone()])),this.faceVertexUvs[0].push([n[i].clone(),n[i+1].clone(),h.clone()])}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new oe.Sphere(new oe.Vector3,e)},oe.CircleGeometry.prototype=Object.create(oe.Geometry.prototype),oe.CubeGeometry=oe.BoxGeometry,oe.CylinderGeometry=function(e,t,r,o,n,l){oe.Geometry.call(this),this.className="CylinderGeometry",this.radiusTop=e=void 0!==e?e:20,this.radiusBottom=t=void 0!==t?t:20,this.height=r=void 0!==r?r:100,this.radialSegments=o=o||8,this.heightSegments=n=n||1,this.openEnded=l=void 0!==l&&l;var h,c,f=r/2,d=[],m=[];for(c=0;c<=n;c++){var v=[],y=[],x=c/n,_=x*(t-e)+e;for(h=0;h<=o;h++){var u=h/o,M=new oe.Vector3;M.x=_*Math.sin(u*Math.PI*2),M.y=-x*r+f,M.z=_*Math.cos(u*Math.PI*2),this.vertices.push(M),v.push(this.vertices.length-1),y.push(new oe.Vector2(u,1-x))}d.push(v),m.push(y)}var w,S,A=(t-e)/r;for(h=0;h<o;h++)for(0!==e?(w=this.vertices[d[0][h]].clone(),S=this.vertices[d[0][h+1]].clone()):(w=this.vertices[d[1][h]].clone(),S=this.vertices[d[1][h+1]].clone()),w.setY(Math.sqrt(w.x*w.x+w.z*w.z)*A).normalize(),S.setY(Math.sqrt(S.x*S.x+S.z*S.z)*A).normalize(),c=0;c<n;c++){var T=d[c][h],C=d[c+1][h],E=d[c+1][h+1],L=d[c][h+1],P=w.clone(),R=w.clone(),D=S.clone(),U=S.clone(),F=m[c][h].clone(),V=m[c+1][h].clone(),N=m[c+1][h+1].clone(),O=m[c][h+1].clone();this.faces.push(new oe.Face3(T,C,L,[P,R,U])),this.faceVertexUvs[0].push([F,V,O]),this.faces.push(new oe.Face3(C,E,L,[R.clone(),D,U.clone()])),this.faceVertexUvs[0].push([V.clone(),N,O.clone()])}if(!1===l&&e>0)for(this.vertices.push(new oe.Vector3(0,f,0)),h=0;h<o;h++){T=d[0][h],C=d[0][h+1],E=this.vertices.length-1,P=new oe.Vector3(0,1,0),R=new oe.Vector3(0,1,0),D=new oe.Vector3(0,1,0),F=m[0][h].clone(),V=m[0][h+1].clone(),N=new oe.Vector2(V.x,0);this.faces.push(new oe.Face3(T,C,E,[P,R,D])),this.faceVertexUvs[0].push([F,V,N])}if(!1===l&&t>0)for(this.vertices.push(new oe.Vector3(0,-f,0)),h=0;h<o;h++){T=d[c][h+1],C=d[c][h],E=this.vertices.length-1,P=new oe.Vector3(0,-1,0),R=new oe.Vector3(0,-1,0),D=new oe.Vector3(0,-1,0),F=m[c][h+1].clone(),V=m[c][h].clone(),N=new oe.Vector2(V.x,1);this.faces.push(new oe.Face3(T,C,E,[P,R,D])),this.faceVertexUvs[0].push([F,V,N])}this.computeCentroids(),this.computeFaceNormals()},oe.CylinderGeometry.prototype=Object.create(oe.Geometry.prototype),oe.ExtrudeGeometry=function(e,t){void 0!==e?(oe.Geometry.call(this),this.className="ExtrudeGeometry",e=e instanceof Array?e:[e],this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),this.computeFaceNormals()):e=[]},oe.ExtrudeGeometry.prototype=Object.create(oe.Geometry.prototype),oe.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var r=e.length,s=0;s<r;s++){var o=e[s];this.addShape(o,t)}},oe.ExtrudeGeometry.prototype.addShape=function(e,t){var r,o,n,l,h,c,f,d,m=void 0!==t.amount?t.amount:100,v=void 0!==t.bevelThickness?t.bevelThickness:6,y=void 0!==t.bevelSize?t.bevelSize:v-2,x=void 0!==t.bevelSegments?t.bevelSegments:3,_=void 0===t.bevelEnabled||t.bevelEnabled,M=void 0!==t.curveSegments?t.curveSegments:12,w=void 0!==t.steps?t.steps:1,S=t.extrudePath,A=!1,T=t.material,C=t.extrudeMaterial,E=void 0!==t.UVGenerator?t.UVGenerator:oe.ExtrudeGeometry.WorldUVGenerator;this.shapebb;S&&(r=S.getSpacedPoints(w),A=!0,_=!1,o=void 0!==t.frames?t.frames:new oe.TubeGeometry.FrenetFrames(S,w,!1),n=new oe.Vector3,l=new oe.Vector3,h=new oe.Vector3),_||(x=0,v=0,y=0);var L=this,P=this.vertices.length,R=e.extractPoints(M),D=R.shape,U=R.holes,F=!oe.Shape.Utils.isClockWise(D);if(F){for(D=D.reverse(),f=0,d=U.length;f<d;f++)c=U[f],oe.Shape.Utils.isClockWise(c)&&(U[f]=c.reverse());F=!1}var V=oe.Shape.Utils.triangulateShape(D,U),N=D;for(f=0,d=U.length;f<d;f++)c=U[f],D=D.concat(c);function O(e,t,r){return t?t.clone().multiplyScalar(r).add(e):oe.onerror("die, vec not specified")}var b,z,I,B,k,G,H=D.length,j=V.length;N.length,Math.PI;function W(e,t,r){var o,n,l=oe.Math.sign,h=1,c=e.x-t.x,f=e.y-t.y,d=r.x-e.x,m=r.y-e.y,v=c*c+f*f,y=c*m-f*d;if(Math.abs(y)>1e-10){var x=Math.sqrt(v),_=Math.sqrt(d*d+m*m),M=t.x-f/x,w=t.y+c/x,S=((r.x-m/_-M)*m-(r.y+d/_-w)*d)/(c*m-f*d),A=(o=M+c*S-e.x)*o+(n=w+f*S-e.y)*n;if(A<=2)return new oe.Vector2(o,n);h=Math.sqrt(A/2)}else{var T=!1;c>1e-10?d>1e-10&&(T=!0):c<-1e-10?d<-1e-10&&(T=!0):l(f)==l(m)&&(T=!0),T?(o=-f,n=c,h=Math.sqrt(v)):(o=c,n=f,h=Math.sqrt(v/2))}return new oe.Vector2(o/h,n/h)}for(var X=[],i=0,Y=N.length,K=Y-1,$=i+1;i<Y;i++,K++,$++){K===Y&&(K=0),$===Y&&($=0);N[i],N[K],N[$];X[i]=W(N[i],N[K],N[$])}var Q,s,Z=[],J=X.concat();for(f=0,d=U.length;f<d;f++){for(c=U[f],Q=[],i=0,K=(Y=c.length)-1,$=i+1;i<Y;i++,K++,$++)K===Y&&(K=0),$===Y&&($=0),Q[i]=W(c[i],c[K],c[$]);Z.push(Q),J=J.concat(Q)}for(b=0;b<x;b++){for(B=v*(1-(I=b/x)),z=y*Math.sin(I*Math.PI/2),i=0,Y=N.length;i<Y;i++)te((k=O(N[i],X[i],z)).x,k.y,-B);for(f=0,d=U.length;f<d;f++)for(c=U[f],Q=Z[f],i=0,Y=c.length;i<Y;i++)te((k=O(c[i],Q[i],z)).x,k.y,-B)}for(z=y,i=0;i<H;i++)k=_?O(D[i],J[i],z):D[i],A?(l.copy(o.normals[0]).multiplyScalar(k.x),n.copy(o.binormals[0]).multiplyScalar(k.y),h.copy(r[0]).add(l).add(n),te(h.x,h.y,h.z)):te(k.x,k.y,0);for(s=1;s<=w;s++)for(i=0;i<H;i++)k=_?O(D[i],J[i],z):D[i],A?(l.copy(o.normals[s]).multiplyScalar(k.x),n.copy(o.binormals[s]).multiplyScalar(k.y),h.copy(r[s]).add(l).add(n),te(h.x,h.y,h.z)):te(k.x,k.y,m/w*s);for(b=x-1;b>=0;b--){for(B=v*(1-(I=b/x)),z=y*Math.sin(I*Math.PI/2),i=0,Y=N.length;i<Y;i++)te((k=O(N[i],X[i],z)).x,k.y,m+B);for(f=0,d=U.length;f<d;f++)for(c=U[f],Q=Z[f],i=0,Y=c.length;i<Y;i++)k=O(c[i],Q[i],z),A?te(k.x,k.y+r[w-1].y,r[w-1].x+B):te(k.x,k.y,m+B)}function ee(e,t){var r,o;for(i=e.length;--i>=0;){r=i,(o=i-1)<0&&(o=e.length-1);var s=0,n=w+2*x;for(s=0;s<n;s++){var l=H*s,h=H*(s+1);ie(t+r+l,t+o+l,t+o+h,t+r+h,e,s,n,r,o)}}}function te(e,t,r){L.vertices.push(new oe.Vector3(e,t,r))}function re(a,b,r,o){a+=P,b+=P,r+=P,L.faces.push(new oe.Face3(a,b,r,null,null,T));var n=o?E.generateBottomUV(L,e,t,a,b,r):E.generateTopUV(L,e,t,a,b,r);L.faceVertexUvs[0].push(n)}function ie(a,b,r,o,n,l,h,c,f){a+=P,b+=P,r+=P,o+=P,L.faces.push(new oe.Face3(a,b,o,null,null,C)),L.faces.push(new oe.Face3(b,r,o,null,null,C));var d=E.generateSideWallUV(L,e,n,t,a,b,r,o,l,h,c,f);L.faceVertexUvs[0].push([d[0],d[1],d[3]]),L.faceVertexUvs[0].push([d[1],d[2],d[3]])}!function(){if(_){var e=0,t=H*e;for(i=0;i<j;i++)re((G=V[i])[2]+t,G[1]+t,G[0]+t,!0);for(t=H*(e=w+2*x),i=0;i<j;i++)re((G=V[i])[0]+t,G[1]+t,G[2]+t,!1)}else{for(i=0;i<j;i++)re((G=V[i])[2],G[1],G[0],!0);for(i=0;i<j;i++)re((G=V[i])[0]+H*w,G[1]+H*w,G[2]+H*w,!1)}}(),function(){var e=0;for(ee(N,e),e+=N.length,f=0,d=U.length;f<d;f++)ee(c=U[f],e),e+=c.length}()},oe.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,r,o,n,l){var h=e.vertices[o].x,c=e.vertices[o].y,f=e.vertices[n].x,d=e.vertices[n].y,m=e.vertices[l].x,v=e.vertices[l].y;return[new oe.Vector2(h,c),new oe.Vector2(f,d),new oe.Vector2(m,v)]},generateBottomUV:function(e,t,r,o,n,l){return this.generateTopUV(e,t,r,o,n,l)},generateSideWallUV:function(e,t,r,o,n,l,h,c,f,d,m,v){var y=e.vertices[n].x,x=e.vertices[n].y,_=e.vertices[n].z,M=e.vertices[l].x,w=e.vertices[l].y,S=e.vertices[l].z,A=e.vertices[h].x,T=e.vertices[h].y,C=e.vertices[h].z,E=e.vertices[c].x,L=e.vertices[c].y,P=e.vertices[c].z;return Math.abs(x-w)<.01?[new oe.Vector2(y,1-_),new oe.Vector2(M,1-S),new oe.Vector2(A,1-C),new oe.Vector2(E,1-P)]:[new oe.Vector2(x,1-_),new oe.Vector2(w,1-S),new oe.Vector2(T,1-C),new oe.Vector2(L,1-P)]}},oe.ExtrudeGeometry.__v1=new oe.Vector2,oe.ExtrudeGeometry.__v2=new oe.Vector2,oe.ExtrudeGeometry.__v3=new oe.Vector2,oe.ExtrudeGeometry.__v4=new oe.Vector2,oe.ExtrudeGeometry.__v5=new oe.Vector2,oe.ExtrudeGeometry.__v6=new oe.Vector2,oe.ShapeGeometry=function(e,t){oe.Geometry.call(this),this.className="ShapeGeometry",e instanceof Array==!1&&(e=[e]),this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),this.computeFaceNormals()},oe.ShapeGeometry.prototype=Object.create(oe.Geometry.prototype),oe.ShapeGeometry.prototype.addShapeList=function(e,t){for(var i=0,r=e.length;i<r;i++)this.addShape(e[i],t);return this},oe.ShapeGeometry.prototype.addShape=function(e,t){void 0===t&&(t={});var i,r,o,n=void 0!==t.curveSegments?t.curveSegments:12,l=t.material,h=void 0===t.UVGenerator?oe.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator,c=(this.shapebb,this.vertices.length),f=e.extractPoints(n),d=f.shape,m=f.holes,v=!oe.Shape.Utils.isClockWise(d);if(v){for(d=d.reverse(),i=0,r=m.length;i<r;i++)o=m[i],oe.Shape.Utils.isClockWise(o)&&(m[i]=o.reverse());v=!1}var y=oe.Shape.Utils.triangulateShape(d,m),x=d;for(i=0,r=m.length;i<r;i++)o=m[i],d=d.concat(o);var _,M,w=d.length,S=y.length;x.length;for(i=0;i<w;i++)_=d[i],this.vertices.push(new oe.Vector3(_.x,_.y,0));for(i=0;i<S;i++){var a=(M=y[i])[0]+c,b=M[1]+c,A=M[2]+c;this.faces.push(new oe.Face3(a,b,A,null,null,l)),this.faceVertexUvs[0].push(h.generateBottomUV(this,e,t,a,b,A))}},oe.LatheGeometry=function(e,t,r,o){oe.Geometry.call(this),this.className="LatheGeometry",t=t||12,r=r||0,o=o||2*Math.PI;for(var n=1/(e.length-1),l=1/t,i=0,h=t;i<=h;i++)for(var c=r+i*l*o,f=Math.cos(c),s=Math.sin(c),d=0,m=e.length;d<m;d++){var v=e[d],y=new oe.Vector3;y.x=f*v.x-s*v.y,y.y=s*v.x+f*v.y,y.z=v.z,this.vertices.push(y)}var x=e.length;for(i=0,h=t;i<h;i++)for(d=0,m=e.length-1;d<m;d++){var base=d+x*i,a=base,b=base+x,_=(f=base+1+x,base+1),M=i*l,w=d*n,S=M+l,A=w+n;this.faces.push(new oe.Face3(a,b,_)),this.faceVertexUvs[0].push([new oe.Vector2(M,w),new oe.Vector2(S,w),new oe.Vector2(M,A)]),this.faces.push(new oe.Face3(b,f,_)),this.faceVertexUvs[0].push([new oe.Vector2(S,w),new oe.Vector2(S,A),new oe.Vector2(M,A)])}this.mergeVertices(),this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},oe.LatheGeometry.prototype=Object.create(oe.Geometry.prototype),oe.PlaneGeometry=function(e,t,r,o){var n,l;oe.Geometry.call(this),this.className="PlaneGeometry",this.width=e,this.height=t,this.widthSegments=r||1,this.heightSegments=o||1;var h=e/2,c=t/2,f=this.widthSegments,d=this.heightSegments,m=f+1,v=d+1,y=this.width/f,x=this.height/d,_=new oe.Vector3(0,0,1);for(l=0;l<v;l++)for(n=0;n<m;n++){var M=n*y-h,w=l*x-c;this.vertices.push(new oe.Vector3(M,-w,0))}for(l=0;l<d;l++)for(n=0;n<f;n++){var a=n+m*l,b=n+m*(l+1),S=n+1+m*(l+1),A=n+1+m*l,T=new oe.Vector2(n/f,1-l/d),C=new oe.Vector2(n/f,1-(l+1)/d),E=new oe.Vector2((n+1)/f,1-(l+1)/d),L=new oe.Vector2((n+1)/f,1-l/d),P=new oe.Face3(a,b,A);P.normal.copy(_),P.vertexNormals.push(_.clone(),_.clone(),_.clone()),this.faces.push(P),this.faceVertexUvs[0].push([T,C,L]),(P=new oe.Face3(b,S,A)).normal.copy(_),P.vertexNormals.push(_.clone(),_.clone(),_.clone()),this.faces.push(P),this.faceVertexUvs[0].push([C.clone(),E,L.clone()])}this.computeCentroids()},oe.PlaneGeometry.prototype=Object.create(oe.Geometry.prototype),oe.RingGeometry=function(e,t,r,o,n,l){oe.Geometry.call(this),this.className="RingGeometry",e=e||0,t=t||50,n=void 0!==n?n:0,l=void 0!==l?l:2*Math.PI,r=void 0!==r?Math.max(3,r):8;var i,h,c=[],f=e,d=(t-e)/(o=void 0!==o?Math.max(3,o):8);for(i=0;i<=o;i++){for(h=0;h<=r;h++){var m=new oe.Vector3,v=n+h/r*l;m.x=f*Math.cos(v),m.y=f*Math.sin(v),this.vertices.push(m),c.push(new oe.Vector2((m.x/t+1)/2,(m.y/t+1)/2))}f+=d}var y=new oe.Vector3(0,0,1);for(i=0;i<o;i++){var x=i*r;for(h=0;h<=r;h++){var _=(v=h+x)+i,M=v+r+i,w=v+r+1+i;this.faces.push(new oe.Face3(_,M,w,[y.clone(),y.clone(),y.clone()])),this.faceVertexUvs[0].push([c[_].clone(),c[M].clone(),c[w].clone()]),_=v+i,M=v+r+1+i,w=v+1+i,this.faces.push(new oe.Face3(_,M,w,[y.clone(),y.clone(),y.clone()])),this.faceVertexUvs[0].push([c[_].clone(),c[M].clone(),c[w].clone()])}}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new oe.Sphere(new oe.Vector3,f)},oe.RingGeometry.prototype=Object.create(oe.Geometry.prototype),oe.SphereGeometry=function(e,t,r,o,n,l,h){oe.Geometry.call(this),this.className="SphereGeometry",this.radius=e=e||50,this.widthSegments=t=Math.max(3,Math.floor(t)||8),this.heightSegments=r=Math.max(2,Math.floor(r)||6),this.phiStart=o=void 0!==o?o:0,this.phiLength=n=void 0!==n?n:2*Math.PI,this.thetaStart=l=void 0!==l?l:0,this.thetaLength=h=void 0!==h?h:Math.PI;var c,f,d=[],m=[];for(f=0;f<=r;f++){var v=[],y=[];for(c=0;c<=t;c++){var u=c/t,x=f/r,_=new oe.Vector3;_.x=-e*Math.cos(o+u*n)*Math.sin(l+x*h),_.y=e*Math.cos(l+x*h),_.z=e*Math.sin(o+u*n)*Math.sin(l+x*h),this.vertices.push(_),v.push(this.vertices.length-1),y.push(new oe.Vector2(u,1-x))}d.push(v),m.push(y)}for(f=0;f<this.heightSegments;f++)for(c=0;c<this.widthSegments;c++){var M=d[f][c+1],w=d[f][c],S=d[f+1][c],A=d[f+1][c+1],T=this.vertices[M].clone().normalize(),C=this.vertices[w].clone().normalize(),E=this.vertices[S].clone().normalize(),L=this.vertices[A].clone().normalize(),P=m[f][c+1].clone(),R=m[f][c].clone(),D=m[f+1][c].clone(),U=m[f+1][c+1].clone();Math.abs(this.vertices[M].y)===this.radius?(P.x=(P.x+R.x)/2,this.faces.push(new oe.Face3(M,S,A,[T,E,L])),this.faceVertexUvs[0].push([P,D,U])):Math.abs(this.vertices[S].y)===this.radius?(D.x=(D.x+U.x)/2,this.faces.push(new oe.Face3(M,w,S,[T,C,E])),this.faceVertexUvs[0].push([P,R,D])):(this.faces.push(new oe.Face3(M,w,A,[T,C,L])),this.faceVertexUvs[0].push([P,R,U]),this.faces.push(new oe.Face3(w,S,A,[C.clone(),E,L.clone()])),this.faceVertexUvs[0].push([R.clone(),D,U.clone()]))}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new oe.Sphere(new oe.Vector3,e)},oe.SphereGeometry.prototype=Object.create(oe.Geometry.prototype),oe.TextGeometry=function(text,e){this.className="TextGeometry",e=e||{};var t=oe.FontUtils.generateShapes(text,e);e.amount=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),oe.ExtrudeGeometry.call(this,t,e)},oe.TextGeometry.prototype=Object.create(oe.ExtrudeGeometry.prototype),oe.TorusGeometry=function(e,t,r,o,n){oe.Geometry.call(this),this.className="TorusGeometry";this.radius=e||100,this.tube=t||40,this.radialSegments=r||8,this.tubularSegments=o||6,this.arc=n||2*Math.PI;for(var l=new oe.Vector3,h=[],c=[],f=0;f<=this.radialSegments;f++)for(var i=0;i<=this.tubularSegments;i++){var u=i/this.tubularSegments*this.arc,d=f/this.radialSegments*Math.PI*2;l.x=this.radius*Math.cos(u),l.y=this.radius*Math.sin(u);var m=new oe.Vector3;m.x=(this.radius+this.tube*Math.cos(d))*Math.cos(u),m.y=(this.radius+this.tube*Math.cos(d))*Math.sin(u),m.z=this.tube*Math.sin(d),this.vertices.push(m),h.push(new oe.Vector2(i/this.tubularSegments,f/this.radialSegments)),c.push(m.clone().sub(l).normalize())}for(f=1;f<=this.radialSegments;f++)for(i=1;i<=this.tubularSegments;i++){var a=(this.tubularSegments+1)*f+i-1,b=(this.tubularSegments+1)*(f-1)+i-1,v=(this.tubularSegments+1)*(f-1)+i,y=(this.tubularSegments+1)*f+i,x=new oe.Face3(a,b,y,[c[a].clone(),c[b].clone(),c[y].clone()]);this.faces.push(x),this.faceVertexUvs[0].push([h[a].clone(),h[b].clone(),h[y].clone()]),x=new oe.Face3(b,v,y,[c[b].clone(),c[v].clone(),c[y].clone()]),this.faces.push(x),this.faceVertexUvs[0].push([h[b].clone(),h[v].clone(),h[y].clone()])}this.computeCentroids(),this.computeFaceNormals()},oe.TorusGeometry.prototype=Object.create(oe.Geometry.prototype),oe.TorusKnotGeometry=function(e,t,r,o,p,q,n){oe.Geometry.call(this),this.className="TorusKnotGeometry";this.radius=e||100,this.tube=t||40,this.radialSegments=r||64,this.tubularSegments=o||8,this.p=p||2,this.q=q||3,this.heightScale=n||1,this.grid=new Array(this.radialSegments);for(var l=new oe.Vector3,h=new oe.Vector3,c=new oe.Vector3,i=0;i<this.radialSegments;++i){this.grid[i]=new Array(this.tubularSegments);var u=i/this.radialSegments*2*this.p*Math.PI,f=P(u,this.q,this.p,this.radius,this.heightScale),d=P(u+.01,this.q,this.p,this.radius,this.heightScale);l.subVectors(d,f),h.addVectors(d,f),c.crossVectors(l,h),h.crossVectors(c,l),c.normalize(),h.normalize();for(var m=0;m<this.tubularSegments;++m){var v=m/this.tubularSegments*2*Math.PI,y=-this.tube*Math.cos(v),x=this.tube*Math.sin(v),_=new oe.Vector3;_.x=f.x+y*h.x+x*c.x,_.y=f.y+y*h.y+x*c.y,_.z=f.z+y*h.z+x*c.z,this.grid[i][m]=this.vertices.push(_)-1}}for(i=0;i<this.radialSegments;++i)for(m=0;m<this.tubularSegments;++m){var M=(i+1)%this.radialSegments,w=(m+1)%this.tubularSegments,a=this.grid[i][m],b=this.grid[M][m],S=this.grid[M][w],A=this.grid[i][w],T=new oe.Vector2(i/this.radialSegments,m/this.tubularSegments),C=new oe.Vector2((i+1)/this.radialSegments,m/this.tubularSegments),E=new oe.Vector2((i+1)/this.radialSegments,(m+1)/this.tubularSegments),L=new oe.Vector2(i/this.radialSegments,(m+1)/this.tubularSegments);this.faces.push(new oe.Face3(a,b,A)),this.faceVertexUvs[0].push([T,C,L]),this.faces.push(new oe.Face3(b,S,A)),this.faceVertexUvs[0].push([C.clone(),E,L.clone()])}function P(u,e,t,r,o){var n=Math.cos(u),l=Math.sin(u),h=e/t*u,c=Math.cos(h),f=r*(2+c)*.5*n,d=r*(2+c)*l*.5,m=o*r*Math.sin(h)*.5;return new oe.Vector3(f,d,m)}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},oe.TorusKnotGeometry.prototype=Object.create(oe.Geometry.prototype),oe.TubeGeometry=function(path,e,t,r,o){oe.Geometry.call(this),this.className="TubeGeometry",this.path=path,this.segments=e||64,this.radius=t||1,this.radialSegments=r||8,this.closed=o||!1,this.grid=[];var n,l,u,h,c,f,d,i,m,v,y,a,b,x,_,M,w,S,A,T=this,C=this.segments+1,E=new oe.Vector3,L=new oe.TubeGeometry.FrenetFrames(this.path,this.segments,this.closed),P=L.tangents,R=L.normals,D=L.binormals;function U(e,t,r){return T.vertices.push(new oe.Vector3(e,t,r))-1}for(this.tangents=P,this.normals=R,this.binormals=D,i=0;i<C;i++)for(this.grid[i]=[],u=i/(C-1),d=path.getPointAt(u),P[i],n=R[i],l=D[i],m=0;m<this.radialSegments;m++)h=m/this.radialSegments*2*Math.PI,c=-this.radius*Math.cos(h),f=this.radius*Math.sin(h),E.copy(d),E.x+=c*n.x+f*l.x,E.y+=c*n.y+f*l.y,E.z+=c*n.z+f*l.z,this.grid[i][m]=U(E.x,E.y,E.z);for(i=0;i<this.segments;i++)for(m=0;m<this.radialSegments;m++)v=this.closed?(i+1)%this.segments:i+1,y=(m+1)%this.radialSegments,a=this.grid[i][m],b=this.grid[v][m],x=this.grid[v][y],_=this.grid[i][y],M=new oe.Vector2(i/this.segments,m/this.radialSegments),w=new oe.Vector2((i+1)/this.segments,m/this.radialSegments),S=new oe.Vector2((i+1)/this.segments,(m+1)/this.radialSegments),A=new oe.Vector2(i/this.segments,(m+1)/this.radialSegments),this.faces.push(new oe.Face3(a,b,_)),this.faceVertexUvs[0].push([M,w,A]),this.faces.push(new oe.Face3(b,x,_)),this.faceVertexUvs[0].push([w.clone(),S,A.clone()]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},oe.TubeGeometry.prototype=Object.create(oe.Geometry.prototype),oe.TubeGeometry.FrenetFrames=function(path,e,t){new oe.Vector3;var r,o,n,l,h,i,u,c=new oe.Vector3,f=(new oe.Vector3,[]),d=[],m=[],v=new oe.Vector3,y=new oe.Matrix4,x=e+1;for(this.tangents=f,this.normals=d,this.binormals=m,i=0;i<x;i++)u=i/(x-1),f[i]=path.getTangentAt(u),f[i].normalize();for(function(){d[0]=new oe.Vector3,m[0]=new oe.Vector3,o=Number.MAX_VALUE,n=Math.abs(f[0].x),l=Math.abs(f[0].y),h=Math.abs(f[0].z),n<=o&&(o=n,c.set(1,0,0));l<=o&&(o=l,c.set(0,1,0));h<=o&&c.set(0,0,1);v.crossVectors(f[0],c).normalize(),d[0].crossVectors(f[0],v),m[0].crossVectors(f[0],d[0])}(),i=1;i<x;i++)d[i]=d[i-1].clone(),m[i]=m[i-1].clone(),v.crossVectors(f[i-1],f[i]),v.length()>1e-4&&(v.normalize(),r=Math.acos(oe.Math.clamp(f[i-1].dot(f[i]),-1,1)),d[i].applyMatrix4(y.makeRotationAxis(v,r))),m[i].crossVectors(f[i],d[i]);if(t)for(r=Math.acos(oe.Math.clamp(d[0].dot(d[x-1]),-1,1)),r/=x-1,f[0].dot(v.crossVectors(d[0],d[x-1]))>0&&(r=-r),i=1;i<x;i++)d[i].applyMatrix4(y.makeRotationAxis(f[i],r*i)),m[i].crossVectors(f[i],d[i])},oe.PolyhedronGeometry=function(e,t,r,o){oe.Geometry.call(this),this.className="PolyhedronGeometry",r=r||1,o=o||0;for(var n=this,i=0,l=e.length;i<l;i++)w(new oe.Vector3(e[i][0],e[i][1],e[i][2]));var p=this.vertices,h=[];for(i=0,l=t.length;i<l;i++){var c=p[t[i][0]],f=p[t[i][1]],d=p[t[i][2]];h[i]=new oe.Face3(c.index,f.index,d.index,[c.clone(),f.clone(),d.clone()])}for(i=0,l=h.length;i<l;i++)A(h[i],o);for(i=0,l=this.faceVertexUvs[0].length;i<l;i++){var m=this.faceVertexUvs[0][i],v=m[0].x,y=m[1].x,x=m[2].x,_=Math.max(v,Math.max(y,x)),M=Math.min(v,Math.min(y,x));_>.9&&M<.1&&(v<.2&&(m[0].x+=1),y<.2&&(m[1].x+=1),x<.2&&(m[2].x+=1))}for(i=0,l=this.vertices.length;i<l;i++)this.vertices[i].multiplyScalar(r);function w(e){var t=e.normalize().clone();t.index=n.vertices.push(t)-1;var u=T(e)/2/Math.PI+.5,r=function(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}(e)/Math.PI+.5;return t.uv=new oe.Vector2(u,1-r),t}function S(e,t,r){var o=new oe.Face3(e.index,t.index,r.index,[e.clone(),t.clone(),r.clone()]);o.centroid.add(e).add(t).add(r).divideScalar(3),n.faces.push(o);var l=T(o.centroid);n.faceVertexUvs[0].push([C(e.uv,e,l),C(t.uv,t,l),C(r.uv,r,l)])}function A(e,t){for(var r=Math.pow(2,t),a=(Math.pow(4,t),w(n.vertices[e.a])),b=w(n.vertices[e.b]),o=w(n.vertices[e.c]),l=[],i=0;i<=r;i++){l[i]=[];for(var h=w(a.clone().lerp(o,i/r)),c=w(b.clone().lerp(o,i/r)),f=r-i,d=0;d<=f;d++)l[i][d]=0==d&&i==r?h:w(h.clone().lerp(c,d/f))}for(i=0;i<r;i++)for(d=0;d<2*(r-i)-1;d++){var m=Math.floor(d/2);d%2==0?S(l[i][m+1],l[i+1][m],l[i][m]):S(l[i][m+1],l[i+1][m+1],l[i+1][m])}}function T(e){return Math.atan2(e.z,-e.x)}function C(e,t,r){return r<0&&1===e.x&&(e=new oe.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new oe.Vector2(r/2/Math.PI+.5,e.y)),e.clone()}this.mergeVertices(),this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new oe.Sphere(new oe.Vector3,r)},oe.PolyhedronGeometry.prototype=Object.create(oe.Geometry.prototype),oe.IcosahedronGeometry=function(e,t){this.radius=e,this.detail=t;var r=(1+Math.sqrt(5))/2,o=[[-1,r,0],[1,r,0],[-1,-r,0],[1,-r,0],[0,-1,r],[0,1,r],[0,-1,-r],[0,1,-r],[r,0,-1],[r,0,1],[-r,0,-1],[-r,0,1]];oe.PolyhedronGeometry.call(this,o,[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]],e,t),this.className="IcosahedronGeometry"},oe.IcosahedronGeometry.prototype=Object.create(oe.Geometry.prototype),oe.OctahedronGeometry=function(e,t){oe.PolyhedronGeometry.call(this,[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]],e,t),this.className="OctahedronGeometry"},oe.OctahedronGeometry.prototype=Object.create(oe.Geometry.prototype),oe.TetrahedronGeometry=function(e,t){this.className="TetrahedronGeometry";oe.PolyhedronGeometry.call(this,[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]],[[2,1,0],[0,3,2],[1,3,0],[2,3,1]],e,t)},oe.TetrahedronGeometry.prototype=Object.create(oe.Geometry.prototype),oe.ParametricGeometry=function(e,t,r){oe.Geometry.call(this),this.className="ParametricGeometry";var i,o,p,n,a,b,l,h,c,f,d,m,v=this.vertices,y=this.faces,x=this.faceVertexUvs[0],_=t+1;for(i=0;i<=r;i++)for(n=i/r,o=0;o<=t;o++)p=e(o/t,n),v.push(p);for(i=0;i<r;i++)for(o=0;o<t;o++)a=i*_+o,b=i*_+o+1,l=(i+1)*_+o+1,h=(i+1)*_+o,c=new oe.Vector2(o/t,i/r),f=new oe.Vector2((o+1)/t,i/r),d=new oe.Vector2((o+1)/t,(i+1)/r),m=new oe.Vector2(o/t,(i+1)/r),y.push(new oe.Face3(a,b,h)),x.push([c,f,m]),y.push(new oe.Face3(b,l,h)),x.push([f.clone(),d,m.clone()]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},oe.ParametricGeometry.prototype=Object.create(oe.Geometry.prototype),oe.AxisHelper=function(e){e=e||1;var t=new oe.Geometry;t.vertices.push(new oe.Vector3,new oe.Vector3(e,0,0),new oe.Vector3,new oe.Vector3(0,e,0),new oe.Vector3,new oe.Vector3(0,0,e)),t.colors.push(new oe.Color(16711680),new oe.Color(16755200),new oe.Color(65280),new oe.Color(11206400),new oe.Color(255),new oe.Color(43775));var r=new oe.LineBasicMaterial({vertexColors:oe.VertexColors});oe.Line.call(this,t,r,oe.LinePieces),this.className="AxisHelper"},oe.AxisHelper.prototype=Object.create(oe.Line.prototype),oe.ArrowHelper=function(e,t,r,o,n,l){oe.Object3D.call(this),this.className="ArrowHelper",void 0===o&&(o=16776960),void 0===r&&(r=1),void 0===n&&(n=.2*r),void 0===l&&(l=.2*n),this.position=t;var h=new oe.Geometry;h.vertices.push(new oe.Vector3(0,0,0)),h.vertices.push(new oe.Vector3(0,1,0)),this.line=new oe.Line(h,new oe.LineBasicMaterial({color:o})),this.line.matrixAutoUpdate=!1,this.add(this.line);var c=new oe.CylinderGeometry(0,.5,1,5,1);c.applyMatrix((new oe.Matrix4).makeTranslation(0,-.5,0)),this.cone=new oe.Mesh(c,new oe.MeshBasicMaterial({color:o})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,n,l)},oe.ArrowHelper.prototype=Object.create(oe.Object3D.prototype),oe.ArrowHelper.prototype.setDirection=(ie=new oe.Vector3,function(e){e.y>.99999?this.quaternion.set(0,0,0,1):e.y<-.99999?this.quaternion.set(1,0,0,0):(ie.set(e.z,0,-e.x).normalize(),re=Math.acos(e.y),this.quaternion.setFromAxisAngle(ie,re))}),oe.ArrowHelper.prototype.setLength=function(e,t,r){void 0===t&&(t=.2*e),void 0===r&&(r=.2*t),this.line.scale.set(1,e,1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()},oe.ArrowHelper.prototype.setColor=function(e){this.line.material.color.setHex(e),this.cone.material.color.setHex(e)},oe.BoxHelper=function(object){var e=[new oe.Vector3(1,1,1),new oe.Vector3(-1,1,1),new oe.Vector3(-1,-1,1),new oe.Vector3(1,-1,1),new oe.Vector3(1,1,-1),new oe.Vector3(-1,1,-1),new oe.Vector3(-1,-1,-1),new oe.Vector3(1,-1,-1)];this.vertices=e;var t=new oe.Geometry;t.vertices.push(e[0],e[1],e[1],e[2],e[2],e[3],e[3],e[0],e[4],e[5],e[5],e[6],e[6],e[7],e[7],e[4],e[0],e[4],e[1],e[5],e[2],e[6],e[3],e[7]),oe.Line.call(this,t,new oe.LineBasicMaterial({color:16776960}),oe.LinePieces),void 0!==object&&this.update(object)},oe.BoxHelper.prototype=Object.create(oe.Line.prototype),oe.BoxHelper.prototype.update=function(object){var e=object.geometry;null===e.boundingBox&&e.computeBoundingBox();var t=e.boundingBox.min,r=e.boundingBox.max,o=this.vertices;o[0].set(r.x,r.y,r.z),o[1].set(t.x,r.y,r.z),o[2].set(t.x,t.y,r.z),o[3].set(r.x,t.y,r.z),o[4].set(r.x,r.y,t.z),o[5].set(t.x,r.y,t.z),o[6].set(t.x,t.y,t.z),o[7].set(r.x,t.y,t.z),this.geometry.computeBoundingSphere(),this.geometry.verticesNeedUpdate=!0,this.matrixAutoUpdate=!1,this.matrixWorld=object.matrixWorld},oe.BoundingBoxHelper=function(object,e){var t=void 0!==e?e:8947848;this.object=object,this.box=new oe.Box3,oe.Mesh.call(this,new oe.BoxGeometry(1,1,1),new oe.MeshBasicMaterial({color:t,wireframe:!0}))},oe.BoundingBoxHelper.prototype=Object.create(oe.Mesh.prototype),oe.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.center(this.position)},oe.CameraHelper=function(e){var t=new oe.Geometry,r=new oe.LineBasicMaterial({color:16777215,vertexColors:oe.FaceColors}),o={};function n(a,b,e){l(a,e),l(b,e)}function l(e,r){t.vertices.push(new oe.Vector3),t.colors.push(new oe.Color(r)),void 0===o[e]&&(o[e]=[]),o[e].push(t.vertices.length-1)}n("n1","n2",16755200),n("n2","n4",16755200),n("n4","n3",16755200),n("n3","n1",16755200),n("f1","f2",16755200),n("f2","f4",16755200),n("f4","f3",16755200),n("f3","f1",16755200),n("n1","f1",16755200),n("n2","f2",16755200),n("n3","f3",16755200),n("n4","f4",16755200),n("p","n1",16711680),n("p","n2",16711680),n("p","n3",16711680),n("p","n4",16711680),n("u1","u2",43775),n("u2","u3",43775),n("u3","u1",43775),n("c","t",16777215),n("p","c",3355443),n("cn1","cn2",3355443),n("cn3","cn4",3355443),n("cf1","cf2",3355443),n("cf3","cf4",3355443),oe.Line.call(this,t,r,oe.LinePieces),this.camera=e,this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()},oe.CameraHelper.prototype=Object.create(oe.Line.prototype),oe.CameraHelper.prototype.update=function(){var e=new oe.Vector3,t=new oe.Camera,r=new oe.Projector;return function(){var o=this;function n(n,l,h,c){e.set(l,h,c),r.unprojectVector(e,t);var f=o.pointMap[n];if(void 0!==f)for(var i=0,d=f.length;i<d;i++)o.geometry.vertices[f[i]].copy(e)}t.projectionMatrix.copy(this.camera.projectionMatrix),n("c",0,0,-1),n("t",0,0,1),n("n1",-1,-1,-1),n("n2",1,-1,-1),n("n3",-1,1,-1),n("n4",1,1,-1),n("f1",-1,-1,1),n("f2",1,-1,1),n("f3",-1,1,1),n("f4",1,1,1),n("u1",.7,1.1,-1),n("u2",-.7,1.1,-1),n("u3",0,2,-1),n("cf1",-1,0,1),n("cf2",1,0,1),n("cf3",0,-1,1),n("cf4",0,1,1),n("cn1",-1,0,-1),n("cn2",1,0,-1),n("cn3",0,-1,-1),n("cn4",0,1,-1),this.geometry.verticesNeedUpdate=!0}}(),oe.DirectionalLightHelper=function(e,t){oe.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,t=t||1;var r=new oe.PlaneGeometry(t,t),o=new oe.MeshBasicMaterial({wireframe:!0,fog:!1});o.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightPlane=new oe.Mesh(r,o),this.add(this.lightPlane),(r=new oe.Geometry).vertices.push(new oe.Vector3),r.vertices.push(new oe.Vector3),(o=new oe.LineBasicMaterial({fog:!1})).color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new oe.Line(r,o),this.add(this.targetLine),this.update()},oe.DirectionalLightHelper.prototype=Object.create(oe.Object3D.prototype),oe.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},oe.DirectionalLightHelper.prototype.update=function(){var e=new oe.Vector3,t=new oe.Vector3,r=new oe.Vector3;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),r.subVectors(t,e),this.lightPlane.lookAt(r),this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.vertices[1].copy(r),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.lightPlane.material.color)}}(),oe.EdgesHelper=function(object,e){var t=void 0!==e?e:16777215,r=[0,0],o={},n=function(a,b){return a-b},l=["a","b","c"],h=new oe.BufferGeometry,c=object.geometry.clone();c.mergeVertices(),c.computeFaceNormals();for(var f=c.vertices,d=c.faces,m=0,i=0,v=d.length;i<v;i++)for(var y=d[i],x=0;x<3;x++){r[0]=y[l[x]],r[1]=y[l[(x+1)%3]],r.sort(n),void 0===o[w=r.toString()]?(o[w]={vert1:r[0],vert2:r[1],face1:i,face2:void 0},m++):o[w].face2=i}h.addAttribute("position",Float32Array,2*m,3);var _=h.attributes.position.array,M=0;for(var w in o){var S=o[w];if(void 0===S.face2||d[S.face1].normal.dot(d[S.face2].normal)<.9999){var A=f[S.vert1];_[M++]=A.x,_[M++]=A.y,_[M++]=A.z,A=f[S.vert2],_[M++]=A.x,_[M++]=A.y,_[M++]=A.z}}oe.Line.call(this,h,new oe.LineBasicMaterial({color:t}),oe.LinePieces),this.matrixAutoUpdate=!1,this.matrixWorld=object.matrixWorld},oe.EdgesHelper.prototype=Object.create(oe.Line.prototype),oe.FaceNormalsHelper=function(object,e,t,r){this.object=object,this.size=void 0!==e?e:1;for(var o=void 0!==t?t:16776960,n=void 0!==r?r:1,l=new oe.Geometry,i=0,h=this.object.geometry.faces.length;i<h;i++)l.vertices.push(new oe.Vector3),l.vertices.push(new oe.Vector3);oe.Line.call(this,l,new oe.LineBasicMaterial({color:o,linewidth:n}),oe.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new oe.Matrix3,this.update()},oe.FaceNormalsHelper.prototype=Object.create(oe.Line.prototype),oe.FaceNormalsHelper.prototype.update=function(object){var e=new oe.Vector3;return function(object){this.object.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var t=this.geometry.vertices,r=this.object.geometry.faces,o=this.object.matrixWorld,i=0,n=r.length;i<n;i++){var l=r[i];e.copy(l.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size);var h=2*i;t[h].copy(l.centroid).applyMatrix4(o),t[h+1].addVectors(t[h],e)}return this.geometry.verticesNeedUpdate=!0,this}}(),oe.GridHelper=function(e,t){var r=new oe.Geometry,o=new oe.LineBasicMaterial({vertexColors:oe.VertexColors});this.color1=new oe.Color(4473924),this.color2=new oe.Color(8947848);for(var i=-e;i<=e;i+=t){r.vertices.push(new oe.Vector3(-e,0,i),new oe.Vector3(e,0,i),new oe.Vector3(i,0,-e),new oe.Vector3(i,0,e));var n=0===i?this.color1:this.color2;r.colors.push(n,n,n,n)}oe.Line.call(this,r,o,oe.LinePieces)},oe.GridHelper.prototype=Object.create(oe.Line.prototype),oe.GridHelper.prototype.setColors=function(e,t){this.color1.set(e),this.color2.set(t),this.geometry.colorsNeedUpdate=!0},oe.HemisphereLightHelper=function(e,t,r,o){oe.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new oe.Color,new oe.Color];var n=new oe.SphereGeometry(t,4,2);n.applyMatrix((new oe.Matrix4).makeRotationX(-Math.PI/2));for(var i=0;i<8;i++)n.faces[i].color=this.colors[i<4?0:1];var l=new oe.MeshBasicMaterial({vertexColors:oe.FaceColors,wireframe:!0});this.lightSphere=new oe.Mesh(n,l),this.add(this.lightSphere),this.update()},oe.HemisphereLightHelper.prototype=Object.create(oe.Object3D.prototype),oe.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},oe.HemisphereLightHelper.prototype.update=function(){var e=new oe.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}}(),oe.PointLightHelper=function(e,t){this.light=e,this.light.updateMatrixWorld();var r=new oe.SphereGeometry(t,4,2),o=new oe.MeshBasicMaterial({wireframe:!0,fog:!1});o.color.copy(this.light.color).multiplyScalar(this.light.intensity),oe.Mesh.call(this,r,o),this.matrixWorld=this.light.matrixWorld,this.matrixAutoUpdate=!1},oe.PointLightHelper.prototype=Object.create(oe.Mesh.prototype),oe.PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},oe.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},oe.SpotLightHelper=function(e){oe.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1;var t=new oe.CylinderGeometry(0,1,1,8,1,!0);t.applyMatrix((new oe.Matrix4).makeTranslation(0,-.5,0)),t.applyMatrix((new oe.Matrix4).makeRotationX(-Math.PI/2));var r=new oe.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new oe.Mesh(t,r),this.add(this.cone),this.update()},oe.SpotLightHelper.prototype=Object.create(oe.Object3D.prototype),oe.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},oe.SpotLightHelper.prototype.update=function(){var e=new oe.Vector3,t=new oe.Vector3;return function(){var r=this.light.distance?this.light.distance:1e4,o=r*Math.tan(this.light.angle);this.cone.scale.set(o,o,r),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),oe.VertexNormalsHelper=function(object,e,t,r){this.object=object,this.size=void 0!==e?e:1;for(var o=void 0!==t?t:16711680,n=void 0!==r?r:1,l=new oe.Geometry,h=(object.geometry.vertices,object.geometry.faces),i=0,c=h.length;i<c;i++)for(var f=0,d=h[i].vertexNormals.length;f<d;f++)l.vertices.push(new oe.Vector3),l.vertices.push(new oe.Vector3);oe.Line.call(this,l,new oe.LineBasicMaterial({color:o,linewidth:n}),oe.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new oe.Matrix3,this.update()},oe.VertexNormalsHelper.prototype=Object.create(oe.Line.prototype),oe.VertexNormalsHelper.prototype.update=function(object){var e=new oe.Vector3;return function(object){var t=["a","b","c","d"];this.object.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var r=this.geometry.vertices,o=this.object.geometry.vertices,n=this.object.geometry.faces,l=this.object.matrixWorld,h=0,i=0,c=n.length;i<c;i++)for(var f=n[i],d=0,m=f.vertexNormals.length;d<m;d++){var v=o[f[t[d]]],y=f.vertexNormals[d];r[h].copy(v).applyMatrix4(l),e.copy(y).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size),e.add(r[h]),r[h+=1].copy(e),h+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),oe.VertexTangentsHelper=function(object,e,t,r){this.object=object,this.size=void 0!==e?e:1;for(var o=void 0!==t?t:255,n=void 0!==r?r:1,l=new oe.Geometry,h=(object.geometry.vertices,object.geometry.faces),i=0,c=h.length;i<c;i++)for(var f=0,d=h[i].vertexTangents.length;f<d;f++)l.vertices.push(new oe.Vector3),l.vertices.push(new oe.Vector3);oe.Line.call(this,l,new oe.LineBasicMaterial({color:o,linewidth:n}),oe.LinePieces),this.matrixAutoUpdate=!1,this.update()},oe.VertexTangentsHelper.prototype=Object.create(oe.Line.prototype),oe.VertexTangentsHelper.prototype.update=function(object){var e=new oe.Vector3;return function(object){var t=["a","b","c","d"];this.object.updateMatrixWorld(!0);for(var r=this.geometry.vertices,o=this.object.geometry.vertices,n=this.object.geometry.faces,l=this.object.matrixWorld,h=0,i=0,c=n.length;i<c;i++)for(var f=n[i],d=0,m=f.vertexTangents.length;d<m;d++){var v=o[f[t[d]]],y=f.vertexTangents[d];r[h].copy(v).applyMatrix4(l),e.copy(y).transformDirection(l).multiplyScalar(this.size),e.add(r[h]),r[h+=1].copy(e),h+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),oe.WireframeHelper=function(object,e){var t=void 0!==e?e:16777215,r=[0,0],o={},n=function(a,b){return a-b},l=["a","b","c"],h=new oe.BufferGeometry;if(object.geometry instanceof oe.Geometry){for(var c=object.geometry.vertices,f=object.geometry.faces,d=0,m=new Uint32Array(6*f.length),i=0,v=f.length;i<v;i++)for(var y=f[i],x=0;x<3;x++){r[0]=y[l[x]],r[1]=y[l[(x+1)%3]],r.sort(n),void 0===o[P=r.toString()]&&(m[2*d]=r[0],m[2*d+1]=r[1],o[P]=!0,d++)}h.addAttribute("position",Float32Array,2*d,3);var _=h.attributes.position.array;for(i=0,v=d;i<v;i++)for(x=0;x<2;x++){var M=c[m[2*i+x]];_[(E=6*i+3*x)+0]=M.x,_[E+1]=M.y,_[E+2]=M.z}}else if(object.geometry instanceof oe.BufferGeometry&&void 0!==object.geometry.attributes.index){c=object.geometry.attributes.position.array;for(var w=object.geometry.attributes.index.array,S=object.geometry.offsets,A=(d=0,m=new Uint32Array(2*w.length),0),ol=S.length;A<ol;++A)for(var T=S[A].start,C=S[A].count,E=S[A].index,L=(i=T,T+C);i<L;i+=3)for(x=0;x<3;x++){var P;r[0]=E+w[i+x],r[1]=E+w[i+(x+1)%3],r.sort(n),void 0===o[P=r.toString()]&&(m[2*d]=r[0],m[2*d+1]=r[1],o[P]=!0,d++)}h.addAttribute("position",Float32Array,2*d,3);for(_=h.attributes.position.array,i=0,v=d;i<v;i++)for(x=0;x<2;x++){E=6*i+3*x;var R=3*m[2*i+x];_[E+0]=c[R],_[E+1]=c[R+1],_[E+2]=c[R+2]}}else if(object.geometry instanceof oe.BufferGeometry){var D=(d=(c=object.geometry.attributes.position.array).length/3)/3;h.addAttribute("position",Float32Array,2*d,3);for(_=h.attributes.position.array,i=0,v=D;i<v;i++)for(x=0;x<3;x++){var U=9*i+3*x;_[(E=18*i+6*x)+0]=c[U],_[E+1]=c[U+1],_[E+2]=c[U+2];R=9*i+(x+1)%3*3;_[E+3]=c[R],_[E+4]=c[R+1],_[E+5]=c[R+2]}}oe.Line.call(this,h,new oe.LineBasicMaterial({color:t}),oe.LinePieces),this.matrixAutoUpdate=!1,this.matrixWorld=object.matrixWorld},oe.WireframeHelper.prototype=Object.create(oe.Line.prototype),oe.ImmediateRenderObject=function(){oe.Object3D.call(this),this.render=function(e){}},oe.ImmediateRenderObject.prototype=Object.create(oe.Object3D.prototype),oe.LensFlare=function(e,t,r,o,n){oe.Object3D.call(this),this.lensFlares=[],this.positionScreen=new oe.Vector3,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,r,o,n)},oe.LensFlare.prototype=Object.create(oe.Object3D.prototype),oe.LensFlare.prototype.add=function(e,t,r,o,n,l){void 0===t&&(t=-1),void 0===r&&(r=0),void 0===l&&(l=1),void 0===n&&(n=new oe.Color(16777215)),void 0===o&&(o=oe.NormalBlending),r=Math.min(r,Math.max(0,r)),this.lensFlares.push({texture:e,size:t,distance:r,x:0,y:0,z:0,scale:1,rotation:1,opacity:l,color:n,blending:o})},oe.LensFlare.prototype.updateLensFlares=function(){var e,t,r=this.lensFlares.length,o=2*-this.positionScreen.x,n=2*-this.positionScreen.y;for(e=0;e<r;e++)(t=this.lensFlares[e]).x=this.positionScreen.x+o*t.distance,t.y=this.positionScreen.y+n*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation+=.25*(t.wantedRotation-t.rotation)},oe.MorphBlendMesh=function(e,t){oe.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var r=this.geometry.morphTargets.length,o=r-1,n=r/1;this.createAnimation("__default",0,o,n),this.setAnimationWeight("__default",1)},oe.MorphBlendMesh.prototype=Object.create(oe.Mesh.prototype),oe.MorphBlendMesh.prototype.createAnimation=function(e,t,r,o){var n={startFrame:t,endFrame:r,length:r-t+1,fps:o,duration:(r-t)/o,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=n,this.animationsList.push(n)},oe.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t,pattern=/([a-z]+)(\d+)/,r={},o=this.geometry,i=0,n=o.morphTargets.length;i<n;i++){var l=o.morphTargets[i].name.match(pattern);if(l&&l.length>1){var h=l[1];l[2];r[h]||(r[h]={start:1/0,end:-1/0}),i<(c=r[h]).start&&(c.start=i),i>c.end&&(c.end=i),t||(t=h)}}for(var h in r){var c=r[h];this.createAnimation(h,c.start,c.end,e)}this.firstAnimation=t},oe.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},oe.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},oe.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var r=this.animationsMap[e];r&&(r.fps=t,r.duration=(r.end-r.start)/r.fps)},oe.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var r=this.animationsMap[e];r&&(r.duration=t,r.fps=(r.end-r.start)/r.duration)},oe.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var r=this.animationsMap[e];r&&(r.weight=t)},oe.MorphBlendMesh.prototype.setAnimationTime=function(e,time){var t=this.animationsMap[e];t&&(t.time=time)},oe.MorphBlendMesh.prototype.getAnimationTime=function(e){var time=0,t=this.animationsMap[e];return t&&(time=t.time),time},oe.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1,r=this.animationsMap[e];return r&&(t=r.duration),t},oe.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):oe.onwarning("animation["+e+"] undefined")},oe.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];t&&(t.active=!1)},oe.MorphBlendMesh.prototype.update=function(e){for(var i=0,t=this.animationsList.length;i<t;i++){var r=this.animationsList[i];if(r.active){var o=r.duration/r.length;r.time+=r.direction*e,r.mirroredLoop?(r.time>r.duration||r.time<0)&&(r.direction*=-1,r.time>r.duration&&(r.time=r.duration,r.directionBackwards=!0),r.time<0&&(r.time=0,r.directionBackwards=!1)):(r.time=r.time%r.duration,r.time<0&&(r.time+=r.duration));var n=r.startFrame+oe.Math.clamp(Math.floor(r.time/o),0,r.length-1),l=r.weight;n!==r.currentFrame&&(this.morphTargetInfluences[r.lastFrame]=0,this.morphTargetInfluences[r.currentFrame]=1*l,this.morphTargetInfluences[n]=0,r.lastFrame=r.currentFrame,r.currentFrame=n);var h=r.time%o/o;r.directionBackwards&&(h=1-h),this.morphTargetInfluences[r.currentFrame]=h*l,this.morphTargetInfluences[r.lastFrame]=(1-h)*l}}},oe.LensFlarePlugin=function(){var e,t,r,o={};function n(t,r){var o=e.createProgram(),n=e.createShader(e.FRAGMENT_SHADER),l=e.createShader(e.VERTEX_SHADER),h="precision "+r+" float;\n";return e.shaderSource(n,h+t.fragmentShader),e.shaderSource(l,h+t.vertexShader),e.compileShader(n),e.compileShader(l),e.attachShader(o,n),e.attachShader(o,l),e.linkProgram(o),o}this.init=function(l){e=l.context,t=l,r=l.getPrecision(),o.vertices=new Float32Array(16),o.faces=new Uint16Array(6);var i=0;o.vertices[i++]=-1,o.vertices[i++]=-1,o.vertices[i++]=0,o.vertices[i++]=0,o.vertices[i++]=1,o.vertices[i++]=-1,o.vertices[i++]=1,o.vertices[i++]=0,o.vertices[i++]=1,o.vertices[i++]=1,o.vertices[i++]=1,o.vertices[i++]=1,o.vertices[i++]=-1,o.vertices[i++]=1,o.vertices[i++]=0,o.vertices[i++]=1,i=0,o.faces[i++]=0,o.faces[i++]=1,o.faces[i++]=2,o.faces[i++]=0,o.faces[i++]=2,o.faces[i++]=3,o.vertexBuffer=e.createBuffer(),o.elementBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,o.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,o.vertices,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,o.elementBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,o.faces,e.STATIC_DRAW),o.tempTexture=e.createTexture(),o.occlusionTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,o.tempTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGB,16,16,0,e.RGB,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.bindTexture(e.TEXTURE_2D,o.occlusionTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,16,16,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0?(o.hasVertexTexture=!1,o.program=n(oe.ShaderFlares.lensFlare,r)):(o.hasVertexTexture=!0,o.program=n(oe.ShaderFlares.lensFlareVertexTexture,r)),o.attributes={},o.uniforms={},o.attributes.vertex=e.getAttribLocation(o.program,"position"),o.attributes.uv=e.getAttribLocation(o.program,"uv"),o.uniforms.renderType=e.getUniformLocation(o.program,"renderType"),o.uniforms.map=e.getUniformLocation(o.program,"map"),o.uniforms.occlusionMap=e.getUniformLocation(o.program,"occlusionMap"),o.uniforms.opacity=e.getUniformLocation(o.program,"opacity"),o.uniforms.color=e.getUniformLocation(o.program,"color"),o.uniforms.scale=e.getUniformLocation(o.program,"scale"),o.uniforms.rotation=e.getUniformLocation(o.program,"rotation"),o.uniforms.screenPosition=e.getUniformLocation(o.program,"screenPosition")},this.render=function(r,n,l,h){var c=r.__webglFlares,f=c.length;if(f){var i,d,m,v,y,x=new oe.Vector3,_=h/l,M=.5*l,w=.5*h,S=16/h,A=new oe.Vector2(S*_,S),T=new oe.Vector3(1,1,0),C=new oe.Vector2(1,1),E=o.uniforms,L=o.attributes;for(e.useProgram(o.program),e.enableVertexAttribArray(o.attributes.vertex),e.enableVertexAttribArray(o.attributes.uv),e.uniform1i(E.occlusionMap,0),e.uniform1i(E.map,1),e.bindBuffer(e.ARRAY_BUFFER,o.vertexBuffer),e.vertexAttribPointer(L.vertex,2,e.FLOAT,!1,16,0),e.vertexAttribPointer(L.uv,2,e.FLOAT,!1,16,8),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,o.elementBuffer),e.disable(e.CULL_FACE),e.depthMask(!1),i=0;i<f;i++)if(S=16/h,A.set(S*_,S),v=c[i],x.set(v.matrixWorld.elements[12],v.matrixWorld.elements[13],v.matrixWorld.elements[14]),x.applyMatrix4(n.matrixWorldInverse),x.applyProjection(n.projectionMatrix),T.copy(x),C.x=T.x*M+M,C.y=T.y*w+w,o.hasVertexTexture||C.x>0&&C.x<l&&C.y>0&&C.y<h)for(e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,o.tempTexture),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGB,C.x-8,C.y-8,16,16,0),e.uniform1i(E.renderType,0),e.uniform2f(E.scale,A.x,A.y),e.uniform3f(E.screenPosition,T.x,T.y,T.z),e.disable(e.BLEND),e.enable(e.DEPTH_TEST),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,o.occlusionTexture),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,C.x-8,C.y-8,16,16,0),e.uniform1i(E.renderType,1),e.disable(e.DEPTH_TEST),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,o.tempTexture),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0),v.positionScreen.copy(T),v.customUpdateCallback?v.customUpdateCallback(v):v.updateLensFlares(),e.uniform1i(E.renderType,2),e.enable(e.BLEND),d=0,m=v.lensFlares.length;d<m;d++)(y=v.lensFlares[d]).opacity>.001&&y.scale>.001&&(T.x=y.x,T.y=y.y,T.z=y.z,S=y.size*y.scale/h,A.x=S*_,A.y=S,e.uniform3f(E.screenPosition,T.x,T.y,T.z),e.uniform2f(E.scale,A.x,A.y),e.uniform1f(E.rotation,y.rotation),e.uniform1f(E.opacity,y.opacity),e.uniform3f(E.color,y.color.r,y.color.g,y.color.b),t.setBlending(y.blending,y.blendEquation,y.blendSrc,y.blendDst),t.setTexture(y.texture,1),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0));e.enable(e.CULL_FACE),e.enable(e.DEPTH_TEST),e.depthMask(!0)}}},oe.ShadowMapPlugin=function(){var e,t,r,o,n,l,h=new oe.Frustum,c=new oe.Matrix4,f=new oe.Vector3,d=new oe.Vector3,m=new oe.Vector3;function v(e,t){var r=new oe.DirectionalLight;r.isVirtual=!0,r.onlyShadow=!0,r.castShadow=!0,r.shadowCameraNear=e.shadowCameraNear,r.shadowCameraFar=e.shadowCameraFar,r.shadowCameraLeft=e.shadowCameraLeft,r.shadowCameraRight=e.shadowCameraRight,r.shadowCameraBottom=e.shadowCameraBottom,r.shadowCameraTop=e.shadowCameraTop,r.shadowCameraVisible=e.shadowCameraVisible,r.shadowDarkness=e.shadowDarkness,r.shadowBias=e.shadowCascadeBias[t],r.shadowMapWidth=e.shadowCascadeWidth[t],r.shadowMapHeight=e.shadowCascadeHeight[t],r.pointsWorld=[],r.pointsFrustum=[];for(var o=r.pointsWorld,n=r.pointsFrustum,i=0;i<8;i++)o[i]=new oe.Vector3,n[i]=new oe.Vector3;var l=e.shadowCascadeNearZ[t],h=e.shadowCascadeFarZ[t];return n[0].set(-1,-1,l),n[1].set(1,-1,l),n[2].set(-1,1,l),n[3].set(1,1,l),n[4].set(-1,-1,h),n[5].set(1,-1,h),n[6].set(-1,1,h),n[7].set(1,1,h),r}function y(e,t){var r=e.shadowCascadeArray[t];r.position.copy(e.position),r.target.position.copy(e.target.position),r.lookAt(r.target),r.shadowCameraVisible=e.shadowCameraVisible,r.shadowDarkness=e.shadowDarkness,r.shadowBias=e.shadowCascadeBias[t];var o=e.shadowCascadeNearZ[t],n=e.shadowCascadeFarZ[t],l=r.pointsFrustum;l[0].z=o,l[1].z=o,l[2].z=o,l[3].z=o,l[4].z=n,l[5].z=n,l[6].z=n,l[7].z=n}function x(e,t){var r=t.shadowCamera,o=t.pointsFrustum,n=t.pointsWorld;f.set(1/0,1/0,1/0),d.set(-1/0,-1/0,-1/0);for(var i=0;i<8;i++){var p=n[i];p.copy(o[i]),oe.ShadowMapPlugin.__projector.unprojectVector(p,e),p.applyMatrix4(r.matrixWorldInverse),p.x<f.x&&(f.x=p.x),p.x>d.x&&(d.x=p.x),p.y<f.y&&(f.y=p.y),p.y>d.y&&(d.y=p.y),p.z<f.z&&(f.z=p.z),p.z>d.z&&(d.z=p.z)}r.left=f.x,r.right=d.x,r.top=d.y,r.bottom=f.y,r.updateProjectionMatrix()}function _(object){return object.material instanceof oe.MeshFaceMaterial?object.material.materials[0]:object.material}this.init=function(h){e=h.context,t=h;var c=oe.ShaderLib.depthRGBA,f=oe.UniformsUtils.clone(c.uniforms);r=new oe.ShaderMaterial({fragmentShader:c.fragmentShader,vertexShader:c.vertexShader,uniforms:f}),o=new oe.ShaderMaterial({fragmentShader:c.fragmentShader,vertexShader:c.vertexShader,uniforms:f,morphTargets:!0}),n=new oe.ShaderMaterial({fragmentShader:c.fragmentShader,vertexShader:c.vertexShader,uniforms:f,skinning:!0}),l=new oe.ShaderMaterial({fragmentShader:c.fragmentShader,vertexShader:c.vertexShader,uniforms:f,morphTargets:!0,skinning:!0}),r._shadowPass=!0,o._shadowPass=!0,n._shadowPass=!0,l._shadowPass=!0},this.render=function(e,r){t.shadowMapEnabled&&t.shadowMapAutoUpdate&&this.update(e,r)},this.update=function(f,d){var i,M,w,S,A,T,C,E,L,P,R,object,D,U,F=[],V=0;for(e.clearColor(1,1,1,1),e.disable(e.BLEND),e.enable(e.CULL_FACE),e.frontFace(e.CCW),t.shadowMapCullFace===oe.CullFaceFront?e.cullFace(e.FRONT):e.cullFace(e.BACK),t.setDepthTest(!0),i=0,M=f.__lights.length;i<M;i++)if((D=f.__lights[i]).castShadow)if(D instanceof oe.DirectionalLight&&D.shadowCascade)for(A=0;A<D.shadowCascadeCount;A++){var N;if(D.shadowCascadeArray[A])N=D.shadowCascadeArray[A];else{(N=v(D,A)).originalCamera=d;var O=new oe.Gyroscope;O.position=D.shadowCascadeOffset,O.add(N),O.add(N.target),d.add(O),D.shadowCascadeArray[A]=N}y(D,A),F[V]=N,V++}else F[V]=D,V++;for(i=0,M=F.length;i<M;i++){if(!(D=F[i]).shadowMap){var z=oe.LinearFilter;t.shadowMapType===oe.PCFSoftShadowMap&&(z=oe.NearestFilter);var I={minFilter:z,magFilter:z,format:oe.RGBAFormat};D.shadowMap=new oe.WebGLRenderTarget(D.shadowMapWidth,D.shadowMapHeight,I),D.shadowMapSize=new oe.Vector2(D.shadowMapWidth,D.shadowMapHeight),D.shadowMatrix=new oe.Matrix4}if(!D.shadowCamera){if(D instanceof oe.SpotLight)D.shadowCamera=new oe.PerspectiveCamera(D.shadowCameraFov,D.shadowMapWidth/D.shadowMapHeight,D.shadowCameraNear,D.shadowCameraFar);else{if(!(D instanceof oe.DirectionalLight)){oe.onerror("Unsupported light type for shadow");continue}D.shadowCamera=new oe.OrthographicCamera(D.shadowCameraLeft,D.shadowCameraRight,D.shadowCameraTop,D.shadowCameraBottom,D.shadowCameraNear,D.shadowCameraFar)}f.add(D.shadowCamera),!0===f.autoUpdate&&f.updateMatrixWorld()}for(D.shadowCameraVisible&&!D.cameraHelper&&(D.cameraHelper=new oe.CameraHelper(D.shadowCamera),D.shadowCamera.add(D.cameraHelper)),D.isVirtual&&N.originalCamera==d&&x(d,D),T=D.shadowMap,C=D.shadowMatrix,(E=D.shadowCamera).position.setFromMatrixPosition(D.matrixWorld),m.setFromMatrixPosition(D.target.matrixWorld),E.lookAt(m),E.updateMatrixWorld(),E.matrixWorldInverse.getInverse(E.matrixWorld),D.cameraHelper&&(D.cameraHelper.visible=D.shadowCameraVisible),D.shadowCameraVisible&&D.cameraHelper.update(),C.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),C.multiply(E.projectionMatrix),C.multiply(E.matrixWorldInverse),c.multiplyMatrices(E.projectionMatrix,E.matrixWorldInverse),h.setFromMatrix(c),t.setRenderTarget(T),t.clear(),w=0,S=(U=f.__webglObjects).length;w<S;w++)object=(R=U[w]).object,R.render=!1,object.visible&&object.castShadow&&((object instanceof oe.Mesh||object instanceof oe.ParticleSystem)&&object.frustumCulled&&!h.intersectsObject(object)||(object._modelViewMatrix.multiplyMatrices(E.matrixWorldInverse,object.matrixWorld),R.render=!0));var B,k,G;for(w=0,S=U.length;w<S;w++)(R=U[w]).render&&(object=R.object,L=R.buffer,B=_(object),k=void 0!==object.geometry.morphTargets&&object.geometry.morphTargets.length>0&&B.morphTargets,G=object instanceof oe.SkinnedMesh&&B.skinning,P=object.customDepthMaterial?object.customDepthMaterial:G?k?l:n:k?o:r,L instanceof oe.BufferGeometry?t.renderBufferDirect(E,f.__lights,null,P,L,object):t.renderBuffer(E,f.__lights,null,P,L,object));for(w=0,S=(U=f.__webglObjectsImmediate).length;w<S;w++)(object=(R=U[w]).object).visible&&object.castShadow&&(object._modelViewMatrix.multiplyMatrices(E.matrixWorldInverse,object.matrixWorld),t.renderImmediateObject(E,f.__lights,null,r,object))}var H=t.getClearColor(),j=t.getClearAlpha();e.clearColor(H.r,H.g,H.b,j),e.enable(e.BLEND),t.shadowMapCullFace===oe.CullFaceFront&&e.cullFace(e.BACK)}},oe.ShadowMapPlugin.__projector=new oe.Projector,oe.SpritePlugin=function(){var e,t,r,o,n,l,h,c,f,d;function m(a,b){return a.z!==b.z?b.z-a.z:b.id-a.id}this.init=function(m){e=m.context,t=m,o=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),n=new Uint16Array([0,1,2,0,2,3]),l=e.createBuffer(),h=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,l),e.bufferData(e.ARRAY_BUFFER,o,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,h),e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.STATIC_DRAW),c=function(){var r=e.createProgram(),o=e.createShader(e.VERTEX_SHADER),n=e.createShader(e.FRAGMENT_SHADER);return e.shaderSource(o,["precision "+t.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),e.shaderSource(n,["precision "+t.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),e.compileShader(o),e.compileShader(n),e.attachShader(r,o),e.attachShader(r,n),e.linkProgram(r),r}(),f={position:e.getAttribLocation(c,"position"),uv:e.getAttribLocation(c,"uv")},d={uvOffset:e.getUniformLocation(c,"uvOffset"),uvScale:e.getUniformLocation(c,"uvScale"),rotation:e.getUniformLocation(c,"rotation"),scale:e.getUniformLocation(c,"scale"),color:e.getUniformLocation(c,"color"),map:e.getUniformLocation(c,"map"),opacity:e.getUniformLocation(c,"opacity"),modelViewMatrix:e.getUniformLocation(c,"modelViewMatrix"),projectionMatrix:e.getUniformLocation(c,"projectionMatrix"),fogType:e.getUniformLocation(c,"fogType"),fogDensity:e.getUniformLocation(c,"fogDensity"),fogNear:e.getUniformLocation(c,"fogNear"),fogFar:e.getUniformLocation(c,"fogFar"),fogColor:e.getUniformLocation(c,"fogColor"),alphaTest:e.getUniformLocation(c,"alphaTest")};var canvas=document.createElement("canvas");canvas.width=8,canvas.height=8;var v=canvas.getContext("2d");v.fillStyle="#ffffff",v.fillRect(0,0,canvas.width,canvas.height),(r=new oe.Texture(canvas)).needsUpdate=!0},this.render=function(o,n,v,y){var x=o.__webglSprites,_=x.length;if(_){e.useProgram(c),e.enableVertexAttribArray(f.position),e.enableVertexAttribArray(f.uv),e.disable(e.CULL_FACE),e.enable(e.BLEND),e.bindBuffer(e.ARRAY_BUFFER,l),e.vertexAttribPointer(f.position,2,e.FLOAT,!1,16,0),e.vertexAttribPointer(f.uv,2,e.FLOAT,!1,16,8),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,h),e.uniformMatrix4fv(d.projectionMatrix,!1,n.projectionMatrix.elements),e.activeTexture(e.TEXTURE0),e.uniform1i(d.map,0);var M=0,w=0,S=o.fog;S?(e.uniform3f(d.fogColor,S.color.r,S.color.g,S.color.b),S instanceof oe.Fog?(e.uniform1f(d.fogNear,S.near),e.uniform1f(d.fogFar,S.far),e.uniform1i(d.fogType,1),M=1,w=1):S instanceof oe.FogExp2&&(e.uniform1f(d.fogDensity,S.density),e.uniform1i(d.fogType,2),M=2,w=2)):(e.uniform1i(d.fogType,0),M=0,w=0);var i,A,T,C,E=[];for(i=0;i<_;i++)T=(A=x[i]).material,!1!==A.visible&&(A._modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,A.matrixWorld),A.z=-A._modelViewMatrix.elements[14]);for(x.sort(m),i=0;i<_;i++)!1!==(A=x[i]).visible&&(T=A.material,e.uniform1f(d.alphaTest,T.alphaTest),e.uniformMatrix4fv(d.modelViewMatrix,!1,A._modelViewMatrix.elements),E[0]=A.scale.x,E[1]=A.scale.y,M!==(C=o.fog&&T.fog?w:0)&&(e.uniform1i(d.fogType,C),M=C),null!==T.map?(e.uniform2f(d.uvOffset,T.map.offset.x,T.map.offset.y),e.uniform2f(d.uvScale,T.map.repeat.x,T.map.repeat.y)):(e.uniform2f(d.uvOffset,0,0),e.uniform2f(d.uvScale,1,1)),e.uniform1f(d.opacity,T.opacity),e.uniform3f(d.color,T.color.r,T.color.g,T.color.b),e.uniform1f(d.rotation,T.rotation),e.uniform2fv(d.scale,E),t.setBlending(T.blending,T.blendEquation,T.blendSrc,T.blendDst),t.setDepthTest(T.depthTest),t.setDepthWrite(T.depthWrite),T.map&&T.map.image&&T.map.image.width?t.setTexture(T.map,0):t.setTexture(r,0),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0));e.enable(e.CULL_FACE)}}},oe.DepthPassPlugin=function(){this.enabled=!1,this.renderTarget=null;var e,t,r,o,n,l,h=new oe.Frustum,c=new oe.Matrix4;function f(object){return object.material instanceof oe.MeshFaceMaterial?object.material.materials[0]:object.material}this.init=function(h){e=h.context,t=h;var c=oe.ShaderLib.depthRGBA,f=oe.UniformsUtils.clone(c.uniforms);r=new oe.ShaderMaterial({fragmentShader:c.fragmentShader,vertexShader:c.vertexShader,uniforms:f}),o=new oe.ShaderMaterial({fragmentShader:c.fragmentShader,vertexShader:c.vertexShader,uniforms:f,morphTargets:!0}),n=new oe.ShaderMaterial({fragmentShader:c.fragmentShader,vertexShader:c.vertexShader,uniforms:f,skinning:!0}),l=new oe.ShaderMaterial({fragmentShader:c.fragmentShader,vertexShader:c.vertexShader,uniforms:f,morphTargets:!0,skinning:!0}),r._shadowPass=!0,o._shadowPass=!0,n._shadowPass=!0,l._shadowPass=!0},this.render=function(e,t){this.enabled&&this.update(e,t)},this.update=function(d,m){var v,y,x,_,M,object,w,S,A,T;for(e.clearColor(1,1,1,1),e.disable(e.BLEND),t.setDepthTest(!0),!0===d.autoUpdate&&d.updateMatrixWorld(),m.matrixWorldInverse.getInverse(m.matrixWorld),c.multiplyMatrices(m.projectionMatrix,m.matrixWorldInverse),h.setFromMatrix(c),t.setRenderTarget(this.renderTarget),t.clear(),v=0,y=(w=d.__webglObjects).length;v<y;v++)object=(M=w[v]).object,M.render=!1,object.visible&&((object instanceof oe.Mesh||object instanceof oe.ParticleSystem)&&object.frustumCulled&&!h.intersectsObject(object)||(object._modelViewMatrix.multiplyMatrices(m.matrixWorldInverse,object.matrixWorld),M.render=!0));for(v=0,y=w.length;v<y;v++)if((M=w[v]).render){if(object=M.object,x=M.buffer,object instanceof oe.ParticleSystem&&!object.customDepthMaterial)continue;(S=f(object))&&t.setMaterialFaces(object.material),A=object.geometry.morphTargets.length>0&&S.morphTargets,T=object instanceof oe.SkinnedMesh&&S.skinning,_=object.customDepthMaterial?object.customDepthMaterial:T?A?l:n:A?o:r,x instanceof oe.BufferGeometry?t.renderBufferDirect(m,d.__lights,null,_,x,object):t.renderBuffer(m,d.__lights,null,_,x,object)}for(v=0,y=(w=d.__webglObjectsImmediate).length;v<y;v++)(object=(M=w[v]).object).visible&&(object._modelViewMatrix.multiplyMatrices(m.matrixWorldInverse,object.matrixWorld),t.renderImmediateObject(m,d.__lights,null,r,object));var C=t.getClearColor(),E=t.getClearAlpha();e.clearColor(C.r,C.g,C.b,E),e.enable(e.BLEND)}},oe.ShaderFlares={lensFlareVertexTexture:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},lensFlare:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}},e.exports&&(t=e.exports=oe),t.THREE=oe},185:function(e,t,r){"use strict";e.exports=function(){var e=document.createElement("canvas");try{return!(!window.WebGLRenderingContext||!e.getContext("experimental-webgl")&&!e.getContext("webgl"))}catch(e){return null}}()},29:function(e,t,r){"use strict";var o={name:"NoSsr",functional:!0,props:{placeholder:String,placeholderTag:{type:String,default:"div"}},render:function(e,t){var r=t.parent,o=t.slots,n=t.props,l=o(),h=l.default;void 0===h&&(h=[]);var c=l.placeholder;return r._isMounted?h:(r.$once("hook:mounted",(function(){r.$forceUpdate()})),n.placeholderTag&&(n.placeholder||c)?e(n.placeholderTag,{class:["no-ssr-placeholder"]},n.placeholder||c):h.length>0?h.map((function(){return e(!1)})):e(!1))}};e.exports=o},69:function(e,t,r){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var content=function(e,t){var content=e[1]||"",r=e[3];if(!r)return content;if(t&&"function"==typeof btoa){var o=(l=r,h=btoa(unescape(encodeURIComponent(JSON.stringify(l)))),data="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(h),"/*# ".concat(data," */")),n=r.sources.map((function(source){return"/*# sourceURL=".concat(r.sourceRoot||"").concat(source," */")}));return[content].concat(n).concat([o]).join("\n")}var l,h,data;return[content].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(content,"}"):content})).join("")},t.i=function(e,r,o){"string"==typeof e&&(e=[[null,e,""]]);var n={};if(o)for(var i=0;i<this.length;i++){var l=this[i][0];null!=l&&(n[l]=!0)}for(var h=0;h<e.length;h++){var c=[].concat(e[h]);o&&n[c[0]]||(r&&(c[2]?c[2]="".concat(r," and ").concat(c[2]):c[2]=r),t.push(c))}},t}},70:function(e,t,r){"use strict";function o(e,t){for(var r=[],o={},i=0;i<t.length;i++){var n=t[i],l=n[0],h={id:e+":"+i,css:n[1],media:n[2],sourceMap:n[3]};o[l]?o[l].parts.push(h):r.push(o[l]={id:l,parts:[h]})}return r}r.r(t),r.d(t,"default",(function(){return y}));var n="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!n)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var l={},head=n&&(document.head||document.getElementsByTagName("head")[0]),h=null,c=0,f=!1,d=function(){},m=null,v="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function y(e,t,r,n){f=r,m=n||{};var h=o(e,t);return x(h),function(t){for(var r=[],i=0;i<h.length;i++){var n=h[i];(c=l[n.id]).refs--,r.push(c)}t?x(h=o(e,t)):h=[];for(i=0;i<r.length;i++){var c;if(0===(c=r[i]).refs){for(var f=0;f<c.parts.length;f++)c.parts[f]();delete l[c.id]}}}}function x(e){for(var i=0;i<e.length;i++){var t=e[i],r=l[t.id];if(r){r.refs++;for(var o=0;o<r.parts.length;o++)r.parts[o](t.parts[o]);for(;o<t.parts.length;o++)r.parts.push(M(t.parts[o]));r.parts.length>t.parts.length&&(r.parts.length=t.parts.length)}else{var n=[];for(o=0;o<t.parts.length;o++)n.push(M(t.parts[o]));l[t.id]={id:t.id,refs:1,parts:n}}}}function _(){var e=document.createElement("style");return e.type="text/css",head.appendChild(e),e}function M(e){var t,r,o=document.querySelector('style[data-vue-ssr-id~="'+e.id+'"]');if(o){if(f)return d;o.parentNode.removeChild(o)}if(v){var n=c++;o=h||(h=_()),t=A.bind(null,o,n,!1),r=A.bind(null,o,n,!0)}else o=_(),t=T.bind(null,o),r=function(){o.parentNode.removeChild(o)};return t(e),function(o){if(o){if(o.css===e.css&&o.media===e.media&&o.sourceMap===e.sourceMap)return;t(e=o)}else r()}}var w,S=(w=[],function(e,t){return w[e]=t,w.filter(Boolean).join("\n")});function A(e,t,r,o){var n=r?"":o.css;if(e.styleSheet)e.styleSheet.cssText=S(t,n);else{var l=document.createTextNode(n),h=e.childNodes;h[t]&&e.removeChild(h[t]),h.length?e.insertBefore(l,h[t]):e.appendChild(l)}}function T(e,t){var r=t.css,o=t.media,n=t.sourceMap;if(o&&e.setAttribute("media",o),m.ssrId&&e.setAttribute("data-vue-ssr-id",t.id),n&&(r+="\n/*# sourceURL="+n.sources[0]+" */",r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(n))))+" */"),e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}},72:function(e,t,r){"use strict";var o={name:"ClientOnly",functional:!0,props:{placeholder:String,placeholderTag:{type:String,default:"div"}},render:function(e,t){var r=t.parent,o=t.slots,n=t.props,l=o(),h=l.default;void 0===h&&(h=[]);var c=l.placeholder;return r._isMounted?h:(r.$once("hook:mounted",(function(){r.$forceUpdate()})),n.placeholderTag&&(n.placeholder||c)?e(n.placeholderTag,{class:["client-only-placeholder"]},n.placeholder||c):h.length>0?h.map((function(){return e(!1)})):e(!1))}};e.exports=o},73:function(e,t,r){"use strict";var o=["style","currency","currencyDisplay","useGrouping","minimumIntegerDigits","minimumFractionDigits","maximumFractionDigits","minimumSignificantDigits","maximumSignificantDigits","localeMatcher","formatMatcher","unit"];function n(e,t){"undefined"!=typeof console&&(console.warn("[vue-i18n] "+e),t&&console.warn(t.stack))}function l(e){return null!==e&&"object"==typeof e}var h=Object.prototype.toString;function c(e){return"[object Object]"===h.call(e)}function f(e){return null==e}function d(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];var r=null,o=null;return 1===e.length?l(e[0])||Array.isArray(e[0])?o=e[0]:"string"==typeof e[0]&&(r=e[0]):2===e.length&&("string"==typeof e[0]&&(r=e[0]),(l(e[1])||Array.isArray(e[1]))&&(o=e[1])),{locale:r,params:o}}function m(e){return JSON.parse(JSON.stringify(e))}var v=Object.prototype.hasOwnProperty;function y(e,t){return v.call(e,t)}function x(e){for(var t=arguments,output=Object(e),i=1;i<arguments.length;i++){var source=t[i];if(null!=source){var r=void 0;for(r in source)y(source,r)&&(l(source[r])?output[r]=x(output[r],source[r]):output[r]=source[r])}}return output}function _(a,b){if(a===b)return!0;var e=l(a),t=l(b);if(!e||!t)return!e&&!t&&String(a)===String(b);try{var r=Array.isArray(a),o=Array.isArray(b);if(r&&o)return a.length===b.length&&a.every((function(e,i){return _(e,b[i])}));if(r||o)return!1;var n=Object.keys(a),h=Object.keys(b);return n.length===h.length&&n.every((function(e){return _(a[e],b[e])}))}catch(e){return!1}}var M={beforeCreate:function(){var e=this.$options;if(e.i18n=e.i18n||(e.__i18n?{}:null),e.i18n)if(e.i18n instanceof Z){if(e.__i18n)try{var t={};e.__i18n.forEach((function(e){t=x(t,JSON.parse(e))})),Object.keys(t).forEach((function(r){e.i18n.mergeLocaleMessage(r,t[r])}))}catch(e){0}this._i18n=e.i18n,this._i18nWatcher=this._i18n.watchI18nData()}else if(c(e.i18n)){if(this.$root&&this.$root.$i18n&&this.$root.$i18n instanceof Z&&(e.i18n.root=this.$root,e.i18n.formatter=this.$root.$i18n.formatter,e.i18n.fallbackLocale=this.$root.$i18n.fallbackLocale,e.i18n.formatFallbackMessages=this.$root.$i18n.formatFallbackMessages,e.i18n.silentTranslationWarn=this.$root.$i18n.silentTranslationWarn,e.i18n.silentFallbackWarn=this.$root.$i18n.silentFallbackWarn,e.i18n.pluralizationRules=this.$root.$i18n.pluralizationRules,e.i18n.preserveDirectiveContent=this.$root.$i18n.preserveDirectiveContent),e.__i18n)try{var r={};e.__i18n.forEach((function(e){r=x(r,JSON.parse(e))})),e.i18n.messages=r}catch(e){0}var o=e.i18n.sharedMessages;o&&c(o)&&(e.i18n.messages=x(e.i18n.messages,o)),this._i18n=new Z(e.i18n),this._i18nWatcher=this._i18n.watchI18nData(),(void 0===e.i18n.sync||e.i18n.sync)&&(this._localeWatcher=this.$i18n.watchLocale())}else 0;else this.$root&&this.$root.$i18n&&this.$root.$i18n instanceof Z?this._i18n=this.$root.$i18n:e.parent&&e.parent.$i18n&&e.parent.$i18n instanceof Z&&(this._i18n=e.parent.$i18n)},beforeMount:function(){var e=this.$options;e.i18n=e.i18n||(e.__i18n?{}:null),e.i18n?e.i18n instanceof Z?(this._i18n.subscribeDataChanging(this),this._subscribing=!0):c(e.i18n)&&(this._i18n.subscribeDataChanging(this),this._subscribing=!0):this.$root&&this.$root.$i18n&&this.$root.$i18n instanceof Z?(this._i18n.subscribeDataChanging(this),this._subscribing=!0):e.parent&&e.parent.$i18n&&e.parent.$i18n instanceof Z&&(this._i18n.subscribeDataChanging(this),this._subscribing=!0)},beforeDestroy:function(){if(this._i18n){var e=this;this.$nextTick((function(){e._subscribing&&(e._i18n.unsubscribeDataChanging(e),delete e._subscribing),e._i18nWatcher&&(e._i18nWatcher(),e._i18n.destroyVM(),delete e._i18nWatcher),e._localeWatcher&&(e._localeWatcher(),delete e._localeWatcher),e._i18n=null}))}}},w={name:"i18n",functional:!0,props:{tag:{type:String},path:{type:String,required:!0},locale:{type:String},places:{type:[Array,Object]}},render:function(e,t){var data=t.data,r=t.parent,o=t.props,n=t.slots,l=r.$i18n;if(l){var path=o.path,h=o.locale,c=o.places,f=n(),d=l.i(path,h,function(e){var t;for(t in e)if("default"!==t)return!1;return Boolean(t)}(f)||c?function(e,t){var r=t?function(e){0;return Array.isArray(e)?e.reduce(A,{}):Object.assign({},e)}(t):{};if(!e)return r;var o=(e=e.filter((function(e){return e.tag||""!==e.text.trim()}))).every(T);0;return e.reduce(o?S:A,r)}(f.default,c):f),m=o.tag||"span";return m?e(m,data,d):d}}};function S(e,t){return t.data&&t.data.attrs&&t.data.attrs.place&&(e[t.data.attrs.place]=t),e}function A(e,t,r){return e[r]=t,e}function T(e){return Boolean(e.data&&e.data.attrs&&e.data.attrs.place)}var C,E={name:"i18n-n",functional:!0,props:{tag:{type:String,default:"span"},value:{type:Number,required:!0},format:{type:[String,Object]},locale:{type:String}},render:function(e,t){var r=t.props,n=t.parent,data=t.data,h=n.$i18n;if(!h)return null;var c=null,f=null;"string"==typeof r.format?c=r.format:l(r.format)&&(r.format.key&&(c=r.format.key),f=Object.keys(r.format).reduce((function(e,t){var n;return o.includes(t)?Object.assign({},e,((n={})[t]=r.format[t],n)):e}),null));var d=r.locale||h.locale,m=h._ntp(r.value,d,c,f),v=m.map((function(e,t){var r,slot=data.scopedSlots&&data.scopedSlots[e.type];return slot?slot(((r={})[e.type]=e.value,r.index=t,r.parts=m,r)):e.value}));return e(r.tag,{attrs:data.attrs,class:data.class,staticClass:data.staticClass},v)}};function L(e,t,r){D(e,r)&&U(e,t,r)}function P(e,t,r,o){if(D(e,r)){var n=r.context.$i18n;(function(e,t){var r=t.context;return e._locale===r.$i18n.locale})(e,r)&&_(t.value,t.oldValue)&&_(e._localeMessage,n.getLocaleMessage(n.locale))||U(e,t,r)}}function R(e,t,r,o){if(r.context){var l=r.context.$i18n||{};t.modifiers.preserve||l.preserveDirectiveContent||(e.textContent=""),e._vt=void 0,delete e._vt,e._locale=void 0,delete e._locale,e._localeMessage=void 0,delete e._localeMessage}else n("Vue instance does not exists in VNode context")}function D(e,t){var r=t.context;return r?!!r.$i18n||(n("VueI18n instance does not exists in Vue instance"),!1):(n("Vue instance does not exists in VNode context"),!1)}function U(e,t,r){var o,l,h=function(e){var path,t,r,o;"string"==typeof e?path=e:c(e)&&(path=e.path,t=e.locale,r=e.args,o=e.choice);return{path:path,locale:t,args:r,choice:o}}(t.value),path=h.path,f=h.locale,d=h.args,m=h.choice;if(path||f||d)if(path){var v=r.context;e._vt=e.textContent=m?(o=v.$i18n).tc.apply(o,[path,m].concat(F(f,d))):(l=v.$i18n).t.apply(l,[path].concat(F(f,d))),e._locale=v.$i18n.locale,e._localeMessage=v.$i18n.getLocaleMessage(v.$i18n.locale)}else n("`path` is required in v-t directive");else n("value type not supported")}function F(e,t){var r=[];return e&&r.push(e),t&&(Array.isArray(t)||c(t))&&r.push(t),r}function V(e){V.installed=!0;(C=e).version&&Number(C.version.split(".")[0]);(function(e){e.prototype.hasOwnProperty("$i18n")||Object.defineProperty(e.prototype,"$i18n",{get:function(){return this._i18n}}),e.prototype.$t=function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];var o=this.$i18n;return o._t.apply(o,[e,o.locale,o._getMessages(),this].concat(t))},e.prototype.$tc=function(e,t){for(var r=[],o=arguments.length-2;o-- >0;)r[o]=arguments[o+2];var n=this.$i18n;return n._tc.apply(n,[e,n.locale,n._getMessages(),this,t].concat(r))},e.prototype.$te=function(e,t){var r=this.$i18n;return r._te(e,r.locale,r._getMessages(),t)},e.prototype.$d=function(e){for(var t,r=[],o=arguments.length-1;o-- >0;)r[o]=arguments[o+1];return(t=this.$i18n).d.apply(t,[e].concat(r))},e.prototype.$n=function(e){for(var t,r=[],o=arguments.length-1;o-- >0;)r[o]=arguments[o+1];return(t=this.$i18n).n.apply(t,[e].concat(r))}})(C),C.mixin(M),C.directive("t",{bind:L,update:P,unbind:R}),C.component(w.name,w),C.component(E.name,E),C.config.optionMergeStrategies.i18n=function(e,t){return void 0===t?e:t}}var N=function(){this._caches=Object.create(null)};N.prototype.interpolate=function(e,t){if(!t)return[e];var r=this._caches[e];return r||(r=function(e){var t=[],r=0,text="";for(;r<e.length;){var o=e[r++];if("{"===o){text&&t.push({type:"text",value:text}),text="";var sub="";for(o=e[r++];void 0!==o&&"}"!==o;)sub+=o,o=e[r++];var n="}"===o,l=O.test(sub)?"list":n&&z.test(sub)?"named":"unknown";t.push({value:sub,type:l})}else"%"===o?"{"!==e[r]&&(text+=o):text+=o}return text&&t.push({type:"text",value:text}),t}(e),this._caches[e]=r),function(e,t){var r=[],o=0,n=Array.isArray(t)?"list":l(t)?"named":"unknown";if("unknown"===n)return r;for(;o<e.length;){var h=e[o];switch(h.type){case"text":r.push(h.value);break;case"list":r.push(t[parseInt(h.value,10)]);break;case"named":"named"===n&&r.push(t[h.value]);break;case"unknown":0}o++}return r}(r,t)};var O=/^(?:\d)+/,z=/^(?:\w)+/;var I=[];I[0]={ws:[0],ident:[3,0],"[":[4],eof:[7]},I[1]={ws:[1],".":[2],"[":[4],eof:[7]},I[2]={ws:[2],ident:[3,0],0:[3,0],number:[3,0]},I[3]={ident:[3,0],0:[3,0],number:[3,0],ws:[1,1],".":[2,1],"[":[4,1],eof:[7,1]},I[4]={"'":[5,0],'"':[6,0],"[":[4,2],"]":[1,3],eof:8,else:[4,0]},I[5]={"'":[4,0],eof:8,else:[5,0]},I[6]={'"':[4,0],eof:8,else:[6,0]};var B=/^\s?(?:true|false|-?[\d.]+|'[^']*'|"[^"]*")\s?$/;function k(e){if(null==e)return"eof";switch(e.charCodeAt(0)){case 91:case 93:case 46:case 34:case 39:return e;case 95:case 36:case 45:return"ident";case 9:case 10:case 13:case 160:case 65279:case 8232:case 8233:return"ws"}return"ident"}function G(path){var e,a,t,r=path.trim();return("0"!==path.charAt(0)||!isNaN(path))&&(t=r,B.test(t)?(a=(e=r).charCodeAt(0))!==e.charCodeAt(e.length-1)||34!==a&&39!==a?e:e.slice(1,-1):"*"+r)}var H=function(){this._cache=Object.create(null)};H.prototype.parsePath=function(path){var e=this._cache[path];return e||(e=function(path){var e,t,r,o,n,l,h,c=[],f=-1,d=0,m=0,v=[];function y(){var e=path[f+1];if(5===d&&"'"===e||6===d&&'"'===e)return f++,r="\\"+e,v[0](),!0}for(v[1]=function(){void 0!==t&&(c.push(t),t=void 0)},v[0]=function(){void 0===t?t=r:t+=r},v[2]=function(){v[0](),m++},v[3]=function(){if(m>0)m--,d=4,v[0]();else{if(m=0,void 0===t)return!1;if(!1===(t=G(t)))return!1;v[1]()}};null!==d;)if(f++,"\\"!==(e=path[f])||!y()){if(o=k(e),8===(n=(h=I[d])[o]||h.else||8))return;if(d=n[0],(l=v[n[1]])&&(r=void 0===(r=n[2])?e:r,!1===l()))return;if(7===d)return c}}(path))&&(this._cache[path]=e),e||[]},H.prototype.getPathValue=function(e,path){if(!l(e))return null;var t=this.parsePath(path);if(0===t.length)return null;for(var r=t.length,o=e,i=0;i<r;){var n=o[t[i]];if(void 0===n)return null;o=n,i++}return o};var j,W=/<\/?[\w\s="/.':;#-\/]+>/,X=/(?:@(?:\.[a-z]+)?:(?:[\w\-_|.]+|\([\w\-_|.]+\)))/g,Y=/^@(?:\.([a-z]+))?:/,K=/[()]/g,$={upper:function(e){return e.toLocaleUpperCase()},lower:function(e){return e.toLocaleLowerCase()}},Q=new N,Z=function(e){var t=this;void 0===e&&(e={}),!C&&"undefined"!=typeof window&&window.Vue&&V(window.Vue);var r=e.locale||"en-US",o=e.fallbackLocale||"en-US",n=e.messages||{},l=e.dateTimeFormats||{},h=e.numberFormats||{};this._vm=null,this._formatter=e.formatter||Q,this._modifiers=e.modifiers||{},this._missing=e.missing||null,this._root=e.root||null,this._sync=void 0===e.sync||!!e.sync,this._fallbackRoot=void 0===e.fallbackRoot||!!e.fallbackRoot,this._formatFallbackMessages=void 0!==e.formatFallbackMessages&&!!e.formatFallbackMessages,this._silentTranslationWarn=void 0!==e.silentTranslationWarn&&e.silentTranslationWarn,this._silentFallbackWarn=void 0!==e.silentFallbackWarn&&!!e.silentFallbackWarn,this._dateTimeFormatters={},this._numberFormatters={},this._path=new H,this._dataListeners=[],this._preserveDirectiveContent=void 0!==e.preserveDirectiveContent&&!!e.preserveDirectiveContent,this.pluralizationRules=e.pluralizationRules||{},this._warnHtmlInMessage=e.warnHtmlInMessage||"off",this._exist=function(e,r){return!(!e||!r)&&(!f(t._path.getPathValue(e,r))||!!e[r])},"warn"!==this._warnHtmlInMessage&&"error"!==this._warnHtmlInMessage||Object.keys(n).forEach((function(e){t._checkLocaleMessage(e,t._warnHtmlInMessage,n[e])})),this._initVM({locale:r,fallbackLocale:o,messages:n,dateTimeFormats:l,numberFormats:h})},J={vm:{configurable:!0},messages:{configurable:!0},dateTimeFormats:{configurable:!0},numberFormats:{configurable:!0},availableLocales:{configurable:!0},locale:{configurable:!0},fallbackLocale:{configurable:!0},formatFallbackMessages:{configurable:!0},missing:{configurable:!0},formatter:{configurable:!0},silentTranslationWarn:{configurable:!0},silentFallbackWarn:{configurable:!0},preserveDirectiveContent:{configurable:!0},warnHtmlInMessage:{configurable:!0}};Z.prototype._checkLocaleMessage=function(e,t,r){var o=function(e,t,r,l){if(c(r))Object.keys(r).forEach((function(n){var h=r[n];c(h)?(l.push(n),l.push("."),o(e,t,h,l),l.pop(),l.pop()):(l.push(n),o(e,t,h,l),l.pop())}));else if(Array.isArray(r))r.forEach((function(r,n){c(r)?(l.push("["+n+"]"),l.push("."),o(e,t,r,l),l.pop(),l.pop()):(l.push("["+n+"]"),o(e,t,r,l),l.pop())}));else if("string"==typeof r){if(W.test(r)){var h="Detected HTML in message '"+r+"' of keypath '"+l.join("")+"' at '"+t+"'. Consider component interpolation with '<i18n>' to avoid XSS. See https://bit.ly/2ZqJzkp";"warn"===e?n(h):"error"===e&&function(e,t){"undefined"!=typeof console&&(console.error("[vue-i18n] "+e),t&&console.error(t.stack))}(h)}}};o(t,e,r,[])},Z.prototype._initVM=function(data){var e=C.config.silent;C.config.silent=!0,this._vm=new C({data:data}),C.config.silent=e},Z.prototype.destroyVM=function(){this._vm.$destroy()},Z.prototype.subscribeDataChanging=function(e){this._dataListeners.push(e)},Z.prototype.unsubscribeDataChanging=function(e){!function(e,t){if(e.length){var r=e.indexOf(t);if(r>-1)e.splice(r,1)}}(this._dataListeners,e)},Z.prototype.watchI18nData=function(){var e=this;return this._vm.$watch("$data",(function(){for(var i=e._dataListeners.length;i--;)C.nextTick((function(){e._dataListeners[i]&&e._dataListeners[i].$forceUpdate()}))}),{deep:!0})},Z.prototype.watchLocale=function(){if(!this._sync||!this._root)return null;var e=this._vm;return this._root.$i18n.vm.$watch("locale",(function(t){e.$set(e,"locale",t),e.$forceUpdate()}),{immediate:!0})},J.vm.get=function(){return this._vm},J.messages.get=function(){return m(this._getMessages())},J.dateTimeFormats.get=function(){return m(this._getDateTimeFormats())},J.numberFormats.get=function(){return m(this._getNumberFormats())},J.availableLocales.get=function(){return Object.keys(this.messages).sort()},J.locale.get=function(){return this._vm.locale},J.locale.set=function(e){this._vm.$set(this._vm,"locale",e)},J.fallbackLocale.get=function(){return this._vm.fallbackLocale},J.fallbackLocale.set=function(e){this._vm.$set(this._vm,"fallbackLocale",e)},J.formatFallbackMessages.get=function(){return this._formatFallbackMessages},J.formatFallbackMessages.set=function(e){this._formatFallbackMessages=e},J.missing.get=function(){return this._missing},J.missing.set=function(e){this._missing=e},J.formatter.get=function(){return this._formatter},J.formatter.set=function(e){this._formatter=e},J.silentTranslationWarn.get=function(){return this._silentTranslationWarn},J.silentTranslationWarn.set=function(e){this._silentTranslationWarn=e},J.silentFallbackWarn.get=function(){return this._silentFallbackWarn},J.silentFallbackWarn.set=function(e){this._silentFallbackWarn=e},J.preserveDirectiveContent.get=function(){return this._preserveDirectiveContent},J.preserveDirectiveContent.set=function(e){this._preserveDirectiveContent=e},J.warnHtmlInMessage.get=function(){return this._warnHtmlInMessage},J.warnHtmlInMessage.set=function(e){var t=this,r=this._warnHtmlInMessage;if(this._warnHtmlInMessage=e,r!==e&&("warn"===e||"error"===e)){var o=this._getMessages();Object.keys(o).forEach((function(e){t._checkLocaleMessage(e,t._warnHtmlInMessage,o[e])}))}},Z.prototype._getMessages=function(){return this._vm.messages},Z.prototype._getDateTimeFormats=function(){return this._vm.dateTimeFormats},Z.prototype._getNumberFormats=function(){return this._vm.numberFormats},Z.prototype._warnDefault=function(e,t,r,o,n){if(!f(r))return r;if(this._missing){var l=this._missing.apply(null,[e,t,o,n]);if("string"==typeof l)return l}else 0;if(this._formatFallbackMessages){var h=d.apply(void 0,n);return this._render(t,"string",h.params,t)}return t},Z.prototype._isFallbackRoot=function(e){return!e&&!f(this._root)&&this._fallbackRoot},Z.prototype._isSilentFallbackWarn=function(e){return this._silentFallbackWarn instanceof RegExp?this._silentFallbackWarn.test(e):this._silentFallbackWarn},Z.prototype._isSilentFallback=function(e,t){return this._isSilentFallbackWarn(t)&&(this._isFallbackRoot()||e!==this.fallbackLocale)},Z.prototype._isSilentTranslationWarn=function(e){return this._silentTranslationWarn instanceof RegExp?this._silentTranslationWarn.test(e):this._silentTranslationWarn},Z.prototype._interpolate=function(e,t,r,o,n,l,h){if(!t)return null;var d,m=this._path.getPathValue(t,r);if(Array.isArray(m)||c(m))return m;if(f(m)){if(!c(t))return null;if("string"!=typeof(d=t[r]))return null}else{if("string"!=typeof m)return null;d=m}return(d.indexOf("@:")>=0||d.indexOf("@.")>=0)&&(d=this._link(e,t,d,o,"raw",l,h)),this._render(d,n,l,r)},Z.prototype._link=function(e,t,r,o,n,l,h){var c=r,f=c.match(X);for(var d in f)if(f.hasOwnProperty(d)){var link=f[d],m=link.match(Y),v=m[0],y=m[1],x=link.replace(v,"").replace(K,"");if(h.includes(x))return c;h.push(x);var _=this._interpolate(e,t,x,o,"raw"===n?"string":n,"raw"===n?void 0:l,h);if(this._isFallbackRoot(_)){if(!this._root)throw Error("unexpected error");var M=this._root.$i18n;_=M._translate(M._getMessages(),M.locale,M.fallbackLocale,x,o,n,l)}_=this._warnDefault(e,x,_,o,Array.isArray(l)?l:[l]),this._modifiers.hasOwnProperty(y)?_=this._modifiers[y](_):$.hasOwnProperty(y)&&(_=$[y](_)),h.pop(),c=_?c.replace(link,_):c}return c},Z.prototype._render=function(e,t,r,path){var o=this._formatter.interpolate(e,r,path);return o||(o=Q.interpolate(e,r,path)),"string"===t?o.join(""):o},Z.prototype._translate=function(e,t,r,o,n,l,h){var c=this._interpolate(t,e[t],o,n,l,h,[o]);return f(c)&&f(c=this._interpolate(r,e[r],o,n,l,h,[o]))?null:c},Z.prototype._t=function(e,t,r,o){for(var n,l=[],h=arguments.length-4;h-- >0;)l[h]=arguments[h+4];if(!e)return"";var c=d.apply(void 0,l),f=c.locale||t,m=this._translate(r,f,this.fallbackLocale,e,o,"string",c.params);if(this._isFallbackRoot(m)){if(!this._root)throw Error("unexpected error");return(n=this._root).$t.apply(n,[e].concat(l))}return this._warnDefault(f,e,m,o,l)},Z.prototype.t=function(e){for(var t,r=[],o=arguments.length-1;o-- >0;)r[o]=arguments[o+1];return(t=this)._t.apply(t,[e,this.locale,this._getMessages(),null].concat(r))},Z.prototype._i=function(e,t,r,o,n){var l=this._translate(r,t,this.fallbackLocale,e,o,"raw",n);if(this._isFallbackRoot(l)){if(!this._root)throw Error("unexpected error");return this._root.$i18n.i(e,t,n)}return this._warnDefault(t,e,l,o,[n])},Z.prototype.i=function(e,t,r){return e?("string"!=typeof t&&(t=this.locale),this._i(e,t,this._getMessages(),null,r)):""},Z.prototype._tc=function(e,t,r,o,n){for(var l,h=[],c=arguments.length-5;c-- >0;)h[c]=arguments[c+5];if(!e)return"";void 0===n&&(n=1);var f={count:n,n:n},m=d.apply(void 0,h);return m.params=Object.assign(f,m.params),h=null===m.locale?[m.params]:[m.locale,m.params],this.fetchChoice((l=this)._t.apply(l,[e,t,r,o].concat(h)),n)},Z.prototype.fetchChoice=function(e,t){if(!e&&"string"!=typeof e)return null;var r=e.split("|");return r[t=this.getChoiceIndex(t,r.length)]?r[t].trim():e},Z.prototype.getChoiceIndex=function(e,t){var r,o;return this.locale in this.pluralizationRules?this.pluralizationRules[this.locale].apply(this,[e,t]):(r=e,o=t,r=Math.abs(r),2===o?r?r>1?1:0:1:r?Math.min(r,2):0)},Z.prototype.tc=function(e,t){for(var r,o=[],n=arguments.length-2;n-- >0;)o[n]=arguments[n+2];return(r=this)._tc.apply(r,[e,this.locale,this._getMessages(),null,t].concat(o))},Z.prototype._te=function(e,t,r){for(var o=[],n=arguments.length-3;n-- >0;)o[n]=arguments[n+3];var l=d.apply(void 0,o).locale||t;return this._exist(r[l],e)},Z.prototype.te=function(e,t){return this._te(e,this.locale,this._getMessages(),t)},Z.prototype.getLocaleMessage=function(e){return m(this._vm.messages[e]||{})},Z.prototype.setLocaleMessage=function(e,t){("warn"!==this._warnHtmlInMessage&&"error"!==this._warnHtmlInMessage||(this._checkLocaleMessage(e,this._warnHtmlInMessage,t),"error"!==this._warnHtmlInMessage))&&this._vm.$set(this._vm.messages,e,t)},Z.prototype.mergeLocaleMessage=function(e,t){("warn"!==this._warnHtmlInMessage&&"error"!==this._warnHtmlInMessage||(this._checkLocaleMessage(e,this._warnHtmlInMessage,t),"error"!==this._warnHtmlInMessage))&&this._vm.$set(this._vm.messages,e,x({},this._vm.messages[e]||{},t))},Z.prototype.getDateTimeFormat=function(e){return m(this._vm.dateTimeFormats[e]||{})},Z.prototype.setDateTimeFormat=function(e,t){this._vm.$set(this._vm.dateTimeFormats,e,t)},Z.prototype.mergeDateTimeFormat=function(e,t){this._vm.$set(this._vm.dateTimeFormats,e,x(this._vm.dateTimeFormats[e]||{},t))},Z.prototype._localizeDateTime=function(e,t,r,o,n){var l=t,h=o[l];if((f(h)||f(h[n]))&&(h=o[l=r]),f(h)||f(h[n]))return null;var c=h[n],d=l+"__"+n,m=this._dateTimeFormatters[d];return m||(m=this._dateTimeFormatters[d]=new Intl.DateTimeFormat(l,c)),m.format(e)},Z.prototype._d=function(e,t,r){if(!r)return new Intl.DateTimeFormat(t).format(e);var o=this._localizeDateTime(e,t,this.fallbackLocale,this._getDateTimeFormats(),r);if(this._isFallbackRoot(o)){if(!this._root)throw Error("unexpected error");return this._root.$i18n.d(e,r,t)}return o||""},Z.prototype.d=function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];var o=this.locale,n=null;return 1===t.length?"string"==typeof t[0]?n=t[0]:l(t[0])&&(t[0].locale&&(o=t[0].locale),t[0].key&&(n=t[0].key)):2===t.length&&("string"==typeof t[0]&&(n=t[0]),"string"==typeof t[1]&&(o=t[1])),this._d(e,o,n)},Z.prototype.getNumberFormat=function(e){return m(this._vm.numberFormats[e]||{})},Z.prototype.setNumberFormat=function(e,t){this._vm.$set(this._vm.numberFormats,e,t)},Z.prototype.mergeNumberFormat=function(e,t){this._vm.$set(this._vm.numberFormats,e,x(this._vm.numberFormats[e]||{},t))},Z.prototype._getNumberFormatter=function(e,t,r,o,n,l){var h=t,c=o[h];if((f(c)||f(c[n]))&&(c=o[h=r]),f(c)||f(c[n]))return null;var d,m=c[n];if(l)d=new Intl.NumberFormat(h,Object.assign({},m,l));else{var v=h+"__"+n;(d=this._numberFormatters[v])||(d=this._numberFormatters[v]=new Intl.NumberFormat(h,m))}return d},Z.prototype._n=function(e,t,r,o){if(!Z.availabilities.numberFormat)return"";if(!r)return(o?new Intl.NumberFormat(t,o):new Intl.NumberFormat(t)).format(e);var n=this._getNumberFormatter(e,t,this.fallbackLocale,this._getNumberFormats(),r,o),l=n&&n.format(e);if(this._isFallbackRoot(l)){if(!this._root)throw Error("unexpected error");return this._root.$i18n.n(e,Object.assign({},{key:r,locale:t},o))}return l||""},Z.prototype.n=function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];var n=this.locale,h=null,c=null;return 1===t.length?"string"==typeof t[0]?h=t[0]:l(t[0])&&(t[0].locale&&(n=t[0].locale),t[0].key&&(h=t[0].key),c=Object.keys(t[0]).reduce((function(e,r){var n;return o.includes(r)?Object.assign({},e,((n={})[r]=t[0][r],n)):e}),null)):2===t.length&&("string"==typeof t[0]&&(h=t[0]),"string"==typeof t[1]&&(n=t[1])),this._n(e,n,h,c)},Z.prototype._ntp=function(e,t,r,o){if(!Z.availabilities.numberFormat)return[];if(!r)return(o?new Intl.NumberFormat(t,o):new Intl.NumberFormat(t)).formatToParts(e);var n=this._getNumberFormatter(e,t,this.fallbackLocale,this._getNumberFormats(),r,o),l=n&&n.formatToParts(e);if(this._isFallbackRoot(l)){if(!this._root)throw Error("unexpected error");return this._root.$i18n._ntp(e,t,r,o)}return l||[]},Object.defineProperties(Z.prototype,J),Object.defineProperty(Z,"availabilities",{get:function(){if(!j){var e="undefined"!=typeof Intl;j={dateTimeFormat:e&&void 0!==Intl.DateTimeFormat,numberFormat:e&&void 0!==Intl.NumberFormat}}return j}}),Z.install=V,Z.version="8.15.3",t.a=Z}}]);